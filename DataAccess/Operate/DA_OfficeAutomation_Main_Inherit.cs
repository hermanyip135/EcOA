using System;
using System.Collections.Generic;
using System.Text;
using System.Data.SqlClient;
using System.Data;

using DataEntity;

namespace DataAccess.Operate
{
    public class DA_OfficeAutomation_Main_Inherit : DA_OfficeAutomation_Main_Operate
    {
        #region 查询主表内容

        /// <summary>
        /// 查询主表内容
        /// </summary>
        /// <param name="mainID">主键</param>
        /// <returns></returns>
        public DataSet SelectByMainID(string mainID)
        {
            string sql = "SELECT  *"
                          + "   FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Main]"
                          + " WHERE [OfficeAutomation_Main_ID]='" + mainID + "'";

            return RunSQL(sql);
        }

        /// <summary>
        /// 根据文档编码查询主表内容
        /// </summary>
        /// <param name="mainID">主键</param>
        /// <returns></returns>
        public DataSet SelectBySerialNumber(string serialNumber)
        {
            string sql = "SELECT  *"
                          + "   FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Main]"
                          + " WHERE [OfficeAutomation_SerialNumber]='" + serialNumber + "'";

            return RunSQL(sql);
        }

        #endregion

        #region 标记 20151106
        /// <summary>
        /// 根据id给对应申请表备注,不进行重复标注。
        /// </summary>
        /// <param name="id"></param>
        /// <param name="deal"></param>
        /// <returns></returns>
        public bool AddSremarkByID(string mid, string remark)
        {
            string sql = "UPDATE [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Main]"
                                + "   SET [OfficeAutomation_Main_Sremark] = CASE WHEN [OfficeAutomation_Main_Sremark] IS NULL THEN '" + remark + "'"
                                + "                                                                                       WHEN CHARINDEX('" + remark + "',[OfficeAutomation_Main_Sremark])!=0 THEN [OfficeAutomation_Main_Sremark]"
                                + "                                                                                        ELSE  [OfficeAutomation_Main_Sremark] + ' " + remark + "' END"
                                + " WHERE [OfficeAutomation_Main_ID]='" + mid + "'";

            return RunNoneSQL(sql);
        }
        #endregion

        #region 用于审核后的流程状态的更新
        /// <summary>
        /// 用于审核后的流程状态的更新
        /// </summary>
        /// <param name="mainID"></param>
        public void UpdateFlowStateForAudit(string mainID)
        {
            string sql = "SELECT distinct [OfficeAutomation_Flow_Audit]"
                        + "    FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Flow]"
                        + "  WHERE OfficeAutomation_Flow_MainID= '" + mainID + "'";

            DataSet ds = new DataSet();
            ds = RunSQL(sql);

            if (ds != null && ds.Tables[0] != null && ds.Tables[0].Rows.Count > 0)
            {
                T_OfficeAutomation_Main t_OfficeAutomation_Main = new T_OfficeAutomation_Main();
                t_OfficeAutomation_Main.OfficeAutomation_Main_ID = new Guid(mainID);
                if (ds.Tables[0].Rows.Count > 1)
                {
                    t_OfficeAutomation_Main.OfficeAutomation_Main_FlowStateID = 2;//审核中
                    Update(t_OfficeAutomation_Main);
                }
                else if (ds.Tables[0].Rows.Count == 1)
                {
                    switch (ds.Tables[0].Rows[0][0].ToString())
                    {
                        case "False":
                            t_OfficeAutomation_Main.OfficeAutomation_Main_FlowStateID = 1;//未审核
                            Update(t_OfficeAutomation_Main);
                            break;
                        case "True":
                            t_OfficeAutomation_Main.OfficeAutomation_Main_FlowStateID = 3;//已审核
                            Update(t_OfficeAutomation_Main);
                            break;
                        default:
                            break;
                    }
                }
            }
        }
        #endregion
        /// <summary>
        /// 财务退单状态变未审核
        /// </summary>
        public void updateFlowCancel(string mainID)
        {
            string sql = "UPDATE t_OfficeAutomation_Main"
                        + "    SET  [OfficeAutomation_Main_FlowStateID]=1"
                        + "  WHERE OfficeAutomation_Main_ID='" + mainID + "'";
            RunSQL(sql);
        }
        /// <summary>
        /// 财务退单状态变未审核
        /// </summary>
        public void updateGroups(string mainID,string IsGroups)
        {
            string sql = "UPDATE t_OfficeAutomation_Main"
                        + "    SET  [OfficeAutomation_Main_IsGroups]='" + IsGroups + "'"
                        + "  WHERE OfficeAutomation_Main_ID='" + mainID + "'";
            RunSQL(sql);
        }
        #region 用于撤销审核后的流程状态的更新20141205
        /// <summary>
        /// 用于撤销审核后的流程状态的更新20141205
        /// </summary>
        /// <param name="mainID"></param>
        public void UpdateFlowForCancel(string mainID)
        {
            string sql = "SELECT distinct [OfficeAutomation_Flow_Audit]"
                        + "    FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Flow]"
                        + "  WHERE OfficeAutomation_Flow_MainID= '" + mainID + "'";

            DataSet ds = new DataSet();
            ds = RunSQL(sql);

            if (ds != null && ds.Tables[0].Rows.Count > 0)
            {
                T_OfficeAutomation_Main t_OfficeAutomation_Main = new T_OfficeAutomation_Main();
                //DA_OfficeAutomation_Main_Inherit da_OfficeAutomation_Main_Inherit = new DA_OfficeAutomation_Main_Inherit();
                t_OfficeAutomation_Main.OfficeAutomation_Main_ID = new Guid(mainID);
                t_OfficeAutomation_Main.OfficeAutomation_Main_IsBackUp = false;

                //da_OfficeAutomation_Main_Inherit.SetNullAuditorWhenFlow(mainID);
                if (ds.Tables[0].Rows.Count > 1)
                {
                    t_OfficeAutomation_Main.OfficeAutomation_Main_FlowStateID = 2;//审核中
                    UpdateAndBk(t_OfficeAutomation_Main);
                }
                else if (ds.Tables[0].Rows.Count == 1)
                {
                    sql = "SELECT TOP 1 OfficeAutomation_Flow_Auditor FROM t_OfficeAutomation_Flow"
                        + "    WHERE OfficeAutomation_Flow_MainID = '" + mainID + "'"
                        + "    ORDER BY OfficeAutomation_Flow_Idx";
                    ds = RunSQL(sql);
                    if (ds.Tables[0].Rows[0][0] == DBNull.Value)
                    {
                        t_OfficeAutomation_Main.OfficeAutomation_Main_FlowStateID = 1;//未审核
                        UpdateAndBk(t_OfficeAutomation_Main);
                    }
                }
            }
        }
        #endregion

        #region 获得流程状态
        /// <summary>
        /// 获得流程状态
        /// </summary>
        /// <param name="mainID"></param>
        /// <returns>1为未审核，2为审核中，3为已完成审核</returns>
        public string GetFlowState(string mainID)
        {
            string sql = "SELECT  OfficeAutomation_Main_FlowStateID FROM t_OfficeAutomation_Main WHERE  OfficeAutomation_Main_ID='" + mainID + "'";
            //return RunSQL(sql).Tables[0].Rows[0][0].ToString();

            DataSet ds = null;
            string result = string.Empty;
            ds = RunSQL(sql);

            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                result = ds.Tables[0].Rows[0][0].ToString();
            }

            return result;
        }
        #endregion

        #region 流程结束时，updateMain表的AuditorIDsSum，AuditorNamesSum字段
        /// <summary>
        /// 流程结束时，updateMain表的AuditorIDsSum，AuditorNamesSum字段
        /// 2014-3-25
        /// </summary>
        /// <param name="mainID"></param>
        /// <returns></returns>
        public bool UpdateAuditorWhenFlowEnd(string mainID)
        {
            string sql = "UPDATE t_OfficeAutomation_Main"
                        + "  SET  [OfficeAutomation_Main_AuditorIDsSum]=dbo.Fun_sum_employee(OfficeAutomation_Main_ID),"
                        + "         [OfficeAutomation_Main_AuditorNamesSum]=dbo.Fun_sum_employeeid(OfficeAutomation_Main_ID)"
                        + "  WHERE  OfficeAutomation_Main_ID='" + mainID + "'";
            return RunNoneSQL(sql);
        }

        /// <summary>
        /// 更新OfficeAutomation_Main_AuditorIDsSum、OfficeAutomation_Main_AuditorNamesSum、OfficeAutomation_Main_FlowStateID
        /// </summary>
        /// <param name="mainID"></param>
        /// <returns></returns>
        public bool UpdateWhenFlowEnd(string mainID)
        {
            string sql = "UPDATE t_OfficeAutomation_Main"
                        + "  SET [OfficeAutomation_Main_AuditorIDsSum]=dbo.Fun_sum_employeeid(OfficeAutomation_Main_ID),"
                        + "      [OfficeAutomation_Main_AuditorNamesSum]=dbo.Fun_sum_employee(OfficeAutomation_Main_ID),"
                        + "      [OfficeAutomation_Main_FlowStateID]=3"
                        + "  WHERE OfficeAutomation_Main_ID='" + mainID + "'";
            return RunNoneSQL(sql);
        }

        #endregion

        #region 流程未结束时，清空表的AuditorIDsSum，AuditorNamesSum字段
        /// <summary>
        /// 流程未结束时，清空表的AuditorIDsSum，AuditorNamesSum字段
        /// 20150105
        /// </summary>
        /// <param name="mainID"></param>
        /// <returns></returns>
        public bool SetNullAuditorWhenFlow(string mainID)
        {
            string sql = "UPDATE t_OfficeAutomation_Main"
                        + "  SET  [OfficeAutomation_Main_AuditorIDsSum]=NULL,"
                        + "         [OfficeAutomation_Main_AuditorNamesSum]=NULL"
                        + "  WHERE  OfficeAutomation_Main_ID='" + mainID + "'";
            return RunNoneSQL(sql);
        }
        #endregion

        #region 通过搜索，查询出各申请表列表
//        /// <summary>
//        /// 通过搜索，查询出各申请表列表
//        /// </summary>
//        /// <param name="isAdmin">是否管理员查询</param>
//        /// <param name="applicationDepartment"></param>
//        /// <param name="applicant"></param>
//        /// <param name="begin"></param>
//        /// <param name="end"></param>
//        /// <param name="applyType"></param>
//        /// <param name="state"></param>
//        /// <param name="purview">权限</param>
//        /// <returns></returns>
//        public DataSet Search(bool isAdmin, string applicationDepartment, string applicant, string begin, string end, string applyType, string state, string employee, string code, string purview, string serialNumber, string keyWord)
//        {
//            string myAgency = "";
//            DA_OfficeAutomation_Agent_Inherit da_OfficeAutomation_Agent_Inherit = new DA_OfficeAutomation_Agent_Inherit();
//            DataSet ds = da_OfficeAutomation_Agent_Inherit.GetMyAgencyForAgent(employee, code);
//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    myAgency += " OR (auditoridsum LIKE '%" + dr["OfficeAutomation_Agent_AuditorID"].ToString()
//                        + "%' AND auditorsum LIKE '%" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "%')";
//                }
//            }

//            string sql = "";

//            if (!isAdmin)
//            {
//                sql += "CREATE TABLE #a"
//                       + " ("
//                       + "    OfficeAutomation_Flow_MainID UNIQUEIDENTIFIER,"
//                       + "    auditorsum                   NVARCHAR(2000),"
//                       + "    auditoridsum                NVARCHAR(2000),"
//                       + "    DocumentID                 int"
//                       + "  )"
//                       + " INSERT INTO #a"
//                       + "                     (OfficeAutomation_Flow_MainID,"
//                       + "                      auditorsum,"
//                       + "                      auditoridsum)"
//                    //+ " SELECT *"
//                    //+ " FROM   vw_SumAuditor";
//                       + " SELECT OfficeAutomation_Flow_MainID,"
//                       + "            CASE WHEN toam.OfficeAutomation_Main_AuditorNamesSum IS NULL then dbo.Fun_sum_employee(OfficeAutomation_Flow_MainID) ELSE toam.OfficeAutomation_Main_AuditorNamesSum END   AS auditorsum,"
//                       + "            CASE WHEN toam.OfficeAutomation_Main_AuditorIDsSum IS NULL then dbo.Fun_sum_employeeid(OfficeAutomation_Flow_MainID) ELSE toam.OfficeAutomation_Main_AuditorIDsSum END   AS auditoridsum"
//                       + " FROM  dbo.t_OfficeAutomation_Flow AS toaf"
//                       + "            LEFT JOIN t_OfficeAutomation_Main toam"
//                       + "                      ON toaf.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID"
//                       + " WHERE 1=1";

//                if (state != "")
//                    sql += " AND toam.OfficeAutomation_Main_FlowStateID=" + state;
//                if (applyType != "")
//                    sql += " AND toam.OfficeAutomation_DocumentID=" + applyType;
//                if (serialNumber != "")
//                    sql += " AND toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//                sql += " GROUP BY OfficeAutomation_Flow_MainID,OfficeAutomation_Main_AuditorNamesSum,OfficeAutomation_Main_AuditorIDsSum";
//            }

//            string itpower = " SELECT [OfficeAutomation_Document_ITPower_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ITPower_MainID] as MainID"
//                 + "          ,[OfficeAutomation_Document_ITPower_DepartmentID] as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ITPower_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ITPower_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ITPower_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITPower_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITPower_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,todi.OfficeAutomation_Document_ITPower_Deal as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ITPower] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ITPower_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_005"))
//                itpower += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            itpower += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_005"))
//                itpower += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ITPower_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    itpower += "  OR OfficeAutomation_Document_ITPower_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                itpower += " and OfficeAutomation_Document_ITPower_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                itpower += " and OfficeAutomation_Document_ITPower_Apply = '" + applicant + "'";

//            if (begin != "")
//                itpower += " and OfficeAutomation_Document_ITPower_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                itpower += " and OfficeAutomation_Document_ITPower_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                itpower += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                itpower += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                itpower += " and [OfficeAutomation_Document_ITPower_ApplyReason] like '%" + keyWord + "%'";

//            string sysreq = " SELECT [OfficeAutomation_Document_SysReq_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_SysReq_MainID] as MainID"
//                 + "          ,[OfficeAutomation_Document_SysReq_DepartmentID] as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_SysReq_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_SysReq_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_SysReq_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysReq_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysReq_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,'' as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SysReq] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SysReq_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_007"))
//                sysreq += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            sysreq += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_007"))
//                sysreq += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SysReq_Apply='" + employee + "')";

//            if (!isAdmin && !purview.Contains("OA_Search_007")) //20140919-跟进人也能看到审批表
//                sysreq += " or OfficeAutomation_Document_SysReq_Follower Like '%" + employee + "%'";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    sysreq += "  OR OfficeAutomation_Document_SysReq_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                sysreq += " and OfficeAutomation_Document_SysReq_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                sysreq += " and OfficeAutomation_Document_SysReq_Apply = '" + applicant + "'";

//            if (begin != "")
//                sysreq += " and OfficeAutomation_Document_SysReq_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                sysreq += " and OfficeAutomation_Document_SysReq_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                sysreq += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                sysreq += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                sysreq += " and [OfficeAutomation_Document_SysReq_ReqContent] like '%" + keyWord + "%'";

//            string syspower = " SELECT [OfficeAutomation_Document_SysPower_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_SysPower_MainID] as MainID"
//                 + "          ,[OfficeAutomation_Document_SysPower_DepartmentID] as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_SysPower_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_SysPower_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_SysPower_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysPower_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysPower_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,todi.OfficeAutomation_Document_SysPower_Deal as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SysPower] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SysPower_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_006"))
//                syspower += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            syspower += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_006"))
//                syspower += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SysPower_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    syspower += "  OR OfficeAutomation_Document_SysPower_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                syspower += " and OfficeAutomation_Document_SysPower_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                syspower += " and OfficeAutomation_Document_SysPower_Apply = '" + applicant + "'";

//            if (begin != "")
//                syspower += " and OfficeAutomation_Document_SysPower_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                syspower += " and OfficeAutomation_Document_SysPower_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                syspower += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                syspower += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                syspower += " and [OfficeAutomation_Document_SysPower_ReqContent] like '%" + keyWord + "%'";

//            string scrap = " SELECT [OfficeAutomation_Document_Scrap_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_Scrap_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_Scrap_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_Scrap_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_Scrap_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Scrap_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Scrap_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,todi.[OfficeAutomation_Document_Scrap_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Scrap] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Scrap_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_009"))
//                scrap += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            scrap += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_009"))
//                scrap += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Scrap_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    scrap += "  OR OfficeAutomation_Document_Scrap_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                scrap += " and OfficeAutomation_Document_Scrap_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                scrap += " and OfficeAutomation_Document_Scrap_Apply = '" + applicant + "'";

//            if (begin != "")
//                scrap += " and OfficeAutomation_Document_Scrap_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                scrap += " and OfficeAutomation_Document_Scrap_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                scrap += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                scrap += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                scrap += " and [OfficeAutomation_Document_Scrap_ReqReason] like '%" + keyWord + "%'";

//            string assettransfer = " SELECT [OfficeAutomation_Document_AssetTransfer_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AssetTransfer_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AssetTransfer_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_AssetTransfer] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_AssetTransfer_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_010"))
//                assettransfer += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            assettransfer += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_010"))
//                assettransfer += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_AssetTransfer_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    assettransfer += "  OR OfficeAutomation_Document_AssetTransfer_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                assettransfer += " and OfficeAutomation_Document_AssetTransfer_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                assettransfer += " and OfficeAutomation_Document_AssetTransfer_Apply = '" + applicant + "'";

//            if (begin != "")
//                assettransfer += " and OfficeAutomation_Document_AssetTransfer_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                assettransfer += " and OfficeAutomation_Document_AssetTransfer_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                assettransfer += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                assettransfer += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                assettransfer += " and OfficeAutomation_Document_AssetTransfer_TransferReason like '%" + keyWord + "%'";

//            string dealoffice = " SELECT [OfficeAutomation_Document_DealOffice_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_DealOffice_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_DealOffice_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_DealOffice_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_DealOffice_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,'' as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_DealOffice] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_DealOffice_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_011"))
//                dealoffice += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            dealoffice += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_011"))
//                dealoffice += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_DealOffice_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    dealoffice += "  OR OfficeAutomation_Document_DealOffice_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                dealoffice += " and OfficeAutomation_Document_DealOffice_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                dealoffice += " and OfficeAutomation_Document_DealOffice_Apply = '" + applicant + "'";

//            if (begin != "")
//                dealoffice += " and OfficeAutomation_Document_DealOffice_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                dealoffice += " and OfficeAutomation_Document_DealOffice_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                dealoffice += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                dealoffice += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                dealoffice += " and ([OfficeAutomation_Document_DealOffice_CrossAreaRemark] like '%" + keyWord + "%' OR [OfficeAutomation_Document_DealOffice_MoneyRemark] like '%" + keyWord + "%')";

//            string itbuy = " SELECT [OfficeAutomation_Document_ITBuy_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ITBuy_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ITBuy_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ITBuy_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ITBuy_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITBuy_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITBuy_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ITBuy_ApplyID]+' '+case when [OfficeAutomation_Document_ITBuy_Remark]!='' then '√' else '' end as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ITBuy] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ITBuy_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_008"))
//                itbuy += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            itbuy += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_008"))
//                itbuy += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ITBuy_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    itbuy += "  OR OfficeAutomation_Document_ITBuy_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                itbuy += " and OfficeAutomation_Document_ITBuy_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                itbuy += " and OfficeAutomation_Document_ITBuy_Apply = '" + applicant + "'";

//            if (begin != "")
//                itbuy += " and OfficeAutomation_Document_ITBuy_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                itbuy += " and OfficeAutomation_Document_ITBuy_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                itbuy += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                itbuy += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                itbuy += " and OfficeAutomation_Document_ITBuy_Reason like '%" + keyWord + "%'";

//            string persinterests = " SELECT [OfficeAutomation_Document_PersInterests_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_PersInterests_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_PersInterests_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_PersInterests_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_PersInterests_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PersInterests_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PersInterests_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_PersInterests_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_PersInterests] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_PersInterests_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_012"))
//                persinterests += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            persinterests += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_012"))
//                persinterests += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_PersInterests_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    persinterests += "  OR OfficeAutomation_Document_PersInterests_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                persinterests += " and OfficeAutomation_Document_PersInterests_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                persinterests += " and OfficeAutomation_Document_PersInterests_Apply = '" + applicant + "'";

//            if (begin != "")
//                persinterests += " and OfficeAutomation_Document_PersInterests_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                persinterests += " and OfficeAutomation_Document_PersInterests_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                persinterests += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                persinterests += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                persinterests += " and OfficeAutomation_Document_PersInterests_ApplyDetail like '%" + keyWord + "%'";

//            string buybuilding = " SELECT [OfficeAutomation_Document_BuyBuilding_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BuyBuilding] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BuyBuilding_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_013"))
//                buybuilding += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            buybuilding += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_013"))
//                buybuilding += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BuyBuilding_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    buybuilding += "  OR OfficeAutomation_Document_BuyBuilding_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                buybuilding += " and OfficeAutomation_Document_BuyBuilding_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                buybuilding += " and OfficeAutomation_Document_BuyBuilding_Apply = '" + applicant + "'";

//            if (begin != "")
//                buybuilding += " and OfficeAutomation_Document_BuyBuilding_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                buybuilding += " and OfficeAutomation_Document_BuyBuilding_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                buybuilding += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                buybuilding += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                buybuilding += " and OfficeAutomation_Document_BuyBuilding_SpecialRequest like '%" + keyWord + "%'";

//            string carallowance = " SELECT [OfficeAutomation_Document_CarAllowance_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CarAllowance] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CarAllowance_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_014"))
//                carallowance += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            carallowance += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_014"))
//                carallowance += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CarAllowance_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    carallowance += "  OR OfficeAutomation_Document_CarAllowance_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                carallowance += " and OfficeAutomation_Document_CarAllowance_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                carallowance += " and OfficeAutomation_Document_CarAllowance_Apply = '" + applicant + "'";

//            if (begin != "")
//                carallowance += " and OfficeAutomation_Document_CarAllowance_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                carallowance += " and OfficeAutomation_Document_CarAllowance_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                carallowance += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                carallowance += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            //if (keyWord != "")
//            //    carallowance += " and OfficeAutomation_Document_BuyBuilding_SpecialRequest like '%" + keyWord + "%'";

//            string backcomm = " SELECT [OfficeAutomation_Document_BackComm_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_BackComm_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_BackComm_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_BackComm_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_BackComm_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BackComm_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BackComm_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_BackComm_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BackComm] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BackComm_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_015"))
//                backcomm += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            backcomm += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_015"))
//                backcomm += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BackComm_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    backcomm += "  OR OfficeAutomation_Document_BackComm_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                backcomm += " and OfficeAutomation_Document_BackComm_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                backcomm += " and OfficeAutomation_Document_BackComm_Apply = '" + applicant + "'";

//            if (begin != "")
//                backcomm += " and OfficeAutomation_Document_BackComm_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                backcomm += " and OfficeAutomation_Document_BackComm_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                backcomm += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                backcomm += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                backcomm += " and ([OfficeAutomation_Document_BackComm_Reason] like '%" + keyWord + "%' OR [OfficeAutomation_Document_BackComm_Measure] like '%" + keyWord + "%')";

//            string baddebts = " SELECT [OfficeAutomation_Document_BadDebts_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_BadDebts_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_BadDebts_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_BadDebts_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_BadDebts_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_BadDebts_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BadDebts] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BadDebts_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_016"))
//                baddebts += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            baddebts += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_016"))
//                baddebts += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BadDebts_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    baddebts += "  OR OfficeAutomation_Document_BadDebts_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                baddebts += " and OfficeAutomation_Document_BadDebts_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                baddebts += " and OfficeAutomation_Document_BadDebts_Apply = '" + applicant + "'";

//            if (begin != "" && end != "")
//                baddebts += " and OfficeAutomation_Document_BadDebts_ApplyDate between '" + begin + " 00:00:00' and '" + end + " 23:59:59'";

//            if (state != "")
//                baddebts += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                baddebts += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                baddebts += " and [OfficeAutomation_Document_BadDebts_Reason] like '%" + keyWord + "%'";

//            string reducecomm = " SELECT [OfficeAutomation_Document_ReduceComm_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ReduceComm] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ReduceComm_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_017"))
//                reducecomm += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            reducecomm += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_017"))
//                reducecomm += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ReduceComm_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    reducecomm += "  OR OfficeAutomation_Document_ReduceComm_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                reducecomm += " and OfficeAutomation_Document_ReduceComm_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                reducecomm += " and OfficeAutomation_Document_ReduceComm_Apply = '" + applicant + "'";

//            if (begin != "")
//                reducecomm += " and OfficeAutomation_Document_ReduceComm_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                reducecomm += " and OfficeAutomation_Document_ReduceComm_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                reducecomm += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                reducecomm += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                reducecomm += " and [OfficeAutomation_Document_ReduceComm_Reason] like '%" + keyWord + "%'";

//            string projcost = " SELECT [OfficeAutomation_Document_ProjCost_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ProjCost_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ProjCost_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ProjCost_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ProjCost_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjCost_Project] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjCost] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjCost_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_018"))
//                projcost += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            projcost += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_018"))
//                projcost += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjCost_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    projcost += "  OR OfficeAutomation_Document_ProjCost_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                projcost += " and OfficeAutomation_Document_ProjCost_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                projcost += " and OfficeAutomation_Document_ProjCost_Apply = '" + applicant + "'";

//            if (begin != "")
//                projcost += " and OfficeAutomation_Document_ProjCost_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                projcost += " and OfficeAutomation_Document_ProjCost_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                projcost += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                projcost += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                projcost += " and [OfficeAutomation_Document_ProjCost_Project] like '%" + keyWord + "%'";

//            string coopcost = " SELECT [OfficeAutomation_Document_CoopCost_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_CoopCost_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_CoopCost_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_CoopCost_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_CoopCost_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_CoopCost_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CoopCost] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CoopCost_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_019"))
//                coopcost += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            coopcost += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_019"))
//                coopcost += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CoopCost_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    coopcost += "  OR OfficeAutomation_Document_CoopCost_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                coopcost += " and OfficeAutomation_Document_CoopCost_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                coopcost += " and OfficeAutomation_Document_CoopCost_Apply = '" + applicant + "'";

//            if (begin != "")
//                coopcost += " and OfficeAutomation_Document_CoopCost_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                coopcost += " and OfficeAutomation_Document_CoopCost_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                coopcost += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                coopcost += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                coopcost += " and [OfficeAutomation_Document_CoopCost_Reason] like '%" + keyWord + "%'";


//            string undertakeproj = " SELECT [OfficeAutomation_Document_UndertakeProj_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_UndertakeProj_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_UndertakeProj_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_UndertakeProj_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_UndertakeProj_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,OfficeAutomation_Document_UndertakeProj_Project as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_UndertakeProj] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_UndertakeProj_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_020"))
//                undertakeproj += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            undertakeproj += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_020"))
//                undertakeproj += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_UndertakeProj_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    undertakeproj += "  OR OfficeAutomation_Document_UndertakeProj_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_Apply = '" + applicant + "'";

//            if (begin != "")
//                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                undertakeproj += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                undertakeproj += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                undertakeproj += " and [OfficeAutomation_Document_UndertakeProj_Project] like '%" + keyWord + "%'";

//            string extrabonus = " SELECT [OfficeAutomation_Document_ExtraBonus_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_Project] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ExtraBonus] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ExtraBonus_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_021"))
//                extrabonus += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            extrabonus += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_021"))
//                extrabonus += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ExtraBonus_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    extrabonus += "  OR OfficeAutomation_Document_ExtraBonus_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                extrabonus += " and OfficeAutomation_Document_ExtraBonus_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                extrabonus += " and OfficeAutomation_Document_ExtraBonus_Apply = '" + applicant + "'";

//            if (begin != "")
//                extrabonus += " and OfficeAutomation_Document_ExtraBonus_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                extrabonus += " and OfficeAutomation_Document_ExtraBonus_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                extrabonus += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                extrabonus += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                extrabonus += " and [OfficeAutomation_Document_ExtraBonus_Project] like '%" + keyWord + "%'";

//            string resumebusi = " SELECT [OfficeAutomation_Document_ResumeBusi_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ResumeBusi_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ResumeBusi_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ResumeBusi] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ResumeBusi_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_022"))
//                resumebusi += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            resumebusi += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_022"))
//                resumebusi += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ResumeBusi_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    resumebusi += "  OR OfficeAutomation_Document_ResumeBusi_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                resumebusi += " and OfficeAutomation_Document_ResumeBusi_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                resumebusi += " and OfficeAutomation_Document_ResumeBusi_Apply = '" + applicant + "'";

//            if (begin != "")
//                resumebusi += " and OfficeAutomation_Document_ResumeBusi_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                resumebusi += " and OfficeAutomation_Document_ResumeBusi_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                resumebusi += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                resumebusi += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                resumebusi += " and [OfficeAutomation_Document_ResumeBusi_Reason] like '%" + keyWord + "%'";

//            string withdrawshop = " SELECT [OfficeAutomation_Document_WithdrawShop_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WithdrawShop_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WithdrawShop_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_WithdrawShop] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_WithdrawShop_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_023"))
//                withdrawshop += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            withdrawshop += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_023"))
//                withdrawshop += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_WithdrawShop_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    withdrawshop += "  OR OfficeAutomation_Document_WithdrawShop_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                withdrawshop += " and OfficeAutomation_Document_WithdrawShop_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                withdrawshop += " and OfficeAutomation_Document_WithdrawShop_Apply = '" + applicant + "'";

//            if (begin != "")
//                withdrawshop += " and OfficeAutomation_Document_WithdrawShop_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                withdrawshop += " and OfficeAutomation_Document_WithdrawShop_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                withdrawshop += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                withdrawshop += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                withdrawshop += " and [OfficeAutomation_Document_WithdrawShop_Reason] like '%" + keyWord + "%'";

//            string suspendbusi = " SELECT [OfficeAutomation_Document_SuspendBusi_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SuspendBusi_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SuspendBusi_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SuspendBusi] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SuspendBusi_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_024"))
//                suspendbusi += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            suspendbusi += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_024"))
//                suspendbusi += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SuspendBusi_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    suspendbusi += "  OR OfficeAutomation_Document_SuspendBusi_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                suspendbusi += " and OfficeAutomation_Document_SuspendBusi_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                suspendbusi += " and OfficeAutomation_Document_SuspendBusi_Apply = '" + applicant + "'";

//            if (begin != "")
//                suspendbusi += " and OfficeAutomation_Document_SuspendBusi_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                suspendbusi += " and OfficeAutomation_Document_SuspendBusi_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                suspendbusi += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                suspendbusi += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                suspendbusi += " and [OfficeAutomation_Document_SuspendBusi_Reason] like '%" + keyWord + "%'";

//            string projagentclause = " SELECT [OfficeAutomation_Document_ProjAgentClause_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_ProjName] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjAgentClause] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjAgentClause_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_025"))
//                projagentclause += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            projagentclause += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_025"))
//                projagentclause += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjAgentClause_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    projagentclause += "  OR OfficeAutomation_Document_ProjAgentClause_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_Apply = '" + applicant + "'";

//            if (begin != "")
//                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                projagentclause += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                projagentclause += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                projagentclause += " and [OfficeAutomation_Document_ProjAgentClause_Reason] like '%" + keyWord + "%'";

//            string projworkcloth = " SELECT [OfficeAutomation_Document_ProjWorkCloth_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjWorkCloth_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjWorkCloth_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_ProjName] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjWorkCloth] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjWorkCloth_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_026"))
//                projworkcloth += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            projworkcloth += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_026"))
//                projworkcloth += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjWorkCloth_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    projworkcloth += "  OR OfficeAutomation_Document_ProjWorkCloth_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                projworkcloth += " and OfficeAutomation_Document_ProjWorkCloth_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                projworkcloth += " and OfficeAutomation_Document_ProjWorkCloth_Apply = '" + applicant + "'";

//            if (begin != "")
//                projworkcloth += " and OfficeAutomation_Document_ProjWorkCloth_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                projworkcloth += " and OfficeAutomation_Document_ProjWorkCloth_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                projworkcloth += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                projworkcloth += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                projworkcloth += " and [OfficeAutomation_Document_ProjWorkCloth_Reason] like '%" + keyWord + "%'";

//            string projdormsubsiby = " SELECT [OfficeAutomation_Document_ProjDormSubsiby_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_ProjName] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjDormSubsiby] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjDormSubsiby_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_027"))
//                projdormsubsiby += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            projdormsubsiby += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_027"))
//                projdormsubsiby += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjDormSubsiby_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    projdormsubsiby += "  OR OfficeAutomation_Document_ProjDormSubsiby_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_Apply = '" + applicant + "'";

//            if (begin != "")
//                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                projdormsubsiby += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                projdormsubsiby += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                projdormsubsiby += " and [OfficeAutomation_Document_ProjDormSubsiby_ProjName] like '%" + keyWord + "%'";

//            string projrepodata = " SELECT [OfficeAutomation_Document_ProjRepoData_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_ProjName] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjRepoData] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjRepoData_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_028"))
//                projrepodata += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            projrepodata += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_028"))
//                projrepodata += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjRepoData_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    projrepodata += "  OR OfficeAutomation_Document_ProjRepoData_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                projrepodata += " and OfficeAutomation_Document_ProjRepoData_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                projrepodata += " and OfficeAutomation_Document_ProjRepoData_Apply = '" + applicant + "'";

//            if (begin != "")
//                projrepodata += " and OfficeAutomation_Document_ProjRepoData_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                projrepodata += " and OfficeAutomation_Document_ProjRepoData_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                projrepodata += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                projrepodata += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                projrepodata += " and [OfficeAutomation_Document_ProjRepoData_Reason] like '%" + keyWord + "%'";


//            string projlinkrepodata = " SELECT [OfficeAutomation_Document_ProjLinkRepoData_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 //+ "                      FROM   t_OfficeAutomation_Flow f"
//                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID]"
//                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 //+ "             WHEN 3 THEN '已完成'"
//                 //+ "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_ProjName] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjLinkRepoData] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjLinkRepoData_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_029"))
//                projlinkrepodata += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            projlinkrepodata += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_029"))
//                projlinkrepodata += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjLinkRepoData_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    projlinkrepodata += "  OR OfficeAutomation_Document_ProjLinkRepoData_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                projlinkrepodata += " and OfficeAutomation_Document_ProjLinkRepoData_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                projlinkrepodata += " and OfficeAutomation_Document_ProjLinkRepoData_Apply = '" + applicant + "'";

//            if (begin != "")
//                projlinkrepodata += " and OfficeAutomation_Document_ProjLinkRepoData_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                projlinkrepodata += " and OfficeAutomation_Document_ProjLinkRepoData_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                projlinkrepodata += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                projlinkrepodata += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                projlinkrepodata += " and [OfficeAutomation_Document_ProjLinkRepoData_ProjName] like '%" + keyWord + "%'";


//            string ChangeData = " SELECT [OfficeAutomation_Document_ChangeData_ID] as ID"
//                + "          ,[OfficeAutomation_Document_ChangeData_MainID] as MainID"
//                + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                + "          ,[OfficeAutomation_Document_ChangeData_Department] as Department"
//                + "          ,[OfficeAutomation_Document_ChangeData_ApplyDate] as ApplyDate"
//                + "          ,[OfficeAutomation_Document_ChangeData_Apply] as Apply"
//                + "          ,toam.OfficeAutomation_SerialNumber"
//                + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                //+ "                      FROM   t_OfficeAutomation_Flow f"
//                //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeData_MainID]"
//                //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                //+ "                      FROM   t_OfficeAutomation_Flow f"
//                //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeData_MainID]"
//                //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                //+ "             WHEN 3 THEN '已完成'"
//                //+ "           END AS [waitfor]"
//                + "          ,tdoad.OfficeAutomation_Document_Name"
//                + "          ,[OfficeAutomation_Document_ChangeData_Reason] as Remark"
//                + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ChangeData] todi"
//                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ChangeData_MainID"
//                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_032"))
//                ChangeData += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            ChangeData += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_032"))
//                ChangeData += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ChangeData_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    ChangeData += "  OR OfficeAutomation_Document_ChangeData_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                ChangeData += " and OfficeAutomation_Document_ChangeData_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                ChangeData += " and OfficeAutomation_Document_ChangeData_Apply = '" + applicant + "'";

//            if (begin != "")
//                ChangeData += " and OfficeAutomation_Document_ChangeData_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                ChangeData += " and OfficeAutomation_Document_ChangeData_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                ChangeData += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                ChangeData += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                ChangeData += " and [OfficeAutomation_Document_ChangeData_Reason] like '%" + keyWord + "%'";

//            string CommissionAdjust = " SELECT [OfficeAutomation_Document_CommissionAdjust_ID] as ID"
//    + "          ,[OfficeAutomation_Document_CommissionAdjust_MainID] as MainID"
//    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//    + "          ,[OfficeAutomation_Document_CommissionAdjust_Department] as Department"
//    + "          ,[OfficeAutomation_Document_CommissionAdjust_ApplyDate] as ApplyDate"
//    + "          ,[OfficeAutomation_Document_CommissionAdjust_Apply] as Apply"
//    + "          ,toam.OfficeAutomation_SerialNumber"
//    + "          ,toam.OfficeAutomation_Main_FlowStateID"
//    //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//    //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//    //+ "                      FROM   t_OfficeAutomation_Flow f"
//    //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAdjust_MainID]"
//    //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//    //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//    //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//    //+ "                      FROM   t_OfficeAutomation_Flow f"
//    //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAdjust_MainID]"
//    //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//    //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//    //+ "             WHEN 3 THEN '已完成'"
//    //+ "           END AS [waitfor]"
//    + "          ,tdoad.OfficeAutomation_Document_Name"
//    + "          ,[OfficeAutomation_Document_CommissionAdjust_Property] as Remark"
//    + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CommissionAdjust] todi"
//    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CommissionAdjust_MainID"
//    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_033"))
//                CommissionAdjust += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            CommissionAdjust += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_033"))
//                CommissionAdjust += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CommissionAdjust_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    CommissionAdjust += "  OR OfficeAutomation_Document_CommissionAdjust_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                CommissionAdjust += " and OfficeAutomation_Document_CommissionAdjust_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                CommissionAdjust += " and OfficeAutomation_Document_CommissionAdjust_Apply = '" + applicant + "'";

//            if (begin != "")
//                CommissionAdjust += " and OfficeAutomation_Document_CommissionAdjust_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                CommissionAdjust += " and OfficeAutomation_Document_CommissionAdjust_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                CommissionAdjust += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                CommissionAdjust += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                CommissionAdjust += " and [OfficeAutomation_Document_CommissionAdjust_Property] like '%" + keyWord + "%'";

//            string WirelessFixedLine = " SELECT [OfficeAutomation_Document_WirelessFixedLine_ID] as ID"
//                    + "          ,[OfficeAutomation_Document_WirelessFixedLine_MainID] as MainID"
//                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                    + "          ,'项目部' as Department"
//                    + "          ,[OfficeAutomation_Document_WirelessFixedLine_ApplyDate] as ApplyDate"
//                    + "          ,[OfficeAutomation_Document_WirelessFixedLine_Apply] as Apply"
//                    + "          ,toam.OfficeAutomation_SerialNumber"
//                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                    //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                    //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                    //+ "                      FROM   t_OfficeAutomation_Flow f"
//                    //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WirelessFixedLine_MainID]"
//                    //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                    //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                    //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                    //+ "                      FROM   t_OfficeAutomation_Flow f"
//                    //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WirelessFixedLine_MainID]"
//                    //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                    //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                    //+ "             WHEN 3 THEN '已完成'"
//                    //+ "           END AS [waitfor]"
//                    + "          ,tdoad.OfficeAutomation_Document_Name"
//                    + "          ,[OfficeAutomation_Document_WirelessFixedLine_ApplyID] as Remark"
//                    + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_WirelessFixedLine] todi"
//                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_WirelessFixedLine_MainID"
//                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_034"))
//                WirelessFixedLine += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            WirelessFixedLine += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_034"))
//                WirelessFixedLine += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_WirelessFixedLine_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    WirelessFixedLine += "  OR OfficeAutomation_Document_WirelessFixedLine_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            //if (applicationDepartment != "")
//            //    WirelessFixedLine += " and OfficeAutomation_Document_WirelessFixedLine_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                WirelessFixedLine += " and OfficeAutomation_Document_WirelessFixedLine_Apply = '" + applicant + "'";

//            if (begin != "")
//                WirelessFixedLine += " and OfficeAutomation_Document_WirelessFixedLine_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                WirelessFixedLine += " and OfficeAutomation_Document_WirelessFixedLine_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                WirelessFixedLine += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                WirelessFixedLine += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                WirelessFixedLine += " and [OfficeAutomation_Document_WirelessFixedLine_ApplyID] like '%" + keyWord + "%'";

//            string FurtherEducation = " SELECT [OfficeAutomation_Document_FurtherEducation_ID] as ID"
//        + "          ,[OfficeAutomation_Document_FurtherEducation_MainID] as MainID"
//        + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//        + "          ,[OfficeAutomation_Document_FurtherEducation_Department] as Department"
//        + "          ,[OfficeAutomation_Document_FurtherEducation_ApplyDate] as ApplyDate"
//        + "          ,[OfficeAutomation_Document_FurtherEducation_Apply] as Apply"
//        + "          ,toam.OfficeAutomation_SerialNumber"
//        + "          ,toam.OfficeAutomation_Main_FlowStateID"
//        //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//        //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//        //+ "                      FROM   t_OfficeAutomation_Flow f"
//        //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID]"
//        //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//        //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//        //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//        //+ "                      FROM   t_OfficeAutomation_Flow f"
//        //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID]"
//        //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//        //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//        //+ "             WHEN 3 THEN '已完成'"
//        //+ "           END AS [waitfor]"
//        + "          ,tdoad.OfficeAutomation_Document_Name"
//        + "          ,[OfficeAutomation_Document_FurtherEducation_School] as Remark"
//        + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//        + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_FurtherEducation] todi"
//        + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_FurtherEducation_MainID"
//        + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//        + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_035"))
//                FurtherEducation += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            FurtherEducation += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_035"))
//                FurtherEducation += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_FurtherEducation_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    FurtherEducation += "  OR OfficeAutomation_Document_FurtherEducation_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_Apply = '" + applicant + "'";

//            if (begin != "")
//                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                FurtherEducation += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                FurtherEducation += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                FurtherEducation += " and [OfficeAutomation_Document_FurtherEducation_School] like '%" + keyWord + "%'";

//            string SpecialNumber = " SELECT [OfficeAutomation_Document_SpecialNumber_ID] as ID"
//                    + "          ,[OfficeAutomation_Document_SpecialNumber_MainID] as MainID"
//                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                    + "          ,[OfficeAutomation_Document_SpecialNumber_Department] as Department"
//                    + "          ,[OfficeAutomation_Document_SpecialNumber_ApplyDate] as ApplyDate"
//                    + "          ,[OfficeAutomation_Document_SpecialNumber_Apply] as Apply"
//                    + "          ,toam.OfficeAutomation_SerialNumber"
//                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                    //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                    //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                    //+ "                      FROM   t_OfficeAutomation_Flow f"
//                    //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID]"
//                    //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                    //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                    //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                    //+ "                      FROM   t_OfficeAutomation_Flow f"
//                    //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID]"
//                    //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                    //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                    //+ "             WHEN 3 THEN '已完成'"
//                    //+ "           END AS [waitfor]"
//                    + "          ,tdoad.OfficeAutomation_Document_Name"
//                    + "          ,[OfficeAutomation_Document_SpecialNumber_Subject] as Remark"
//                    + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SpecialNumber] todi"
//                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SpecialNumber_MainID"
//                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_036"))
//                SpecialNumber += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            SpecialNumber += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_036"))
//                SpecialNumber += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SpecialNumber_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    SpecialNumber += "  OR OfficeAutomation_Document_SpecialNumber_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                SpecialNumber += " and OfficeAutomation_Document_SpecialNumber_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                SpecialNumber += " and OfficeAutomation_Document_SpecialNumber_Apply = '" + applicant + "'";

//            if (begin != "")
//                SpecialNumber += " and OfficeAutomation_Document_SpecialNumber_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                SpecialNumber += " and OfficeAutomation_Document_SpecialNumber_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                SpecialNumber += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                SpecialNumber += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                SpecialNumber += " and [OfficeAutomation_Document_SpecialNumber_Subject] like '%" + keyWord + "%'";

//            string OfficialSeal = " SELECT [OfficeAutomation_Document_OfficialSeal_ID] as ID"
//        + "          ,[OfficeAutomation_Document_OfficialSeal_MainID] as MainID"
//        + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//        + "          ,[OfficeAutomation_Document_OfficialSeal_Department] as Department"
//        + "          ,[OfficeAutomation_Document_OfficialSeal_ApplyDate] as ApplyDate"
//        + "          ,[OfficeAutomation_Document_OfficialSeal_Apply] as Apply"
//        + "          ,toam.OfficeAutomation_SerialNumber"
//        + "          ,toam.OfficeAutomation_Main_FlowStateID"
//        //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//        //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//        //+ "                      FROM   t_OfficeAutomation_Flow f"
//        //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID]"
//        //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//        //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//        //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//        //+ "                      FROM   t_OfficeAutomation_Flow f"
//        //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID]"
//        //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//        //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//        //+ "             WHEN 3 THEN '已完成'"
//        //+ "           END AS [waitfor]"
//        + "          ,tdoad.OfficeAutomation_Document_Name"
//        + "          ,(SELECT OfficeAutomation_Document_OfficialSeal_Detail_TransFile + '；' FROM t_OfficeAutomation_Document_OfficialSeal_Detail WHERE OfficeAutomation_Document_OfficialSeal_Detail_MainID = OfficeAutomation_Document_OfficialSeal_ID FOR XML PATH('')) as Remark"
//        + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//        + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_OfficialSeal] todi"
//        + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_OfficialSeal_MainID"
//        + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//        + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_037"))
//                OfficialSeal += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            OfficialSeal += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_037"))
//                OfficialSeal += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_OfficialSeal_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    OfficialSeal += "  OR OfficeAutomation_Document_OfficialSeal_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_Apply = '" + applicant + "'";

//            if (begin != "")
//                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                OfficialSeal += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                OfficialSeal += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                OfficialSeal += " and (SELECT OfficeAutomation_Document_OfficialSeal_Detail_TransFile + '；' FROM t_OfficeAutomation_Document_OfficialSeal_Detail WHERE OfficeAutomation_Document_OfficialSeal_Detail_MainID = OfficeAutomation_Document_OfficialSeal_ID FOR XML PATH('')) like '%" + keyWord + "%'";

//            string BranchContract = " SELECT [OfficeAutomation_Document_BranchContract_ID] as ID"
//                + "          ,[OfficeAutomation_Document_BranchContract_MainID] as MainID"
//                + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                + "          ,[OfficeAutomation_Document_BranchContract_Department] as Department"
//                + "          ,[OfficeAutomation_Document_BranchContract_ApplyDate] as ApplyDate"
//                + "          ,[OfficeAutomation_Document_BranchContract_Apply] as Apply"
//                + "          ,toam.OfficeAutomation_SerialNumber"
//                + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                //+ "                      FROM   t_OfficeAutomation_Flow f"
//                //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BranchContract_MainID]"
//                //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                //+ "                      FROM   t_OfficeAutomation_Flow f"
//                //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BranchContract_MainID]"
//                //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                //+ "             WHEN 3 THEN '已完成'"
//                //+ "           END AS [waitfor]"
//                + "          ,tdoad.OfficeAutomation_Document_Name"
//                + "          ,[OfficeAutomation_Document_BranchContract_Name] as Remark"
//                + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BranchContract] todi"
//                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BranchContract_MainID"
//                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_038"))
//                BranchContract += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            BranchContract += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_038"))
//                BranchContract += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BranchContract_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    BranchContract += "  OR OfficeAutomation_Document_BranchContract_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                BranchContract += " and OfficeAutomation_Document_BranchContract_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                BranchContract += " and OfficeAutomation_Document_BranchContract_Apply = '" + applicant + "'";

//            if (begin != "")
//                BranchContract += " and OfficeAutomation_Document_BranchContract_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                BranchContract += " and OfficeAutomation_Document_BranchContract_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                BranchContract += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                BranchContract += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                BranchContract += " and [OfficeAutomation_Document_BranchContract_Name] like '%" + keyWord + "%'";

//            string Tourism = " SELECT [OfficeAutomation_Document_Tourism_ID] as ID"
//                    + "          ,[OfficeAutomation_Document_Tourism_MainID] as MainID"
//                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                    + "          ,[OfficeAutomation_Document_Tourism_Department] as Department"
//                    + "          ,[OfficeAutomation_Document_Tourism_ApplyDate] as ApplyDate"
//                    + "          ,[OfficeAutomation_Document_Tourism_Apply] as Apply"
//                    + "          ,toam.OfficeAutomation_SerialNumber"
//                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                    //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                    //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                    //+ "                      FROM   t_OfficeAutomation_Flow f"
//                    //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Tourism_MainID]"
//                    //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                    //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                    //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                    //+ "                      FROM   t_OfficeAutomation_Flow f"
//                    //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Tourism_MainID]"
//                    //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                    //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                    //+ "             WHEN 3 THEN '已完成'"
//                    //+ "           END AS [waitfor]"
//                    + "          ,tdoad.OfficeAutomation_Document_Name"
//                    + "          ,[OfficeAutomation_Document_Tourism_ActivityPlace] as Remark"
//                    + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Tourism] todi"
//                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Tourism_MainID"
//                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_039"))
//                Tourism += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            Tourism += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_039"))
//                Tourism += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Tourism_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    Tourism += "  OR OfficeAutomation_Document_Tourism_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                Tourism += " and OfficeAutomation_Document_Tourism_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                Tourism += " and OfficeAutomation_Document_Tourism_Apply = '" + applicant + "'";

//            if (begin != "")
//                Tourism += " and OfficeAutomation_Document_Tourism_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                Tourism += " and OfficeAutomation_Document_Tourism_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                Tourism += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                Tourism += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                Tourism += " and [OfficeAutomation_Document_Tourism_ActivityPlace] like '%" + keyWord + "%'";

//            string OweSubmit = " SELECT [OfficeAutomation_Document_OweSubmit_ID] as ID"
//+ "          ,[OfficeAutomation_Document_OweSubmit_MainID] as MainID"
//+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//+ "          ,[OfficeAutomation_Document_OweSubmit_Department] as Department"
//+ "          ,[OfficeAutomation_Document_OweSubmit_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_OweSubmit_Apply] as Apply"
//+ "          ,toam.OfficeAutomation_SerialNumber"
//+ "          ,toam.OfficeAutomation_Main_FlowStateID"
////+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
////+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
////+ "                      FROM   t_OfficeAutomation_Flow f"
////+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OweSubmit_MainID]"
////+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
////+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
////+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
////+ "                      FROM   t_OfficeAutomation_Flow f"
////+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OweSubmit_MainID]"
////+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
////+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
////+ "             WHEN 3 THEN '已完成'"
////+ "           END AS [waitfor]"
//+ "          ,tdoad.OfficeAutomation_Document_Name"
//+ "          ,[OfficeAutomation_Document_OweSubmit_Name] as Remark"
//+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_OweSubmit] todi"
//+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_OweSubmit_MainID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_040"))
//                OweSubmit += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            OweSubmit += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_040"))
//                OweSubmit += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_OweSubmit_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    OweSubmit += "  OR OfficeAutomation_Document_OweSubmit_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                OweSubmit += " and OfficeAutomation_Document_OweSubmit_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                OweSubmit += " and OfficeAutomation_Document_OweSubmit_Apply = '" + applicant + "'";

//            if (begin != "")
//                OweSubmit += " and OfficeAutomation_Document_OweSubmit_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                OweSubmit += " and OfficeAutomation_Document_OweSubmit_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                OweSubmit += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                OweSubmit += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                OweSubmit += " and [OfficeAutomation_Document_OweSubmit_Name] like '%" + keyWord + "%'";

//            string TotalRev = " SELECT [OfficeAutomation_Document_TotalRev_ID] as ID"
//+ "          ,[OfficeAutomation_Document_TotalRev_MainID] as MainID"
//+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//+ "          ,[OfficeAutomation_Document_TotalRev_Department] as Department"
//+ "          ,[OfficeAutomation_Document_TotalRev_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_TotalRev_Apply] as Apply"
//+ "          ,toam.OfficeAutomation_SerialNumber"
//+ "          ,toam.OfficeAutomation_Main_FlowStateID"
////+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
////+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
////+ "                      FROM   t_OfficeAutomation_Flow f"
////+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_TotalRev_MainID]"
////+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
////+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
////+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
////+ "                      FROM   t_OfficeAutomation_Flow f"
////+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_TotalRev_MainID]"
////+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
////+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
////+ "             WHEN 3 THEN '已完成'"
////+ "           END AS [waitfor]"
//+ "          ,tdoad.OfficeAutomation_Document_Name"
//+ "          ,[OfficeAutomation_Document_TotalRev_Subject] as Remark"
//+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_TotalRev] todi"
//+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_TotalRev_MainID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_041"))
//                TotalRev += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            TotalRev += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_041"))
//                TotalRev += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_TotalRev_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    TotalRev += "  OR OfficeAutomation_Document_TotalRev_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                TotalRev += " and OfficeAutomation_Document_TotalRev_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                TotalRev += " and OfficeAutomation_Document_TotalRev_Apply = '" + applicant + "'";

//            if (begin != "")
//                TotalRev += " and OfficeAutomation_Document_TotalRev_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                TotalRev += " and OfficeAutomation_Document_TotalRev_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                TotalRev += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                TotalRev += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                TotalRev += " and [OfficeAutomation_Document_TotalRev_Subject] like '%" + keyWord + "%'";

//            string Feasibility = " SELECT [OfficeAutomation_Document_Feasibility_ID] as ID"
//+ "          ,[OfficeAutomation_Document_Feasibility_MainID] as MainID"
//+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//+ "          ,[OfficeAutomation_Document_Feasibility_Department] as Department"
//+ "          ,[OfficeAutomation_Document_Feasibility_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_Feasibility_Apply] as Apply"
//+ "          ,toam.OfficeAutomation_SerialNumber"
//+ "          ,toam.OfficeAutomation_Main_FlowStateID"
////+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
////+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
////+ "                      FROM   t_OfficeAutomation_Flow f"
////+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Feasibility_MainID]"
////+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
////+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
////+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
////+ "                      FROM   t_OfficeAutomation_Flow f"
////+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Feasibility_MainID]"
////+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
////+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
////+ "             WHEN 3 THEN '已完成'"
////+ "           END AS [waitfor]"
//+ "          ,tdoad.OfficeAutomation_Document_Name"
//+ "          ,[OfficeAutomation_Document_Feasibility_Branch] as Remark"
//+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Feasibility] todi"
//+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Feasibility_MainID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_042"))
//                Feasibility += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            Feasibility += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_042"))
//                Feasibility += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Feasibility_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    Feasibility += "  OR OfficeAutomation_Document_Feasibility_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                Feasibility += " and OfficeAutomation_Document_Feasibility_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                Feasibility += " and OfficeAutomation_Document_Feasibility_Apply = '" + applicant + "'";

//            if (begin != "")
//                Feasibility += " and OfficeAutomation_Document_Feasibility_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                Feasibility += " and OfficeAutomation_Document_Feasibility_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                Feasibility += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                Feasibility += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                Feasibility += " and [OfficeAutomation_Document_Feasibility_Branch] like '%" + keyWord + "%'";

//            string AfterCommission = " SELECT [OfficeAutomation_Document_AfterCommission_ID] as ID"
//+ "          ,[OfficeAutomation_Document_AfterCommission_MainID] as MainID"
//+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//+ "          ,[OfficeAutomation_Document_AfterCommission_Department] as Department"
//+ "          ,[OfficeAutomation_Document_AfterCommission_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_AfterCommission_Apply] as Apply"
//+ "          ,toam.OfficeAutomation_SerialNumber"
//+ "          ,toam.OfficeAutomation_Main_FlowStateID"
////+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
////+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
////+ "                      FROM   t_OfficeAutomation_Flow f"
////+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AfterCommission_MainID]"
////+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
////+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
////+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
////+ "                      FROM   t_OfficeAutomation_Flow f"
////+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AfterCommission_MainID]"
////+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
////+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
////+ "             WHEN 3 THEN '已完成'"
////+ "           END AS [waitfor]"
//+ "          ,tdoad.OfficeAutomation_Document_Name"
//+ "          ,[OfficeAutomation_Document_AfterCommission_Subject] as Remark"
//+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_AfterCommission] todi"
//+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_AfterCommission_MainID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_043"))
//                AfterCommission += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            AfterCommission += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_043"))
//                AfterCommission += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_AfterCommission_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    AfterCommission += "  OR OfficeAutomation_Document_AfterCommission_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                AfterCommission += " and OfficeAutomation_Document_AfterCommission_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                AfterCommission += " and OfficeAutomation_Document_AfterCommission_Apply = '" + applicant + "'";

//            if (begin != "")
//                AfterCommission += " and OfficeAutomation_Document_AfterCommission_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                AfterCommission += " and OfficeAutomation_Document_AfterCommission_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                AfterCommission += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                AfterCommission += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                AfterCommission += " and [OfficeAutomation_Document_AfterCommission_Subject] like '%" + keyWord + "%'";

//            string LegalCommission = " SELECT [OfficeAutomation_Document_LegalCommission_ID] as ID"
//+ "          ,[OfficeAutomation_Document_LegalCommission_MainID] as MainID"
//+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//+ "          ,[OfficeAutomation_Document_LegalCommission_Department] as Department"
//+ "          ,[OfficeAutomation_Document_LegalCommission_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_LegalCommission_Apply] as Apply"
//+ "          ,toam.OfficeAutomation_SerialNumber"
//+ "          ,toam.OfficeAutomation_Main_FlowStateID"
////+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
////+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
////+ "                      FROM   t_OfficeAutomation_Flow f"
////+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_LegalCommission_MainID]"
////+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
////+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
////+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
////+ "                      FROM   t_OfficeAutomation_Flow f"
////+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_LegalCommission_MainID]"
////+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
////+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
////+ "             WHEN 3 THEN '已完成'"
////+ "           END AS [waitfor]"
//+ "          ,tdoad.OfficeAutomation_Document_Name"
//+ "          ,[OfficeAutomation_Document_LegalCommission_Subject] as Remark"
//+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_LegalCommission] todi"
//+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_LegalCommission_MainID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID";

//            if (!isAdmin && !purview.Contains("OA_Search_044"))
//                LegalCommission += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            LegalCommission += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_044"))
//                LegalCommission += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_LegalCommission_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    LegalCommission += "  OR OfficeAutomation_Document_LegalCommission_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                LegalCommission += " and OfficeAutomation_Document_LegalCommission_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                LegalCommission += " and OfficeAutomation_Document_LegalCommission_Apply = '" + applicant + "'";

//            if (begin != "")
//                LegalCommission += " and OfficeAutomation_Document_LegalCommission_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                LegalCommission += " and OfficeAutomation_Document_LegalCommission_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                LegalCommission += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                LegalCommission += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                LegalCommission += " and [OfficeAutomation_Document_LegalCommission_Subject] like '%" + keyWord + "%'";












//            if (string.IsNullOrEmpty(applyType))
//                //sql += itpower + " union " + sysreq + " union " + syspower + " union " + scrap + " union " + assettransfer + " union " + dealoffice + " union " + itbuy + " union " + persinterests + " union " + buybuilding + " union " + carallowance + " union " + backcomm + " union " + baddebts + " union " + reducecomm + " union " + projcost + " union " + coopcost + " union " + undertakeproj + " union " + extrabonus + " union " + resumebusi + " union " + withdrawshop + " union " + suspendbusi + " union " + projagentclause + " union " + projworkcloth + " union " + projdormsubsiby;
//                sql += itpower + " union " + sysreq + " union " + syspower + " union " + scrap + " union " + assettransfer + " union " + dealoffice + " union " + itbuy + " union " + persinterests + " union " + buybuilding + " union " + carallowance + " union " + backcomm + " union " + baddebts + " union " + reducecomm + " union " + projcost + " union " + coopcost + " union " + undertakeproj + " union " + extrabonus + " union " + resumebusi + " union " + withdrawshop + " union " + suspendbusi + " union " + projagentclause + " union " + projworkcloth + " union " + projdormsubsiby + " union " + projrepodata + " union " + projlinkrepodata + " union " + ChangeData + " union " + CommissionAdjust + " union " + WirelessFixedLine + " union " + FurtherEducation + " union " + SpecialNumber + " union " + OfficialSeal + " union " + BranchContract + " union " + Tourism + " union " + OweSubmit + " union " + TotalRev + " union " + Feasibility + " union " + AfterCommission + " union " + LegalCommission;
//            else
//            {
//                switch (applyType)
//                {
//                    case "1":
//                        sql += itpower;
//                        break;
//                    case "2":
//                        sql += sysreq;
//                        break;
//                    case "3":
//                        sql += syspower;
//                        break;
//                    case "4":
//                        sql += scrap;
//                        break;
//                    case "5":
//                        sql += assettransfer;
//                        break;
//                    case "6":
//                        sql += dealoffice;
//                        break;
//                    case "7":
//                        sql += itbuy;
//                        break;
//                    case "8":
//                        sql += persinterests;
//                        break;
//                    case "9":
//                        sql += buybuilding;
//                        break;
//                    case "10":
//                        sql += carallowance;
//                        break;
//                    case "11":
//                        sql += backcomm;
//                        break;
//                    case "12":
//                        sql += baddebts;
//                        break;
//                    case "13":
//                        sql += reducecomm;
//                        break;
//                    case "14":
//                        sql += projcost;
//                        break;
//                    case "15":
//                        sql += coopcost;
//                        break;
//                    case "16":
//                        sql += undertakeproj;
//                        break;
//                    case "17":
//                        sql += extrabonus;
//                        break;
//                    case "18":
//                        sql += resumebusi;
//                        break;
//                    case "19":
//                        sql += withdrawshop;
//                        break;
//                    case "20":
//                        sql += suspendbusi;
//                        break;
//                    case "21":
//                        sql += projagentclause;
//                        break;
//                    case "22":
//                        sql += projworkcloth;
//                        break;
//                    case "23":
//                        sql += projdormsubsiby;
//                        break;
//                    case "24":
//                        sql += projrepodata;
//                        break;
//                    case "25":
//                        sql += projlinkrepodata;
//                        break;
//                    case "26":
//                        sql += ChangeData;
//                        break;
//                    case "27":
//                        sql += CommissionAdjust;
//                        break;
//                    case "28":
//                        sql += WirelessFixedLine;
//                        break;
//                    case "29":
//                        sql += FurtherEducation;
//                        break;
//                    case "30":
//                        sql += SpecialNumber;
//                        break;
//                    case "31":
//                        sql += OfficialSeal;
//                        break;
//                    case "32":
//                        sql += BranchContract;
//                        break;
//                    case "33":
//                        sql += Tourism;
//                        break;
//                    case "34":
//                        sql += OweSubmit;
//                        break;
//                    case "35":
//                        sql += TotalRev;
//                        break;
//                    case "36":
//                        sql += Feasibility;
//                        break;
//                    case "37":
//                        sql += AfterCommission;
//                        break;
//                    case "38":
//                        sql += LegalCommission;
//                        break;

//                    default:
//                        break;
//                }
//            }

//            sql += " order by ApplyDate desc";

//            if (!isAdmin)
//                sql += " DROP TABLE #a";

//            return RunSQL(sql);
        //        }
        #endregion

        #region 通过搜索，查询出各申请表列表，按最后审批时间排序
        //        /// <summary>
//        /// 通过搜索，查询出各申请表列表，按最后审批时间排序
//        /// </summary>
//        /// <param name="isAdmin">是否管理员查询</param>
//        /// <param name="applicationDepartment"></param>
//        /// <param name="applicant"></param>
//        /// <param name="begin"></param>
//        /// <param name="end"></param>
//        /// <param name="applyType"></param>
//        /// <param name="state"></param>
//        /// <param name="purview">权限</param>
//        /// <returns></returns>
//        public DataSet Search_OBLastFlowCT(bool isAdmin, string applicationDepartment, string applicant, string begin, string end, string applyType, string state, string employee, string code, string purview, string serialNumber, string keyWord)
//        {
//            string myAgency = "";
//            DA_OfficeAutomation_Agent_Inherit da_OfficeAutomation_Agent_Inherit = new DA_OfficeAutomation_Agent_Inherit();
//            DataSet ds = da_OfficeAutomation_Agent_Inherit.GetMyAgencyForAgent(employee, code);
//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    myAgency += " OR (auditoridsum LIKE '%" + dr["OfficeAutomation_Agent_AuditorID"].ToString()
//                        + "%' AND auditorsum LIKE '%" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "%')";
//                }
//            }

//            string sql = "";

//            if (!isAdmin)
//            {
//                sql += "CREATE TABLE #a"
//                       + " ("
//                       + "    OfficeAutomation_Flow_MainID UNIQUEIDENTIFIER,"
//                       + "    auditorsum                   NVARCHAR(2000),"
//                       + "    auditoridsum                NVARCHAR(2000),"
//                       + "    DocumentID                 int"
//                       + "  )"
//                       + " INSERT INTO #a"
//                       + "                     (OfficeAutomation_Flow_MainID,"
//                       + "                      auditorsum,"
//                       + "                      auditoridsum)"
//                    //+ " SELECT *"
//                    //+ " FROM   vw_SumAuditor";
//                       + " SELECT OfficeAutomation_Flow_MainID,"
//                       + "            CASE WHEN toam.OfficeAutomation_Main_AuditorNamesSum IS NULL then dbo.Fun_sum_employee(OfficeAutomation_Flow_MainID) ELSE toam.OfficeAutomation_Main_AuditorNamesSum END   AS auditorsum,"
//                       + "            CASE WHEN toam.OfficeAutomation_Main_AuditorIDsSum IS NULL then dbo.Fun_sum_employeeid(OfficeAutomation_Flow_MainID) ELSE toam.OfficeAutomation_Main_AuditorIDsSum END   AS auditoridsum"
//                       + " FROM  dbo.t_OfficeAutomation_Flow AS toaf"
//                       + "            LEFT JOIN t_OfficeAutomation_Main toam"
//                       + "                      ON toaf.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID"
//                       + " WHERE 1=1";

//                if (state != "")
//                    sql += " AND toam.OfficeAutomation_Main_FlowStateID=" + state;
//                if (applyType != "")
//                    sql += " AND toam.OfficeAutomation_DocumentID=" + applyType;
//                if (serialNumber != "")
//                    sql += " AND toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//                sql += " GROUP BY OfficeAutomation_Flow_MainID,OfficeAutomation_Main_AuditorNamesSum,OfficeAutomation_Main_AuditorIDsSum";
//            }

//            string itpower = " SELECT [OfficeAutomation_Document_ITPower_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ITPower_MainID] as MainID"
//                 + "          ,[OfficeAutomation_Document_ITPower_DepartmentID] as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ITPower_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ITPower_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ITPower_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITPower_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITPower_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,todi.OfficeAutomation_Document_ITPower_Deal as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "           ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ITPower] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ITPower_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//                 + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ITPower_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_005"))
//                itpower += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            itpower += " WHERE 1=1 ";

//            if (!isAdmin && !purview.Contains("OA_Search_005"))
//                itpower += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ITPower_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    itpower += "  OR OfficeAutomation_Document_ITPower_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                itpower += " and OfficeAutomation_Document_ITPower_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                itpower += " and OfficeAutomation_Document_ITPower_Apply = '" + applicant + "'";

//            if (begin != "")
//                itpower += " and OfficeAutomation_Document_ITPower_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                itpower += " and OfficeAutomation_Document_ITPower_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                itpower += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                itpower += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                itpower += " and [OfficeAutomation_Document_ITPower_ApplyReason] like '%" + keyWord + "%'";

//            itpower += " GROUP BY OfficeAutomation_Document_ITPower_ID"
//            + ",OfficeAutomation_Document_ITPower_MainID"
//            + ",OfficeAutomation_Document_ITPower_DepartmentID"
//            + ",OfficeAutomation_Document_ITPower_Department"
//            + ",OfficeAutomation_Document_ITPower_ApplyDate"
//            + ",OfficeAutomation_Document_ITPower_Apply"
//            + ",toam.OfficeAutomation_SerialNumber"
//            + ",toam.OfficeAutomation_Main_FlowStateID"
//            + ",tdoad.OfficeAutomation_Document_Name"
//            + ",todi.OfficeAutomation_Document_ITPower_Deal"
//            + ",toam.OfficeAutomation_SerialNumber";//*-1

//            string sysreq = " SELECT [OfficeAutomation_Document_SysReq_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_SysReq_MainID] as MainID"
//                 + "          ,[OfficeAutomation_Document_SysReq_DepartmentID] as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_SysReq_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_SysReq_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_SysReq_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysReq_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysReq_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,'' as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SysReq] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SysReq_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//                 + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SysReq_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_007"))
//                sysreq += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            sysreq += " WHERE 1=1 ";

//            if (!isAdmin && !purview.Contains("OA_Search_007"))
//                sysreq += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SysReq_Apply='" + employee + "')";

//            if (!isAdmin && !purview.Contains("OA_Search_007")) //20140919-跟进人也能看到审批表
//                sysreq += " or OfficeAutomation_Document_SysReq_Follower Like '%" + employee + "%'";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    sysreq += "  OR OfficeAutomation_Document_SysReq_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                sysreq += " and OfficeAutomation_Document_SysReq_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                sysreq += " and OfficeAutomation_Document_SysReq_Apply = '" + applicant + "'";

//            if (begin != "")
//                sysreq += " and OfficeAutomation_Document_SysReq_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                sysreq += " and OfficeAutomation_Document_SysReq_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                sysreq += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                sysreq += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                sysreq += " and [OfficeAutomation_Document_SysReq_ReqContent] like '%" + keyWord + "%'";

//            sysreq += " GROUP BY [OfficeAutomation_Document_SysReq_ID]"
//                 + "          ,[OfficeAutomation_Document_SysReq_MainID]"
//                 + "          ,[OfficeAutomation_Document_SysReq_DepartmentID]"
//                 + "          ,[OfficeAutomation_Document_SysReq_Department]"
//                 + "          ,[OfficeAutomation_Document_SysReq_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_SysReq_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-3

//            string syspower = " SELECT [OfficeAutomation_Document_SysPower_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_SysPower_MainID] as MainID"
//                 + "          ,[OfficeAutomation_Document_SysPower_DepartmentID] as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_SysPower_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_SysPower_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_SysPower_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysPower_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysPower_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,todi.OfficeAutomation_Document_SysPower_Deal as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SysPower] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SysPower_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SysPower_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_006"))
//                syspower += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            syspower += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_006"))
//                syspower += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SysPower_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    syspower += "  OR OfficeAutomation_Document_SysPower_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                syspower += " and OfficeAutomation_Document_SysPower_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                syspower += " and OfficeAutomation_Document_SysPower_Apply = '" + applicant + "'";

//            if (begin != "")
//                syspower += " and OfficeAutomation_Document_SysPower_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                syspower += " and OfficeAutomation_Document_SysPower_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                syspower += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                syspower += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                syspower += " and [OfficeAutomation_Document_SysPower_ReqContent] like '%" + keyWord + "%'";

//            syspower += " GROUP BY [OfficeAutomation_Document_SysPower_ID]"
//                 + "          ,[OfficeAutomation_Document_SysPower_MainID]"
//                 + "          ,[OfficeAutomation_Document_SysPower_DepartmentID]"
//                 + "          ,[OfficeAutomation_Document_SysPower_Department]"
//                 + "          ,[OfficeAutomation_Document_SysPower_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_SysPower_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,todi.OfficeAutomation_Document_SysPower_Deal"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-4

//            string scrap = " SELECT [OfficeAutomation_Document_Scrap_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_Scrap_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_Scrap_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_Scrap_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_Scrap_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Scrap_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Scrap_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,todi.[OfficeAutomation_Document_Scrap_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Scrap] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Scrap_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Scrap_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_009"))
//                scrap += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            scrap += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_009"))
//                scrap += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Scrap_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    scrap += "  OR OfficeAutomation_Document_Scrap_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                scrap += " and OfficeAutomation_Document_Scrap_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                scrap += " and OfficeAutomation_Document_Scrap_Apply = '" + applicant + "'";

//            if (begin != "")
//                scrap += " and OfficeAutomation_Document_Scrap_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                scrap += " and OfficeAutomation_Document_Scrap_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                scrap += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                scrap += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                scrap += " and [OfficeAutomation_Document_Scrap_ReqReason] like '%" + keyWord + "%'";

//            scrap += " GROUP BY [OfficeAutomation_Document_Scrap_ID]"
//                 + "          ,[OfficeAutomation_Document_Scrap_MainID]"
//                 + "          ,[OfficeAutomation_Document_Scrap_Department]"
//                 + "          ,[OfficeAutomation_Document_Scrap_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_Scrap_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,todi.[OfficeAutomation_Document_Scrap_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-5

//            string assettransfer = " SELECT [OfficeAutomation_Document_AssetTransfer_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AssetTransfer_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AssetTransfer_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_AssetTransfer] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_AssetTransfer_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_AssetTransfer_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_010"))
//                assettransfer += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            assettransfer += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_010"))
//                assettransfer += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_AssetTransfer_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    assettransfer += "  OR OfficeAutomation_Document_AssetTransfer_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                assettransfer += " and OfficeAutomation_Document_AssetTransfer_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                assettransfer += " and OfficeAutomation_Document_AssetTransfer_Apply = '" + applicant + "'";

//            if (begin != "")
//                assettransfer += " and OfficeAutomation_Document_AssetTransfer_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                assettransfer += " and OfficeAutomation_Document_AssetTransfer_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                assettransfer += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                assettransfer += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                assettransfer += " and OfficeAutomation_Document_AssetTransfer_TransferReason like '%" + keyWord + "%'";

//            assettransfer += " GROUP BY [OfficeAutomation_Document_AssetTransfer_ID]"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_MainID]"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_Department]"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_AssetTransfer_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-6

//            string dealoffice = " SELECT [OfficeAutomation_Document_DealOffice_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_DealOffice_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_DealOffice_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_DealOffice_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_DealOffice_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,'' as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_DealOffice] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_DealOffice_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_DealOffice_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_011"))
//                dealoffice += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            dealoffice += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_011"))
//                dealoffice += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_DealOffice_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    dealoffice += "  OR OfficeAutomation_Document_DealOffice_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                dealoffice += " and OfficeAutomation_Document_DealOffice_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                dealoffice += " and OfficeAutomation_Document_DealOffice_Apply = '" + applicant + "'";

//            if (begin != "")
//                dealoffice += " and OfficeAutomation_Document_DealOffice_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                dealoffice += " and OfficeAutomation_Document_DealOffice_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                dealoffice += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                dealoffice += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                dealoffice += " and ([OfficeAutomation_Document_DealOffice_CrossAreaRemark] like '%" + keyWord + "%' OR [OfficeAutomation_Document_DealOffice_MoneyRemark] like '%" + keyWord + "%')";

//            dealoffice += " GROUP BY [OfficeAutomation_Document_DealOffice_ID]"
//                 + "          ,[OfficeAutomation_Document_DealOffice_MainID]"
//                 + "          ,[OfficeAutomation_Document_DealOffice_Department]"
//                 + "          ,[OfficeAutomation_Document_DealOffice_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_DealOffice_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-7

//            string itbuy = " SELECT [OfficeAutomation_Document_ITBuy_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ITBuy_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ITBuy_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ITBuy_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ITBuy_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITBuy_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITBuy_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ITBuy_ApplyID]+' '+case when [OfficeAutomation_Document_ITBuy_Remark]!='' then '√' else '' end as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ITBuy] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ITBuy_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ITBuy_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_008"))
//                itbuy += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            itbuy += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_008"))
//                itbuy += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ITBuy_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    itbuy += "  OR OfficeAutomation_Document_ITBuy_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                itbuy += " and OfficeAutomation_Document_ITBuy_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                itbuy += " and OfficeAutomation_Document_ITBuy_Apply = '" + applicant + "'";

//            if (begin != "")
//                itbuy += " and OfficeAutomation_Document_ITBuy_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                itbuy += " and OfficeAutomation_Document_ITBuy_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                itbuy += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                itbuy += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                itbuy += " and OfficeAutomation_Document_ITBuy_Reason like '%" + keyWord + "%'";

//            itbuy += " GROUP BY [OfficeAutomation_Document_ITBuy_ID]"
//                 + "          ,[OfficeAutomation_Document_ITBuy_MainID]"
//                 + "          ,[OfficeAutomation_Document_ITBuy_Department]"
//                 + "          ,[OfficeAutomation_Document_ITBuy_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_ITBuy_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ITBuy_ApplyID]"
//                 + "          ,[OfficeAutomation_Document_ITBuy_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-8

//            string persinterests = " SELECT [OfficeAutomation_Document_PersInterests_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_PersInterests_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_PersInterests_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_PersInterests_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_PersInterests_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PersInterests_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PersInterests_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_PersInterests_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_PersInterests] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_PersInterests_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_PersInterests_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_012"))
//                persinterests += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            persinterests += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_012"))
//                persinterests += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_PersInterests_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    persinterests += "  OR OfficeAutomation_Document_PersInterests_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                persinterests += " and OfficeAutomation_Document_PersInterests_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                persinterests += " and OfficeAutomation_Document_PersInterests_Apply = '" + applicant + "'";

//            if (begin != "")
//                persinterests += " and OfficeAutomation_Document_PersInterests_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                persinterests += " and OfficeAutomation_Document_PersInterests_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                persinterests += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                persinterests += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                persinterests += " and OfficeAutomation_Document_PersInterests_ApplyDetail like '%" + keyWord + "%'";

//            persinterests += " GROUP BY [OfficeAutomation_Document_PersInterests_ID]"
//                 + "          ,[OfficeAutomation_Document_PersInterests_MainID]"
//                 + "          ,[OfficeAutomation_Document_PersInterests_Department]"
//                 + "          ,[OfficeAutomation_Document_PersInterests_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_PersInterests_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_PersInterests_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-9

//            string buybuilding = " SELECT [OfficeAutomation_Document_BuyBuilding_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BuyBuilding] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BuyBuilding_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BuyBuilding_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_013"))
//                buybuilding += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            buybuilding += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_013"))
//                buybuilding += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BuyBuilding_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    buybuilding += "  OR OfficeAutomation_Document_BuyBuilding_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                buybuilding += " and OfficeAutomation_Document_BuyBuilding_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                buybuilding += " and OfficeAutomation_Document_BuyBuilding_Apply = '" + applicant + "'";

//            if (begin != "")
//                buybuilding += " and OfficeAutomation_Document_BuyBuilding_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                buybuilding += " and OfficeAutomation_Document_BuyBuilding_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                buybuilding += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                buybuilding += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                buybuilding += " and OfficeAutomation_Document_BuyBuilding_SpecialRequest like '%" + keyWord + "%'";

//            buybuilding += " GROUP BY [OfficeAutomation_Document_BuyBuilding_ID]"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_MainID]"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_Department]"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_BuyBuilding_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-10

//            string carallowance = " SELECT [OfficeAutomation_Document_CarAllowance_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CarAllowance] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CarAllowance_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CarAllowance_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_014"))
//                carallowance += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            carallowance += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_014"))
//                carallowance += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CarAllowance_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    carallowance += "  OR OfficeAutomation_Document_CarAllowance_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                carallowance += " and OfficeAutomation_Document_CarAllowance_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                carallowance += " and OfficeAutomation_Document_CarAllowance_Apply = '" + applicant + "'";

//            if (begin != "")
//                carallowance += " and OfficeAutomation_Document_CarAllowance_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                carallowance += " and OfficeAutomation_Document_CarAllowance_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                carallowance += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                carallowance += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            //if (keyWord != "")
//            //    carallowance += " and OfficeAutomation_Document_BuyBuilding_SpecialRequest like '%" + keyWord + "%'";

//            carallowance += " GROUP BY [OfficeAutomation_Document_CarAllowance_ID]"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_MainID]"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_Department]"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_CarAllowance_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-11

//            string backcomm = " SELECT [OfficeAutomation_Document_BackComm_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_BackComm_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_BackComm_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_BackComm_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_BackComm_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BackComm_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BackComm_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_BackComm_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BackComm] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BackComm_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BackComm_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_015"))
//                backcomm += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            backcomm += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_015"))
//                backcomm += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BackComm_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    backcomm += "  OR OfficeAutomation_Document_BackComm_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                backcomm += " and OfficeAutomation_Document_BackComm_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                backcomm += " and OfficeAutomation_Document_BackComm_Apply = '" + applicant + "'";

//            if (begin != "")
//                backcomm += " and OfficeAutomation_Document_BackComm_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                backcomm += " and OfficeAutomation_Document_BackComm_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                backcomm += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                backcomm += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                backcomm += " and ([OfficeAutomation_Document_BackComm_Reason] like '%" + keyWord + "%' OR [OfficeAutomation_Document_BackComm_Measure] like '%" + keyWord + "%')";

//            backcomm += " GROUP BY [OfficeAutomation_Document_BackComm_ID]"
//                 + "          ,[OfficeAutomation_Document_BackComm_MainID]"
//                 + "          ,[OfficeAutomation_Document_BackComm_Department]"
//                 + "          ,[OfficeAutomation_Document_BackComm_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_BackComm_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_BackComm_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-12

//            string baddebts = " SELECT [OfficeAutomation_Document_BadDebts_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_BadDebts_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_BadDebts_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_BadDebts_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_BadDebts_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_BadDebts_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BadDebts] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BadDebts_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BadDebts_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_016"))
//                baddebts += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            baddebts += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_016"))
//                baddebts += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BadDebts_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    baddebts += "  OR OfficeAutomation_Document_BadDebts_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                baddebts += " and OfficeAutomation_Document_BadDebts_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                baddebts += " and OfficeAutomation_Document_BadDebts_Apply = '" + applicant + "'";

//            if (begin != "" && end != "")
//                baddebts += " and OfficeAutomation_Document_BadDebts_ApplyDate between '" + begin + " 00:00:00' and '" + end + " 23:59:59'";

//            if (state != "")
//                baddebts += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                baddebts += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                baddebts += " and [OfficeAutomation_Document_BadDebts_Reason] like '%" + keyWord + "%'";

//            baddebts += " GROUP BY [OfficeAutomation_Document_BadDebts_ID]"
//                 + "          ,[OfficeAutomation_Document_BadDebts_MainID]"
//                 + "          ,[OfficeAutomation_Document_BadDebts_Department]"
//                 + "          ,[OfficeAutomation_Document_BadDebts_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_BadDebts_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_BadDebts_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-13

//            string reducecomm = " SELECT [OfficeAutomation_Document_ReduceComm_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ReduceComm] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ReduceComm_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ReduceComm_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_017"))
//                reducecomm += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            reducecomm += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_017"))
//                reducecomm += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ReduceComm_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    reducecomm += "  OR OfficeAutomation_Document_ReduceComm_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                reducecomm += " and OfficeAutomation_Document_ReduceComm_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                reducecomm += " and OfficeAutomation_Document_ReduceComm_Apply = '" + applicant + "'";

//            if (begin != "")
//                reducecomm += " and OfficeAutomation_Document_ReduceComm_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                reducecomm += " and OfficeAutomation_Document_ReduceComm_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                reducecomm += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                reducecomm += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                reducecomm += " and [OfficeAutomation_Document_ReduceComm_Reason] like '%" + keyWord + "%'";

//            reducecomm += " GROUP BY [OfficeAutomation_Document_ReduceComm_ID]"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_MainID]"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_Department]"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ReduceComm_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-14

//            string projcost = " SELECT [OfficeAutomation_Document_ProjCost_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ProjCost_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ProjCost_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ProjCost_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ProjCost_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjCost_Project] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjCost] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjCost_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjCost_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_018"))
//                projcost += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            projcost += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_018"))
//                projcost += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjCost_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    projcost += "  OR OfficeAutomation_Document_ProjCost_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                projcost += " and OfficeAutomation_Document_ProjCost_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                projcost += " and OfficeAutomation_Document_ProjCost_Apply = '" + applicant + "'";

//            if (begin != "")
//                projcost += " and OfficeAutomation_Document_ProjCost_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                projcost += " and OfficeAutomation_Document_ProjCost_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                projcost += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                projcost += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                projcost += " and [OfficeAutomation_Document_ProjCost_Project] like '%" + keyWord + "%'";

//            projcost += " GROUP BY [OfficeAutomation_Document_ProjCost_ID]"
//                 + "          ,[OfficeAutomation_Document_ProjCost_MainID]"
//                 + "          ,[OfficeAutomation_Document_ProjCost_Department]"
//                 + "          ,[OfficeAutomation_Document_ProjCost_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_ProjCost_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjCost_Project]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-15

//            string coopcost = " SELECT [OfficeAutomation_Document_CoopCost_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_CoopCost_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_CoopCost_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_CoopCost_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_CoopCost_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_CoopCost_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CoopCost] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CoopCost_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CoopCost_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_019"))
//                coopcost += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            coopcost += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_019"))
//                coopcost += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CoopCost_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    coopcost += "  OR OfficeAutomation_Document_CoopCost_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                coopcost += " and OfficeAutomation_Document_CoopCost_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                coopcost += " and OfficeAutomation_Document_CoopCost_Apply = '" + applicant + "'";

//            if (begin != "")
//                coopcost += " and OfficeAutomation_Document_CoopCost_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                coopcost += " and OfficeAutomation_Document_CoopCost_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                coopcost += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                coopcost += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                coopcost += " and [OfficeAutomation_Document_CoopCost_Reason] like '%" + keyWord + "%'";

//            coopcost += " GROUP BY [OfficeAutomation_Document_CoopCost_ID]"
//                 + "          ,[OfficeAutomation_Document_CoopCost_MainID]"
//                 + "          ,[OfficeAutomation_Document_CoopCost_Department]"
//                 + "          ,[OfficeAutomation_Document_CoopCost_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_CoopCost_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_CoopCost_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-16

//            string undertakeproj = " SELECT [OfficeAutomation_Document_UndertakeProj_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_UndertakeProj_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_UndertakeProj_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_UndertakeProj_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_UndertakeProj_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,OfficeAutomation_Document_UndertakeProj_Project as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_UndertakeProj] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_UndertakeProj_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_UndertakeProj_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_020"))
//                undertakeproj += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            undertakeproj += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_020"))
//                undertakeproj += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_UndertakeProj_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    undertakeproj += "  OR OfficeAutomation_Document_UndertakeProj_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_Apply = '" + applicant + "'";

//            if (begin != "")
//                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                undertakeproj += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                undertakeproj += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                undertakeproj += " and [OfficeAutomation_Document_UndertakeProj_Project] like '%" + keyWord + "%'";

//            undertakeproj += " GROUP BY [OfficeAutomation_Document_UndertakeProj_ID]"
//                 + "          ,[OfficeAutomation_Document_UndertakeProj_MainID]"
//                 + "          ,[OfficeAutomation_Document_UndertakeProj_Department]"
//                 + "          ,[OfficeAutomation_Document_UndertakeProj_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_UndertakeProj_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,OfficeAutomation_Document_UndertakeProj_Project"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-17

//            string extrabonus = " SELECT [OfficeAutomation_Document_ExtraBonus_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_Project] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ExtraBonus] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ExtraBonus_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ExtraBonus_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_021"))
//                extrabonus += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            extrabonus += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_021"))
//                extrabonus += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ExtraBonus_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    extrabonus += "  OR OfficeAutomation_Document_ExtraBonus_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                extrabonus += " and OfficeAutomation_Document_ExtraBonus_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                extrabonus += " and OfficeAutomation_Document_ExtraBonus_Apply = '" + applicant + "'";

//            if (begin != "")
//                extrabonus += " and OfficeAutomation_Document_ExtraBonus_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                extrabonus += " and OfficeAutomation_Document_ExtraBonus_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                extrabonus += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                extrabonus += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                extrabonus += " and [OfficeAutomation_Document_ExtraBonus_Project] like '%" + keyWord + "%'";

//            extrabonus += " GROUP BY [OfficeAutomation_Document_ExtraBonus_ID]"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_MainID]"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_Department]"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ExtraBonus_Project]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-18

//            string resumebusi = " SELECT [OfficeAutomation_Document_ResumeBusi_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ResumeBusi_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ResumeBusi_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ResumeBusi] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ResumeBusi_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ResumeBusi_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_022"))
//                resumebusi += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            resumebusi += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_022"))
//                resumebusi += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ResumeBusi_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    resumebusi += "  OR OfficeAutomation_Document_ResumeBusi_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                resumebusi += " and OfficeAutomation_Document_ResumeBusi_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                resumebusi += " and OfficeAutomation_Document_ResumeBusi_Apply = '" + applicant + "'";

//            if (begin != "")
//                resumebusi += " and OfficeAutomation_Document_ResumeBusi_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                resumebusi += " and OfficeAutomation_Document_ResumeBusi_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                resumebusi += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                resumebusi += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                resumebusi += " and [OfficeAutomation_Document_ResumeBusi_Reason] like '%" + keyWord + "%'";

//            resumebusi += " GROUP BY [OfficeAutomation_Document_ResumeBusi_ID]"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_MainID]"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_Department]"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ResumeBusi_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-19

//            string withdrawshop = " SELECT [OfficeAutomation_Document_WithdrawShop_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WithdrawShop_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WithdrawShop_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_WithdrawShop] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_WithdrawShop_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_WithdrawShop_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_023"))
//                withdrawshop += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            withdrawshop += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_023"))
//                withdrawshop += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_WithdrawShop_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    withdrawshop += "  OR OfficeAutomation_Document_WithdrawShop_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                withdrawshop += " and OfficeAutomation_Document_WithdrawShop_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                withdrawshop += " and OfficeAutomation_Document_WithdrawShop_Apply = '" + applicant + "'";

//            if (begin != "")
//                withdrawshop += " and OfficeAutomation_Document_WithdrawShop_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                withdrawshop += " and OfficeAutomation_Document_WithdrawShop_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                withdrawshop += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                withdrawshop += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                withdrawshop += " and [OfficeAutomation_Document_WithdrawShop_Reason] like '%" + keyWord + "%'";

//            withdrawshop += " GROUP BY [OfficeAutomation_Document_WithdrawShop_ID]"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_MainID]"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_Department]"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_WithdrawShop_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-20

//            string suspendbusi = " SELECT [OfficeAutomation_Document_SuspendBusi_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SuspendBusi_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SuspendBusi_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_Remark] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SuspendBusi] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SuspendBusi_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SuspendBusi_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_024"))
//                suspendbusi += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            suspendbusi += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_024"))
//                suspendbusi += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SuspendBusi_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    suspendbusi += "  OR OfficeAutomation_Document_SuspendBusi_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                suspendbusi += " and OfficeAutomation_Document_SuspendBusi_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                suspendbusi += " and OfficeAutomation_Document_SuspendBusi_Apply = '" + applicant + "'";

//            if (begin != "")
//                suspendbusi += " and OfficeAutomation_Document_SuspendBusi_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                suspendbusi += " and OfficeAutomation_Document_SuspendBusi_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                suspendbusi += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                suspendbusi += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                suspendbusi += " and [OfficeAutomation_Document_SuspendBusi_Reason] like '%" + keyWord + "%'";

//            suspendbusi += " GROUP BY [OfficeAutomation_Document_SuspendBusi_ID]"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_MainID]"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_Department]"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_SuspendBusi_Remark]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-21

//            string projagentclause = " SELECT [OfficeAutomation_Document_ProjAgentClause_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_ProjName] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjAgentClause] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjAgentClause_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjAgentClause_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_025"))
//                projagentclause += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            projagentclause += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_025"))
//                projagentclause += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjAgentClause_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    projagentclause += "  OR OfficeAutomation_Document_ProjAgentClause_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_Apply = '" + applicant + "'";

//            if (begin != "")
//                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                projagentclause += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                projagentclause += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                projagentclause += " and [OfficeAutomation_Document_ProjAgentClause_Reason] like '%" + keyWord + "%'";

//            projagentclause += " GROUP BY [OfficeAutomation_Document_ProjAgentClause_ID]"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_MainID]"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_Department]"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjAgentClause_ProjName]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-22

//            string projworkcloth = " SELECT [OfficeAutomation_Document_ProjWorkCloth_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjWorkCloth_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjWorkCloth_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_ProjName] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjWorkCloth] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjWorkCloth_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjWorkCloth_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_026"))
//                projworkcloth += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            projworkcloth += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_026"))
//                projworkcloth += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjWorkCloth_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    projworkcloth += "  OR OfficeAutomation_Document_ProjWorkCloth_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                projworkcloth += " and OfficeAutomation_Document_ProjWorkCloth_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                projworkcloth += " and OfficeAutomation_Document_ProjWorkCloth_Apply = '" + applicant + "'";

//            if (begin != "")
//                projworkcloth += " and OfficeAutomation_Document_ProjWorkCloth_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                projworkcloth += " and OfficeAutomation_Document_ProjWorkCloth_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                projworkcloth += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                projworkcloth += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                projworkcloth += " and [OfficeAutomation_Document_ProjWorkCloth_Reason] like '%" + keyWord + "%'";

//            projworkcloth += " GROUP BY [OfficeAutomation_Document_ProjWorkCloth_ID]"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_MainID]"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_Department]"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_ProjName]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-23

//            string projdormsubsiby = " SELECT [OfficeAutomation_Document_ProjDormSubsiby_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_ProjName] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjDormSubsiby] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjDormSubsiby_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//                 + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjDormSubsiby_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_027"))
//                projdormsubsiby += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            projdormsubsiby += " WHERE 1=1 ";

//            if (!isAdmin && !purview.Contains("OA_Search_027"))
//                projdormsubsiby += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjDormSubsiby_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    projdormsubsiby += "  OR OfficeAutomation_Document_ProjDormSubsiby_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_Apply = '" + applicant + "'";

//            if (begin != "")
//                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                projdormsubsiby += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                projdormsubsiby += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                projdormsubsiby += " and [OfficeAutomation_Document_ProjDormSubsiby_ProjName] like '%" + keyWord + "%'";

//            projdormsubsiby += " GROUP BY [OfficeAutomation_Document_ProjDormSubsiby_ID]"
//            + ",[OfficeAutomation_Document_ProjDormSubsiby_MainID]"
//            + ",[OfficeAutomation_Document_ProjDormSubsiby_Department]"
//            + ",[OfficeAutomation_Document_ProjDormSubsiby_ApplyDate]"
//            + ",[OfficeAutomation_Document_ProjDormSubsiby_Apply]"
//            + ",toam.OfficeAutomation_SerialNumber"
//            + ",toam.OfficeAutomation_Main_FlowStateID"
//            + ",tdoad.OfficeAutomation_Document_Name"
//            + ",[OfficeAutomation_Document_ProjDormSubsiby_ProjName]"
//            + ",toam.[OfficeAutomation_SerialNumber]";//*-2

//            string projrepodata = " SELECT [OfficeAutomation_Document_ProjRepoData_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_ProjName] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjRepoData] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjRepoData_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjRepoData_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_028"))
//                projrepodata += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            projrepodata += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_028"))
//                projrepodata += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjRepoData_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    projrepodata += "  OR OfficeAutomation_Document_ProjRepoData_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                projrepodata += " and OfficeAutomation_Document_ProjRepoData_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                projrepodata += " and OfficeAutomation_Document_ProjRepoData_Apply = '" + applicant + "'";

//            if (begin != "")
//                projrepodata += " and OfficeAutomation_Document_ProjRepoData_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                projrepodata += " and OfficeAutomation_Document_ProjRepoData_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                projrepodata += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                projrepodata += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                projrepodata += " and [OfficeAutomation_Document_ProjRepoData_Reason] like '%" + keyWord + "%'";

//            projrepodata += " GROUP BY [OfficeAutomation_Document_ProjRepoData_ID]"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_MainID]"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_Department]"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjRepoData_ProjName]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-24

//            string projlinkrepodata = " SELECT [OfficeAutomation_Document_ProjLinkRepoData_ID] as ID"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_MainID] as MainID"
//                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Department] as Department"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_ApplyDate] as ApplyDate"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Apply] as Apply"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                 + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                 + "                      FROM   t_OfficeAutomation_Flow f"
//                 + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID]"
//                 + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                 + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN '已完成'"
//                 + "           END AS [waitfor]"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_ProjName] as Remark"
//                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjLinkRepoData] todi"
//                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjLinkRepoData_MainID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjLinkRepoData_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_029"))
//                projlinkrepodata += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            projlinkrepodata += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_029"))
//                projlinkrepodata += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjLinkRepoData_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    projlinkrepodata += "  OR OfficeAutomation_Document_ProjLinkRepoData_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                projlinkrepodata += " and OfficeAutomation_Document_ProjLinkRepoData_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                projlinkrepodata += " and OfficeAutomation_Document_ProjLinkRepoData_Apply = '" + applicant + "'";

//            if (begin != "")
//                projlinkrepodata += " and OfficeAutomation_Document_ProjLinkRepoData_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                projlinkrepodata += " and OfficeAutomation_Document_ProjLinkRepoData_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                projlinkrepodata += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                projlinkrepodata += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                projlinkrepodata += " and [OfficeAutomation_Document_ProjLinkRepoData_ProjName] like '%" + keyWord + "%'";

//            projlinkrepodata += " GROUP BY [OfficeAutomation_Document_ProjLinkRepoData_ID]"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_MainID]"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Department]"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_ProjName]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-25

//            string ChangeData = " SELECT [OfficeAutomation_Document_ChangeData_ID] as ID"
//                + "          ,[OfficeAutomation_Document_ChangeData_MainID] as MainID"
//                + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                + "          ,[OfficeAutomation_Document_ChangeData_Department] as Department"
//                + "          ,[OfficeAutomation_Document_ChangeData_ApplyDate] as ApplyDate"
//                + "          ,[OfficeAutomation_Document_ChangeData_Apply] as Apply"
//                + "          ,toam.OfficeAutomation_SerialNumber"
//                + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                + "                      FROM   t_OfficeAutomation_Flow f"
//                + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeData_MainID]"
//                + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                + "                      FROM   t_OfficeAutomation_Flow f"
//                + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeData_MainID]"
//                + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                + "             WHEN 3 THEN '已完成'"
//                + "           END AS [waitfor]"
//                + "          ,tdoad.OfficeAutomation_Document_Name"
//                + "          ,[OfficeAutomation_Document_ChangeData_Reason] as Remark"
//                + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ChangeData] todi"
//                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ChangeData_MainID"
//                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//                + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ChangeData_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_032"))
//                ChangeData += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            ChangeData += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_032"))
//                ChangeData += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ChangeData_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    ChangeData += "  OR OfficeAutomation_Document_ChangeData_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                ChangeData += " and OfficeAutomation_Document_ChangeData_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                ChangeData += " and OfficeAutomation_Document_ChangeData_Apply = '" + applicant + "'";

//            if (begin != "")
//                ChangeData += " and OfficeAutomation_Document_ChangeData_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                ChangeData += " and OfficeAutomation_Document_ChangeData_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                ChangeData += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                ChangeData += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                ChangeData += " and [OfficeAutomation_Document_ChangeData_Reason] like '%" + keyWord + "%'";

//            ChangeData += " GROUP BY [OfficeAutomation_Document_ChangeData_ID]"
//                 + "          ,[OfficeAutomation_Document_ChangeData_MainID]"
//                 + "          ,[OfficeAutomation_Document_ChangeData_Department]"
//                 + "          ,[OfficeAutomation_Document_ChangeData_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_ChangeData_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_ChangeData_Reason]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-26

//            string CommissionAdjust = " SELECT [OfficeAutomation_Document_CommissionAdjust_ID] as ID"
//                + "          ,[OfficeAutomation_Document_CommissionAdjust_MainID] as MainID"
//                + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                + "          ,[OfficeAutomation_Document_CommissionAdjust_Department] as Department"
//                + "          ,[OfficeAutomation_Document_CommissionAdjust_ApplyDate] as ApplyDate"
//                + "          ,[OfficeAutomation_Document_CommissionAdjust_Apply] as Apply"
//                + "          ,toam.OfficeAutomation_SerialNumber"
//                + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                + "                      FROM   t_OfficeAutomation_Flow f"
//                + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAdjust_MainID]"
//                + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                + "                      FROM   t_OfficeAutomation_Flow f"
//                + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAdjust_MainID]"
//                + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                + "             WHEN 3 THEN '已完成'"
//                + "           END AS [waitfor]"
//                + "          ,tdoad.OfficeAutomation_Document_Name"
//                + "          ,[OfficeAutomation_Document_CommissionAdjust_Property] as Remark"
//                + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CommissionAdjust] todi"
//                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CommissionAdjust_MainID"
//                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//                + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CommissionAdjust_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_033"))
//                CommissionAdjust += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            CommissionAdjust += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_033"))
//                CommissionAdjust += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CommissionAdjust_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    CommissionAdjust += "  OR OfficeAutomation_Document_CommissionAdjust_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                CommissionAdjust += " and OfficeAutomation_Document_CommissionAdjust_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                CommissionAdjust += " and OfficeAutomation_Document_CommissionAdjust_Apply = '" + applicant + "'";

//            if (begin != "")
//                CommissionAdjust += " and OfficeAutomation_Document_CommissionAdjust_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                CommissionAdjust += " and OfficeAutomation_Document_CommissionAdjust_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                CommissionAdjust += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                CommissionAdjust += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                CommissionAdjust += " and [OfficeAutomation_Document_CommissionAdjust_Property] like '%" + keyWord + "%'";

//            CommissionAdjust += " GROUP BY [OfficeAutomation_Document_CommissionAdjust_ID]"
//                 + "          ,[OfficeAutomation_Document_CommissionAdjust_MainID]"
//                 + "          ,[OfficeAutomation_Document_CommissionAdjust_Department]"
//                 + "          ,[OfficeAutomation_Document_CommissionAdjust_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_CommissionAdjust_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_CommissionAdjust_Property]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-27

//            string WirelessFixedLine = " SELECT [OfficeAutomation_Document_WirelessFixedLine_ID] as ID"
//                + "          ,[OfficeAutomation_Document_WirelessFixedLine_MainID] as MainID"
//                + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                + "          ,'项目部' as Department"
//                + "          ,[OfficeAutomation_Document_WirelessFixedLine_ApplyDate] as ApplyDate"
//                + "          ,[OfficeAutomation_Document_WirelessFixedLine_Apply] as Apply"
//                + "          ,toam.OfficeAutomation_SerialNumber"
//                + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                + "                      FROM   t_OfficeAutomation_Flow f"
//                + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WirelessFixedLine_MainID]"
//                + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                + "                      FROM   t_OfficeAutomation_Flow f"
//                + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WirelessFixedLine_MainID]"
//                + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                + "             WHEN 3 THEN '已完成'"
//                + "           END AS [waitfor]"
//                + "          ,tdoad.OfficeAutomation_Document_Name"
//                + "          ,[OfficeAutomation_Document_WirelessFixedLine_ApplyID] as Remark"
//                + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_WirelessFixedLine] todi"
//                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_WirelessFixedLine_MainID"
//                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//                + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_WirelessFixedLine_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_034"))
//                WirelessFixedLine += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            WirelessFixedLine += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_034"))
//                WirelessFixedLine += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_WirelessFixedLine_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    WirelessFixedLine += "  OR OfficeAutomation_Document_WirelessFixedLine_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            //if (applicationDepartment != "")
//            //    WirelessFixedLine += " and OfficeAutomation_Document_WirelessFixedLine_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                WirelessFixedLine += " and OfficeAutomation_Document_WirelessFixedLine_Apply = '" + applicant + "'";

//            if (begin != "")
//                WirelessFixedLine += " and OfficeAutomation_Document_WirelessFixedLine_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                WirelessFixedLine += " and OfficeAutomation_Document_WirelessFixedLine_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                WirelessFixedLine += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                WirelessFixedLine += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                WirelessFixedLine += " and [OfficeAutomation_Document_WirelessFixedLine_ApplyID] like '%" + keyWord + "%'";

//            WirelessFixedLine += " GROUP BY [OfficeAutomation_Document_WirelessFixedLine_ID]"
//                 + "          ,[OfficeAutomation_Document_WirelessFixedLine_MainID]"
//                 + "          ,[OfficeAutomation_Document_WirelessFixedLine_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_WirelessFixedLine_Apply]"
//                 + "          ,[OfficeAutomation_Document_WirelessFixedLine_SumNumber]"
//                 + "          ,[OfficeAutomation_Document_WirelessFixedLine_ApplyID]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-28

//            string FurtherEducation = " SELECT [OfficeAutomation_Document_FurtherEducation_ID] as ID"
//                    + "          ,[OfficeAutomation_Document_FurtherEducation_MainID] as MainID"
//                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                    + "          ,[OfficeAutomation_Document_FurtherEducation_Department] as Department"
//                    + "          ,[OfficeAutomation_Document_FurtherEducation_ApplyDate] as ApplyDate"
//                    + "          ,[OfficeAutomation_Document_FurtherEducation_Apply] as Apply"
//                    + "          ,toam.OfficeAutomation_SerialNumber"
//                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                    + "                      FROM   t_OfficeAutomation_Flow f"
//                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID]"
//                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                    + "                      FROM   t_OfficeAutomation_Flow f"
//                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID]"
//                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                    + "             WHEN 3 THEN '已完成'"
//                    + "           END AS [waitfor]"
//                    + "          ,tdoad.OfficeAutomation_Document_Name"
//                    + "          ,[OfficeAutomation_Document_FurtherEducation_School] as Remark"
//                    + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                    + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_FurtherEducation] todi"
//                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_FurtherEducation_MainID"
//                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//                    + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_FurtherEducation_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_035"))
//                FurtherEducation += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            FurtherEducation += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_035"))
//                FurtherEducation += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_FurtherEducation_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    FurtherEducation += "  OR OfficeAutomation_Document_FurtherEducation_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_Apply = '" + applicant + "'";

//            if (begin != "")
//                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                FurtherEducation += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                FurtherEducation += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                FurtherEducation += " and [OfficeAutomation_Document_FurtherEducation_School] like '%" + keyWord + "%'";

//            FurtherEducation += " GROUP BY [OfficeAutomation_Document_FurtherEducation_ID]"
//                 + "          ,[OfficeAutomation_Document_FurtherEducation_MainID]"
//                 + "          ,[OfficeAutomation_Document_FurtherEducation_Department]"
//                 + "          ,[OfficeAutomation_Document_FurtherEducation_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_FurtherEducation_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_FurtherEducation_School]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-29

//            string SpecialNumber = " SELECT [OfficeAutomation_Document_SpecialNumber_ID] as ID"
//                    + "          ,[OfficeAutomation_Document_SpecialNumber_MainID] as MainID"
//                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                    + "          ,[OfficeAutomation_Document_SpecialNumber_Department] as Department"
//                    + "          ,[OfficeAutomation_Document_SpecialNumber_ApplyDate] as ApplyDate"
//                    + "          ,[OfficeAutomation_Document_SpecialNumber_Apply] as Apply"
//                    + "          ,toam.OfficeAutomation_SerialNumber"
//                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                    + "                      FROM   t_OfficeAutomation_Flow f"
//                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID]"
//                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                    + "                      FROM   t_OfficeAutomation_Flow f"
//                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID]"
//                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                    + "             WHEN 3 THEN '已完成'"
//                    + "           END AS [waitfor]"
//                    + "          ,tdoad.OfficeAutomation_Document_Name"
//                    + "          ,[OfficeAutomation_Document_SpecialNumber_Subject] as Remark"
//                    + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                    + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SpecialNumber] todi"
//                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SpecialNumber_MainID"
//                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//                    + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SpecialNumber_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_036"))
//                SpecialNumber += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            SpecialNumber += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_036"))
//                SpecialNumber += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SpecialNumber_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    SpecialNumber += "  OR OfficeAutomation_Document_SpecialNumber_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                SpecialNumber += " and OfficeAutomation_Document_SpecialNumber_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                SpecialNumber += " and OfficeAutomation_Document_SpecialNumber_Apply = '" + applicant + "'";

//            if (begin != "")
//                SpecialNumber += " and OfficeAutomation_Document_SpecialNumber_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                SpecialNumber += " and OfficeAutomation_Document_SpecialNumber_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                SpecialNumber += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                SpecialNumber += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                SpecialNumber += " and [OfficeAutomation_Document_SpecialNumber_Subject] like '%" + keyWord + "%'";

//            SpecialNumber += " GROUP BY [OfficeAutomation_Document_SpecialNumber_ID]"
//                 + "          ,[OfficeAutomation_Document_SpecialNumber_MainID]"
//                 + "          ,[OfficeAutomation_Document_SpecialNumber_Department]"
//                 + "          ,[OfficeAutomation_Document_SpecialNumber_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_SpecialNumber_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_SpecialNumber_Subject]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-30

//            string OfficialSeal = " SELECT [OfficeAutomation_Document_OfficialSeal_ID] as ID"
//        + "          ,[OfficeAutomation_Document_OfficialSeal_MainID] as MainID"
//        + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//        + "          ,[OfficeAutomation_Document_OfficialSeal_Department] as Department"
//        + "          ,[OfficeAutomation_Document_OfficialSeal_ApplyDate] as ApplyDate"
//        + "          ,[OfficeAutomation_Document_OfficialSeal_Apply] as Apply"
//        + "          ,toam.OfficeAutomation_SerialNumber"
//        + "          ,toam.OfficeAutomation_Main_FlowStateID"
//        + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//        + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//        + "                      FROM   t_OfficeAutomation_Flow f"
//        + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID]"
//        + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//        + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//        + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//        + "                      FROM   t_OfficeAutomation_Flow f"
//        + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID]"
//        + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//        + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//        + "             WHEN 3 THEN '已完成'"
//        + "           END AS [waitfor]"
//        + "          ,tdoad.OfficeAutomation_Document_Name"
//        + "          ,(SELECT OfficeAutomation_Document_OfficialSeal_Detail_TransFile + '；' FROM t_OfficeAutomation_Document_OfficialSeal_Detail WHERE OfficeAutomation_Document_OfficialSeal_Detail_MainID = OfficeAutomation_Document_OfficialSeal_ID FOR XML PATH('')) as Remark"
//        + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//        + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//        + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_OfficialSeal] todi"
//        + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_OfficialSeal_MainID"
//        + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//        + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//        + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_OfficialSeal_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_037"))
//                OfficialSeal += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            OfficialSeal += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_037"))
//                OfficialSeal += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_OfficialSeal_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    OfficialSeal += "  OR OfficeAutomation_Document_OfficialSeal_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_Apply = '" + applicant + "'";

//            if (begin != "")
//                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                OfficialSeal += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                OfficialSeal += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                OfficialSeal += " and (SELECT OfficeAutomation_Document_OfficialSeal_Detail_TransFile + '；' FROM t_OfficeAutomation_Document_OfficialSeal_Detail WHERE OfficeAutomation_Document_OfficialSeal_Detail_MainID = OfficeAutomation_Document_OfficialSeal_ID FOR XML PATH('')) like '%" + keyWord + "%'";

//            OfficialSeal += " GROUP BY [OfficeAutomation_Document_OfficialSeal_ID]"
//                 + "          ,[OfficeAutomation_Document_OfficialSeal_MainID]"
//                 + "          ,[OfficeAutomation_Document_OfficialSeal_Department]"
//                 + "          ,[OfficeAutomation_Document_OfficialSeal_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_OfficialSeal_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-31

//            string BranchContract = " SELECT [OfficeAutomation_Document_BranchContract_ID] as ID"
//                + "          ,[OfficeAutomation_Document_BranchContract_MainID] as MainID"
//                + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//                + "          ,[OfficeAutomation_Document_BranchContract_Department] as Department"
//                + "          ,[OfficeAutomation_Document_BranchContract_ApplyDate] as ApplyDate"
//                + "          ,[OfficeAutomation_Document_BranchContract_Apply] as Apply"
//                + "          ,toam.OfficeAutomation_SerialNumber"
//                + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//                + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                + "                      FROM   t_OfficeAutomation_Flow f"
//                + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BranchContract_MainID]"
//                + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//                + "                      FROM   t_OfficeAutomation_Flow f"
//                + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BranchContract_MainID]"
//                + "                             AND f.OfficeAutomation_Flow_Audit = 0"
//                + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                + "             WHEN 3 THEN '已完成'"
//                + "           END AS [waitfor]"
//                + "          ,tdoad.OfficeAutomation_Document_Name"
//                + "          ,[OfficeAutomation_Document_BranchContract_Name] as Remark"
//                + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//                + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BranchContract] todi"
//                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BranchContract_MainID"
//                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//                + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BranchContract_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_038"))
//                BranchContract += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            BranchContract += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_038"))
//                BranchContract += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BranchContract_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    BranchContract += "  OR OfficeAutomation_Document_BranchContract_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                BranchContract += " and OfficeAutomation_Document_BranchContract_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                BranchContract += " and OfficeAutomation_Document_BranchContract_Apply = '" + applicant + "'";

//            if (begin != "")
//                BranchContract += " and OfficeAutomation_Document_BranchContract_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                BranchContract += " and OfficeAutomation_Document_BranchContract_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                BranchContract += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                BranchContract += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                BranchContract += " and [OfficeAutomation_Document_BranchContract_Name] like '%" + keyWord + "%'";

//            BranchContract += " GROUP BY [OfficeAutomation_Document_BranchContract_ID]"
//                 + "          ,[OfficeAutomation_Document_BranchContract_MainID]"
//                 + "          ,[OfficeAutomation_Document_BranchContract_Department]"
//                 + "          ,[OfficeAutomation_Document_BranchContract_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_BranchContract_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_BranchContract_Name]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-32

//            string Tourism = " SELECT [OfficeAutomation_Document_Tourism_ID] as ID"
//+ "          ,[OfficeAutomation_Document_Tourism_MainID] as MainID"
//+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//+ "          ,[OfficeAutomation_Document_Tourism_Department] as Department"
//+ "          ,[OfficeAutomation_Document_Tourism_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_Tourism_Apply] as Apply"
//+ "          ,toam.OfficeAutomation_SerialNumber"
//+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Tourism_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Tourism_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN '已完成'"
//+ "           END AS [waitfor]"
//+ "          ,tdoad.OfficeAutomation_Document_Name"
//+ "          ,[OfficeAutomation_Document_Tourism_ActivityPlace] as Remark"
//+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Tourism] todi"
//+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Tourism_MainID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Tourism_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_039"))
//                Tourism += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            Tourism += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_039"))
//                Tourism += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Tourism_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    Tourism += "  OR OfficeAutomation_Document_Tourism_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                Tourism += " and OfficeAutomation_Document_Tourism_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                Tourism += " and OfficeAutomation_Document_Tourism_Apply = '" + applicant + "'";

//            if (begin != "")
//                Tourism += " and OfficeAutomation_Document_Tourism_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                Tourism += " and OfficeAutomation_Document_Tourism_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                Tourism += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                Tourism += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                Tourism += " and [OfficeAutomation_Document_Tourism_ActivityPlace] like '%" + keyWord + "%'";

//            Tourism += " GROUP BY [OfficeAutomation_Document_Tourism_ID]"
//                 + "          ,[OfficeAutomation_Document_Tourism_MainID]"
//                 + "          ,[OfficeAutomation_Document_Tourism_Department]"
//                 + "          ,[OfficeAutomation_Document_Tourism_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_Tourism_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_Tourism_ActivityPlace]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-33

//            string OweSubmit = " SELECT [OfficeAutomation_Document_OweSubmit_ID] as ID"
//+ "          ,[OfficeAutomation_Document_OweSubmit_MainID] as MainID"
//+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//+ "          ,[OfficeAutomation_Document_OweSubmit_Department] as Department"
//+ "          ,[OfficeAutomation_Document_OweSubmit_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_OweSubmit_Apply] as Apply"
//+ "          ,toam.OfficeAutomation_SerialNumber"
//+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OweSubmit_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OweSubmit_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN '已完成'"
//+ "           END AS [waitfor]"
//+ "          ,tdoad.OfficeAutomation_Document_Name"
//+ "          ,[OfficeAutomation_Document_OweSubmit_Name] as Remark"
//+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_OweSubmit] todi"
//+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_OweSubmit_MainID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_OweSubmit_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_040"))
//                OweSubmit += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            OweSubmit += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_040"))
//                OweSubmit += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_OweSubmit_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    OweSubmit += "  OR OfficeAutomation_Document_OweSubmit_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                OweSubmit += " and OfficeAutomation_Document_OweSubmit_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                OweSubmit += " and OfficeAutomation_Document_OweSubmit_Apply = '" + applicant + "'";

//            if (begin != "")
//                OweSubmit += " and OfficeAutomation_Document_OweSubmit_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                OweSubmit += " and OfficeAutomation_Document_OweSubmit_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                OweSubmit += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                OweSubmit += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                OweSubmit += " and [OfficeAutomation_Document_OweSubmit_Name] like '%" + keyWord + "%'";

//            OweSubmit += " GROUP BY [OfficeAutomation_Document_OweSubmit_ID]"
//                 + "          ,[OfficeAutomation_Document_OweSubmit_MainID]"
//                 + "          ,[OfficeAutomation_Document_OweSubmit_Department]"
//                 + "          ,[OfficeAutomation_Document_OweSubmit_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_OweSubmit_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_OweSubmit_Name]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";

//            string TotalRev = " SELECT [OfficeAutomation_Document_TotalRev_ID] as ID"
//+ "          ,[OfficeAutomation_Document_TotalRev_MainID] as MainID"
//+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//+ "          ,[OfficeAutomation_Document_TotalRev_Department] as Department"
//+ "          ,[OfficeAutomation_Document_TotalRev_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_TotalRev_Apply] as Apply"
//+ "          ,toam.OfficeAutomation_SerialNumber"
//+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_TotalRev_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_TotalRev_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN '已完成'"
//+ "           END AS [waitfor]"
//+ "          ,tdoad.OfficeAutomation_Document_Name"
//+ "          ,[OfficeAutomation_Document_TotalRev_Subject] as Remark"
//+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_TotalRev] todi"
//+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_TotalRev_MainID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_TotalRev_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_041"))
//                TotalRev += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            TotalRev += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_041"))
//                TotalRev += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_TotalRev_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    TotalRev += "  OR OfficeAutomation_Document_TotalRev_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                TotalRev += " and OfficeAutomation_Document_TotalRev_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                TotalRev += " and OfficeAutomation_Document_TotalRev_Apply = '" + applicant + "'";

//            if (begin != "")
//                TotalRev += " and OfficeAutomation_Document_TotalRev_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                TotalRev += " and OfficeAutomation_Document_TotalRev_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                TotalRev += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                TotalRev += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                TotalRev += " and [OfficeAutomation_Document_TotalRev_Subject] like '%" + keyWord + "%'";

//            TotalRev += " GROUP BY [OfficeAutomation_Document_TotalRev_ID]"
//                 + "          ,[OfficeAutomation_Document_TotalRev_MainID]"
//                 + "          ,[OfficeAutomation_Document_TotalRev_Department]"
//                 + "          ,[OfficeAutomation_Document_TotalRev_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_TotalRev_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_TotalRev_Subject]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";

//            string Feasibility = " SELECT [OfficeAutomation_Document_Feasibility_ID] as ID"
//+ "          ,[OfficeAutomation_Document_Feasibility_MainID] as MainID"
//+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//+ "          ,[OfficeAutomation_Document_Feasibility_Department] as Department"
//+ "          ,[OfficeAutomation_Document_Feasibility_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_Feasibility_Apply] as Apply"
//+ "          ,toam.OfficeAutomation_SerialNumber"
//+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Feasibility_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Feasibility_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN '已完成'"
//+ "           END AS [waitfor]"
//+ "          ,tdoad.OfficeAutomation_Document_Name"
//+ "          ,[OfficeAutomation_Document_Feasibility_Branch] as Remark"
//+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Feasibility] todi"
//+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Feasibility_MainID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Feasibility_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_042"))
//                Feasibility += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            Feasibility += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_042"))
//                Feasibility += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Feasibility_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    Feasibility += "  OR OfficeAutomation_Document_Feasibility_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                Feasibility += " and OfficeAutomation_Document_Feasibility_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                Feasibility += " and OfficeAutomation_Document_Feasibility_Apply = '" + applicant + "'";

//            if (begin != "")
//                Feasibility += " and OfficeAutomation_Document_Feasibility_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                Feasibility += " and OfficeAutomation_Document_Feasibility_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                Feasibility += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                Feasibility += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                Feasibility += " and [OfficeAutomation_Document_Feasibility_Branch] like '%" + keyWord + "%'";

//            Feasibility += " GROUP BY [OfficeAutomation_Document_Feasibility_ID]"
//                 + "          ,[OfficeAutomation_Document_Feasibility_MainID]"
//                 + "          ,[OfficeAutomation_Document_Feasibility_Department]"
//                 + "          ,[OfficeAutomation_Document_Feasibility_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_Feasibility_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_Feasibility_Branch]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";

//            string AfterCommission = " SELECT [OfficeAutomation_Document_AfterCommission_ID] as ID"
//+ "          ,[OfficeAutomation_Document_AfterCommission_MainID] as MainID"
//+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//+ "          ,[OfficeAutomation_Document_AfterCommission_Department] as Department"
//+ "          ,[OfficeAutomation_Document_AfterCommission_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_AfterCommission_Apply] as Apply"
//+ "          ,toam.OfficeAutomation_SerialNumber"
//+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AfterCommission_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AfterCommission_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN '已完成'"
//+ "           END AS [waitfor]"
//+ "          ,tdoad.OfficeAutomation_Document_Name"
//+ "          ,[OfficeAutomation_Document_AfterCommission_Subject] as Remark"
//+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_AfterCommission] todi"
//+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_AfterCommission_MainID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_AfterCommission_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_043"))
//                AfterCommission += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            AfterCommission += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_043"))
//                AfterCommission += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_AfterCommission_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    AfterCommission += "  OR OfficeAutomation_Document_AfterCommission_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                AfterCommission += " and OfficeAutomation_Document_AfterCommission_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                AfterCommission += " and OfficeAutomation_Document_AfterCommission_Apply = '" + applicant + "'";

//            if (begin != "")
//                AfterCommission += " and OfficeAutomation_Document_AfterCommission_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                AfterCommission += " and OfficeAutomation_Document_AfterCommission_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                AfterCommission += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                AfterCommission += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                AfterCommission += " and [OfficeAutomation_Document_AfterCommission_Subject] like '%" + keyWord + "%'";

//            AfterCommission += " GROUP BY [OfficeAutomation_Document_AfterCommission_ID]"
//                 + "          ,[OfficeAutomation_Document_AfterCommission_MainID]"
//                 + "          ,[OfficeAutomation_Document_AfterCommission_Department]"
//                 + "          ,[OfficeAutomation_Document_AfterCommission_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_AfterCommission_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_AfterCommission_Subject]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";

//            string LegalCommission = " SELECT [OfficeAutomation_Document_LegalCommission_ID] as ID"
//+ "          ,[OfficeAutomation_Document_LegalCommission_MainID] as MainID"
//+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//+ "          ,[OfficeAutomation_Document_LegalCommission_Department] as Department"
//+ "          ,[OfficeAutomation_Document_LegalCommission_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_LegalCommission_Apply] as Apply"
//+ "          ,toam.OfficeAutomation_SerialNumber"
//+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_LegalCommission_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_LegalCommission_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN '已完成'"
//+ "           END AS [waitfor]"
//+ "          ,tdoad.OfficeAutomation_Document_Name"
//+ "          ,[OfficeAutomation_Document_LegalCommission_Subject] as Remark"
//+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_LegalCommission] todi"
//+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_LegalCommission_MainID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_LegalCommission_MainID";

//            if (!isAdmin && !purview.Contains("OA_Search_044"))
//                LegalCommission += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            LegalCommission += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_044"))
//                LegalCommission += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_LegalCommission_Apply='" + employee + "')";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    LegalCommission += "  OR OfficeAutomation_Document_LegalCommission_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            if (applicationDepartment != "")
//                LegalCommission += " and OfficeAutomation_Document_LegalCommission_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                LegalCommission += " and OfficeAutomation_Document_LegalCommission_Apply = '" + applicant + "'";

//            if (begin != "")
//                LegalCommission += " and OfficeAutomation_Document_LegalCommission_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                LegalCommission += " and OfficeAutomation_Document_LegalCommission_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                LegalCommission += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

//            if (serialNumber != "")
//                LegalCommission += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                LegalCommission += " and [OfficeAutomation_Document_LegalCommission_Subject] like '%" + keyWord + "%'";

//            LegalCommission += " GROUP BY [OfficeAutomation_Document_LegalCommission_ID]"
//                 + "          ,[OfficeAutomation_Document_LegalCommission_MainID]"
//                 + "          ,[OfficeAutomation_Document_LegalCommission_Department]"
//                 + "          ,[OfficeAutomation_Document_LegalCommission_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_LegalCommission_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_LegalCommission_Subject]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]";







//            if (string.IsNullOrEmpty(applyType))
//                //sql += itpower + " union " + sysreq + " union " + syspower + " union " + scrap + " union " + assettransfer + " union " + dealoffice + " union " + itbuy + " union " + persinterests + " union " + buybuilding + " union " + carallowance + " union " + backcomm + " union " + baddebts + " union " + reducecomm + " union " + projcost + " union " + coopcost + " union " + undertakeproj + " union " + extrabonus + " union " + resumebusi + " union " + withdrawshop + " union " + suspendbusi + " union " + projagentclause + " union " + projworkcloth + " union " + projdormsubsiby;
//                sql += itpower + " union " + sysreq + " union " + syspower + " union " + scrap + " union " + assettransfer + " union " + dealoffice + " union " + itbuy + " union " + persinterests + " union " + buybuilding + " union " + carallowance + " union " + backcomm + " union " + baddebts + " union " + reducecomm + " union " + projcost + " union " + coopcost + " union " + undertakeproj + " union " + extrabonus + " union " + resumebusi + " union " + withdrawshop + " union " + suspendbusi + " union " + projagentclause + " union " + projworkcloth + " union " + projdormsubsiby + " union " + projrepodata + " union " + projlinkrepodata + " union " + ChangeData + " union " + CommissionAdjust + " union " + WirelessFixedLine + " union " + FurtherEducation + " union " + SpecialNumber + " union " + OfficialSeal + " union " + BranchContract + " union " + Tourism + " union " + OweSubmit + " union " + TotalRev + " union " + Feasibility + " union " + AfterCommission + " union " + LegalCommission;
//            else
//            {
//                switch (applyType)
//                {
//                    case "1":
//                        sql += itpower;
//                        break;
//                    case "2":
//                        sql += sysreq;
//                        break;
//                    case "3":
//                        sql += syspower;
//                        break;
//                    case "4":
//                        sql += scrap;
//                        break;
//                    case "5":
//                        sql += assettransfer;
//                        break;
//                    case "6":
//                        sql += dealoffice;
//                        break;
//                    case "7":
//                        sql += itbuy;
//                        break;
//                    case "8":
//                        sql += persinterests;
//                        break;
//                    case "9":
//                        sql += buybuilding;
//                        break;
//                    case "10":
//                        sql += carallowance;
//                        break;
//                    case "11":
//                        sql += backcomm;
//                        break;
//                    case "12":
//                        sql += baddebts;
//                        break;
//                    case "13":
//                        sql += reducecomm;
//                        break;
//                    case "14":
//                        sql += projcost;
//                        break;
//                    case "15":
//                        sql += coopcost;
//                        break;
//                    case "16":
//                        sql += undertakeproj;
//                        break;
//                    case "17":
//                        sql += extrabonus;
//                        break;
//                    case "18":
//                        sql += resumebusi;
//                        break;
//                    case "19":
//                        sql += withdrawshop;
//                        break;
//                    case "20":
//                        sql += suspendbusi;
//                        break;
//                    case "21":
//                        sql += projagentclause;
//                        break;
//                    case "22":
//                        sql += projworkcloth;
//                        break;
//                    case "23":
//                        sql += projdormsubsiby;
//                        break;
//                    case "24":
//                        sql += projrepodata;
//                        break;
//                    case "25":
//                        sql += projlinkrepodata;
//                        break;
//                    case "26":
//                        sql += ChangeData;
//                        break;
//                    case "27":
//                        sql += CommissionAdjust;
//                        break;
//                    case "28":
//                        sql += WirelessFixedLine;
//                        break;
//                    case "29":
//                        sql += FurtherEducation;
//                        break;
//                    case "30":
//                        sql += SpecialNumber;
//                        break;
//                    case "31":
//                        sql += OfficialSeal;
//                        break;
//                    case "32":
//                        sql += BranchContract;
//                        break;
//                    case "33":
//                        sql += Tourism;
//                        break;
//                    case "34":
//                        sql += OweSubmit;
//                        break;
//                    case "35":
//                        sql += TotalRev;
//                        break;
//                    case "36":
//                        sql += Feasibility;
//                        break;
//                    case "37":
//                        sql += AfterCommission;
//                        break;
//                    case "38":
//                        sql += LegalCommission;
//                        break;

//                    default:
//                        break;
//                }
//            }

//            sql += " ORDER BY LastFlowCT DESC";

//            if (!isAdmin)
//                sql += " DROP TABLE #a";

//            return RunSQL(sql);
        //        }
        #endregion

        #region 获取待该员工审核的各申请表列表 （20150401：放弃该函数）
        /// <summary>
        /// 获取待该员工审核的各申请表列表
        /// </summary>
        /// <param name="code"></param>
        /// <returns></returns>
        public DataSet WaitForMe(string employeeID, string employeeName)
        {
            DA_OfficeAutomation_Agent_Inherit da_OfficeAutomation_Agent_Inherit = new DA_OfficeAutomation_Agent_Inherit();
            string myAgency = da_OfficeAutomation_Agent_Inherit.GetMyAgencyForSQL(employeeName, employeeID);

            string sqlIn = " (  SELECT tidx.OfficeAutomation_Flow_MainID"
                           + "     FROM   (SELECT OfficeAutomation_Flow_MainID,"
                           + "                    OfficeAutomation_Flow_Idx AS idx"
                           + "             FROM   [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Flow]"
                           + "             WHERE  ((OfficeAutomation_Flow_EmployeeID LIKE '%" + employeeID + "%'"
                           + "                    AND OfficeAutomation_Flow_Employee LIKE '%" + employeeName + "%')"
                           + myAgency
                //+ "                   ) AND OfficeAutomation_Flow_Audit = 0) tidx"
                + "                   ) AND OfficeAutomation_Flow_Audit = 0 AND (OfficeAutomation_Flow_AuditorID not like '%" + employeeID + "%' OR OfficeAutomation_Flow_AuditorID IS NULL)) tidx"  //+20150121：在多人审批中，审完后不再提示
                           + "            LEFT JOIN (SELECT OfficeAutomation_Flow_MainID,"
                           + "                              Min(toaf.OfficeAutomation_Flow_Idx) AS minidx"
                           + "                       FROM   t_OfficeAutomation_Flow toaf"
                           + "                       WHERE  toaf.OfficeAutomation_Flow_MainID IN (SELECT OfficeAutomation_Flow_MainID"
                           + "                                                                    FROM   t_OfficeAutomation_Flow toaf"
                           + "                                                               WHERE  ((OfficeAutomation_Flow_EmployeeID LIKE '%" + employeeID + "%'"
                           + "                                                                      AND OfficeAutomation_Flow_Employee LIKE '%" + employeeName + "%')"
                           + myAgency
                //+ "                                                                         ) AND OfficeAutomation_Flow_Audit = 0)"
                + "                                                                         ) AND OfficeAutomation_Flow_Audit = 0 AND (OfficeAutomation_Flow_AuditorID not like '%" + employeeID + "%' OR OfficeAutomation_Flow_AuditorID IS NULL))"  //+20150121：在多人审批中，审完后不再提示
                           + "                      GROUP  BY toaf.OfficeAutomation_Flow_MainID) tminidx"
                           + "                  ON tminidx.OfficeAutomation_Flow_MainID = tidx.OfficeAutomation_Flow_MainID"
                           + "    WHERE  tminidx.minidx = tidx.idx "
                           + "    UNION"
                           + "    SELECT OfficeAutomation_Flow_MainID"
                           + "    FROM   (SELECT toaf.*"
                           + "                 FROM   t_OfficeAutomation_Flow toaf"
                           + "                             RIGHT JOIN (SELECT OfficeAutomation_Flow_MainID,"
                           + "                                                            min(OfficeAutomation_Flow_Idx) as Idx"
                           + "                                                 FROM   [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Flow]"
                           + "                                                 WHERE  ((OfficeAutomation_Flow_EmployeeID LIKE '%" + employeeID + "%'"
                           + "                                                              AND OfficeAutomation_Flow_Employee LIKE '%" + employeeName + "%')"
                           + myAgency
                           + "                                                             ) AND OfficeAutomation_Flow_Audit = 0"
                + "                 AND (OfficeAutomation_Flow_AuditorID not like '%" + employeeID + "%'  OR OfficeAutomation_Flow_AuditorID IS NULL)" //+20150121：在多人审批中，审完后不再提示
                           + "                                                              AND OfficeAutomation_Flow_Idx <> 1"
                           + "                                                 GROUP BY OfficeAutomation_Flow_MainID) old"
                           + "                                           ON old.OfficeAutomation_Flow_MainID = toaf.OfficeAutomation_Flow_MainID"
                           + "                 WHERE  toaf.OfficeAutomation_Flow_Idx < old.Idx) t1"
                           + "    WHERE  t1.OfficeAutomation_Flow_Idx = (SELECT Max(t2.OfficeAutomation_Flow_Idx)"
                           + "                                                                FROM   (SELECT toaf.*"
                           + "                                                                             FROM   t_OfficeAutomation_Flow toaf"
                           + "                                                                                         RIGHT JOIN (SELECT OfficeAutomation_Flow_MainID,"
                           + "                                                                                                                        min(OfficeAutomation_Flow_Idx) as Idx"
                           + "                                                                                                             FROM   [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Flow]"
                           + "                                                                                                             WHERE  ((OfficeAutomation_Flow_EmployeeID LIKE '%" + employeeID + "%'"
                           + "                                                                                                                         AND OfficeAutomation_Flow_Employee LIKE '%" + employeeName + "%')"
                           + myAgency
                           + "                                                                                                                        ) AND OfficeAutomation_Flow_Audit = 0"
                + "                 AND (OfficeAutomation_Flow_AuditorID not like '%" + employeeID + "%'  OR OfficeAutomation_Flow_AuditorID IS NULL)" //+20150121：在多人审批中，审完后不再提示
                           + "                                                                                                                         AND OfficeAutomation_Flow_Idx <> 1"
                           + "                                                                                                             GROUP BY OfficeAutomation_Flow_MainID) old"
                           + "                                                                                                     ON old.OfficeAutomation_Flow_MainID = toaf.OfficeAutomation_Flow_MainID"
                           + "                                                                            WHERE  toaf.OfficeAutomation_Flow_Idx < old.Idx )t2"
                           + "                                                               WHERE  t2.OfficeAutomation_Flow_MainID = t1.OfficeAutomation_Flow_MainID)"
                           + "                 AND t1.OfficeAutomation_Flow_Audit = 1)"
            + "                 AND toam.OfficeAutomation_Main_ID NOT IN (select OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main where OfficeAutomation_Main_WillDelete = 1)"; //+20141219：M_DeleteC

            string sql = "SELECT [OfficeAutomation_Document_ITPower_ID] as ID"
                           + "          ,[OfficeAutomation_Document_ITPower_MainID] as MainID"
                           + "          ,[OfficeAutomation_Document_ITPower_DepartmentID] as DepartmentID"
                           + "          ,[OfficeAutomation_Document_ITPower_Department] as Department"
                           + "          ,[OfficeAutomation_Document_ITPower_ApplyDate] as ApplyDate"
                           + "          ,[OfficeAutomation_Document_ITPower_Apply] as Apply"
                           + "          ,toam.OfficeAutomation_SerialNumber"
                           + "          ,toam.OfficeAutomation_Main_FlowStateID"
                           + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                           + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                           + "                      FROM   t_OfficeAutomation_Flow f"
                           + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITPower_MainID]"
                           + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                           + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                           + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                           + "                      FROM   t_OfficeAutomation_Flow f"
                           + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITPower_MainID]"
                           + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                           + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                           + "             WHEN 3 THEN '已完成'"
                           + "           END AS [waitfor]"
                           + "          ,tdoad.OfficeAutomation_Document_Name"
                           + "          ,todi.OfficeAutomation_Document_ITPower_Deal as Remark"
                           + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ITPower] todi"
                           + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ITPower_MainID"
                           + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                           + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                           + " WHERE todi.OfficeAutomation_Document_ITPower_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_SysReq_ID] as ID"
                    + "          ,[OfficeAutomation_Document_SysReq_MainID] as MainID"
                    + "          ,[OfficeAutomation_Document_SysReq_DepartmentID] as DepartmentID"
                    + "          ,[OfficeAutomation_Document_SysReq_Department] as Department"
                    + "          ,[OfficeAutomation_Document_SysReq_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_SysReq_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysReq_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysReq_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,'' as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SysReq] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SysReq_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_SysReq_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_SysPower_ID] as ID"
                    + "          ,[OfficeAutomation_Document_SysPower_MainID] as MainID"
                    + "          ,[OfficeAutomation_Document_SysPower_DepartmentID] as DepartmentID"
                    + "          ,[OfficeAutomation_Document_SysPower_Department] as Department"
                    + "          ,[OfficeAutomation_Document_SysPower_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_SysPower_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysPower_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysPower_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,todi.OfficeAutomation_Document_SysPower_Deal as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SysPower] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SysPower_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_SysPower_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_Scrap_ID] as ID"
                    + "          ,[OfficeAutomation_Document_Scrap_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_Scrap_Department] as Department"
                    + "          ,[OfficeAutomation_Document_Scrap_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_Scrap_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Scrap_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Scrap_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,todi.OfficeAutomation_Document_Scrap_Remark as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Scrap] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Scrap_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_Scrap_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_AssetTransfer_ID] as ID"
                    + "          ,[OfficeAutomation_Document_AssetTransfer_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_AssetTransfer_Department] as Department"
                    + "          ,[OfficeAutomation_Document_AssetTransfer_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_AssetTransfer_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AssetTransfer_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AssetTransfer_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_AssetTransfer_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_AssetTransfer] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_AssetTransfer_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_AssetTransfer_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_DealOffice_ID] as ID"
                    + "          ,[OfficeAutomation_Document_DealOffice_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_DealOffice_Department] as Department"
                    + "          ,[OfficeAutomation_Document_DealOffice_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_DealOffice_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,'' as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_DealOffice] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_DealOffice_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_DealOffice_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ITBuy_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ITBuy_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ITBuy_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ITBuy_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ITBuy_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITBuy_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITBuy_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ITBuy_ApplyID]+' '+[OfficeAutomation_Document_ITBuy_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ITBuy] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ITBuy_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ITBuy_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_PersInterests_ID] as ID"
                    + "          ,[OfficeAutomation_Document_PersInterests_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_PersInterests_Department] as Department"
                    + "          ,[OfficeAutomation_Document_PersInterests_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_PersInterests_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PersInterests_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PersInterests_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_PersInterests_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_PersInterests] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_PersInterests_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_PersInterests_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_BuyBuilding_ID] as ID"
                    + "          ,[OfficeAutomation_Document_BuyBuilding_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_BuyBuilding_Department] as Department"
                    + "          ,[OfficeAutomation_Document_BuyBuilding_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_BuyBuilding_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_BuyBuilding_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BuyBuilding] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BuyBuilding_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_BuyBuilding_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_CarAllowance_ID] as ID"
                    + "          ,[OfficeAutomation_Document_CarAllowance_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_CarAllowance_Department] as Department"
                    + "          ,[OfficeAutomation_Document_CarAllowance_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_CarAllowance_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_CarAllowance_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CarAllowance] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CarAllowance_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_CarAllowance_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_BackComm_ID] as ID"
                    + "          ,[OfficeAutomation_Document_BackComm_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_BackComm_Department] as Department"
                    + "          ,[OfficeAutomation_Document_BackComm_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_BackComm_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BackComm_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BackComm_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_BackComm_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BackComm] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BackComm_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_BackComm_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_BadDebts_ID] as ID"
                    + "          ,[OfficeAutomation_Document_BadDebts_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_BadDebts_Department] as Department"
                    + "          ,[OfficeAutomation_Document_BadDebts_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_BadDebts_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_BadDebts_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BadDebts] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BadDebts_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_BadDebts_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ReduceComm_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ReduceComm_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ReduceComm_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ReduceComm_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ReduceComm_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ReduceComm_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ReduceComm] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ReduceComm_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ReduceComm_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ProjCost_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ProjCost_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ProjCost_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ProjCost_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ProjCost_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ProjCost_Project] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjCost] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjCost_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ProjCost_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_CoopCost_ID] as ID"
                    + "          ,[OfficeAutomation_Document_CoopCost_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_CoopCost_Department] as Department"
                    + "          ,[OfficeAutomation_Document_CoopCost_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_CoopCost_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_CoopCost_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CoopCost] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CoopCost_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_CoopCost_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_UndertakeProj_ID] as ID"
                    + "          ,[OfficeAutomation_Document_UndertakeProj_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_UndertakeProj_Department] as Department"
                    + "          ,[OfficeAutomation_Document_UndertakeProj_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_UndertakeProj_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_UndertakeProj_Project] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_UndertakeProj] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_UndertakeProj_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_UndertakeProj_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ExtraBonus_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ExtraBonus_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ExtraBonus_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ExtraBonus_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ExtraBonus_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ExtraBonus_Project] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ExtraBonus] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ExtraBonus_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ExtraBonus_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ResumeBusi_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ResumeBusi_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ResumeBusi_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ResumeBusi_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ResumeBusi_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ResumeBusi_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ResumeBusi_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ResumeBusi_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ResumeBusi] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ResumeBusi_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ResumeBusi_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_WithdrawShop_ID] as ID"
                    + "          ,[OfficeAutomation_Document_WithdrawShop_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_WithdrawShop_Department] as Department"
                    + "          ,[OfficeAutomation_Document_WithdrawShop_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_WithdrawShop_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WithdrawShop_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WithdrawShop_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_WithdrawShop_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_WithdrawShop] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_WithdrawShop_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_WithdrawShop_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_SuspendBusi_ID] as ID"
                    + "          ,[OfficeAutomation_Document_SuspendBusi_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_SuspendBusi_Department] as Department"
                    + "          ,[OfficeAutomation_Document_SuspendBusi_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_SuspendBusi_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SuspendBusi_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SuspendBusi_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_SuspendBusi_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SuspendBusi] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SuspendBusi_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_SuspendBusi_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ProjAgentClause_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ProjAgentClause_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ProjAgentClause_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ProjAgentClause_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ProjAgentClause_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ProjAgentClause_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjAgentClause] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjAgentClause_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ProjAgentClause_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ProjWorkCloth_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ProjWorkCloth_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ProjWorkCloth_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ProjWorkCloth_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ProjWorkCloth_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjWorkCloth_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjWorkCloth_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ProjWorkCloth_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjWorkCloth] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjWorkCloth_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ProjWorkCloth_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ProjDormSubsiby_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ProjDormSubsiby_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ProjDormSubsiby_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ProjDormSubsiby_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ProjDormSubsiby_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ProjDormSubsiby_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjDormSubsiby] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjDormSubsiby_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ProjDormSubsiby_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ProjRepoData_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ProjRepoData_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ProjRepoData_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ProjRepoData_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ProjRepoData_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ProjRepoData_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjRepoData] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjRepoData_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ProjRepoData_MainID IN " + sqlIn;
            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ProjLinkRepoData_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ProjLinkRepoData_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ProjLinkRepoData_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Remark] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjLinkRepoData] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjLinkRepoData_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ProjLinkRepoData_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ChangeData_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ChangeData_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ChangeData_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ChangeData_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ChangeData_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeData_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeData_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ChangeData_Reason] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ChangeData] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ChangeData_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ChangeData_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_CommissionAdjust_ID] as ID"
                    + "          ,[OfficeAutomation_Document_CommissionAdjust_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_CommissionAdjust_Department] as Department"
                    + "          ,[OfficeAutomation_Document_CommissionAdjust_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_CommissionAdjust_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAdjust_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAdjust_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_CommissionAdjust_Property] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CommissionAdjust] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CommissionAdjust_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_CommissionAdjust_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_WirelessFixedLine_ID] as ID"
                    + "          ,[OfficeAutomation_Document_WirelessFixedLine_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,'项目部' as Department"
                    + "          ,[OfficeAutomation_Document_WirelessFixedLine_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_WirelessFixedLine_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WirelessFixedLine_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WirelessFixedLine_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_WirelessFixedLine_ApplyID] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_WirelessFixedLine] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_WirelessFixedLine_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_WirelessFixedLine_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_FurtherEducation_ID] as ID"
                    + "          ,[OfficeAutomation_Document_FurtherEducation_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_FurtherEducation_Department] as Department"
                    + "          ,[OfficeAutomation_Document_FurtherEducation_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_FurtherEducation_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_FurtherEducation_ApplyID] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_FurtherEducation] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_FurtherEducation_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_FurtherEducation_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_SpecialNumber_ID] as ID"
                    + "          ,[OfficeAutomation_Document_SpecialNumber_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_SpecialNumber_Department] as Department"
                    + "          ,[OfficeAutomation_Document_SpecialNumber_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_SpecialNumber_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_SpecialNumber_Subject] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SpecialNumber] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SpecialNumber_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_SpecialNumber_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_OfficialSeal_ID] as ID"
                    + "          ,[OfficeAutomation_Document_OfficialSeal_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_OfficialSeal_Department] as Department"
                    + "          ,[OfficeAutomation_Document_OfficialSeal_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_OfficialSeal_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,(SELECT OfficeAutomation_Document_OfficialSeal_Detail_TransFile + '；' FROM t_OfficeAutomation_Document_OfficialSeal_Detail WHERE OfficeAutomation_Document_OfficialSeal_Detail_MainID = OfficeAutomation_Document_OfficialSeal_ID FOR XML PATH('')) as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_OfficialSeal] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_OfficialSeal_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_OfficialSeal_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_BranchContract_ID] as ID"
                    + "          ,[OfficeAutomation_Document_BranchContract_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_BranchContract_Department] as Department"
                    + "          ,[OfficeAutomation_Document_BranchContract_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_BranchContract_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BranchContract_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BranchContract_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_BranchContract_Name] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BranchContract] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BranchContract_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_BranchContract_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_Tourism_ID] as ID"
                    + "          ,[OfficeAutomation_Document_Tourism_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_Tourism_Department] as Department"
                    + "          ,[OfficeAutomation_Document_Tourism_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_Tourism_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Tourism_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Tourism_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_Tourism_ActivityPlace] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Tourism] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Tourism_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_Tourism_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_OweSubmit_ID] as ID"
                    + "          ,[OfficeAutomation_Document_OweSubmit_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_OweSubmit_Department] as Department"
                    + "          ,[OfficeAutomation_Document_OweSubmit_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_OweSubmit_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OweSubmit_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OweSubmit_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_OweSubmit_Name] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_OweSubmit] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_OweSubmit_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_OweSubmit_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_TotalRev_ID] as ID"
                    + "          ,[OfficeAutomation_Document_TotalRev_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_TotalRev_Department] as Department"
                    + "          ,[OfficeAutomation_Document_TotalRev_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_TotalRev_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_TotalRev_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_TotalRev_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_TotalRev_Subject] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_TotalRev] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_TotalRev_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_TotalRev_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_Feasibility_ID] as ID"
                    + "          ,[OfficeAutomation_Document_Feasibility_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_Feasibility_Department] as Department"
                    + "          ,[OfficeAutomation_Document_Feasibility_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_Feasibility_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Feasibility_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Feasibility_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_Feasibility_Branch] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Feasibility] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Feasibility_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_Feasibility_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_AfterCommission_ID] as ID"
                    + "          ,[OfficeAutomation_Document_AfterCommission_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_AfterCommission_Department] as Department"
                    + "          ,[OfficeAutomation_Document_AfterCommission_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_AfterCommission_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AfterCommission_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AfterCommission_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_AfterCommission_Subject] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_AfterCommission] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_AfterCommission_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_AfterCommission_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_LegalCommission_ID] as ID"
                    + "          ,[OfficeAutomation_Document_LegalCommission_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_LegalCommission_Department] as Department"
                    + "          ,[OfficeAutomation_Document_LegalCommission_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_LegalCommission_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_LegalCommission_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_LegalCommission_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_LegalCommission_Subject] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_LegalCommission] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_LegalCommission_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_LegalCommission_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_GeneralApply_ID] as ID"
                    + "          ,[OfficeAutomation_Document_GeneralApply_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_GeneralApply_Department] as Department"
                    + "          ,[OfficeAutomation_Document_GeneralApply_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_GeneralApply_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_GeneralApply_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_GeneralApply_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_GeneralApply_Subject] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_GeneralApply] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_GeneralApply_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_GeneralApply_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ContractTerms_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ContractTerms_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ContractTerms_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ContractTerms_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ContractTerms_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ContractTerms_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ContractTerms_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ContractTerms_Subject] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ContractTerms] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ContractTerms_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ContractTerms_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_NetSign_ID] as ID"
                    + "          ,[OfficeAutomation_Document_NetSign_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_NetSign_Department] as Department"
                    + "          ,[OfficeAutomation_Document_NetSign_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_NetSign_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_NetSign_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_NetSign_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_NetSign_BudingAddress] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_NetSign] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_NetSign_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_NetSign_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_CommissionOfMonth_ID] as ID"
                    + "          ,[OfficeAutomation_Document_CommissionOfMonth_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_CommissionOfMonth_Department] as Department"
                    + "          ,[OfficeAutomation_Document_CommissionOfMonth_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_CommissionOfMonth_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_CommissionOfMonth_Name] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CommissionOfMonth] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CommissionOfMonth_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_CommissionOfMonth_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_Marketing_ID] as ID"
                    + "          ,[OfficeAutomation_Document_Marketing_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_Marketing_Department] as Department"
                    + "          ,[OfficeAutomation_Document_Marketing_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_Marketing_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Marketing_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Marketing_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_Marketing_Subject] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Marketing] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Marketing_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_Marketing_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_Secondment_ID] as ID"
                    + "          ,[OfficeAutomation_Document_Secondment_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_Secondment_Department] as Department"
                    + "          ,[OfficeAutomation_Document_Secondment_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_Secondment_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Secondment_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Secondment_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_Secondment_AssetsName] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Secondment] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Secondment_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_Secondment_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_CostOfActivity_ID] as ID"
                    + "          ,[OfficeAutomation_Document_CostOfActivity_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_CostOfActivity_Department] as Department"
                    + "          ,[OfficeAutomation_Document_CostOfActivity_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_CostOfActivity_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CostOfActivity_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CostOfActivity_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_CostOfActivity_Subject] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CostOfActivity] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CostOfActivity_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_CostOfActivity_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_PunishTerms_ID] as ID"
                    + "          ,[OfficeAutomation_Document_PunishTerms_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_PunishTerms_Department] as Department"
                    + "          ,[OfficeAutomation_Document_PunishTerms_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_PunishTerms_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PunishTerms_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PunishTerms_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_PunishTerms_Contract] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_PunishTerms] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_PunishTerms_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_PunishTerms_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_ChangeNS_ID] as ID"
                    + "          ,[OfficeAutomation_Document_ChangeNS_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_ChangeNS_Department] as Department"
                    + "          ,[OfficeAutomation_Document_ChangeNS_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_ChangeNS_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeNS_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeNS_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_ChangeNS_Location] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ChangeNS] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ChangeNS_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_ChangeNS_MainID IN " + sqlIn;

            sql += " union ";

            sql += "SELECT [OfficeAutomation_Document_SpecialCase_ID] as ID"
                    + "          ,[OfficeAutomation_Document_SpecialCase_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_SpecialCase_Department] as Department"
                    + "          ,[OfficeAutomation_Document_SpecialCase_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_SpecialCase_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialCase_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                      FROM   t_OfficeAutomation_Flow f"
                    + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialCase_MainID]"
                    + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "             WHEN 3 THEN '已完成'"
                    + "           END AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_SpecialCase_Location] as Remark"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SpecialCase] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SpecialCase_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " WHERE todi.OfficeAutomation_Document_SpecialCase_MainID IN " + sqlIn;






            sql += " order by ApplyDate desc";

            return RunSQL(sql);
        }
        #endregion

        #region 查询资产

        /// <summary>
        /// 查询所有资产
        /// </summary>
        /// <param name="Department">部门名称</param>
        /// <param name="Department">财务编号</param>
        /// <param name="Department">资产类型</param>
        /// <param name="Department">入账时间</param>
        /// <param name="Department">结束入账时间</param>
        /// <returns></returns>
        public DataSet SelectAssets(string Department, string AssetNo, string Classes, string BeginTime, string EndTime)
        {
            string sql;
            if (System.Configuration.ConfigurationSettings.AppSettings["IsTesting"] == "True")
                sql = "EXEC [GZCXXGC14T].[DB_Administration].[dbo].[sp_t_Assets_Asset_Seach]";
            else
                sql = "EXEC [DB_Administration].[dbo].[sp_t_Assets_Asset_Seach]";
            sql += "@txtAsset_Department = '" + Department + "',"
                + "@Asset_AssetNo = '" + AssetNo + "',"
                + "@Asset_Classes = '" + Classes + "',"
                + "@beginAsset_RecordedTime = '" + BeginTime + "',"
                + "@endAsset_RecordedTime = '" + EndTime + "'";

            return RunSQL(sql);
        }

        /// <summary>
        /// 根据ID查询资产
        /// </summary>
        /// <param name="AssetID">主键</param>
        /// <returns></returns>
        public DataSet FindAssetsByID(string AssetID)
        {
            string sql;
            if (System.Configuration.ConfigurationSettings.AppSettings["IsTesting"] == "True")
                sql = "EXEC [GZCXXGC14T].[DB_Administration].[dbo].[sp_t_Assets_Asset_SelectOneDetail]";
            else
                sql = "EXEC [DB_Administration].[dbo].[sp_t_Assets_Asset_SelectOneDetail]";
            sql += "@Asset_Id = '" + AssetID + "'";
            return RunSQL(sql);
        }

        /// <summary>
        /// 根据账务编号查询资产
        /// </summary>
        /// <param name="AssetID">主键</param>
        /// <returns></returns>
        public DataSet FindAssetsByAssetNo(string AssetID)
        {
            string sql;
            if (System.Configuration.ConfigurationSettings.AppSettings["IsTesting"] == "True")
                sql = "EXEC [GZCXXGC14T].[DB_Administration].[dbo].[sp_t_Assets_Asset_SelectDetailByAssetNo]";
            else
                sql = "EXEC [DB_Administration].[dbo].[sp_t_Assets_Asset_SelectDetailByAssetNo]";
            sql += "@Asset_AssetNo = '" + AssetID + "'";
            return RunSQL(sql);
        }

        #endregion

        #region 数据汇总
        /// <summary>
        /// 查询相应的汇总数据 //键值在：t_Dic_OfficeAutomation_Document
        /// </summary>
        public DataSet SummaryData(string eid, string nt, bool isAdmin, string applicationDepartment, string applicant, string begin, string end, string applyType, string state, string employee, string code, string purview, string serialNumber, string keyWord, int cstatue, string approver, string apptime, string apptotime)
        {
            string myAgency = "";
            DA_OfficeAutomation_Agent_Inherit da_OfficeAutomation_Agent_Inherit = new DA_OfficeAutomation_Agent_Inherit();
            DataSet ds = da_OfficeAutomation_Agent_Inherit.GetMyAgencyForAgent(employee, code);
            string myAgency2 = da_OfficeAutomation_Agent_Inherit.GetMyAgencyForSQL(employee, code);
            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    myAgency += " OR (auditoridsum LIKE '%" + dr["OfficeAutomation_Agent_AuditorID"].ToString()
                        + "%' AND auditorsum LIKE '%" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "%')";
                }
            }

            string sql = "";

            if (!isAdmin || approver != "")
            {
                sql += "CREATE TABLE #ab"
                       + " ("
                       + "    OfficeAutomation_Flow_MainID UNIQUEIDENTIFIER,"
                       + "    auditorsum                   NVARCHAR(2000),"
                       + "    auditoridsum                NVARCHAR(2000),"
                       + "    DocumentID                 int"
                       + "  )"
                       + " INSERT INTO #ab"
                       + "                     (OfficeAutomation_Flow_MainID,"
                       + "                      auditorsum,"
                       + "                      auditoridsum)"
                    //+ " SELECT *"
                    //+ " FROM   vw_SumAuditor";
                       + " SELECT OfficeAutomation_Flow_MainID,"
                       + "            CASE WHEN toam.OfficeAutomation_Main_AuditorNamesSum IS NULL then dbo.Fun_sum_employee(OfficeAutomation_Flow_MainID) ELSE toam.OfficeAutomation_Main_AuditorNamesSum END   AS auditorsum,"
                       + "            CASE WHEN toam.OfficeAutomation_Main_AuditorIDsSum IS NULL then dbo.Fun_sum_employeeid(OfficeAutomation_Flow_MainID) ELSE toam.OfficeAutomation_Main_AuditorIDsSum END   AS auditoridsum"
                       + " FROM  dbo.t_OfficeAutomation_Flow AS toaf"
                       + "            LEFT JOIN t_OfficeAutomation_Main toam"
                       + "                      ON toaf.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID"
                       + " WHERE 1=1";

                if (state != "")
                    sql += " AND toam.OfficeAutomation_Main_FlowStateID=" + state;
                if (applyType != "")
                    sql += " AND toam.OfficeAutomation_DocumentID=" + applyType;
                if (serialNumber != "")
                    sql += " AND toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

                sql += " GROUP BY OfficeAutomation_Flow_MainID,OfficeAutomation_Main_AuditorNamesSum,OfficeAutomation_Main_AuditorIDsSum";
            }

            string smax = null, slet = null, sgroup = null, sn = null;
            switch (applyType)
            {
                case "55":
                    if (nt == "1")
                        sn = "ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "LastFlowCT";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                    }
                    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Propaganda_MainID";
                    sgroup = " GROUP BY [OfficeAutomation_Document_Propaganda_ID]"
                        + "          ,[OfficeAutomation_Document_Propaganda_MainID]"
                        + "          ,[OfficeAutomation_Document_Propaganda_Department]"
                        + "          ,[OfficeAutomation_Document_Propaganda_ApplyDate]"
                        + "          ,[OfficeAutomation_Document_Propaganda_Apply]"
                        + "          ,toam.OfficeAutomation_SerialNumber"
                        + "          ,toam.OfficeAutomation_Main_FlowStateID"
                        + "          ,tdoad.OfficeAutomation_Document_Name"
                        + "          ,toam.[OfficeAutomation_SerialNumber]"
                        + "          ,OfficeAutomation_Document_Propaganda_ApplyID"
                        + "          ,OfficeAutomation_Document_Propaganda_Conneter"
                        + "          ,OfficeAutomation_Document_Propaganda_BranchAddress"
                        + "          ,OfficeAutomation_Document_Propaganda_SumPrice"
                        + "          ,OfficeAutomation_Document_Propaganda_KindOfAdvertising"
                        + "          ,OfficeAutomation_Document_Propaganda_AnotherAdvertising"
                        + "          ,OfficeAutomation_Document_Propaganda_KindOfPrinting"
                        + "          ,OfficeAutomation_Document_Propaganda_AnotherPrinting"
                        + "          ,OfficeAutomation_Document_Propaganda_KindOfMaterial"
                        + "          ,OfficeAutomation_Document_Propaganda_AnotherMaterial"
                        + "          ,OfficeAutomation_Document_Propaganda_KindOfActivity"
                        + "          ,OfficeAutomation_Document_Propaganda_AnotherActivity"
                        + "          ,OfficeAutomation_Document_Propaganda_KindOfMap"
                        + "          ,OfficeAutomation_Document_Propaganda_AnotherMap"
                        + "          ,OfficeAutomation_Document_Propaganda_KindOfGift"
                        + "          ,OfficeAutomation_Document_Propaganda_AnotherGift"
                        + "          ,OfficeAutomation_Document_Propaganda_KindOfSend"
                        + "          ,OfficeAutomation_Document_Propaganda_AnotherSend"
                        + "          ,OfficeAutomation_Document_Propaganda_KindOfAnother"
                        + "          ,OfficeAutomation_Document_Propaganda_AnotherAnother"
                        + "          ,OfficeAutomation_Document_Propaganda_Summary"
                        + "          ,OfficeAutomation_Document_Propaganda_Width"
                        + "          ,OfficeAutomation_Document_Propaganda_Height"
                        + "          ,OfficeAutomation_Document_Propaganda_Count"
                        + "          ,OfficeAutomation_Document_Propaganda_Package"
                        + "          ,OfficeAutomation_Document_Propaganda_DemandDate"
                        + "          ,OfficeAutomation_Document_Propaganda_PaySituation"
                        + "          ,OfficeAutomation_Document_Propaganda_PayProjectName"
                        + "          ,OfficeAutomation_Document_Propaganda_FearNo"
                        + "          ,OfficeAutomation_Document_Propaganda_AcceptDate"
                        + "          ,OfficeAutomation_Document_Propaganda_Accepter"
                        + "          ,OfficeAutomation_Document_Propaganda_Designer"
                        + "          ,OfficeAutomation_Document_Propaganda_Reason"
                        + "          ,OfficeAutomation_Document_Propaganda_Verifyer"
                        + "          ,OfficeAutomation_Document_Propaganda_TNo"
                        + "          ,OfficeAutomation_Document_Propaganda_VerifyDate"
                        //+ "          ,dt.OfficeAutomation_Document_Propaganda_Detail_Department"
                        //+ "          ,dt.OfficeAutomation_Document_Propaganda_Detail_Count"
                        + "          ,st.OfficeAutomation_Document_Propaganda_Statistical_SDepartment"
                        + "          ,st.OfficeAutomation_Document_Propaganda_Statistical_Address"
                        + "          ,st.OfficeAutomation_Document_Propaganda_Statistical_SCount"
                        + "          ,OfficeAutomation_Document_Propaganda_Score_DesignScore1"
                        + "          ,OfficeAutomation_Document_Propaganda_Score_DesignScore2"
                        + "          ,OfficeAutomation_Document_Propaganda_Score_DesignScore3"
                        + "          ,OfficeAutomation_Document_Propaganda_Score_AccepterScore1"
                        + "          ,OfficeAutomation_Document_Propaganda_Score_AccepterScore2"
                        + "          ,OfficeAutomation_Document_Propaganda_Score_AccepterScore3"
                        + "          ,OfficeAutomation_Document_Propaganda_Score_DesignScore1Remarks"
                        + "          ,OfficeAutomation_Document_Propaganda_Score_DesignScore2Remarks"
                        + "          ,OfficeAutomation_Document_Propaganda_Score_DesignScore3Remarks"
                        + "          )) AS Propaganda_Count";
                    break;
                case "56":
                    if (nt == "1")
                        sn = "ApplyDate";
                    else if (nt == "2") 
                    {
                        sn = "LastFlowCT";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                    }
                    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Budgetab_MainID";
                    sgroup = " GROUP BY [OfficeAutomation_Document_Budgetab_ID]"
                        + "          ,[OfficeAutomation_Document_Budgetab_MainID]"
                        + "          ,[OfficeAutomation_Document_Budgetab_Department]"
                        + "          ,[OfficeAutomation_Document_Budgetab_ApplyDate]"
                        + "          ,[OfficeAutomation_Document_Budgetab_Apply]"
                        + "          ,toam.OfficeAutomation_SerialNumber"
                        + "          ,toam.OfficeAutomation_Main_FlowStateID"
                        + "          ,tdoad.OfficeAutomation_Document_Name"
                        + "          ,toam.[OfficeAutomation_SerialNumber]"
                        + "          ,OfficeAutomation_Document_Budgetab_ApplyID"
                        + "          ,OfficeAutomation_Document_Budgetab_Phone"
                        + "          ,OfficeAutomation_Document_Budgetab_AProject"
                        + "          ,OfficeAutomation_Document_Budgetab_Akind"
                        + "          ,OfficeAutomation_Document_Budgetab_Aitem"
                        + "          ,OfficeAutomation_Document_Budgetab_AdjustableKind"
                        + "          ,OfficeAutomation_Document_Budgetab_AdjustableItem"
                        + "          ,OfficeAutomation_Document_Budgetab_Price"
                        + "          ,OfficeAutomation_Document_Budgetab_AdvertisingItem"
                        + "          ,OfficeAutomation_Document_Budgetab_AdvertisingPrice"
                        + "          ,OfficeAutomation_Document_Budgetab_PrintingItem"
                        + "          ,OfficeAutomation_Document_Budgetab_PrintingPrice"
                        + "          ,OfficeAutomation_Document_Budgetab_MaterialItem"
                        + "          ,OfficeAutomation_Document_Budgetab_MaterialPrice"
                        + "          ,OfficeAutomation_Document_Budgetab_ActivityItem"
                        + "          ,OfficeAutomation_Document_Budgetab_ActivityPrice"
                        + "          ,OfficeAutomation_Document_Budgetab_AnotherItem"
                        + "          ,OfficeAutomation_Document_Budgetab_AnotherPrice"
                        + "          ,OfficeAutomation_Document_Budgetab_Reason"
                        + "          ,OfficeAutomation_Document_Budgetab_Statement"
                        + "          )) AS All_The_Count";
                    break;
                //case "17":
                //    if (nt == "1")
                //        sn = "ApplyDate";
                //    else if (nt == "2")
                //    {
                //        sn = "LastFlowCT";
                //        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                //    }
                //    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ExtraBonus_MainID";
                //    sgroup = " GROUP BY [OfficeAutomation_Document_ExtraBonus_ID]"
                //        + "          ,[OfficeAutomation_Document_ExtraBonus_MainID]"
                //        + "          ,[OfficeAutomation_Document_ExtraBonus_Department]"
                //        + "          ,[OfficeAutomation_Document_ExtraBonus_ApplyDate]"
                //        + "          ,[OfficeAutomation_Document_ExtraBonus_Apply]"
                //        + "          ,toam.OfficeAutomation_SerialNumber"
                //        + "          ,toam.OfficeAutomation_Main_FlowStateID"
                //        + "          ,tdoad.OfficeAutomation_Document_Name"
                //        + "          ,toam.[OfficeAutomation_SerialNumber]"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_ApplyDate"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_Project"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_AgentStartDate"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_AgentEndDate"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_ClientGuardStartDate"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_ClientGuardEndDate"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_AgentRule"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_ApplyCashRewardValidityDurationStartDate"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_ApplyCashRewardValidityDurationEndDate"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_RewardRule"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_RewardPayTypeID"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_RewardPayTypeOtherCase"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_IsSubmitConfirmation"
                //        + "          ,OfficeAutomation_Document_ExtraBonus_AreaPromiseSubmitDate"
                //        + "          ,dt.OfficeAutomation_Document_ExtraBonus_Detail_SetNumber"
                //        + "          ,dt.OfficeAutomation_Document_ExtraBonus_Detail_PriceRange"
                //        + "          ,dt.OfficeAutomation_Document_ExtraBonus_Detail_UnitPrice"
                //        + "          ,dt.OfficeAutomation_Document_ExtraBonus_Detail_PayPerSet"
                //        + "          ,dt.OfficeAutomation_Document_ExtraBonus_Detail_PayActualScale"
                //        + "          )) AS All_The_Count";
                //    break;
                case "45":
                    if (nt == "1")
                        sn = "ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "LastFlowCT";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                    }

                    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CostOfActivity_MainID";
                    sgroup = " GROUP BY OfficeAutomation_Main_ID"
                        + "          ,OfficeAutomation_Main_Department"
                        + "          , OfficeAutomation_Document_CostOfActivity_ID"
                         + "   ,OfficeAutomation_Document_CostOfActivity_MainID"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Department"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Apply"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Man1"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Man2"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Man3"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Man4"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Man5"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Man6"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Fear1"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Fear2"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Fear3"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Fear4"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Fear5"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_Fear6"
						 + " 				   ,OfficeAutomation_Document_CostOfActivity_ApplyDate "
                        + "          ,OfficeAutomation_Document_CostOfActivity_Cycle"
                        + "          ,toam.OfficeAutomation_SerialNumber"
                        + "          ,toam.OfficeAutomation_Main_FlowStateID"
                        + "          ,tdoad.OfficeAutomation_Document_Name"
                        + "          )) AS All_The_Count";
                    break;
                case "62":
                    if (nt == "1")
                        sn = "ApplyDate";
                    else if (nt == "2") 
                    {
                        sn = "LastFlowCT";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                    }

                    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_UtContract_MainID";
                    sgroup = " GROUP BY OfficeAutomation_Document_UtContract_ACName,[OfficeAutomation_Document_UtContract_ID],OfficeAutomation_Document_UtContract_ddlProjectAddress,OfficeAutomation_Main_ID"
                        + "          ,[OfficeAutomation_Document_UtContract_MainID]"
                        + "          ,[OfficeAutomation_Document_UtContract_Department]"
                        + "          ,[OfficeAutomation_Document_UtContract_ApplyDate]"
                        + "          ,[OfficeAutomation_Document_UtContract_Apply]"
                        + "          ,OfficeAutomation_Document_UtContract_Name1"
                        + "          ,OfficeAutomation_Document_UtContract_Name2"
                        + "          ,OfficeAutomation_Main_Department"
                        +"	,OfficeAutomation_Document_UtContract_IsDirectContract,OfficeAutomation_Document_UtContract_DirectContractName,OfficeAutomation_Document_UtContract_DirectContractType"
                        + "          ,OfficeAutomation_Document_UtContract_Developer"
                         + "          ,OfficeAutomation_Document_UtContract_GroupName"
                        + "          ,OfficeAutomation_Document_UtContract_GroupName"
                        + "          ,OfficeAutomation_Document_UtContract_BaseAgent"
                        + "          ,OfficeAutomation_Document_UtContract_BaseAgentOther"
                        + "          ,OfficeAutomation_Document_UtContract_DealType"
                        + "          ,OfficeAutomation_Document_UtContract_ProjectArea"
                        + "          ,OfficeAutomation_Document_UtContract_LastBeginDate"
                        + "          ,OfficeAutomation_Document_UtContract_LastEndDate"
                        + "          ,OfficeAutomation_Document_UtContract_LastSumNum"
                        + "          ,OfficeAutomation_Document_UtContract_Turnover"
                        + "          ,OfficeAutomation_Document_UtContract_LastResults"
                        + "          ,OfficeAutomation_Document_UtContract_CumulativeBeginDate"
                        + "          ,OfficeAutomation_Document_UtContract_CumulativeEndDate"
                        + "          ,OfficeAutomation_Document_UtContract_CumulativeNum"
                        + "          ,OfficeAutomation_Document_UtContract_SumTurnover"
                        + "          ,OfficeAutomation_Document_UtContract_CumulativeResults"
                        + "          ,OfficeAutomation_Document_UtContract_DealOfficeTypeIDs"
                        + "          ,OfficeAutomation_Document_UtContract_IsStree"
                        + "          ,OfficeAutomation_Document_UtContract_IsMarking"
                        + "          ,OfficeAutomation_Document_UtContract_IsBusiness"
                        + "          ,OfficeAutomation_Document_UtContract_IsBackRent"
                        + "          ,OfficeAutomation_Document_UtContract_txtProjectAddress"
                        + "          ,OfficeAutomation_Document_UtContract_txtReportAddress"
                        + "          ,OfficeAutomation_Document_UtContract_DeveloperContacter"
                        + "          ,OfficeAutomation_Document_UtContract_DeveloperContacterPosition"
                        + "          ,OfficeAutomation_Document_UtContract_DeveloperContacterPhone"
                        + "          ,OfficeAutomation_Document_UtContract_AreaFollowerContacter"
                        + "          ,OfficeAutomation_Document_UtContract_AreaFollowerContacterPosition"
                        + "          ,OfficeAutomation_Document_UtContract_AreaFollowerContacterPhone"
                        + "          ,OfficeAutomation_Document_UtContract_AreaCheckDataer"
                        + "          ,OfficeAutomation_Document_UtContract_AreaCheckDataerCode"
                        + "          ,OfficeAutomation_Document_UtContract_AreaCheckDataerPhone"
                        + "          ,OfficeAutomation_Document_UtContract_Square"
                        + "          ,OfficeAutomation_Document_UtContract_SetNumber"
                        + "          ,OfficeAutomation_Document_UtContract_UnitPrice"
                        + "          ,OfficeAutomation_Document_UtContract_TotalPrice"
                        + "          ,OfficeAutomation_Document_UtContract_IsCoopWithECommerce"
                        + "          ,OfficeAutomation_Document_UtContract_CoopWithE1"
                        + "          ,OfficeAutomation_Document_UtContract_CoopWithE2"
                        + "          ,OfficeAutomation_Document_UtContract_CoopWithE3"
                        + "          ,OfficeAutomation_Document_UtContract_CoopWithE4"
                        + "          ,OfficeAutomation_Document_UtContract_CoopWithE5"
                        + "          ,OfficeAutomation_Document_UtContract_ECommerceName"
                        + "          ,OfficeAutomation_Document_UtContract_ECommerceName2"
                        + "          ,OfficeAutomation_Document_UtContract_ProjFear"
                        + "          ,OfficeAutomation_Document_UtContract_ProjSum1"
                        + "          ,OfficeAutomation_Document_UtContract_ProjSum2"
                        + "          ,OfficeAutomation_Document_UtContract_ProjSum3"
                        + "          ,OfficeAutomation_Document_UtContract_OwnerCommFixScale"
                        + "          ,OfficeAutomation_Document_UtContract_OwnerCommAgent"
                        + "          ,OfficeAutomation_Document_UtContract_ClientCommFixScale"
                        + "          ,OfficeAutomation_Document_UtContract_ClientCommAgent"
                        + "          ,OfficeAutomation_Document_UtContract_EBComm"
                        + "          ,OfficeAutomation_Document_UtContract_EBCommAgent"
                        + "          ,OfficeAutomation_Document_UtContract_Remark"
                        + "          ,OfficeAutomation_Document_UtContract_Jubar1"
                        + "          ,OfficeAutomation_Document_UtContract_Jubar2"
                        + "          ,OfficeAutomation_Document_UtContract_Jubar3"
                        + "          ,OfficeAutomation_Document_UtContract_HaveSingleReward"
                        + "          ,OfficeAutomation_Document_UtContract_RewardSignHave"
                        + "          ,OfficeAutomation_Document_UtContract_AnotherRewardC"
                        + "          ,OfficeAutomation_Document_UtContract_DeveloperConditions"
                        + "          ,OfficeAutomation_Document_UtContract_AreaConditions"
                        + "          ,OfficeAutomation_Document_UtContract_PayRewardWay"
                        + "          ,OfficeAutomation_Document_UtContract_IsMyPay"
                        + "          ,OfficeAutomation_Document_UtContract_AreaComfirn"
                        + "          ,OfficeAutomation_Document_UtContract_ReturnBackDate"
                        + "          ,OfficeAutomation_Document_UtContract_TermsOfContract"
                        + "          ,OfficeAutomation_Document_UtContract_TermsOfMajorIssues"
                        + "          ,OfficeAutomation_Document_UtContract_AgentStartDate"
                        + "          ,OfficeAutomation_Document_UtContract_AgentEndDate"
                        + "          ,OfficeAutomation_Document_UtContract_ClientGuardStartDate"
                        + "          ,OfficeAutomation_Document_UtContract_ClientGuardEndDate"
                        + "          ,OfficeAutomation_Document_UtContract_IsProjEarlyCommBack"
                        + "          ,OfficeAutomation_Document_UtContract_OweCommSum"
                        + "          ,OfficeAutomation_Document_UtContract_AreaReason"
                        + "          ,OfficeAutomation_Document_UtContract_OrdMoney"
                        + "          ,OfficeAutomation_Document_UtContract_OrdTaker"
                        + "          ,OfficeAutomation_Document_UtContract_JOrT"
                        + "          ,OfficeAutomation_Document_UtContract_SamePlaceXX1"
                        + "          ,OfficeAutomation_Document_UtContract_AgencyFee1"
                        + "          ,OfficeAutomation_Document_UtContract_IsCashPrize1"
                        + "          ,OfficeAutomation_Document_UtContract_CashPrize1"
                        + "          ,OfficeAutomation_Document_UtContract_IsPFear1"
                        + "          ,OfficeAutomation_Document_UtContract_PFear1"
                        + "          ,OfficeAutomation_Document_UtContract_SamePlaceXX2"
                        + "          ,OfficeAutomation_Document_UtContract_AgencyFee2"
                        + "          ,OfficeAutomation_Document_UtContract_IsCashPrize2"
                        + "          ,OfficeAutomation_Document_UtContract_CashPrize2"
                        + "          ,OfficeAutomation_Document_UtContract_IsPFear2"
                        + "          ,OfficeAutomation_Document_UtContract_PFear2"
                        + "          ,OfficeAutomation_Document_UtContract_SaleMode"
                        + "          ,OfficeAutomation_Document_UtContract_AreaScale1"
                        + "          ,OfficeAutomation_Document_UtContract_MainAreaScale"
                        + "          ,OfficeAutomation_Document_UtContract_DealAreaScale"
                        + "          ,OfficeAutomation_Document_UtContract_AreaScale"
                        + "          ,OfficeAutomation_Document_UtContract_MainAreaScale2"
                        + "          ,OfficeAutomation_Document_UtContract_DealAreaScale2"
                        + "          ,OfficeAutomation_Document_UtContract_Nre"
                        + "          ,OfficeAutomation_Document_UtContract_AnotherCompany"
                        + "          ,OfficeAutomation_Document_UtContract_Rce"
                        + "          ,OfficeAutomation_Document_UtContract_WillBreakUp"
                        + "          ,OfficeAutomation_Document_UtContract_BreakUp"
                        + "          ,OfficeAutomation_Document_UtContract_GuaranTime"
                        + "          ,OfficeAutomation_Document_UtContract_Ncommissions"
                        + "          ,OfficeAutomation_Document_UtContract_Flange"
                        + "          ,OfficeAutomation_Document_UtContract_Lack"
                        + "          ,OfficeAutomation_Document_UtContract_Lack6"
                        + "          ,OfficeAutomation_Document_UtContract_DealS"
                        + "          ,OfficeAutomation_Document_UtContract_AS2"
                        + "          ,OfficeAutomation_Document_UtContract_MS2"
                        + "          ,OfficeAutomation_Document_UtContract_PreCompleteNumber"
                        + "          ,OfficeAutomation_Document_UtContract_PreCompleteMoney"
                        + "          ,OfficeAutomation_Document_UtContract_PreCompleteComm"
                        + "          ,OfficeAutomation_Document_UtContract_FtoZ"
                        + "          ,OfficeAutomation_Document_UtContract_IsUploadF"
                        + "          ,OfficeAutomation_Document_UtContract_OneOrTwo,OfficeAutomation_Document_UtContract_IslimitBuy,OfficeAutomation_Document_UtContract_IslimitSign"
                        + "          ,toam.OfficeAutomation_SerialNumber"
                        + "          ,toam.OfficeAutomation_Main_FlowStateID"
                        + "          ,tdoad.OfficeAutomation_Document_Name"
                        + "          )) AS All_The_Count";
                    break;
                case "63":
                    if (nt == "1")
                        sn = "ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "LastFlowCT";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                    }
                    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_UtNewProj_MainID";
                    sgroup = " GROUP BY OfficeAutomation_Document_UtNewProj_ACName,[OfficeAutomation_Document_UtNewProj_ID],OfficeAutomation_Main_Department,OfficeAutomation_Document_UtNewProj_ddlProjectAddress,OfficeAutomation_Main_ID"
                        + "          ,[OfficeAutomation_Document_UtNewProj_MainID]"
                        + "          ,[OfficeAutomation_Document_UtNewProj_Department]"
                          + "          ,[OfficeAutomation_Document_UtNewProj_Department]"
                        + "          ,[OfficeAutomation_Document_UtNewProj_ApplyDate]"
                        + "          ,[OfficeAutomation_Document_UtNewProj_Apply]"
                        + "          ,OfficeAutomation_Document_UtNewProj_IsDirectContract,OfficeAutomation_Document_UtNewProj_DirectContractName,OfficeAutomation_Document_UtNewProj_DirectContractType"
                        + "          ,OfficeAutomation_Document_UtNewProj_Project"
                        + "          ,OfficeAutomation_Document_UtNewProj_Developer"
                        + "          ,OfficeAutomation_Document_UtNewProj_GroupName"
                        + "          ,OfficeAutomation_Document_UtNewProj_BaseAgent"
                        + "          ,OfficeAutomation_Document_UtNewProj_BaseAgentOther"
                        + "          ,OfficeAutomation_Document_UtNewProj_DealType"
                        + "          ,OfficeAutomation_Document_UtNewProj_ProjectArea"
                        + "          ,OfficeAutomation_Document_UtNewProj_DealOfficeTypeIDs"
                        + "          ,OfficeAutomation_Document_UtNewProj_IsStree"
                        + "          ,OfficeAutomation_Document_UtNewProj_IsMarking"
                        + "          ,OfficeAutomation_Document_UtNewProj_IsBusiness"
                        + "          ,OfficeAutomation_Document_UtNewProj_IsBackRent"
                        + "          ,OfficeAutomation_Document_UtNewProj_txtProjectAddress"
                        + "          ,OfficeAutomation_Document_UtNewProj_txtReportAddress"
                        + "          ,OfficeAutomation_Document_UtNewProj_DeveloperContacter"
                        + "          ,OfficeAutomation_Document_UtNewProj_DeveloperContacterPosition"
                        + "          ,OfficeAutomation_Document_UtNewProj_DeveloperContacterPhone"
                        + "          ,OfficeAutomation_Document_UtNewProj_AreaFollowerContacter"
                        + "          ,OfficeAutomation_Document_UtNewProj_AreaFollowerContacterPosition"
                        + "          ,OfficeAutomation_Document_UtNewProj_AreaFollowerContacterPhone"
                        + "          ,OfficeAutomation_Document_UtNewProj_AreaCheckDataer"
                        + "          ,OfficeAutomation_Document_UtNewProj_AreaCheckDataerCode"
                        + "          ,OfficeAutomation_Document_UtNewProj_AreaCheckDataerPhone"
                        + "          ,OfficeAutomation_Document_UtNewProj_Square"
                        + "          ,OfficeAutomation_Document_UtNewProj_SetNumber"
                        + "          ,OfficeAutomation_Document_UtNewProj_UnitPrice"
                        + "          ,OfficeAutomation_Document_UtNewProj_TotalPrice"
                        + "          ,OfficeAutomation_Document_UtNewProj_IsCoopWithECommerce"
                        + "          ,OfficeAutomation_Document_UtNewProj_CoopWithE1"
                        + "          ,OfficeAutomation_Document_UtNewProj_CoopWithE2"
                        + "          ,OfficeAutomation_Document_UtNewProj_CoopWithE3"
                        + "          ,OfficeAutomation_Document_UtNewProj_CoopWithE4"
                        + "          ,OfficeAutomation_Document_UtNewProj_CoopWithE5"
                        + "          ,OfficeAutomation_Document_UtNewProj_ECommerceName"
                        + "          ,OfficeAutomation_Document_UtNewProj_ECommerceName2"
                        + "          ,OfficeAutomation_Document_UtNewProj_ProjFear"
                        + "          ,OfficeAutomation_Document_UtNewProj_ProjSum1"
                        + "          ,OfficeAutomation_Document_UtNewProj_ProjSum2"
                        + "          ,OfficeAutomation_Document_UtNewProj_ProjSum3"
                        + "          ,OfficeAutomation_Document_UtNewProj_OwnerCommFixScale"
                        + "          ,OfficeAutomation_Document_UtNewProj_OwnerCommAgent"
                        + "          ,OfficeAutomation_Document_UtNewProj_ClientCommFixScale"
                        + "          ,OfficeAutomation_Document_UtNewProj_ClientCommAgent"
                        + "          ,OfficeAutomation_Document_UtNewProj_EBComm"
                        + "          ,OfficeAutomation_Document_UtNewProj_EBCommAgent"
                        + "          ,OfficeAutomation_Document_UtNewProj_Remark"
                        + "          ,OfficeAutomation_Document_UtNewProj_Jubar1"
                        + "          ,OfficeAutomation_Document_UtNewProj_Jubar2"
                        + "          ,OfficeAutomation_Document_UtNewProj_Jubar3"
                        + "          ,OfficeAutomation_Document_UtNewProj_HaveSingleReward"
                        + "          ,OfficeAutomation_Document_UtNewProj_RewardSignHave"
                        + "          ,OfficeAutomation_Document_UtNewProj_AnotherRewardC"
                        + "          ,OfficeAutomation_Document_UtNewProj_DeveloperConditions"
                        + "          ,OfficeAutomation_Document_UtNewProj_AreaConditions"
                        + "          ,OfficeAutomation_Document_UtNewProj_PayRewardWay"
                        + "          ,OfficeAutomation_Document_UtNewProj_IsMyPay"
                        + "          ,OfficeAutomation_Document_UtNewProj_AreaComfirn"
                        + "          ,OfficeAutomation_Document_UtNewProj_ReturnBackDate"
                        + "          ,OfficeAutomation_Document_UtNewProj_TermsOfContract"
                        + "          ,OfficeAutomation_Document_UtNewProj_TermsOfMajorIssues"
                        + "          ,OfficeAutomation_Document_UtNewProj_AgentStartDate"
                        + "          ,OfficeAutomation_Document_UtNewProj_AgentEndDate"
                        + "          ,OfficeAutomation_Document_UtNewProj_ClientGuardStartDate"
                        + "          ,OfficeAutomation_Document_UtNewProj_ClientGuardEndDate"
                        + "          ,OfficeAutomation_Document_UtNewProj_JOrT"
                        + "          ,OfficeAutomation_Document_UtNewProj_SamePlaceXX1"
                        + "          ,OfficeAutomation_Document_UtNewProj_AgencyFee1"
                        + "          ,OfficeAutomation_Document_UtNewProj_IsCashPrize1"
                        + "          ,OfficeAutomation_Document_UtNewProj_CashPrize1"
                        + "          ,OfficeAutomation_Document_UtNewProj_IsPFear1"
                        + "          ,OfficeAutomation_Document_UtNewProj_PFear1"
                        + "          ,OfficeAutomation_Document_UtNewProj_SamePlaceXX2"
                        + "          ,OfficeAutomation_Document_UtNewProj_AgencyFee2"
                        + "          ,OfficeAutomation_Document_UtNewProj_IsCashPrize2"
                        + "          ,OfficeAutomation_Document_UtNewProj_CashPrize2"
                        + "          ,OfficeAutomation_Document_UtNewProj_IsPFear2"
                        + "          ,OfficeAutomation_Document_UtNewProj_PFear2"
                        + "          ,OfficeAutomation_Document_UtNewProj_SaleMode"
                        + "          ,OfficeAutomation_Document_UtNewProj_AreaScale1"
                        + "          ,OfficeAutomation_Document_UtNewProj_MainAreaScale"
                        + "          ,OfficeAutomation_Document_UtNewProj_DealAreaScale"
                        + "          ,OfficeAutomation_Document_UtNewProj_AreaScale"
                        + "          ,OfficeAutomation_Document_UtNewProj_MainAreaScale2"
                        + "          ,OfficeAutomation_Document_UtNewProj_DealAreaScale2"
                        + "          ,OfficeAutomation_Document_UtNewProj_Nre"
                        + "          ,OfficeAutomation_Document_UtNewProj_AnotherCompany"
                        + "          ,OfficeAutomation_Document_UtNewProj_Rce"
                        + "          ,OfficeAutomation_Document_UtNewProj_WillBreakUp"
                        + "          ,OfficeAutomation_Document_UtNewProj_BreakUp"
                        + "          ,OfficeAutomation_Document_UtNewProj_Ncommissions"
                        + "          ,OfficeAutomation_Document_UtNewProj_Flange"
                        + "          ,OfficeAutomation_Document_UtNewProj_Lack"
                        + "          ,OfficeAutomation_Document_UtNewProj_Lack6"
                        + "          ,OfficeAutomation_Document_UtNewProj_DealS"
                        + "          ,OfficeAutomation_Document_UtNewProj_OneOrTwo"
                        + "          ,OfficeAutomation_Document_UtNewProj_AS2"
                        + "          ,OfficeAutomation_Document_UtNewProj_MS2"
                        + "          ,OfficeAutomation_Document_UtNewProj_PreCompleteNumber"
                        + "          ,OfficeAutomation_Document_UtNewProj_PreCompleteMoney"
                        + "          ,OfficeAutomation_Document_UtNewProj_PreCompleteComm"
                        + "          ,OfficeAutomation_Document_UtNewProj_FtoZ"
                        + "          ,OfficeAutomation_Document_UtNewProj_IsUploadF,OfficeAutomation_Document_UtNewProj_IslimitBuy,OfficeAutomation_Document_UtNewProj_IslimitSign"
                        + "          ,toam.OfficeAutomation_SerialNumber"
                        + "          ,toam.OfficeAutomation_Main_FlowStateID"
                        + "          ,tdoad.OfficeAutomation_Document_Name"
                        + "          )) AS All_The_Count";
                    break;
                case "9":
                    if (nt == "1")
                        sn = "ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "LastFlowCT";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                    }
                    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BuyBuilding_MainID";
                    sgroup = " GROUP BY [OfficeAutomation_Document_BuyBuilding_ID]"
                        + "          ,[OfficeAutomation_Document_BuyBuilding_MainID]"
                        + "          ,[OfficeAutomation_Document_BuyBuilding_Department]"
                        + "          ,[OfficeAutomation_Document_BuyBuilding_ApplyDate]"
                        + "          ,[OfficeAutomation_Document_BuyBuilding_Apply]"
                        + "          ,toam.OfficeAutomation_SerialNumber"
                        + "          ,toam.OfficeAutomation_Main_FlowStateID"
                        + "          ,tdoad.OfficeAutomation_Document_Name"
                        + "          ,toam.[OfficeAutomation_SerialNumber]"
                        + "          ,OfficeAutomation_Document_BuyBuilding_Position"
                        + "          ,OfficeAutomation_Document_BuyBuilding_ApplyForCode"
                        + "          ,OfficeAutomation_Document_BuyBuilding_ApplyForName"
                        + "          ,OfficeAutomation_Document_BuyBuilding_FreeTypeIDs"
                        + "          ,OfficeAutomation_Document_BuyBuilding_DealTypeID"
                        + "          ,[OfficeAutomation_Document_BuyBuilding_OwnerTypeID]"
                        + ",[OfficeAutomation_Document_BuyBuilding_OwnerRelation]"
                        + ",[OfficeAutomation_Document_BuyBuilding_OwnerIsEmployee]"
                        + ",[OfficeAutomation_Document_BuyBuilding_OwnerFamilyRelation]"
                        + ",[OfficeAutomation_Document_BuyBuilding_OwnerEmployeeCode]"
                        + "          ,OfficeAutomation_Document_BuyBuilding_DealBuild"

                        + "          ,OfficeAutomation_Document_BuyBuilding_MortgageAddressTypeID"
                        + "          ,OfficeAutomation_Document_BuyBuilding_TransNo"
                        + "          ,OfficeAutomation_Document_BuyBuilding_TransAddress"
                        + "          ,OfficeAutomation_Document_BuyBuilding_TransDate"
                        + "          ,OfficeAutomation_Document_BuyBuilding_HouseRegistrant"
                        + "          ,OfficeAutomation_Document_BuyBuilding_IsRebate"
                        + "          ,OfficeAutomation_Document_BuyBuilding_RebateDate"
                        + "          ,OfficeAutomation_Document_BuyBuilding_Instruction"
                        + "          )) AS All_The_Count";
                    break;
                case "10":
                    if (nt == "1")
                        sn = "ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "LastFlowCT";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                    }
                    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CarAllowance_MainID";
                    sgroup = " GROUP BY [OfficeAutomation_Document_CarAllowance_ID]"
                        + "          ,[OfficeAutomation_Document_CarAllowance_MainID]"
                        + "          ,[OfficeAutomation_Document_CarAllowance_Department]"
                        + "          ,[OfficeAutomation_Document_CarAllowance_ApplyDate]"
                        + "          ,[OfficeAutomation_Document_CarAllowance_Apply]"
                        + "          ,toam.OfficeAutomation_SerialNumber"
                        + "          ,toam.OfficeAutomation_Main_FlowStateID"
                        + "          ,tdoad.OfficeAutomation_Document_Name"
                        + "          ,toam.[OfficeAutomation_SerialNumber]"
                        + "          ,OfficeAutomation_Document_CarAllowance_Position"
                        + "          ,OfficeAutomation_Document_CarAllowance_ApplyForCode"
                        + "          ,OfficeAutomation_Document_CarAllowance_ApplyForName"
                        + "          ,OfficeAutomation_Document_CarAllowance_Grade"
                        + "          ,OfficeAutomation_Document_CarAllowance_EffectiveDate"
                        + "          ,OfficeAutomation_Document_CarAllowance_MoneyGradeID"
                        + "          )) AS All_The_Count";
                    break;
                case "70":
                    if (nt == "1")
                        sn = "ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "LastFlowCT";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                    }
                    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_OpenProve_MainID";
                    sgroup = " GROUP BY [OfficeAutomation_Document_OpenProve_ID]"
                        + "          ,[OfficeAutomation_Document_OpenProve_MainID]"
                        + "          ,[OfficeAutomation_Document_OpenProve_Apply]"
                        + "          ,[OfficeAutomation_Document_OpenProve_ApplyDate]"
                        + "          ,[OfficeAutomation_Document_OpenProve_Department]"
                        + "          ,[OfficeAutomation_Document_OpenProve_Code]"
                        + "          ,[OfficeAutomation_Document_OpenProve_Name]"
                        + "          ,[OfficeAutomation_Document_OpenProve_EnterDate]"
                        + "          ,[OfficeAutomation_Document_OpenProve_Position]"
                          + "          ,[OfficeAutomation_Document_OpenProve_Phone]"
                          + "          ,[OfficeAutomation_Document_OpenProve_SignMode]"
                          + "          ,[OfficeAutomation_Document_OpenProve_SignAddress]"
                          + "          ,[OfficeAutomation_Document_OpenProve_SignPhone]"
                          + "          ,[OfficeAutomation_Document_OpenProve_Recipient]"
                          + "          ,[OfficeAutomation_Document_OpenProve_ExceptionalCase]"
                      //  + "          ,[OfficeAutomation_Document_OpenProve_Rank]"
                        + "          ,dt.OfficeAutomation_Document_OpenProve_Detail_Prove"
                        + "          ,dt.OfficeAutomation_Document_OpenProve_Detail_No"
                        + "          ,dt.OfficeAutomation_Document_OpenProve_Detail_Reasondb"
                        + "          ,dt.OfficeAutomation_Document_OpenProve_Detail_Address"
                        + "          ,dt.OfficeAutomation_Document_OpenProve_Detail_Sdate"
                        + "          ,dt.OfficeAutomation_Document_OpenProve_Detail_Edate"
                        + "          ,dt.OfficeAutomation_Document_OpenProve_Detail_AnotherR"
                        + "          ,dt.OfficeAutomation_Document_OpenProve_Detail_Kind"
                        + "          ,dt.OfficeAutomation_Document_OpenProve_Detail_AnotherKind"
                        + "          ,toam.OfficeAutomation_SerialNumber"
                        + "          ,toam.OfficeAutomation_Main_FlowStateID"
                        + "          ,tdoad.OfficeAutomation_Document_Name"
                        + "          )) AS All_The_Count";
                    break;
                case "14":
                    if (nt == "1")
                        sn = "ApplyDate";
                    else if (nt == "2") //*All
                    {
                        sn = "LastFlowCT";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                    }
                    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjCost_MainID";
                    sgroup = " GROUP BY [OfficeAutomation_Document_ProjCost_ID]"
                        + "          ,[OfficeAutomation_Document_ProjCost_MainID]"
                        + "          ,[OfficeAutomation_Document_ProjCost_Apply]"
                        + "          ,[OfficeAutomation_Document_ProjCost_ApplyForName]"
                        + "          ,[OfficeAutomation_Document_ProjCost_ApplyForCode]"
                        + "          ,[OfficeAutomation_Document_ProjCost_Department]"
                        + "          ,[OfficeAutomation_Document_ProjCost_DepartmentID]"
                        + "          ,[OfficeAutomation_Document_ProjCost_ApplyDate]"
                        + "          ,[OfficeAutomation_Document_ProjCost_ReplyPhone]"
                        + "          ,[OfficeAutomation_Document_ProjCost_Project]"
                        + "          ,[OfficeAutomation_Document_ProjCost_Developer]"
                        + "          ,[OfficeAutomation_Document_ProjCost_ProjLeader]"
                        + "          ,[OfficeAutomation_Document_ProjCost_ProjBusiLeader]"
                        + "          ,[OfficeAutomation_Document_ProjCost_DealOfficeTypeID]"
                        + "          ,[OfficeAutomation_Document_ProjCost_Square]"
                        + "          ,[OfficeAutomation_Document_ProjCost_PreProjAgenceFee]"
                        + "          ,[OfficeAutomation_Document_ProjCost_BrokerCostApply]"
                        + "          ,[OfficeAutomation_Document_ProjCost_Receiver]"
                        + "          ,[OfficeAutomation_Document_ProjCost_BrokerCostReason]"
                        + "          ,[OfficeAutomation_Document_ProjCost_BrokerName]"
                        + "          ,[OfficeAutomation_Document_ProjCost_JOrT]"
                        + "          ,[OfficeAutomation_Document_ProjCost_SamePlaceXX1]"
                        + "          ,[OfficeAutomation_Document_ProjCost_SamePlaceXX2]"
                        + "          ,[OfficeAutomation_Document_ProjCost_TurnsAgentXX1]"
                        + "          ,[OfficeAutomation_Document_ProjCost_TurnsAgentXX2]"
                        + "          ,[OfficeAutomation_Document_ProjCost_AgencyFee1]"
                        + "          ,[OfficeAutomation_Document_ProjCost_AgencyFee2]"
                        + "          ,[OfficeAutomation_Document_ProjCost_AgencyFee3]"
                        + "          ,[OfficeAutomation_Document_ProjCost_AgencyFee4]"
                        + "          ,[OfficeAutomation_Document_ProjCost_IsCashPrize1]"
                        + "          ,[OfficeAutomation_Document_ProjCost_IsCashPrize2]"
                        + "          ,[OfficeAutomation_Document_ProjCost_IsCashPrize3]"
                        + "          ,[OfficeAutomation_Document_ProjCost_IsCashPrize4]"
                        + "          ,[OfficeAutomation_Document_ProjCost_CashPrize1]"
                        + "          ,[OfficeAutomation_Document_ProjCost_CashPrize2]"
                        + "          ,[OfficeAutomation_Document_ProjCost_CashPrize3]"
                        + "          ,[OfficeAutomation_Document_ProjCost_CashPrize4]"
                        + "          ,[OfficeAutomation_Document_ProjCost_AgencyBeginDate1]"
                        + "          ,[OfficeAutomation_Document_ProjCost_AgencyBeginDate2]"
                        + "          ,[OfficeAutomation_Document_ProjCost_AgencyEndDate1]"
                        + "          ,[OfficeAutomation_Document_ProjCost_AgencyEndDate2]"
                        + "          ,[OfficeAutomation_Document_ProjCost_IsPFear1]"
                        + "          ,[OfficeAutomation_Document_ProjCost_IsPFear2]"
                        + "          ,[OfficeAutomation_Document_ProjCost_IsPFear3]"
                        + "          ,[OfficeAutomation_Document_ProjCost_IsPFear4]"
                        + "          ,[OfficeAutomation_Document_ProjCost_PFear1]"
                        + "          ,[OfficeAutomation_Document_ProjCost_PFear2]"
                        + "          ,[OfficeAutomation_Document_ProjCost_PFear3]"
                        + "          ,[OfficeAutomation_Document_ProjCost_PFear4]"
                        + "          ,[OfficeAutomation_Document_ProjCost_Remark]"
                        + "          ,toam.OfficeAutomation_SerialNumber"
                        + "          ,toam.OfficeAutomation_Main_FlowStateID"
                        + "          ,tdoad.OfficeAutomation_Document_Name"
                        + "          )) AS All_The_Count";
                    break;
                case "15":
                    if (nt == "1")
                        sn = "ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "LastFlowCT";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                    }
                    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CoopCost_MainID";
                    sgroup = " GROUP BY [OfficeAutomation_Document_CoopCost_ID]"
                        + "          ,[OfficeAutomation_Document_CoopCost_MainID]"
                        + "          ,[OfficeAutomation_Document_CoopCost_Apply]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ApplyForName]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ApplyForCode]"
                        + "          ,[OfficeAutomation_Document_CoopCost_Department]"
                        + "          ,[OfficeAutomation_Document_CoopCost_DepartmentID]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ApplyDate]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ReplyPhone]"
                        + "          ,[OfficeAutomation_Document_CoopCost_DepartmentTypeID]"
                        + "          ,[OfficeAutomation_Document_CoopCost_DealDate]"
                        + "          ,[OfficeAutomation_Document_CoopCost_PropertyName]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ReportID]"
                        + "          ,[OfficeAutomation_Document_CoopCost_DealTypeID]"
                        + "          ,[OfficeAutomation_Document_CoopCost_Area]"
                        + "          ,[OfficeAutomation_Document_CoopCost_DealPrice]"
                        + "          ,[OfficeAutomation_Document_CoopCost_OwnerComm]"
                        + "          ,[OfficeAutomation_Document_CoopCost_OwnerScale]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ClientComm]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ClientScale]"
                        + "          ,[OfficeAutomation_Document_CoopCost_TotalComm]"
                        + "          ,[OfficeAutomation_Document_CoopCost_TotalScale]"
                        + "          ,[OfficeAutomation_Document_CoopCost_BillTypeOwner]"
                        + "          ,[OfficeAutomation_Document_CoopCost_OwnerName]"
                        + "          ,[OfficeAutomation_Document_CoopCost_IsOwner]"
                        + "          ,[OfficeAutomation_Document_CoopCost_OwnerCoopCondition]"
                        + "          ,[OfficeAutomation_Document_CoopCost_OwnerCoopMoney]"
                        + "          ,[OfficeAutomation_Document_CoopCost_OwnerCoopScale]"
                        + "          ,[OfficeAutomation_Document_CoopCost_OwnerCoopTotalScale]"
                        + "          ,[OfficeAutomation_Document_CoopCost_BillTypeClient]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ClientName]"
                        + "          ,[OfficeAutomation_Document_CoopCost_IsClient]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ClientCoopCondition]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ClientCoopMoney]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ClientCoopScale]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ClientCoopTotalScale]"
                        + "          ,[OfficeAutomation_Document_CoopCost_CoopMoney]"
                        + "          ,[OfficeAutomation_Document_CoopCost_CoopTotalScale]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ActualComm]"
                        + "          ,[OfficeAutomation_Document_CoopCost_ActualCommScale]"
                        + "          ,[OfficeAutomation_Document_CoopCost_Remark]"
                        + "          ,toam.OfficeAutomation_SerialNumber"
                        + "          ,toam.OfficeAutomation_Main_FlowStateID"
                        + "          ,tdoad.OfficeAutomation_Document_Name"
                        + "          )) AS All_The_Count";
                    break;
                case "16":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_UndertakeProj_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_UndertakeProj_MainID";
                        sgroup = " GROUP BY [OfficeAutomation_Document_UndertakeProj_ID]"
                         + "          ,[OfficeAutomation_Document_UndertakeProj_MainID]"
                         + "          ,[OfficeAutomation_Document_UndertakeProj_Department]"
                         + "          ,[OfficeAutomation_Document_UndertakeProj_ApplyDate]"
                         + "          ,[OfficeAutomation_Document_UndertakeProj_Apply]"
                         + "          ,OfficeAutomation_Document_UndertakeProj_Project"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AreaScale"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AreaFollowerContacter"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AreaFollowerContacterPhone"
                         + "          ,OfficeAutomation_Document_UndertakeProj_ProjectAddress"
                         + "          ,OfficeAutomation_Document_UndertakeProj_ProjectArea"
                         + "          ,OfficeAutomation_Document_UndertakeProj_SetNumber"
                         + "          ,OfficeAutomation_Document_UndertakeProj_Square"
                         + "          ,OfficeAutomation_Document_UndertakeProj_TotalPrice"
                         + "          ,OfficeAutomation_Document_UndertakeProj_UnitPrice"
                         + "          ,OfficeAutomation_Document_UndertakeProj_MainAreaScale"
                         + "          ,OfficeAutomation_Document_UndertakeProj_GroupName"
                         + "          ,OfficeAutomation_Document_UndertakeProj_TermsOfContract"
                         + "          ,OfficeAutomation_Document_UndertakeProj_Remark"
                         + "          ,OfficeAutomation_Document_UndertakeProj_DealTypeID"
                         + "          ,OfficeAutomation_Document_UndertakeProj_ProjectPropertyID"
                         + "          ,OfficeAutomation_Document_UndertakeProj_DealOfficeTypeIDs"
                         + "          ,OfficeAutomation_Document_UndertakeProj_Developer"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AgentStartDate"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AgentEndDate"
                         + "          ,OfficeAutomation_Document_UndertakeProj_OwnerCommFixScale"
                         + "          ,OfficeAutomation_Document_UndertakeProj_ClientCommFixScale"
                         + "          ,OfficeAutomation_Document_UndertakeProj_EBComm"
                         + "          ,OfficeAutomation_Document_UndertakeProj_HaveSingleReward"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsMallSplit"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsUniteAgent"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsCoopWithECommerce"
                         + "          ,OfficeAutomation_Document_UndertakeProj_ECommerceName"
                         + "          ,OfficeAutomation_Document_UndertakeProj_ProjectCost"
                         + "          ,OfficeAutomation_Document_UndertakeProj_PCDeveloper"
                         + "          ,OfficeAutomation_Document_UndertakeProj_EBDeveloper"
                         + "          ,OfficeAutomation_Document_UndertakeProj_SaleModeID"
                         + "          ,OfficeAutomation_Document_UndertakeProj_JOrT"
                         + "          ,OfficeAutomation_Document_UndertakeProj_SamePlaceXX1"
                         + "          ,OfficeAutomation_Document_UndertakeProj_SamePlaceXX2"
                         + "          ,OfficeAutomation_Document_UndertakeProj_SamePlaceXX3"
                         + "          ,OfficeAutomation_Document_UndertakeProj_SamePlaceXX4"
                         + "          ,OfficeAutomation_Document_UndertakeProj_TurnsAgentXX1"
                         + "          ,OfficeAutomation_Document_UndertakeProj_TurnsAgentXX2"
                         + "          ,OfficeAutomation_Document_UndertakeProj_TurnsAgentXX3"
                         + "          ,OfficeAutomation_Document_UndertakeProj_TurnsAgentXX4"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AgencyFee1"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AgencyFee2"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AgencyFee3"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AgencyFee4"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsCashPrize1"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsCashPrize2"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsCashPrize3"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsCashPrize4"
                         + "          ,OfficeAutomation_Document_UndertakeProj_CashPrize1"
                         + "          ,OfficeAutomation_Document_UndertakeProj_CashPrize2"
                         + "          ,OfficeAutomation_Document_UndertakeProj_CashPrize3"
                         + "          ,OfficeAutomation_Document_UndertakeProj_CashPrize4"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AgencyBeginDate1"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AgencyBeginDate2"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AgencyEndDate1"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AgencyEndDate2"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsPFear1"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsPFear2"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsPFear3"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsPFear4"
                         + "          ,OfficeAutomation_Document_UndertakeProj_PFear1"
                         + "          ,OfficeAutomation_Document_UndertakeProj_PFear2"
                         + "          ,OfficeAutomation_Document_UndertakeProj_PFear3"
                         + "          ,OfficeAutomation_Document_UndertakeProj_PFear4"
                         + "          ,OfficeAutomation_Document_UndertakeProj_SubmitReward"
                         + "          ,OfficeAutomation_Document_UndertakeProj_OwnerCommJump"
                         + "          ,OfficeAutomation_Document_UndertakeProj_ClientCommJump"
                         + "          ,OfficeAutomation_Document_UndertakeProj_EBCommJump"
                         + "          ,OfficeAutomation_Document_UndertakeProj_RewardSignHave"
                         + "          ,OfficeAutomation_Document_UndertakeProj_RewardSignHavent"
                         + "          ,OfficeAutomation_Document_UndertakeProj_DeveloperConditions"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AreaConditions"
                         + "          ,OfficeAutomation_Document_UndertakeProj_PayRewardWay"
                         + "          ,OfficeAutomation_Document_UndertakeProj_ReceiveRewardName"
                         + "          ,OfficeAutomation_Document_UndertakeProj_ReceiveRewardNo"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsMyPay"
                         + "          ,OfficeAutomation_Document_UndertakeProj_OtherCondtion"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AreaComfirn"
                         + "          ,OfficeAutomation_Document_UndertakeProj_ReturnBackDate"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AnotherRewardC"
                         + "          ,OfficeAutomation_Document_UndertakeProj_PCDeduct"
                         + "          ,OfficeAutomation_Document_UndertakeProj_EBDeduct"
                         + "          ,OfficeAutomation_Document_UndertakeProj_BaseAgent"
                         + "          ,OfficeAutomation_Document_UndertakeProj_BaseAgentOther"
                         + "          ,OfficeAutomation_Document_UndertakeProj_IsUploadPlan"
                         + "          ,OfficeAutomation_Document_UndertakeProj_Flange"
                         + "          ,OfficeAutomation_Document_UndertakeProj_AnotherCompany"
                         + "          ,OfficeAutomation_Document_UndertakeProj_Referral"
                         + "          ,OfficeAutomation_Document_UndertakeProj_BreakUp"
                         + "          ,OfficeAutomation_Document_UndertakeProj_NCommissions"
                         + "          ,OfficeAutomation_Document_UndertakeProj_HasAtt"
                         + "          ,OfficeAutomation_Document_UndertakeProj_WillBreakUp"
                         + "          ,OfficeAutomation_Document_UndertakeProj_PreCompleteNumber"
                         + "          ,OfficeAutomation_Document_UndertakeProj_PreCompleteMoney"
                         + "          ,OfficeAutomation_Document_UndertakeProj_PreCompleteComm"
                         + "          ,toam.OfficeAutomation_SerialNumber"
                         + "          ,toam.OfficeAutomation_Main_FlowStateID"
                         + "          ,tdoad.OfficeAutomation_Document_Name";
                    }
                    break;
                case "25":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_ProjLinkRepoData_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjLinkRepoData_MainID";
                        sgroup = " GROUP BY [OfficeAutomation_Document_ProjLinkRepoData_ID]"
                         + "          ,[OfficeAutomation_Document_ProjLinkRepoData_MainID]"
                         + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Department]"
                         + "          ,[OfficeAutomation_Document_ProjLinkRepoData_ApplyDate]"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_Apply"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ReplyPhone"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ApplyID"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ProjName"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_HavePreSaleID"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_PreSaleID"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ProjAddress"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_DeveloperName"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_GroupName"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_DealOfficeTypeIDs"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_DealOfficeOther"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AgentStartDate"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AgentEndDate"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_PreComm"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_GoodsQuantity"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_GoodsValue"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_CommPoint"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AgentModel"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ContractType"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ContractTypeOther"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_HaveCoopCost"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_HaveCoopConf"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_IsSignBack"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ContractPreSignBackDate"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_Remark"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_LinkStartDate"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_LinkEndDate"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_CommCalcGet"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ProjDepCount"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ProjDepPrice"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ProjDepComm"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_PropDepCount"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_PropDepPrice"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_PropDepComm"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_CalcGetType"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_CalcGetTypeOther"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AssumeType"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AssumeTypeOther"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AddRemark"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ProjType"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ProjDepPreCount"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_ProjDepPreComm"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_PropDepPreInfo"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_DealHistoryStartDate"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_DealHistoryEndDate"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_TotalProfitStartDate"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_TotalProfitEndDate"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_HisIndepCount"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_HisIndepPerformance"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_HisLinkCount"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_HisLinkPerformance"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_HisTotalProfit"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_JOrT"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_SamePlaceXX1"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_SamePlaceXX2"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_TurnsAgentXX1"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_TurnsAgentXX2"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AgencyFee1"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AgencyFee2"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AgencyFee3"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AgencyFee4"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_IsCashPrize1"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_IsCashPrize2"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_IsCashPrize3"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_IsCashPrize4"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_CashPrize1"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_CashPrize2"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_CashPrize3"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_CashPrize4"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AgencyBeginDate1"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AgencyBeginDate2"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AgencyEndDate1"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_AgencyEndDate2"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_IsPFear1"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_IsPFear2"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_IsPFear3"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_IsPFear4"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_PFear1"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_PFear2"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_PFear3"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_PFear4"
                         + "          ,OfficeAutomation_Document_ProjLinkRepoData_Sign";
                    }
                    break;
                case "29":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_FurtherEducation_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_FurtherEducation_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_FurtherEducation_ID"
                         + "          ,OfficeAutomation_Document_FurtherEducation_MainID"
                         + "          ,OfficeAutomation_Document_FurtherEducation_Apply"
                         + "          ,OfficeAutomation_Document_FurtherEducation_ApplyDate"
                         + "          ,OfficeAutomation_Document_FurtherEducation_ApplyID"
                         + "          ,OfficeAutomation_Document_FurtherEducation_Department"
                         + "          ,OfficeAutomation_Document_FurtherEducation_No"
                         + "          ,OfficeAutomation_Document_FurtherEducation_InData"
                         + "          ,OfficeAutomation_Document_FurtherEducation_OnData"
                         + "          ,OfficeAutomation_Document_FurtherEducation_Position"
                         + "          ,OfficeAutomation_Document_FurtherEducation_Rank"
                         + "          ,OfficeAutomation_Document_FurtherEducation_Srecord"
                         + "          ,OfficeAutomation_Document_FurtherEducation_Welfare"
                         + "          ,OfficeAutomation_Document_FurtherEducation_IDData"
                         + "          ,OfficeAutomation_Document_FurtherEducation_School"
                         + "          ,OfficeAutomation_Document_FurtherEducation_Subjects"
                         + "          ,OfficeAutomation_Document_FurtherEducation_BeginData"
                         + "          ,OfficeAutomation_Document_FurtherEducation_During"
                         + "          ,OfficeAutomation_Document_FurtherEducation_EndData"
                         + "          ,OfficeAutomation_Document_FurtherEducation_Fees"
                         + "          ,OfficeAutomation_Document_FurtherEducation_ShouldAllowance"
                         + "          ,OfficeAutomation_Document_FurtherEducation_ApplyAllowance"
                         + "          ,OfficeAutomation_Document_FurtherEducation_ActualyAllowance"
                         + "          ,OfficeAutomation_Document_FurtherEducation_Conditions"
                         + "          ,OfficeAutomation_Document_FurtherEducation_AllowData"
                         + "          ,OfficeAutomation_Document_FurtherEducation_A"
                         + "          ,OfficeAutomation_Document_FurtherEducation_Name"
                         + "          ,OfficeAutomation_Document_FurtherEducation_Remark";
                    }
                    break;
                case "13":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_ReduceComm_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ReduceComm_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_ReduceComm_ID"
                         + "          ,OfficeAutomation_Document_ReduceComm_MainID"
                         + "          ,OfficeAutomation_Document_ReduceComm_Apply"
                         //+ "          ,OfficeAutomation_Document_ReduceComm_ApplyID"
                         + "          ,OfficeAutomation_Document_ReduceComm_ApplyDate"
                         + "          ,OfficeAutomation_Document_ReduceComm_Department"
                         + "          ,OfficeAutomation_Document_ReduceComm_ApplyForName"
                         + "          ,OfficeAutomation_Document_ReduceComm_ApplyForCode"
                         + "          ,OfficeAutomation_Document_ReduceComm_DepartmentTypeID"
                         + "          ,OfficeAutomation_Document_ReduceComm_Subject"
                         + "          ,OfficeAutomation_Document_ReduceComm_DepartmentID"
                         + "          ,OfficeAutomation_Document_ReduceComm_ReplyPhone"
                         + "          ,OfficeAutomation_Document_ReduceComm_Reason"
                         + "          ,OfficeAutomation_Document_ReduceComm_Remark"
                         + "          ,OfficeAutomation_Document_ReduceComm_DealDepartment"
                         + "          ,OfficeAutomation_Document_ReduceComm_OriginalDealPrice"
                         + "          ,OfficeAutomation_Document_ReduceComm_FinalDealPrice"
                         + "          ,OfficeAutomation_Document_ReduceComm_CommPoint"
                         + "          ,OfficeAutomation_Document_ReduceComm_OriginalComm"
                         + "          ,OfficeAutomation_Document_ReduceComm_ReduceCashBonus"
                         + "          ,OfficeAutomation_Document_ReduceComm_ReduceComm"

                         + "          ,OfficeAutomation_Document_ReduceComm_EBCommPoint"
                         + "          ,OfficeAutomation_Document_ReduceComm_CaCommPoint"
                         + "          ,OfficeAutomation_Document_ReduceComm_EBOriginalComm"
                         + "          ,OfficeAutomation_Document_ReduceComm_CaOriginalComm"
                         + "          ,OfficeAutomation_Document_ReduceComm_EBReduceCashBonus"
                         + "          ,OfficeAutomation_Document_ReduceComm_CaReduceCashBonus"
                         + "          ,OfficeAutomation_Document_ReduceComm_EBReduceComm"
                         + "          ,OfficeAutomation_Document_ReduceComm_CaReduceComm"
                         + "          ,OfficeAutomation_Document_ReduceComm_KSa"
                         + "          ,OfficeAutomation_Document_ReduceComm_KSb"
                         + "          ,OfficeAutomation_Document_ReduceComm_KSc"
                         + "          ,OfficeAutomation_Document_ReduceComm_KSd"

                         + "          ,OfficeAutomation_Document_ReduceComm_TotalReduce"
                         + "          ,OfficeAutomation_Document_ReduceComm_ActualReportMoney"
                         + "          ,OfficeAutomation_Document_ReduceComm_ReduceWay";
                    }
                    break;
                case "30":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_SpecialNumber_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SpecialNumber_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_SpecialNumber_ID"
                         + "          ,OfficeAutomation_Document_SpecialNumber_MainID"
                         + "          ,OfficeAutomation_Document_SpecialNumber_Apply"
                         + "          ,OfficeAutomation_Document_SpecialNumber_ApplyDate"
                         + "          ,OfficeAutomation_Document_SpecialNumber_ApplyID"
                         + "          ,OfficeAutomation_Document_SpecialNumber_Department"
                         + "          ,OfficeAutomation_Document_SpecialNumber_Subject"
                         + "          ,OfficeAutomation_Document_SpecialNumber_ReplyPhone"
                         + "          ,OfficeAutomation_Document_SpecialNumber_Fax"
                         + "          ,OfficeAutomation_Document_SpecialNumber_Describe"
                         + "          ,OfficeAutomation_Document_SpecialNumber_DealNature"
                         + "          ,OfficeAutomation_Document_SpecialNumber_Names"
                         + "          ,OfficeAutomation_Document_SpecialNumber_Period"
                         + "          ,OfficeAutomation_Document_SpecialNumber_ApplyNo"
                         + "          ,OfficeAutomation_Document_SpecialNumber_DealOfficeTypeIDs"
                         + "          ,OfficeAutomation_Document_SpecialNumber_DealOfficeOther"
                         + "          ,OfficeAutomation_Document_SpecialNumber_AgentModel"
                         + "          ,OfficeAutomation_Document_SpecialNumber_TheReason";
                    }
                    break;
                case "42":
                    if (nt == "1")
                        sn = "ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "LastFlowCT";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                    }
                    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CommissionOfMonth_MainID";
                    sgroup = " GROUP BY OfficeAutomation_Document_CommissionOfMonth_ID"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_MainID"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_Apply"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_ApplyDate"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_Department"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_ApplyID"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_Name"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_Code"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_EnterDate"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_Position"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_Rank"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_Results"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_Describe"
                         + "          ,toam.OfficeAutomation_Main_FlowStateID)"
                        //+ "          UNION SELECT ROW_NUMBER() OVER(ORDER BY OfficeAutomation_Document_CommissionOfMonth_ApplyDate desc) as [序号]"
                         + "          UNION (SELECT OfficeAutomation_Document_CommissionOfMonth_ID as [ID]"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_MainID as [MainID]"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_Apply as [Apply]"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_ApplyDate as [ApplyDate]"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_ApplyID as 发文编号"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_Department as [Department]"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_Name as 姓名"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_Code as 工号"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_EnterDate as 入职日期"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_Position as 现职位"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_Rank as 现职级"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_Results as 预估本月实收业绩及解HOLD佣实收业绩"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_Describe as 备注"
                         + "          ,CASE MAX(f.OfficeAutomation_Flow_Idx) WHEN 7 THEN '申请人取消申请' ELSE '确认使用' END AS 反馈确认情况"
                         + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                         + "          WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                         + "                    FROM   t_OfficeAutomation_Flow f"
                         + "                    WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID]"
                         + "                           AND f.OfficeAutomation_Flow_Audit = 0"
                         + "                    ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                         + "          WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                         + "                                FROM   t_OfficeAutomation_Flow f"
                         + "                                WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID]"
                         + "                                       AND f.OfficeAutomation_Flow_Audit = 0"
                         + "                                ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                         + "          WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f"
                         + "                       WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f"
                         + "                       WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) in(1,100) THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f"
                         + "                       WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END)"
                         + "          END AS 审批状态"
                         + smax
                         + "          FROM t_OfficeAutomation_Document_CommissionOfMonth todi"
                         + "          LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CommissionOfMonth_MainID"
                         + "          LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                         + "          LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                         + "          LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CommissionOfMonth_MainID"
                         + "          RIGHT JOIN t_OfficeAutomation_Document_CommissionOfMonth_Detail dt"
                         + "          ON dt.OfficeAutomation_Document_CommissionOfMonth_Detail_MainID = todi.OfficeAutomation_Document_CommissionOfMonth_ID";

                    if (!isAdmin && !purview.Contains("OA_Search_048") || approver != "") //M_20150623
                            sgroup += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

                    sgroup += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

                        if (!isAdmin && !purview.Contains("OA_Search_048"))
                            sgroup += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CommissionOfMonth_Apply='" + employee + "')";

                        if (applicationDepartment != "")
                            sgroup += " and OfficeAutomation_Document_CommissionOfMonth_Department like '%" + applicationDepartment + "%'";

                        if (applicant != "")
                            sgroup += " and OfficeAutomation_Document_CommissionOfMonth_Apply = '" + applicant + "'";

                        if (begin != "")
                            sgroup += " and OfficeAutomation_Document_CommissionOfMonth_ApplyDate >='" + begin + " 00:00:00'";

                        if (end != "")
                            sgroup += " and OfficeAutomation_Document_CommissionOfMonth_ApplyDate<='" + end + " 23:59:59'";

                        if (state != "")
                            sgroup += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

                        if (cstatue != 10)
                            if (cstatue < 3)
                                sgroup += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                            else //M_20150623
                            {
                                if (approver != "")
                                    sgroup += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                                else
                                    sgroup += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                            }

                        if (serialNumber != "")
                            sgroup += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

                        if (keyWord != "")
                            sgroup += " and [OfficeAutomation_Document_CommissionOfMonth_Name] like '%" + keyWord + "%'";

                        if (approver != "" && cstatue != 3) //M_20150623
                            sgroup += " and auditorsum like '%" + approver + "%'";

                        if (approver != "" && apptime != "") //M_GWSky：20150630
                            sgroup += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CommissionOfMonth_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

                        if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
                        {
                            foreach (DataRow dr in ds.Tables[0].Rows)
                            {
                                sgroup += "  OR OfficeAutomation_Document_CommissionOfMonth_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CommissionOfMonth_MainID))";
                            }
                        }
                 sgroup += "          GROUP BY [OfficeAutomation_Document_CommissionOfMonth_ID]"
                         + "          ,[OfficeAutomation_Document_CommissionOfMonth_MainID]"
                         + "          ,[OfficeAutomation_Document_CommissionOfMonth_Department]"
                         + "          ,[OfficeAutomation_Document_CommissionOfMonth_ApplyDate]"
                         + "          ,[OfficeAutomation_Document_CommissionOfMonth_Apply]"
                         + "          ,toam.OfficeAutomation_SerialNumber"
                         + "          ,toam.OfficeAutomation_Main_FlowStateID"
                         + "          ,tdoad.OfficeAutomation_Document_Name"
                         + "          ,toam.[OfficeAutomation_SerialNumber]"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_ApplyID"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_Department"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_Code"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_Name"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_EnterDate"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_Position"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_Rank"
                         + "          ,dt.OfficeAutomation_Document_CommissionOfMonth_Detail_Results"
                         + "          ,OfficeAutomation_Document_CommissionOfMonth_Describe)) AS CommissionOfMonth_Count";
                    break;
                case "6":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_DealOffice_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_DealOffice_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_DealOffice_ID"
                         + "          ,OfficeAutomation_Document_DealOffice_MainID"
                         + "          ,OfficeAutomation_Document_DealOffice_Apply"
                         + "          ,OfficeAutomation_Document_DealOffice_ApplyDate"
                         + "          ,OfficeAutomation_Document_DealOffice_Department"
                         + "          ,OfficeAutomation_Document_DealOffice_ReplyPhone"
                         + "          ,OfficeAutomation_Document_DealOffice_ReplyFax"
                         + "          ,OfficeAutomation_Document_DealOffice_WorkArea"
                         + "          ,OfficeAutomation_Document_DealOffice_Branch"
                         + "          ,OfficeAutomation_Document_DealOffice_TypeID"
                         + "          ,OfficeAutomation_Document_DealOffice_OfficeArea"
                         + "          ,OfficeAutomation_Document_DealOffice_OfficeAddress"
                         + "          ,OfficeAutomation_Document_DealOffice_DealArea"
                         + "          ,OfficeAutomation_Document_DealOffice_DealPrice"
                         + "          ,OfficeAutomation_Document_DealOffice_DealOwnerMoney"
                         + "          ,OfficeAutomation_Document_DealOffice_DealOwnerPercent"
                         + "          ,OfficeAutomation_Document_DealOffice_DealClientMoney"
                         + "          ,OfficeAutomation_Document_DealOffice_DealClientPercent"
                         + "          ,OfficeAutomation_Document_DealOffice_DealMoney"
                         + "          ,OfficeAutomation_Document_DealOffice_DealPercent"
                         + "          ,OfficeAutomation_Document_DealOffice_LeaseArea"
                         + "          ,OfficeAutomation_Document_DealOffice_LeasePrice"
                         + "          ,OfficeAutomation_Document_DealOffice_LeaseOwnerMoney"
                         + "          ,OfficeAutomation_Document_DealOffice_LeaseOwnerPercent"
                         + "          ,OfficeAutomation_Document_DealOffice_LeaseClientMoney"
                         + "          ,OfficeAutomation_Document_DealOffice_LeaseClientPercent"
                         + "          ,OfficeAutomation_Document_DealOffice_LeaseMoney"
                         + "          ,OfficeAutomation_Document_DealOffice_LeasePercent"
                         + "          ,OfficeAutomation_Document_DealOffice_CrossAreaRemark"
                         + "          ,OfficeAutomation_Document_DealOffice_MoneyRemark";
                    }
                    break;
                case "24":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_ProjRepoData_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjRepoData_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_ProjRepoData_ID"
                         + "          ,OfficeAutomation_Document_ProjRepoData_MainID"
                         + "          ,OfficeAutomation_Document_ProjRepoData_Department"
                         + "          ,OfficeAutomation_Document_ProjRepoData_ApplyDate"
                         + "          ,OfficeAutomation_Document_ProjRepoData_Apply"
                         + "          ,OfficeAutomation_Document_ProjRepoData_ReplyPhone"
                         + "          ,OfficeAutomation_Document_ProjRepoData_ApplyID"
                         + "          ,OfficeAutomation_Document_ProjRepoData_ApplyType"
                         + "          ,OfficeAutomation_Document_ProjRepoData_ApplyTypeRate"
                         + "          ,OfficeAutomation_Document_ProjRepoData_ApplyTypeOther"
                         + "          ,OfficeAutomation_Document_ProjRepoData_ProjName"
                         + "          ,OfficeAutomation_Document_ProjRepoData_HavePreSaleID"
                         + "          ,OfficeAutomation_Document_ProjRepoData_PreSaleID"
                         + "          ,OfficeAutomation_Document_ProjRepoData_ProjAddress"
                         + "          ,OfficeAutomation_Document_ProjRepoData_DeveloperName"
                         + "          ,OfficeAutomation_Document_ProjRepoData_GroupName"
                         + "          ,OfficeAutomation_Document_ProjRepoData_DealOfficeTypeIDs"
                         + "          ,OfficeAutomation_Document_ProjRepoData_DealOfficeOther"
                         + "          ,OfficeAutomation_Document_ProjRepoData_AgentStartDate"
                         + "          ,OfficeAutomation_Document_ProjRepoData_AgentEndDate"
                         + "          ,OfficeAutomation_Document_ProjRepoData_PreComm"
                         + "          ,OfficeAutomation_Document_ProjRepoData_GoodsQuantity"
                         + "          ,OfficeAutomation_Document_ProjRepoData_GoodsValue"
                         + "          ,OfficeAutomation_Document_ProjRepoData_CommPoint"
                         + "          ,OfficeAutomation_Document_ProjRepoData_AgentModel"
                         + "          ,OfficeAutomation_Document_ProjRepoData_ContractType"
                         + "          ,OfficeAutomation_Document_ProjRepoData_ContractTypeOther"
                         + "          ,OfficeAutomation_Document_ProjRepoData_HaveCoopCost"
                         + "          ,OfficeAutomation_Document_ProjRepoData_HaveCoopConf"
                         + "          ,OfficeAutomation_Document_ProjRepoData_IsSignBack"
                         + "          ,OfficeAutomation_Document_ProjRepoData_ContractPreSignBackDate"
                         + "          ,OfficeAutomation_Document_ProjRepoData_Remark"
                         + "          ,OfficeAutomation_Document_ProjRepoData_ProjType"
                         + "          ,OfficeAutomation_Document_ProjRepoData_DealHistoryStartDate"
                         + "          ,OfficeAutomation_Document_ProjRepoData_DealHistoryEndDate"
                         + "          ,OfficeAutomation_Document_ProjRepoData_TotalProfitStartDate"
                         + "          ,OfficeAutomation_Document_ProjRepoData_TotalProfitEndDate"
                         + "          ,OfficeAutomation_Document_ProjRepoData_IndepCount"
                         + "          ,OfficeAutomation_Document_ProjRepoData_IndepPerformance"
                         + "          ,OfficeAutomation_Document_ProjRepoData_LinkCount"
                         + "          ,OfficeAutomation_Document_ProjRepoData_LinkPerformance"
                         + "          ,OfficeAutomation_Document_ProjRepoData_TotalProfit"
                         + "          ,OfficeAutomation_Document_ProjRepoData_JOrT"
                         + "          ,OfficeAutomation_Document_ProjRepoData_SamePlaceXX1"
                         + "          ,OfficeAutomation_Document_ProjRepoData_SamePlaceXX2"
                         + "          ,OfficeAutomation_Document_ProjRepoData_TurnsAgentXX1"
                         + "          ,OfficeAutomation_Document_ProjRepoData_TurnsAgentXX2"
                         + "          ,OfficeAutomation_Document_ProjRepoData_AgencyFee1"
                         + "          ,OfficeAutomation_Document_ProjRepoData_AgencyFee2"
                         + "          ,OfficeAutomation_Document_ProjRepoData_AgencyFee3"
                         + "          ,OfficeAutomation_Document_ProjRepoData_AgencyFee4"
                         + "          ,OfficeAutomation_Document_ProjRepoData_IsCashPrize1"
                         + "          ,OfficeAutomation_Document_ProjRepoData_IsCashPrize2"
                         + "          ,OfficeAutomation_Document_ProjRepoData_IsCashPrize3"
                         + "          ,OfficeAutomation_Document_ProjRepoData_IsCashPrize4"
                         + "          ,OfficeAutomation_Document_ProjRepoData_CashPrize1"
                         + "          ,OfficeAutomation_Document_ProjRepoData_CashPrize2"
                         + "          ,OfficeAutomation_Document_ProjRepoData_CashPrize3"
                         + "          ,OfficeAutomation_Document_ProjRepoData_CashPrize4"
                         + "          ,OfficeAutomation_Document_ProjRepoData_AgencyBeginDate1"
                         + "          ,OfficeAutomation_Document_ProjRepoData_AgencyBeginDate2"
                         + "          ,OfficeAutomation_Document_ProjRepoData_AgencyEndDate1"
                         + "          ,OfficeAutomation_Document_ProjRepoData_AgencyEndDate2"
                         + "          ,OfficeAutomation_Document_ProjRepoData_IsPFear1"
                         + "          ,OfficeAutomation_Document_ProjRepoData_IsPFear2"
                         + "          ,OfficeAutomation_Document_ProjRepoData_IsPFear3"
                         + "          ,OfficeAutomation_Document_ProjRepoData_IsPFear4"
                         + "          ,OfficeAutomation_Document_ProjRepoData_PFear1"
                         + "          ,OfficeAutomation_Document_ProjRepoData_PFear2"
                         + "          ,OfficeAutomation_Document_ProjRepoData_PFear3"
                         + "          ,OfficeAutomation_Document_ProjRepoData_PFear4"
                         + "          ,OfficeAutomation_Document_ProjRepoData_Sign"
                         ;
                    }
                    break;
                case "21":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_ProjAgentClause_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjAgentClause_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_ProjAgentClause_ID"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_MainID"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_Department"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ApplyDate"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_Apply"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ReplyPhone"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ApplyID"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ProjName"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_DeveloperName"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ProjAddress"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_AgentStart"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_AgentEnd"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_SaleDate"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_DealOfficeTypeIDs"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_DealOfficeOther"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_GoodsQuantity"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_GoodsValue"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_PreComm"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_AgentModel"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_CommPoint"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ContractType"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ContractTypeOther"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_Remark"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ClauseSettleComm"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ClauseFine"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ClauseAreaLimit"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ClausePerforCheck"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ClauseHonest"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_ClauseOther"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_PorjectExam"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_JOrT"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_SamePlaceXX1"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_SamePlaceXX2"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_TurnsAgentXX1"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_TurnsAgentXX2"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_AgencyFee1"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_AgencyFee2"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_AgencyFee3"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_AgencyFee4"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_IsCashPrize1"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_IsCashPrize2"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_IsCashPrize3"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_IsCashPrize4"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_CashPrize1"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_CashPrize2"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_CashPrize3"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_CashPrize4"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_AgencyBeginDate1"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_AgencyBeginDate2"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_AgencyEndDate1"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_AgencyEndDate2"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_IsPFear1"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_IsPFear2"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_IsPFear3"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_IsPFear4"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_PFear1"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_PFear2"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_PFear3"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_PFear4"
                         + "          ,OfficeAutomation_Document_ProjAgentClause_Sign"
                         ;
                    }
                    break;
                case "23":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_ProjDormSubsiby_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjDormSubsiby_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_ProjDormSubsiby_ID"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_MainID"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_Department"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_ApplyDate"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_Apply"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_ReplyPhone"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_ApplyID"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_ProjName"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DeveloperName"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_ProjAddress"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_AgentStartDate"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_AgentEndDate"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_SaleDate"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DealOfficeTypeIDs"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DealOfficeOther"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_GoodsQuantity"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_GoodsValue"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_PreComm"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_AgentModel"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_CommPoint"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_RentStartDate"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_RentEndDate"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_RentType"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_LiveNumber"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormAddress"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormArea"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormType"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_MonthlyRent"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_Deposit"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_AgencyFee"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_MonthlyEstimatedCost"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_ManagermentCost"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_ElectricCharge"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_WaterCharge"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_GasCharge"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_MonthlyCost"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormRemark"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_StartPlace"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_EndPlace"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_RoundTripMoney"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_NumberOfTimes"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_SumOfMoney"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_SubsibyValidityStartDate"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_SubsibyValidityEndDate"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_SubsibyRemark"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_EnjoyPersonInfo"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_PerformanceProfitInfo"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_SumPerformance"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_SumProfit"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_ProjGoodsQuantity"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_ProjGoodsValue"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_ProjCommission"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_ProjCommPoint"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormSumCost"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_SubsibySumCost"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormSumCostScale"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_SubsibySumCostScale"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormRemark"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormitoryMonth"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormitoryMan"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormitoryMdm"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormitoryStartDate"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormitoryEndDate"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_DormitoryRemark"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_ApplyMoney"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_TrafficApplyMoney"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_LastYear"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_LastMonth"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_LastRent"
                         + "          ,OfficeAutomation_Document_ProjDormSubsiby_Sign"
                         ;
                    }
                    break;
                case "12":
                    if (nt == "1")
                        sn = "ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "LastFlowCT";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                    }
                    slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BadDebts_MainID";
                    if (eid == "3873" || eid == "45362" || eid == "42508" || eid == "28614" || eid == "54917" || eid == "51673" || eid == "50203") //*9
                    {
                        slet += " LEFT JOIN T_OfficeAutomation_Document_BadDebts_Detail dt on dt.OfficeAutomation_Document_BadDebts_Detail_MainID = todi.OfficeAutomation_Document_BadDebts_ID";
                        sgroup = " GROUP BY [OfficeAutomation_Document_BadDebts_ID]"
                            + "          ,[OfficeAutomation_Document_BadDebts_MainID]"
                            + "          ,[OfficeAutomation_Document_BadDebts_Department]"
                            + "          ,[OfficeAutomation_Document_BadDebts_ApplyDate]"
                            + "          ,[OfficeAutomation_Document_BadDebts_Apply]"
                            + "          ,toam.OfficeAutomation_SerialNumber"
                            + "          ,toam.OfficeAutomation_Main_FlowStateID"
                            + "          ,tdoad.OfficeAutomation_Document_Name"
                            + "          ,toam.[OfficeAutomation_SerialNumber]"
                            + "          ,OfficeAutomation_Document_BadDebts_ApplyID"
                            + "          ,OfficeAutomation_Document_BadDebts_ReplyPhone"
                            + "          ,OfficeAutomation_Document_BadDebts_Building"
                            + "          ,OfficeAutomation_Document_BadDebts_Reason"
                            + "          ,OfficeAutomation_Document_BadDebts_MoneyCount"
                            + "          ,OfficeAutomation_Document_BadDebts_Remark"
                            + "          ,OfficeAutomation_Document_BadDebts_OneOrTwo"
                            + "          ,OfficeAutomation_Document_BadDebts_SumBDMoney"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_ReportID"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_Address"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_OwnerBadMoney"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_ClientBadMoney"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_BadReason"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_IsAutoBad"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_AutoBadDate"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_IsSpecialAdjust"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_Owner"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_Client"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_DealDate"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_BadDate"
                            + "          ,dt.OfficeAutomation_Document_BadDebts_Detail_Area"
                            + "          )) AS All_The_Count"
                            ;
                    }
                    else
                    {
                        sgroup = " GROUP BY OfficeAutomation_Document_BadDebts_ID"
                            + "          ,OfficeAutomation_Document_BadDebts_MainID"
                            + "          ,OfficeAutomation_Document_BadDebts_Department"
                            + "          ,OfficeAutomation_Document_BadDebts_ApplyDate"
                            + "          ,OfficeAutomation_Document_BadDebts_Apply"
                            + "          ,OfficeAutomation_Document_BadDebts_Building"
                            + "          ,OfficeAutomation_Document_BadDebts_MoneyCount"
                            + "          ,toam.OfficeAutomation_SerialNumber"
                            + "          ,toam.OfficeAutomation_Main_FlowStateID"
                            + "          ,tdoad.OfficeAutomation_Document_Name"
                            + "          )) AS All_The_Count"
                        ;
                    }
                    break;

                case "77":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_WYRecruit_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_WYRecruit_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_WYRecruit_ID"
                         + "          ,OfficeAutomation_Document_WYRecruit_MainID"
                         + "          ,OfficeAutomation_Document_WYRecruit_Department"
                         + "          ,OfficeAutomation_Document_WYRecruit_ApplyDate"
                         + "          ,OfficeAutomation_Document_WYRecruit_Apply"
                         + "          ,OfficeAutomation_Document_WYRecruit_Remark"
                         + "          ,OfficeAutomation_Document_WYRecruit_Position"
                         + "          ,OfficeAutomation_Document_WYRecruit_Region"
                         + "          ,OfficeAutomation_Document_WYRecruit_RecruitType"
                         + "          ,OfficeAutomation_Document_WYRecruit_ApplyAmount"
                         + "          ,OfficeAutomation_Document_WYRecruit_StartDate"
                         + "          ,OfficeAutomation_Document_WYRecruit_EndDate"
                         + "          ,OfficeAutomation_Document_WYRecruit_OrganizationName"
                         + "          ,OfficeAutomation_Document_WYRecruit_CustomService"
                         + "          ,OfficeAutomation_Document_WYRecruit_Contact"
                         + "          ,OfficeAutomation_Document_WYRecruit_SecretaryCode"
                         + "          ,OfficeAutomation_Document_WYRecruit_Secretary"
                         + "          ,OfficeAutomation_Document_WYRecruit_SecretaryDepartment"
                         + "          ,OfficeAutomation_Document_WYRecruit_UseBranch"
                         + "          ,OfficeAutomation_Document_WYRecruit_ReimbursementAmount"
                         ;
                    }
                    break;
                case "78":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_Recruit_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Recruit_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_Recruit_ID"
                         + "          ,OfficeAutomation_Document_Recruit_MainID"
                         + "          ,OfficeAutomation_Document_Recruit_Department"
                         + "          ,OfficeAutomation_Document_Recruit_ApplyDate"
                         + "          ,OfficeAutomation_Document_Recruit_Apply"
                         + "          ,OfficeAutomation_Document_Recruit_Department"
                         + "          ,OfficeAutomation_Document_Recruit_Position"
                         + "          ,OfficeAutomation_Document_Recruit_Grade"
                         + "          ,OfficeAutomation_Document_Recruit_Remuneration"
                         + "          ,OfficeAutomation_Document_Recruit_Number"
                         + "          ,OfficeAutomation_Document_Recruit_TakeOfficeDate"
                         ;
                    }
                    break;

                    //20161222 添加公基金特殊申请导出数据
                case "80":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_HousingFundChange_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Recruit_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_HousingFundChange_ID"
                         + "          ,OfficeAutomation_Document_HousingFundChange_MainID"
                         + "          ,OfficeAutomation_Document_HousingFundChange_Apply"
                         + "          ,OfficeAutomation_Document_HousingFundChange_ApplyDate"
                         + "          ,OfficeAutomation_Document_HousingFundChange_ApplyID"
                         + "          ,OfficeAutomation_Document_HousingFundChange_Department"
                         + "          ,OfficeAutomation_Document_HousingFundChange_Remark"
                         ;
                    }
                    break;

                case "84":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_HousingFundAdjustment_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_HousingFundAdjustment_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_HousingFundAdjustment_ID"
                         + "          ,OfficeAutomation_Document_HousingFundAdjustment_MainID"
                         + "          ,OfficeAutomation_Document_HousingFundAdjustment_Apply"
                         + "          ,OfficeAutomation_Document_HousingFundAdjustment_ApplyDate"
                         + "          ,OfficeAutomation_Document_HousingFundAdjustment_ApplyID"
                         + "          ,OfficeAutomation_Document_HousingFundAdjustment_Department"
                         ;
                    }
                    break;
                case "95":
                    if (nt == "1")
                        sn = "OfficeAutomation_Document_HousingFundBaseAdjust_ApplyDate";
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_HousingFundBaseAdjust_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_HousingFundBaseAdjust_ID"
                         + "          ,OfficeAutomation_Document_HousingFundBaseAdjust_MainID"
                         + "          ,OfficeAutomation_Document_HousingFundBaseAdjust_Apply"
                         + "          ,OfficeAutomation_Document_HousingFundBaseAdjust_ApplyDate"
                         + "          ,OfficeAutomation_Document_HousingFundBaseAdjust_ApplyID"
                         + "          ,OfficeAutomation_Document_HousingFundBaseAdjust_Department"
                         ;
                    }
                    break;
                case"31":
                    if(nt=="1")
                    {
                        sn = "OfficeAutomation_Document_OfficialSeal_ApplyDate";
                    }
                    else if(nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_OfficialSeal_MainID";
                        sgroup = " GROUP BY OfficeAutomation_Document_OfficialSeal_ID"
                       + "          ,OfficeAutomation_Document_OfficialSeal_MainID"
                       + "          ,OfficeAutomation_Document_OfficialSeal_Apply"
                       + "          ,OfficeAutomation_Document_OfficialSeal_ApplyDate"
                       + "          ,OfficeAutomation_Document_OfficialSeal_Department"
                       ;
                    }
                    break;
                case "86":
                    if (nt == "1")
                    {
                        sn = "OfficeAutomation_Document_Invoicing_ApplyDate ";
                    }
                    else if (nt == "2")
                    {
                        sn = "max(OfficeAutomation_Flow_AuditDate)";
                        smax = " ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT";
                        slet = " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Invoicing_MainID ";
                        sgroup = " GROUP BY OfficeAutomation_Document_Invoicing_ID "
                       + "          ,OfficeAutomation_Document_Invoicing_MainID "
                       + "          ,OfficeAutomation_Document_Invoicing_Apply"
                       + "          ,OfficeAutomation_Document_Invoicing_ApplyDate "
                       + "          ,OfficeAutomation_Document_Invoicing_Department"
                       ;
                    }
                    break;
            }

            string Propaganda = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号], * FROM(("
        + "          SELECT OfficeAutomation_Document_Propaganda_ID as [ID]"
        + "          ,OfficeAutomation_Document_Propaganda_MainID as [MainID]"
        + "          ,OfficeAutomation_Document_Propaganda_TNo AS 申请编号"
        + "          ,OfficeAutomation_Document_Propaganda_Apply as 申请人"
        + "          ,OfficeAutomation_Document_Propaganda_ApplyDate as ApplyDate"
        + "          ,OfficeAutomation_Document_Propaganda_ApplyID as 内M"
        + "          ,OfficeAutomation_Document_Propaganda_Department as 申请部门"
        + "          ,OfficeAutomation_Document_Propaganda_Conneter AS 联系人"
        + "          ,OfficeAutomation_Document_Propaganda_BranchAddress AS 分行地址"
        + "          ,CASE OfficeAutomation_Document_Propaganda_SumPrice WHEN '|1' THEN '广告类' WHEN '|2' THEN '印刷类' WHEN '|3' THEN '物料类' WHEN '|4' THEN '活动类' WHEN '|5' THEN '地图类' WHEN '|6' THEN '礼品类' WHEN '|7' THEN '派送类' WHEN '|8' THEN '其它类' END AS 宣传类型"
        + "          ,(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_Propaganda_KindOfAdvertising,'|1','报纸广告栏，'),'|2','分类广告，'),'|3','杂志广告，'),'|4','户外广告，'),'|5','网络广告，'),'|6','')+ OfficeAutomation_Document_Propaganda_AnotherAdvertising"
        + "          + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_Propaganda_KindOfPrinting,'|1','卡仔，'),'|2','单张，'),'|3','楼盘纸，'),'|4','小册子，'),'|5','书刊，'),'|6','')+ OfficeAutomation_Document_Propaganda_AnotherPrinting"
        + "          + REPLACE(REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_Propaganda_KindOfMaterial,'|1','海报，'),'|2','横幅，'),'|3','展示用品（太阳伞/帐篷/折叠式桌椅），'),'|4','')+ OfficeAutomation_Document_Propaganda_AnotherMaterial"
        + "          + REPLACE(REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_Propaganda_KindOfActivity,'|1','联展活动，'),'|2','专题讲座，'),'|3','公司活动（季会/主管会），'),'|4','')+ OfficeAutomation_Document_Propaganda_AnotherActivity"
        + "          + REPLACE(REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_Propaganda_KindOfMap,'|1','A图，'),'|2','B图，'),'|3','C图，'),'|4','')+ OfficeAutomation_Document_Propaganda_AnotherMap+ OfficeAutomation_Document_Propaganda_AnotherGift"
        + "          + REPLACE(REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_Propaganda_KindOfSend,'|1','正常派送，'),'|2','加急派送，'),'|3','分装配送，'),'|4','')+ OfficeAutomation_Document_Propaganda_AnotherSend"
        + "          + REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_Propaganda_KindOfAnother,'|1','邮局直投，'),'|2','打印，'),'|3','')+ OfficeAutomation_Document_Propaganda_AnotherAnother) AS 包括"
        + "          ,OfficeAutomation_Document_Propaganda_Summary AS [制作项目名称/概念详述]"
        + "          ,OfficeAutomation_Document_Propaganda_Width AS [规格大小（宽）]"
        + "          ,OfficeAutomation_Document_Propaganda_Height AS [规格大小（高）]"
        + "          ,OfficeAutomation_Document_Propaganda_Count AS [数量/页数]"
        + "          ,OfficeAutomation_Document_Propaganda_Package AS [包/安装要求]"
        + "          ,OfficeAutomation_Document_Propaganda_DemandDate AS 成品需求日期"
        + "          ,CASE OfficeAutomation_Document_Propaganda_PaySituation WHEN '|1' THEN '由申请项目之预算费用中支付' WHEN '|2' THEN '由预算中他项费用中调用，项目名称为：' + OfficeAutomation_Document_Propaganda_PayProjectName WHEN '|3' THEN '另行《费用申请》中支付，《费用申请》编号：' + OfficeAutomation_Document_Propaganda_FearNo END AS 支付情况"
        //+ "          ,dt.OfficeAutomation_Document_Propaganda_Detail_Department AS [分摊部门/分行/组别]"
        //+ "          ,dt.OfficeAutomation_Document_Propaganda_Detail_Count AS 分摊数量"
        + "          ,st.OfficeAutomation_Document_Propaganda_Statistical_SDepartment AS [送货部门/分行/组]"
        + "          ,st.OfficeAutomation_Document_Propaganda_Statistical_Address AS 送货地址"
        + "          ,st.OfficeAutomation_Document_Propaganda_Statistical_SCount AS 送货数量"
        + "          ,OfficeAutomation_Document_Propaganda_AcceptDate AS 接单日期"
        + "          ,OfficeAutomation_Document_Propaganda_Accepter AS 接单人"
        + "          ,OfficeAutomation_Document_Propaganda_Designer AS 设计员"
        + "          ,OfficeAutomation_Document_Propaganda_Reason AS [完成情况/取消原因]"
        + "          ,OfficeAutomation_Document_Propaganda_Verifyer AS 核实人"
        + "          ,OfficeAutomation_Document_Propaganda_VerifyDate AS 核实日期"
        + "          ,CASE toam.OfficeAutomation_Main_FlowStateID WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Propaganda_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Propaganda_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Propaganda_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Propaganda_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Propaganda_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) END AS 审批状态"
        + "          ,MAX(f.OfficeAutomation_Flow_AuditDate) AS 最后审批时间"
        + "          ,(case when OfficeAutomation_Document_Propaganda_Score_DesignScore1 =1 then '一般'when OfficeAutomation_Document_Propaganda_Score_DesignScore1 =2 then '良好'when OfficeAutomation_Document_Propaganda_Score_DesignScore1 =3 then '满意'end ) as '设计作品相符度'"
        + " 	     ,OfficeAutomation_Document_Propaganda_Score_DesignScore1Remarks '设计作品相符度原因'"
        + " 	     , (case when OfficeAutomation_Document_Propaganda_Score_DesignScore2 =1 then '一般'when OfficeAutomation_Document_Propaganda_Score_DesignScore2 =2 then '良好' when OfficeAutomation_Document_Propaganda_Score_DesignScore2 =3 then '满意' end ) as '设计效果满意度'"
        + " 	     ,OfficeAutomation_Document_Propaganda_Score_DesignScore2Remarks '设计效果满意度原因'"
        + " 	     , (case when OfficeAutomation_Document_Propaganda_Score_DesignScore3 =1 then '一般'when OfficeAutomation_Document_Propaganda_Score_DesignScore3 =2 then '良好'when OfficeAutomation_Document_Propaganda_Score_DesignScore3 =3 then '满意'end )as '按时完成度'"
        + " 	     ,OfficeAutomation_Document_Propaganda_Score_DesignScore3Remarks '按时完成度原因'"

	    + "			,isnull(OfficeAutomation_Document_Propaganda_Score_AccepterScore1 +OfficeAutomation_Document_Propaganda_Score_AccepterScore2 +OfficeAutomation_Document_Propaganda_Score_AccepterScore3,0) as '接单人总分数'"
	    + "			,(case when isnull((OfficeAutomation_Document_Propaganda_Score_AccepterScore1 +OfficeAutomation_Document_Propaganda_Score_AccepterScore2 +OfficeAutomation_Document_Propaganda_Score_AccepterScore3),0) = 0 then 0 else  isnull((OfficeAutomation_Document_Propaganda_Score_AccepterScore1 +OfficeAutomation_Document_Propaganda_Score_AccepterScore2 +OfficeAutomation_Document_Propaganda_Score_AccepterScore3),0)/3.0 end) as '接单人平均分数'"												
        + smax
        + "          FROM t_OfficeAutomation_Document_Propaganda todi"
        + "          left join  t_OfficeAutomation_Document_Propaganda_Score s on s.OfficeAutomation_Document_Propaganda_Score_MainID = todi.OfficeAutomation_Document_Propaganda_ID"
        + "          LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Propaganda_MainID"
        + "          LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
        + "          LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
        //+ "          LEFT JOIN t_OfficeAutomation_Document_Propaganda_Detail dt ON dt.OfficeAutomation_Document_Propaganda_Detail_MainID = todi.OfficeAutomation_Document_Propaganda_ID"
        + "          LEFT JOIN t_OfficeAutomation_Document_Propaganda_Statistical st ON st.OfficeAutomation_Document_Propaganda_Statistical_MainID = todi.OfficeAutomation_Document_Propaganda_ID"
        + slet;

            if (!isAdmin && !purview.Contains("OA_Search_060") || approver != "") //M_20150623
                Propaganda += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Propaganda += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_060"))
                Propaganda += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Propaganda_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Propaganda += " and OfficeAutomation_Document_Propaganda_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Propaganda += " and OfficeAutomation_Document_Propaganda_Apply = '" + applicant + "'";

            if (begin != "")
                Propaganda += " and OfficeAutomation_Document_Propaganda_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Propaganda += " and OfficeAutomation_Document_Propaganda_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Propaganda += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Propaganda += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Propaganda_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Propaganda += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Propaganda += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Propaganda += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Propaganda += " and [OfficeAutomation_Document_Propaganda_BranchAddress] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                Propaganda += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Propaganda += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Propaganda_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Propaganda += "  OR (OfficeAutomation_Document_Propaganda_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'  and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Propaganda_MainID))";
                }
            }
            Propaganda += sgroup;











            string Budgetab = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号], * FROM(("
        + "          SELECT OfficeAutomation_Document_Budgetab_ID as [ID]"
        + "          ,OfficeAutomation_Document_Budgetab_MainID as [MainID]"
        + "          ,OfficeAutomation_Document_Budgetab_Apply as 申请人"
        + "          ,OfficeAutomation_Document_Budgetab_ApplyDate as ApplyDate"
        + "          ,OfficeAutomation_Document_Budgetab_ApplyID as 编号"
        + "          ,OfficeAutomation_Document_Budgetab_Department as 申请部门"
        + "          ,OfficeAutomation_Document_Budgetab_Phone AS [联系电话/传真]"
        + "          ,(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_Budgetab_AProject,'|1','预算内调用，具体申请如下：由：' + OfficeAutomation_Document_Budgetab_Akind + '类' + OfficeAutomation_Document_Budgetab_Aitem + '项预算调至：' + OfficeAutomation_Document_Budgetab_AdjustableKind + '类' + OfficeAutomation_Document_Budgetab_AdjustableItem + '项，金额为：' + OfficeAutomation_Document_Budgetab_Price + '，'),'|2','预算冻结（跨年度），具体申请如下：'),'|3','广告宣传类' + OfficeAutomation_Document_Budgetab_AdvertisingItem + '项；金额为￥' + OfficeAutomation_Document_Budgetab_AdvertisingPrice + '元。'),'|4','宣传印刷类' + OfficeAutomation_Document_Budgetab_PrintingItem + '项；金额为￥' + OfficeAutomation_Document_Budgetab_PrintingPrice + '元。'),'|5','宣传物料类' + OfficeAutomation_Document_Budgetab_MaterialItem + '项；金额为￥' + OfficeAutomation_Document_Budgetab_MaterialPrice + '元。'),'|6','宣传活动类' + OfficeAutomation_Document_Budgetab_ActivityItem + '项；金额为￥' + OfficeAutomation_Document_Budgetab_ActivityPrice + '元。'),'|7','其他类' + OfficeAutomation_Document_Budgetab_AnotherItem + '项；金额为￥' + OfficeAutomation_Document_Budgetab_AnotherPrice + '元。')) AS 申请项目"
        + "          ,OfficeAutomation_Document_Budgetab_Reason AS 申请原由"
        + "          ,(REPLACE(REPLACE(OfficeAutomation_Document_Budgetab_Statement,'|1','调用　'),'|2','冻结')) AS 向公司申请上述"
        + "          ,CASE toam.OfficeAutomation_Main_FlowStateID WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Budgetab_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Budgetab_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Budgetab_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Budgetab_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Budgetab_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) END AS 审批状态"
        + "          ,MAX(f.OfficeAutomation_Flow_AuditDate) AS 最后审批时间"
        + smax
        + "          FROM t_OfficeAutomation_Document_Budgetab todi"
        + "          LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Budgetab_MainID"
        + "          LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
        + "          LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
        + slet;

            if (!isAdmin && !purview.Contains("OA_Search_061") || approver != "") //M_20150623
                Budgetab += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Budgetab += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_061"))
                Budgetab += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Budgetab_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Budgetab += " and OfficeAutomation_Document_Budgetab_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Budgetab += " and OfficeAutomation_Document_Budgetab_Apply = '" + applicant + "'";

            if (begin != "")
                Budgetab += " and OfficeAutomation_Document_Budgetab_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Budgetab += " and OfficeAutomation_Document_Budgetab_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Budgetab += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Budgetab += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Budgetab_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Budgetab += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Budgetab += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Budgetab += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Budgetab += " and [OfficeAutomation_Document_Budgetab_Phone] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                Budgetab += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Budgetab += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Budgetab_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Budgetab += "  OR (OfficeAutomation_Document_Budgetab_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Budgetab_MainID))";
                }
            }
            Budgetab += sgroup;
            #region 三季市场活动费用申请
            string CostIfActivity = @" SELECT ROW_NUMBER() OVER(ORDER BY " + sn + @" desc) as [序号], * FROM((
        SELECT OfficeAutomation_Document_CostOfActivity_ID as [ID]
                                      ,OfficeAutomation_Document_CostOfActivity_MainID as [MainID]
                                      ,OfficeAutomation_Document_CostOfActivity_Department as 申请部门
                                      ,OfficeAutomation_Document_CostOfActivity_Apply as 申请人
                                    ,OfficeAutomation_Document_CostOfActivity_ApplyDate as ApplyDate
                                     ,case when OfficeAutomation_Document_CostOfActivity_Cycle =2  then '半年度' else '季度'end as 项目名称
				                     ,case when OfficeAutomation_Document_CostOfActivity_Cycle =2 
				                      then Convert(int,case when OfficeAutomation_Document_CostOfActivity_Man5='' then 0 else OfficeAutomation_Document_CostOfActivity_Man5 end)
				                          +Convert(int,case when OfficeAutomation_Document_CostOfActivity_Man6 = '' then 0 else OfficeAutomation_Document_CostOfActivity_Man6 end) 
				                     else Convert(int,case when OfficeAutomation_Document_CostOfActivity_Man1 ='' then 0 else OfficeAutomation_Document_CostOfActivity_Man1 end)
				                          +Convert(int,case when OfficeAutomation_Document_CostOfActivity_Man2 = '' then 0 else OfficeAutomation_Document_CostOfActivity_Man2 end )
				                          +Convert(int,case when OfficeAutomation_Document_CostOfActivity_Man3 = '' then 0 else OfficeAutomation_Document_CostOfActivity_Man3 end )
					                      +Convert(int,OfficeAutomation_Document_CostOfActivity_Man4) end 人数
				
				                     ,case when OfficeAutomation_Document_CostOfActivity_Cycle = 2 
				                     then Convert(decimal(13,2),case when OfficeAutomation_Document_CostOfActivity_Fear5 = '' then 0 else OfficeAutomation_Document_CostOfActivity_Fear5 end)
				                         +Convert(decimal(13,2),case when OfficeAutomation_Document_CostOfActivity_Fear6  = '' then 0 else OfficeAutomation_Document_CostOfActivity_Fear6 end)
				                     else Convert(decimal(13,2),case when OfficeAutomation_Document_CostOfActivity_Fear1  = '' then 0 else OfficeAutomation_Document_CostOfActivity_Fear1 end)
				                         +Convert(decimal(13,2),case when OfficeAutomation_Document_CostOfActivity_Fear2  = '' then 0 else OfficeAutomation_Document_CostOfActivity_Fear2 end)
					                     +Convert(decimal(13,2),case when OfficeAutomation_Document_CostOfActivity_Fear3  = '' then 0 else OfficeAutomation_Document_CostOfActivity_Fear3 end)
					                     +Convert(decimal(13,2),case when OfficeAutomation_Document_CostOfActivity_Fear3  = '' then 0 else OfficeAutomation_Document_CostOfActivity_Fear4 end)
				                     end 费用  ";
            CostIfActivity += smax;
            CostIfActivity += @" FROM t_OfficeAutomation_Document_CostOfActivity todi
                 LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CostOfActivity_MainID
                 LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID
                LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
       + slet;

            if (!isAdmin && !purview.Contains("OA_Search_051") || approver != "") //M_20150623
                CostIfActivity += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            CostIfActivity += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_051"))
                CostIfActivity += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CostOfActivity_Apply='" + employee + "')";

            if (applicationDepartment != "")
                CostIfActivity += " and OfficeAutomation_Document_CostOfActivity_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                CostIfActivity += " and OfficeAutomation_Document_CostOfActivity_Apply = '" + applicant + "'";

            if (begin != "")
                CostIfActivity += " and OfficeAutomation_Document_CostOfActivity_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                CostIfActivity += " and OfficeAutomation_Document_CostOfActivity_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                CostIfActivity += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    CostIfActivity += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CostOfActivity_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        CostIfActivity += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        CostIfActivity += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                CostIfActivity += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            //if (keyWord != "")
            //    Budgetab += " and [OfficeAutomation_Document_Budgetab_Phone] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                CostIfActivity += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                CostIfActivity += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CostOfActivity_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    CostIfActivity += "  OR (OfficeAutomation_Document_CostOfActivity_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CostOfActivity_MainID))";
                }
            }
            CostIfActivity += sgroup;
            #endregion

            string ExtraBonus = " SELECT ROW_NUMBER() OVER(ORDER BY ApplyDate desc) as [序号], * FROM( "
        + "          (SELECT OfficeAutomation_Document_ExtraBonus_ID as [ID]"
        + "          ,OfficeAutomation_Document_ExtraBonus_MainID as [MainID]"
        + "          ,OfficeAutomation_Document_ExtraBonus_Department as 申请部门"
        + "          ,OfficeAutomation_Document_ExtraBonus_Apply as 申请人"
        + "          ,OfficeAutomation_Document_ExtraBonus_ApplyDate as ApplyDate"
        + "          ,OfficeAutomation_Document_ExtraBonus_Project as 项目名称"
        + "          ,convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_AgentStartDate,23) + '～' + convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_AgentEndDate,23)AS 项目代理期"
        + "          ,convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_ClientGuardStartDate,23) + '～' + convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_ClientGuardEndDate,23)AS 客户保护期"
        + "          ,da1.S1 AS 销售量套数"
        + "          ,da1.S2 AS 销售量金额"
        + "          ,da1.S3 AS 代理点数"
        + "          ,convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_ApplyCashRewardValidityDurationStartDate,23) + '～' + convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_ApplyCashRewardValidityDurationEndDate,23)AS 申请现金奖有效期"
        + "          ,CASE OfficeAutomation_Document_ExtraBonus_RewardPayTypeID WHEN 1 THEN '奖金由发展商划入公司帐户，随薪佣发放。' WHEN 2 THEN '奖金由发展商直接支付现金。' WHEN 3 THEN '其他情况：' + OfficeAutomation_Document_ExtraBonus_RewardPayTypeOtherCase END AS 现金奖的发放方式及操作"
        + "          ,CASE OfficeAutomation_Document_ExtraBonus_IsSubmitConfirmation WHEN 1 THEN '是' WHEN 0 THEN '否，区域承诺在' + convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_AreaPromiseSubmitDate,23) + '日前交回公司' END AS 区域是否已提交发展商奖金确认书"
        + "          FROM t_OfficeAutomation_Document_ExtraBonus todi"
        + "          LEFT JOIN dbo.[SplitToExtraBonus_Detail1]('||','&&') da1 ON da1.an = todi.OfficeAutomation_Document_ExtraBonus_ID"
        + "           WHERE EXISTS(SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =todi.OfficeAutomation_Document_ExtraBonus_MainID)"
        + "          )) AS ExtraBonus_Count"
        + "          ORDER BY ApplyDate DESC"
        + "          SELECT ROW_NUMBER() OVER(ORDER BY ApplyDate desc) as [序号], * FROM( "
        + "          (SELECT OfficeAutomation_Document_ExtraBonus_ID as [ID]"
        + "          ,OfficeAutomation_Document_ExtraBonus_MainID as [MainID]"
        + "          ,OfficeAutomation_Document_ExtraBonus_Department as 申请部门"
        + "          ,OfficeAutomation_Document_ExtraBonus_Apply as 申请人"
        + "          ,OfficeAutomation_Document_ExtraBonus_ApplyDate as ApplyDate"
        + "          ,OfficeAutomation_Document_ExtraBonus_Project as 项目名称"
        + "          ,convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_AgentStartDate,23) + '～' + convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_AgentEndDate,23)AS 项目代理期"
        + "          ,convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_ClientGuardStartDate,23) + '～' + convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_ClientGuardEndDate,23)AS 客户保护期"
        + "          ,convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_ApplyCashRewardValidityDurationStartDate,23) + '～' + convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_ApplyCashRewardValidityDurationEndDate,23)AS 申请现金奖有效期"
        + "          ,da2.bS1 AS [现金奖的标准（元/套）]"
        + "          ,da2.bs2 AS 发放条件"
        + "          ,CASE OfficeAutomation_Document_ExtraBonus_RewardPayTypeID WHEN 1 THEN '奖金由发展商划入公司帐户，随薪佣发放。' WHEN 2 THEN '奖金由发展商直接支付现金。' WHEN 3 THEN '其他情况：' + OfficeAutomation_Document_ExtraBonus_RewardPayTypeOtherCase END AS 现金奖的发放方式及操作"
        + "          ,CASE OfficeAutomation_Document_ExtraBonus_IsSubmitConfirmation WHEN 1 THEN '是' WHEN 0 THEN '否，区域承诺在' + convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_AreaPromiseSubmitDate,23) + '日前交回公司' END AS 区域是否已提交发展商奖金确认书"
        + "          FROM t_OfficeAutomation_Document_ExtraBonus todi"
        + "          LEFT JOIN dbo.[SplitToExtraBonus_Detail2]('||','&&') da2 ON da2.bn = todi.OfficeAutomation_Document_ExtraBonus_ID"
        + "          WHERE EXISTS(SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =todi.OfficeAutomation_Document_ExtraBonus_MainID)"
        + "          )) AS ExtraBonus_Count"
        + "          ORDER BY ApplyDate DESC"
        + "          SELECT ROW_NUMBER() OVER(ORDER BY ApplyDate desc) as [序号], * FROM( "
        + "          (SELECT OfficeAutomation_Document_ExtraBonus_ID as [ID]"
        + "          ,OfficeAutomation_Document_ExtraBonus_MainID as [MainID]"
        + "          ,OfficeAutomation_Document_ExtraBonus_Department as 申请部门"
        + "          ,OfficeAutomation_Document_ExtraBonus_Apply as 申请人"
        + "          ,OfficeAutomation_Document_ExtraBonus_ApplyDate as ApplyDate"
        + "          ,OfficeAutomation_Document_ExtraBonus_Project as 项目名称"
        + "          ,convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_AgentStartDate,23) + '～' + convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_AgentEndDate,23)AS 项目代理期"
        + "          ,convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_ClientGuardStartDate,23) + '～' + convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_ClientGuardEndDate,23)AS 客户保护期"
        + "          ,convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_ApplyCashRewardValidityDurationStartDate,23) + '～' + convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_ApplyCashRewardValidityDurationEndDate,23)AS 申请现金奖有效期"
        + "          ,dt.OfficeAutomation_Document_ExtraBonus_Detail_SetNumber AS [货量（套）]"
        + "          ,dt.OfficeAutomation_Document_ExtraBonus_Detail_PriceRange AS [价格区间（万元）]"
        + "          ,dt.OfficeAutomation_Document_ExtraBonus_Detail_UnitPrice AS [单套均价（万元）]"
        + "          ,dt.OfficeAutomation_Document_ExtraBonus_Detail_PayPerSet AS [可发放奖金金额（元/套）]"
        + "          ,dt.OfficeAutomation_Document_ExtraBonus_Detail_PayActualScale AS 奖金实际发放比例"
        + "          ,CASE OfficeAutomation_Document_ExtraBonus_RewardPayTypeID WHEN 1 THEN '奖金由发展商划入公司帐户，随薪佣发放。' WHEN 2 THEN '奖金由发展商直接支付现金。' WHEN 3 THEN '其他情况：' + OfficeAutomation_Document_ExtraBonus_RewardPayTypeOtherCase END AS 现金奖的发放方式及操作"
        + "          ,CASE OfficeAutomation_Document_ExtraBonus_IsSubmitConfirmation WHEN 1 THEN '是' WHEN 0 THEN '否，区域承诺在' + convert(nvarchar(80),OfficeAutomation_Document_ExtraBonus_AreaPromiseSubmitDate,23) + '日前交回公司' END AS 区域是否已提交发展商奖金确认书"
        + "          FROM t_OfficeAutomation_Document_ExtraBonus todi"
        + "          LEFT JOIN t_OfficeAutomation_Document_ExtraBonus_Detail dt ON dt.OfficeAutomation_Document_ExtraBonus_Detail_MainID = todi.OfficeAutomation_Document_ExtraBonus_ID"
        + "          WHERE EXISTS(SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =todi.OfficeAutomation_Document_ExtraBonus_MainID)"
        + "          )) AS ExtraBonus_Count";
        //+ "          ORDER BY ApplyDate DESC";

            //if (!isAdmin && !purview.Contains("OA_Search_021") || approver != "") //M_20150623
            //    ExtraBonus += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            //ExtraBonus += " WHERE 1=1";

            //if (!isAdmin && !purview.Contains("OA_Search_021"))
            //    ExtraBonus += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ExtraBonus_Apply='" + employee + "')";

            //if (applicationDepartment != "")
            //    ExtraBonus += " and OfficeAutomation_Document_ExtraBonus_Department like '%" + applicationDepartment + "%'";

            //if (applicant != "")
            //    ExtraBonus += " and OfficeAutomation_Document_ExtraBonus_Apply = '" + applicant + "'";

            //if (begin != "")
            //    ExtraBonus += " and OfficeAutomation_Document_ExtraBonus_ApplyDate >='" + begin + " 00:00:00'";

            //if (end != "")
            //    ExtraBonus += " and OfficeAutomation_Document_ExtraBonus_ApplyDate<='" + end + " 23:59:59'";

            //if (state != "")
            //    ExtraBonus += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            //if (cstatue != 10)
            //    if (cstatue < 3)
            //        ExtraBonus += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
            //    else //M_20150623
            //    {
            //        if (approver != "")
            //            ExtraBonus += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
            //        else
            //            ExtraBonus += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
            //    }

            //if (serialNumber != "")
            //    ExtraBonus += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            //if (keyWord != "")
            //    ExtraBonus += " and [OfficeAutomation_Document_ExtraBonus_Project] like '%" + keyWord + "%'";

            //if (approver != "" && cstatue != 3) //M_20150623
            //    ExtraBonus += " and auditorsum like '%" + approver + "%'";

            //if (approver != "" && apptime != "") //M_GWSky：20150630
            //    ExtraBonus += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ExtraBonus_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            //if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            //{
            //    foreach (DataRow dr in ds.Tables[0].Rows)
            //    {
            //        ExtraBonus += "  OR OfficeAutomation_Document_ExtraBonus_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
            //    }
            //}
            //ExtraBonus += sgroup;

            //20181009新增字段
            string n =
@"
--20181009新增
			,[dbo].[fn_BaseAgent2Text](OfficeAutomation_Document_UtContract_BaseAgent,OfficeAutomation_Document_UtContract_BaseAgentOther) AS 场内代理,
			CASE 
				WHEN OfficeAutomation_Document_UtContract_IsCoopWithECommerce='1' THEN '1、是，与房友圈签约，客户现场支付' + OfficeAutomation_Document_UtContract_CoopWithE1 + '元团购费（A）抵楼价' + OfficeAutomation_Document_UtContract_CoopWithE2 + '，协议约定房友圈支付我司电商佣'+ OfficeAutomation_Document_UtContract_CoopWithE3 + '元（B），扣除10%营运费用后我司实得' + OfficeAutomation_Document_UtContract_CoopWithE4 + '元，电商佣比例（C）（系统设公式C=B/A）' + OfficeAutomation_Document_UtContract_CoopWithE5 + '%；若C<90%必须上传发展商或电商的盖章文件说明原因。该项目' + CASE WHEN OfficeAutomation_Document_UtContract_FtoZ='1' THEN '由房友圈向发展商引入中原' WHEN OfficeAutomation_Document_UtContract_FtoZ='2' THEN '由中原向发展商引入房友圈' END
				WHEN OfficeAutomation_Document_UtContract_IsCoopWithECommerce='2' THEN '2、是，与其他电商签约，电商公司名称' + OfficeAutomation_Document_UtContract_ECommerceName
				WHEN OfficeAutomation_Document_UtContract_IsCoopWithECommerce='3' THEN '3、否，不需与电商签约，但客户需要在电商公司刷卡以获取买房优惠，电商公司名称' + OfficeAutomation_Document_UtContract_ECommerceName2
				WHEN OfficeAutomation_Document_UtContract_IsCoopWithECommerce='4' THEN '4、否，整个项目没有任何电商参与'
				ELSE ''
			END 我司是否与电商签约,
			CASE
				WHEN OfficeAutomation_Document_UtContract_JOrT='1' THEN '与行家同场联合代理'
				WHEN OfficeAutomation_Document_UtContract_JOrT='2' THEN '与行家轮流代理，即代理期内中原独家代理，代理期之外由行家轮流代理'
				WHEN OfficeAutomation_Document_UtContract_JOrT='3' THEN '整个项目由中原独家代理，发展商没有委托除中原以外的任何代理行'
				ELSE ''
			END 是否与行家联合代理或轮流代理,

			CASE WHEN OfficeAutomation_Document_UtContract_ProjFear='2' THEN '有（项目费用必须另上文申请提交黄生审批同意方可生效）当项目费用勾选“无”时，以下的合作费计提、合作费承担方式内容全部不显示，只需直接写代理费发展商佣合作费计提：' + OfficeAutomation_Document_UtContract_ProjSum1 + '电商佣合作费计提：' + OfficeAutomation_Document_UtContract_ProjSum2 + '（备注: 如项目同时有电商费用及合作费，需分别显示电商费用的比例及合作费的比例）
扣除合作费后的发展商佣金+电商佣金：' + OfficeAutomation_Document_UtContract_ProjSum3
			ELSE '无'
			END '项目费用(合作费)',

			OfficeAutomation_Document_UtContract_ACName AS 合同方法名称 ,

			--代理费相关
			('(1)发展商佣：（若要计算单套现金奖，合同代理费必须填写用来表示百分比的纯数字）固定收佣，合同代理费' + OfficeAutomation_Document_UtContract_OwnerCommFixScale + '%，公布代理费（扣除合作费后实收）：' + OfficeAutomation_Document_UtContract_OwnerCommAgent + '变动收佣，其中'  ) AS '代理费(发展商佣)',
			 OfficeAutomation_Document_UtContract_ClientCommFixScale AS '代理费(客佣)',
			--代理费相关结束

			('(3)电商佣：（若要计算单套现金奖，合同代理费必须填写用来表示百分比的纯数字）固定收佣，合同代理费' + OfficeAutomation_Document_UtContract_EBComm + '%，公布代理费（扣除电商费用及合作费后实收）：' + OfficeAutomation_Document_UtContract_EBCommAgent + '变动收佣，其中') AS '代理费(电商佣)',

			OfficeAutomation_Document_UtContract_Remark AS '代理费(代理费其他情况)',

			CASE WHEN OfficeAutomation_Document_UtContract_HaveSingleReward='1' THEN '有，此项目实收佣金比例≥3%，现金奖' + OfficeAutomation_Document_UtContract_RewardSignHave + '元/套， 现金奖的可发放金额=每套净佣金*15%（以发展商奖金为上限），可发放金额分配比例为：营业员44%，主管15%，区经8%，副总监/总监（O/R）3%，公司30%；超过每套净佣金的15%部分及公司30%部分全数上缴公司，可计入员工业绩，但不计算员工佣金'
				 WHEN OfficeAutomation_Document_UtContract_HaveSingleReward='2' THEN '有，此项目实收佣金比例<3%，现金奖全数上缴公司，可计入员工业绩，但不计算员工佣金；'
				 WHEN OfficeAutomation_Document_UtContract_HaveSingleReward='3' THEN '无，此项目不设现金奖。'
				 WHEN OfficeAutomation_Document_UtContract_HaveSingleReward='4' THEN '其他情况'
			ELSE ''
			END AS '代理费(单套现金奖)',

			OfficeAutomation_Document_UtContract_DeveloperConditions AS '代理费(发展商支付现金奖的条件)',
			OfficeAutomation_Document_UtContract_AreaConditions AS '代理费(区域派发现金奖给同事的条件)',

			CASE WHEN OfficeAutomation_Document_UtContract_PayRewardWay = '1' THEN '奖金由发展商划入公司帐户，随薪佣发放。' 
				 WHEN OfficeAutomation_Document_UtContract_PayRewardWay='2' THEN '奖金由发展商直接支付现金，接收人必须是申请部门负责人。'
				 ELSE ''
			END AS '代理费(现金奖的发放方式)',

			CASE WHEN OfficeAutomation_Document_UtContract_IsMyPay = '1' THEN '是' 
				 WHEN OfficeAutomation_Document_UtContract_IsMyPay = '2' THEN '否' 
				 ELSE ''
			END
			AS '代理费(现金奖是否需开具发票并由我司支付税费)',

			CASE WHEN OfficeAutomation_Document_UtContract_AreaComfirn = '1' THEN '是'
				 WHEN OfficeAutomation_Document_UtContract_AreaComfirn = '2' THEN '否'
				 ELSE ''
			END + ',区域承诺在前交回公司 ' + OfficeAutomation_Document_UtContract_ReturnBackDate + '前交回公司'
			AS '代理费(区域是否已提交发展商奖金确认书)',

			OfficeAutomation_Document_UtContract_TermsOfContract AS '代理费(代理合同约定的佣金支付条件)',
			OfficeAutomation_Document_UtContract_TermsOfMajorIssues AS '重大问题的合同条款（如违约赔偿条款、接盘区域限制等）'
			--20181009新增 结束
";
            

            //20181009新增字段

            string UtContract = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号], * FROM(("
        + "          SELECT OfficeAutomation_Document_UtContract_ID as [ID]"
        + "          ,OfficeAutomation_Document_UtContract_MainID as [MainID]"
      + "  ,OfficeAutomation_Document_UtContract_AreaFollowerContacter '联系人姓名'         "
       + "  ,OfficeAutomation_Document_UtContract_AreaFollowerContacterPhone '联系人电话'         "
  + " , OfficeAutomation_Document_UtContract_Name1 +' '+OfficeAutomation_Document_UtContract_Name2 项目名称   "
 + "   ,(SELECT OfficeAutomation_DealType_Name FROM t_Dic_OfficeAutomation_DealType WHERE OfficeAutomation_DealType_ID = OfficeAutomation_Document_UtContract_DealType) AS 代理类型        "         
 + "    ,OfficeAutomation_Document_UtContract_Developer 开发商  "
 + "    ,OfficeAutomation_Document_UtContract_GroupName 所属集团  "
+ " 	 ,OfficeAutomation_Document_UtContract_txtProjectAddress 地址   "
+ " 	  ,OfficeAutomation_Document_UtContract_AreaFollowerContacter '区域统筹人'   "
+ " 	 ,OfficeAutomation_Document_UtContract_AreaCheckDataer '区域对数人'   "
+ " , OfficeAutomation_Document_UtContract_SetNumber  '承接货量(套数)' "
 + "    , OfficeAutomation_Document_UtContract_PreCompleteNumber '预估代理期内完成货量' "
+ "		,OfficeAutomation_Document_UtContract_PreCompleteMoney '预估代理期内完成货量金额' "
+ "	,OfficeAutomation_Document_UtContract_PreCompleteComm '预估代理期内完成货量佣金' "
 + "  ,CASE OfficeAutomation_Document_UtContract_OneOrTwo WHEN '1' THEN '一手项目' WHEN '2' THEN '二手批量' END AS 项目性质    "
 + " ,(SELECT OfficeAutomation_DealOfficeType_Name + ',' FROM t_Dic_OfficeAutomation_DealOfficeType WHERE CHARINDEX(CONVERT(VARCHAR(10), OfficeAutomation_DealOfficeType_ID) "
 + "   , OfficeAutomation_Document_UtContract_DealOfficeTypeIDs) > 0 FOR XML PATH('')) AS [物业性质]  "
 + "  , OfficeAutomation_Document_UtContract_UnitPrice+'/㎡'     价格  "
 + "  ,'中原' 代理公司 "
 + "  ,OfficeAutomation_Document_UtContract_SamePlaceXX1+'+'+OfficeAutomation_Document_UtContract_SamePlaceXX2 '行家代理信息' "
+ "   , (select [OfficeAutomation_AddressArea_ProjectAddress] from [t_OfficeAutomation_AddressArea] where [OfficeAutomation_AddressArea_Code] =OfficeAutomation_Document_UtContract_ddlProjectAddress) '城市' "
 + "   ,OfficeAutomation_Document_UtContract_ProjectArea 项目所在区域 "
+ "    ,OfficeAutomation_Document_UtContract_AreaScale1    独立接盘区 "
+ "    ,OfficeAutomation_Document_UtContract_AreaScale +'  '+OfficeAutomation_Document_UtContract_AS2 两区合作接盘区 "
 + "   ,'续约' '新签/续约' "
 + "   ,OfficeAutomation_Document_UtContract_AgentStartDate 代理开始日期 "
 + "   ,OfficeAutomation_Document_UtContract_AgentEndDate 代理结束日期 "
 + "   ,OfficeAutomation_Document_UtContract_ClientGuardStartDate 保护开始日期 "
 + "   ,OfficeAutomation_Document_UtContract_ClientGuardEndDate 保护结束日期 "
 + "    ,OfficeAutomation_Document_UtContract_ApplyDate as ApplyDate "
+ " 	 ,(SELECT TOP 1 OfficeAutomation_Flow_AuditDate FROM t_OfficeAutomation_Flow WHERE todi.OfficeAutomation_Document_UtContract_MainID=t_OfficeAutomation_Flow.OfficeAutomation_Flow_MainID AND t_OfficeAutomation_Flow.OfficeAutomation_Flow_EmployeeID='0001' order by t_OfficeAutomation_Flow.OfficeAutomation_Flow_AuditDate desc) as [黄生的终审日期] "
 + "  ,OfficeAutomation_Document_UtContract_OwnerCommFixScale 发展商佣金    "
+ "    ,OfficeAutomation_Document_UtContract_EBCommAgent 电商佣金  "
 + "   ,OfficeAutomation_Document_UtContract_RewardSignHave 现金奖   "
 + n
 + "    , (CASE WHEN  OfficeAutomation_Document_UtContract_IsDirectContract =1 THEN '是' "
 + "  WHEN  OfficeAutomation_Document_UtContract_IsDirectContract =2 then '否' ELSE '' END )AS '是否与该发展商直接签约'"
 + "    ,OfficeAutomation_Document_UtContract_DirectContractName AS '签约公司名称'"
 + "   ,(select OfficeAutomation_DirectContractType_Name from t_Dic_OfficeAutomation_DirectContractType WHERE OfficeAutomation_DirectContractType_ID=OfficeAutomation_Document_UtContract_DirectContractType) AS '公司类型'"

  + "    , (CASE WHEN  OfficeAutomation_Document_UtContract_IslimitBuy =1 THEN '是' "
 + "  WHEN  OfficeAutomation_Document_UtContract_IslimitBuy =2 then '否' ELSE '' END )AS '是否限购'"
   + "    , (CASE WHEN  OfficeAutomation_Document_UtContract_IslimitSign =1 THEN '是' "
 + "  WHEN  OfficeAutomation_Document_UtContract_IslimitSign =2 then '否' ELSE '' END )AS '是否限签'"

  + "   ,REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_UtContract_Nre,'|1','佛山中原，'),'|2','中山中原，'),'|3','其他分公司，'+OfficeAutomation_Document_UtContract_AnotherCompany) '合作公司'  "
  + "   ,REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_UtContract_Rce,'|1','佛山中原，'),'|2','中山中原，'),'|3','其他分公司，'+OfficeAutomation_Document_UtContract_WillBreakUp) '《转介表》确认合作公司名称'  "
  + "   ,OfficeAutomation_Document_UtContract_BreakUp '拆分比例'  "
   + "  ,OfficeAutomation_Document_UtContract_Ncommissions '转介后广州中原净佣金比例'  "
   + "  ,CASE WHEN OfficeAutomation_Document_UtContract_DealS = 1 THEN '是' WHEN OfficeAutomation_Document_UtContract_DealS = 2 THEN '否' END '广州中原是否直接与发展商签代理合同/联动协议'  "
  + "   ,toam.OfficeAutomation_SerialNumber AS 文档编号  "
      + "   ,toam.OfficeAutomation_Main_Department AS 申请部门   "
+ "     ,  case when [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%（1）%' then '未审批'"
  + "  when [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%（2）%' then '审批中'"
+ "	when [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%（7）%' then '暂时保存中'"
+ "	when [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%（8）%' then '已过期'"
 + "   else  [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) end AS  '审批状态' "
        + smax
        + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_UtContract] todi "
        + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_UtContract_MainID"
        + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
        + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
        + slet;

            if (!isAdmin && !purview.Contains("OA_Search_067") || approver != "") //M_20150623
                UtContract += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            UtContract += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_067"))
                UtContract += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_UtContract_Apply='" + employee + "')";

            if (applicationDepartment != "")
                UtContract += " and OfficeAutomation_Document_UtContract_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                UtContract += " and OfficeAutomation_Document_UtContract_Apply = '" + applicant + "'";

            if (begin != "")
                UtContract += " and OfficeAutomation_Document_UtContract_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                UtContract += " and OfficeAutomation_Document_UtContract_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                UtContract += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    UtContract += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UtContract_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        UtContract += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        UtContract += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                UtContract += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                UtContract += " and ([OfficeAutomation_Document_UtContract_Name1] like '%" + keyWord + "%' OR [OfficeAutomation_Document_UtContract_Name2] like '%" + keyWord + "%')";

            if (approver != "" && cstatue != 3) //M_20150623
                UtContract += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                UtContract += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_UtContract_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    UtContract += "  OR (OfficeAutomation_Document_UtContract_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_UtContract_MainID))";
                }
            }
            UtContract += sgroup;

            n =
@"
--20181009新增
			,[dbo].[fn_BaseAgent2Text](OfficeAutomation_Document_UtNewProj_BaseAgent,OfficeAutomation_Document_UtNewProj_BaseAgentOther) AS 场内代理,
			CASE 
				WHEN OfficeAutomation_Document_UtNewProj_IsCoopWithECommerce='1' THEN '1、是，与房友圈签约，客户现场支付' + OfficeAutomation_Document_UtNewProj_CoopWithE1 + '元团购费（A）抵楼价' + OfficeAutomation_Document_UtNewProj_CoopWithE2 + '，协议约定房友圈支付我司电商佣'+ OfficeAutomation_Document_UtNewProj_CoopWithE3 + '元（B），扣除10%营运费用后我司实得' + OfficeAutomation_Document_UtNewProj_CoopWithE4 + '元，电商佣比例（C）（系统设公式C=B/A）' + OfficeAutomation_Document_UtNewProj_CoopWithE5 + '%；若C<90%必须上传发展商或电商的盖章文件说明原因。该项目' + CASE WHEN OfficeAutomation_Document_UtNewProj_FtoZ='1' THEN '由房友圈向发展商引入中原' WHEN OfficeAutomation_Document_UtNewProj_FtoZ='2' THEN '由中原向发展商引入房友圈' END
				WHEN OfficeAutomation_Document_UtNewProj_IsCoopWithECommerce='2' THEN '2、是，与其他电商签约，电商公司名称' + OfficeAutomation_Document_UtNewProj_ECommerceName
				WHEN OfficeAutomation_Document_UtNewProj_IsCoopWithECommerce='3' THEN '3、否，不需与电商签约，但客户需要在电商公司刷卡以获取买房优惠，电商公司名称' + OfficeAutomation_Document_UtNewProj_ECommerceName2
				WHEN OfficeAutomation_Document_UtNewProj_IsCoopWithECommerce='4' THEN '4、否，整个项目没有任何电商参与'
				ELSE ''
			END 我司是否与电商签约,
			CASE
				WHEN OfficeAutomation_Document_UtNewProj_JOrT='1' THEN '与行家同场联合代理'
				WHEN OfficeAutomation_Document_UtNewProj_JOrT='2' THEN '与行家轮流代理，即代理期内中原独家代理，代理期之外由行家轮流代理'
				WHEN OfficeAutomation_Document_UtNewProj_JOrT='3' THEN '整个项目由中原独家代理，发展商没有委托除中原以外的任何代理行'
				ELSE ''
			END 是否与行家联合代理或轮流代理,

			CASE WHEN OfficeAutomation_Document_UtNewProj_ProjFear='2' THEN '有（项目费用必须另上文申请提交黄生审批同意方可生效）当项目费用勾选“无”时，以下的合作费计提、合作费承担方式内容全部不显示，只需直接写代理费发展商佣合作费计提：' + OfficeAutomation_Document_UtNewProj_ProjSum1 + '电商佣合作费计提：' + OfficeAutomation_Document_UtNewProj_ProjSum2 + '（备注: 如项目同时有电商费用及合作费，需分别显示电商费用的比例及合作费的比例）
扣除合作费后的发展商佣金+电商佣金：' + OfficeAutomation_Document_UtNewProj_ProjSum3
			ELSE '无'
			END '项目费用(合作费)',

			OfficeAutomation_Document_UtNewProj_ACName AS 合同方法名称 ,

			--代理费相关
			('(1)发展商佣：（若要计算单套现金奖，合同代理费必须填写用来表示百分比的纯数字）固定收佣，合同代理费' + OfficeAutomation_Document_UtNewProj_OwnerCommFixScale + '%，公布代理费（扣除合作费后实收）：' + OfficeAutomation_Document_UtNewProj_OwnerCommAgent + '变动收佣，其中'  ) AS '代理费(发展商佣)',
			 OfficeAutomation_Document_UtNewProj_ClientCommFixScale AS '代理费(客佣)',
			--代理费相关结束

			('(3)电商佣：（若要计算单套现金奖，合同代理费必须填写用来表示百分比的纯数字）固定收佣，合同代理费' + OfficeAutomation_Document_UtNewProj_EBComm + '%，公布代理费（扣除电商费用及合作费后实收）：' + OfficeAutomation_Document_UtNewProj_EBCommAgent + '变动收佣，其中') AS '代理费(电商佣)',

			OfficeAutomation_Document_UtNewProj_Remark AS '代理费(代理费其他情况)',

			CASE WHEN OfficeAutomation_Document_UtNewProj_HaveSingleReward='1' THEN '有，此项目实收佣金比例≥3%，现金奖' + OfficeAutomation_Document_UtNewProj_RewardSignHave + '元/套， 现金奖的可发放金额=每套净佣金*15%（以发展商奖金为上限），可发放金额分配比例为：营业员44%，主管15%，区经8%，副总监/总监（O/R）3%，公司30%；超过每套净佣金的15%部分及公司30%部分全数上缴公司，可计入员工业绩，但不计算员工佣金'
				 WHEN OfficeAutomation_Document_UtNewProj_HaveSingleReward='2' THEN '有，此项目实收佣金比例<3%，现金奖全数上缴公司，可计入员工业绩，但不计算员工佣金；'
				 WHEN OfficeAutomation_Document_UtNewProj_HaveSingleReward='3' THEN '无，此项目不设现金奖。'
				 WHEN OfficeAutomation_Document_UtNewProj_HaveSingleReward='4' THEN '其他情况'
			ELSE ''
			END AS '代理费(单套现金奖)',

			OfficeAutomation_Document_UtNewProj_DeveloperConditions AS '代理费(发展商支付现金奖的条件)',
			OfficeAutomation_Document_UtNewProj_AreaConditions AS '代理费(区域派发现金奖给同事的条件)',

			CASE WHEN OfficeAutomation_Document_UtNewProj_PayRewardWay = '1' THEN '奖金由发展商划入公司帐户，随薪佣发放。' 
				 WHEN OfficeAutomation_Document_UtNewProj_PayRewardWay='2' THEN '奖金由发展商直接支付现金，接收人必须是申请部门负责人。'
				 ELSE ''
			END AS '代理费(现金奖的发放方式)',

			CASE WHEN OfficeAutomation_Document_UtNewProj_IsMyPay = '1' THEN '是' 
				 WHEN OfficeAutomation_Document_UtNewProj_IsMyPay = '2' THEN '否' 
				 ELSE ''
			END
			AS '代理费(现金奖是否需开具发票并由我司支付税费)',

			CASE WHEN OfficeAutomation_Document_UtNewProj_AreaComfirn = '1' THEN '是'
				 WHEN OfficeAutomation_Document_UtNewProj_AreaComfirn = '2' THEN '否'
				 ELSE ''
			END + ',区域承诺在前交回公司 ' + OfficeAutomation_Document_UtNewProj_ReturnBackDate + '前交回公司'
			AS '代理费(区域是否已提交发展商奖金确认书)',

			OfficeAutomation_Document_UtNewProj_TermsOfContract AS '代理费(代理合同约定的佣金支付条件)',
			OfficeAutomation_Document_UtNewProj_TermsOfMajorIssues AS '重大问题的合同条款（如违约赔偿条款、接盘区域限制等）'
			--20181009新增 结束
";

            string UtNewProj = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号], * FROM(("
                    + "          SELECT OfficeAutomation_Document_UtNewProj_ID as [ID]"
                    + "          ,OfficeAutomation_Document_UtNewProj_MainID as [MainID]"
                    + "          ,OfficeAutomation_Document_UtNewProj_AreaFollowerContacter '联系人姓名'"
                    + "          ,OfficeAutomation_Document_UtNewProj_AreaFollowerContacterPhone '联系人电话'"
                 + ",OfficeAutomation_Document_UtNewProj_Project 项目"
                  + ",(SELECT OfficeAutomation_DealType_Name FROM t_Dic_OfficeAutomation_DealType WHERE OfficeAutomation_DealType_ID = OfficeAutomation_Document_UtNewProj_DealType) AS 代理类型    "      
                   + ",OfficeAutomation_Document_UtNewProj_Developer 开发商 "
                    + ",OfficeAutomation_Document_UtNewProj_GroupName 所属集团 "
                    + ",OfficeAutomation_Document_UtNewProj_txtProjectAddress 项目地址     "
                     + ",OfficeAutomation_Document_UtNewProj_AreaFollowerContacter '区域统筹人'     "
                      + " ,OfficeAutomation_Document_UtNewProj_AreaCheckDataer '区域对数人'     "
	                + ", OfficeAutomation_Document_UtNewProj_SetNumber  '承接货量(套数)'"
                      + "	, OfficeAutomation_Document_UtNewProj_PreCompleteNumber '预估代理期内完成货量' "
		             + "  ,OfficeAutomation_Document_UtNewProj_PreCompleteMoney '预估代理期内完成货量金额' "
                   + "   ,OfficeAutomation_Document_UtNewProj_PreCompleteComm '预估代理期内完成货量佣金' "
	                + " ,CASE OfficeAutomation_Document_UtNewProj_OneOrTwo WHEN '1' THEN '一手项目' WHEN '2' THEN '二手批量' END AS 项目性质   "
                 + ",(SELECT OfficeAutomation_DealOfficeType_Name + ',' FROM t_Dic_OfficeAutomation_DealOfficeType WHERE CHARINDEX(CONVERT(VARCHAR(10), OfficeAutomation_DealOfficeType_ID)"
                  + " , OfficeAutomation_Document_UtNewProj_DealOfficeTypeIDs) > 0 FOR XML PATH('')) AS [物业性质] "
                  + ", OfficeAutomation_Document_UtNewProj_UnitPrice+'/㎡'     价格 "
                  + ",'中原' 代理公司"
                  + ",OfficeAutomation_Document_UtNewProj_SamePlaceXX1+'+'+OfficeAutomation_Document_UtNewProj_SamePlaceXX2 '行家代理信息'"
                  + ", (select [OfficeAutomation_AddressArea_ProjectAddress] from [t_OfficeAutomation_AddressArea] where [OfficeAutomation_AddressArea_Code] =OfficeAutomation_Document_UtNewProj_ddlProjectAddress) '城市'"
                   + ",OfficeAutomation_Document_UtNewProj_ProjectArea 项目所在区域"
                   + ",OfficeAutomation_Document_UtNewProj_AreaScale1    独立接盘区"
                  + " ,OfficeAutomation_Document_UtNewProj_AreaScale +'  '+OfficeAutomation_Document_UtNewProj_AS2 两区合作接盘区"
                   + ",'新签' '新签/续约'"
                  + " ,OfficeAutomation_Document_UtNewProj_AgentStartDate 代理开始日期"
                  + " ,OfficeAutomation_Document_UtNewProj_AgentEndDate 代理结束日期"
                   + ",OfficeAutomation_Document_UtNewProj_ClientGuardStartDate 保护开始日期"
                   + ",OfficeAutomation_Document_UtNewProj_ClientGuardEndDate 保护结束日期"
                    + ",OfficeAutomation_Document_UtNewProj_ApplyDate as ApplyDate"
	                 + ",(SELECT TOP 1 OfficeAutomation_Flow_AuditDate FROM t_OfficeAutomation_Flow WHERE todi.OfficeAutomation_Document_UtNewProj_MainID=t_OfficeAutomation_Flow.OfficeAutomation_Flow_MainID AND t_OfficeAutomation_Flow.OfficeAutomation_Flow_EmployeeID='0001' order by t_OfficeAutomation_Flow.OfficeAutomation_Flow_AuditDate desc) as [黄生的终审日期]"
                  + ",OfficeAutomation_Document_UtNewProj_OwnerCommFixScale 发展商佣金   "
                  + " ,OfficeAutomation_Document_UtNewProj_EBCommAgent 电商佣金 "
                   + ",OfficeAutomation_Document_UtNewProj_RewardSignHave 现金奖  "
                   + n
                   + ", (CASE WHEN  OfficeAutomation_Document_UtNewProj_IsDirectContract =1 THEN '是' "
                    + " WHEN  OfficeAutomation_Document_UtNewProj_IsDirectContract =2 then '否' ELSE '' END )AS '是否与该发展商直接签约'"

                    + " ,OfficeAutomation_Document_UtNewProj_DirectContractName AS '签约公司名称'"
                    + "  ,(select OfficeAutomation_DirectContractType_Name from t_Dic_OfficeAutomation_DirectContractType WHERE OfficeAutomation_DirectContractType_ID=OfficeAutomation_Document_UtNewProj_DirectContractType) AS '公司类型'"

                     + ", (CASE WHEN  OfficeAutomation_Document_UtNewProj_IslimitBuy =1 THEN '是' "
                    + " WHEN  OfficeAutomation_Document_UtNewProj_IslimitBuy =2 then '否' ELSE '' END )AS '是否限购'"
                       + ", (CASE WHEN  OfficeAutomation_Document_UtNewProj_IslimitSign =1 THEN '是' "
                    + " WHEN  OfficeAutomation_Document_UtNewProj_IslimitSign =2 then '否' ELSE '' END )AS '是否限签'"

                    + ",REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_UtNewProj_Nre,'|1','佛山中原，'),'|2','中山中原，'),'|3','其他分公司，'+OfficeAutomation_Document_UtNewProj_AnotherCompany) '合作公司' "
                    + ",REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_UtNewProj_Rce,'|1','佛山中原，'),'|2','中山中原，'),'|3','其他分公司，'+OfficeAutomation_Document_UtNewProj_WillBreakUp) '《转介表》确认合作公司名称' "
                    + ",OfficeAutomation_Document_UtNewProj_BreakUp '拆分比例' "
                    + ",OfficeAutomation_Document_UtNewProj_Ncommissions '转介后广州中原净佣金比例' "
                    + ",CASE WHEN OfficeAutomation_Document_UtNewProj_DealS = 1 THEN '是' WHEN OfficeAutomation_Document_UtNewProj_DealS = 2 THEN '否' END '广州中原是否直接与发展商签代理合同/联动协议' "
                    
                    + ",toam.OfficeAutomation_SerialNumber AS 文档编号 "
                       + ",toam.OfficeAutomation_Main_Department AS 申请部门 "
                  + "  ,  case when [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%（1）%' then '未审批'"
            + " when [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%（2）%' then '审批中'"
	         + "when [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%（7）%' then '暂时保存中'"
             + "when [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%（8）%' then '已过期'"
           + "  else  [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) end AS  '审批状态'"
                            + smax
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_UtNewProj] todi "
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_UtNewProj_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + slet;

            if (!isAdmin && !purview.Contains("OA_Search_068") || approver != "") //M_20150623
                UtNewProj += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            UtNewProj += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_068"))
                UtNewProj += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_UtNewProj_Apply='" + employee + "')";

            if (applicationDepartment != "")
                UtNewProj += " and OfficeAutomation_Document_UtNewProj_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                UtNewProj += " and OfficeAutomation_Document_UtNewProj_Apply = '" + applicant + "'";

            if (begin != "")
                UtNewProj += " and OfficeAutomation_Document_UtNewProj_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                UtNewProj += " and OfficeAutomation_Document_UtNewProj_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                UtNewProj += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    UtNewProj += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UtNewProj_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        UtNewProj += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        UtNewProj += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                UtNewProj += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                UtNewProj += " and [OfficeAutomation_Document_UtNewProj_Project] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                UtNewProj += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                UtNewProj += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_UtNewProj_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    UtNewProj += "  OR (OfficeAutomation_Document_UtNewProj_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_UtNewProj_MainID))";
                }
            }
            UtNewProj += sgroup;














            string BuyBuilding = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号], * FROM(("
                    + "          SELECT OfficeAutomation_Document_BuyBuilding_ID as [ID]"
                    + "          ,OfficeAutomation_Document_BuyBuilding_MainID as [MainID]"
                    + "          ,OfficeAutomation_Document_BuyBuilding_Apply as 申请人"
                    + "          ,OfficeAutomation_Document_BuyBuilding_ApplyDate as ApplyDate"
                    + "          ,toam.OfficeAutomation_SerialNumber AS 文档编码"
                    + "          ,OfficeAutomation_Document_BuyBuilding_Department as 部门"
                    + "          ,OfficeAutomation_Document_BuyBuilding_Position AS 职位"
                    + "          ,OfficeAutomation_Document_BuyBuilding_ApplyForCode AS 工号"
                    + "          ,OfficeAutomation_Document_BuyBuilding_ApplyForName AS 姓名"
                    + "          ,REPLACE(REPLACE(OfficeAutomation_Document_BuyBuilding_FreeTypeIDs,'1','免公司佣金'),'2','免按揭手续费') as 申请项目"
                    + "          ,CASE OfficeAutomation_Document_BuyBuilding_DealTypeID"
                    + "          	WHEN 1 THEN '购买'"
                    + "          	WHEN 2 THEN '租赁'"
                    + "          	ELSE '未选择'"
                    + "          END 交易类型,"
                    + "          CASE OfficeAutomation_Document_BuyBuilding_OwnerTypeID WHEN 1 THEN [OfficeAutomation_Document_BuyBuilding_ApplyForName] WHEN 2 THEN [OfficeAutomation_Document_BuyBuilding_ApplyForName]+'、'+OfficeAutomation_Document_BuyBuilding_OwnerRelation WHEN 3 THEN [OfficeAutomation_Document_BuyBuilding_ApplyForName]+'、'+OfficeAutomation_Document_BuyBuilding_OwnerRelation END AS 业权人,"
                    + "          CASE OfficeAutomation_Document_BuyBuilding_OwnerIsEmployee WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 业权联名人是否同为公司员工,"
                    + "          OfficeAutomation_Document_BuyBuilding_OwnerEmployeeCode AS 关系人工号,"
                    + "          OfficeAutomation_Document_BuyBuilding_OwnerFamilyRelation AS 业权联名人双方关系,"
                    + "          CASE OfficeAutomation_Document_BuyBuilding_DealBuild"
                    + "          	WHEN '1' THEN '一手代理项目'"
                    + "          	WHEN '2' THEN '二手物业'"
                    + "          	ELSE '未选择'"
                    + "          END 交易物业,"
                    + "          CASE OfficeAutomation_Document_BuyBuilding_MortgageAddressTypeID"
                    + "          	WHEN '1' THEN '汇瀚'"
                    + "          	WHEN '2' THEN '其他'"
                    + "          	WHEN '3' THEN '房友圈按揭金融服务中心'"
                    + "          	ELSE '未选择'"
                    + "          END 按揭办理地点"
                    + "          ,OfficeAutomation_Document_BuyBuilding_TransNo AS 成交编号"
                    + "          ,OfficeAutomation_Document_BuyBuilding_TransAddress AS 成交地址"
                    + "          ,OfficeAutomation_Document_BuyBuilding_TransDate AS 成交日期"
                    + "          ,OfficeAutomation_Document_BuyBuilding_HouseRegistrant AS 房产证登记人,"
                    + "          CASE OfficeAutomation_Document_BuyBuilding_IsRebate"
                    + "          	WHEN '1' THEN '是'"
                    + "          	WHEN '0' THEN '否'"
                    + "          	ELSE '未选择'"
                    + "          END 是否已退佣"
                    + "          ,OfficeAutomation_Document_BuyBuilding_RebateDate AS 退佣日期"
                    + "          ,OfficeAutomation_Document_BuyBuilding_Instruction AS 特俗情况说明"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "          WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                     + "                   FROM   t_OfficeAutomation_Flow f"
                    + "                    WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID]"
                    + "                           AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                    ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "          WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                                FROM   t_OfficeAutomation_Flow f"
                    + "                                WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID]"
                    + "                                       AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                                ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "          WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                    + "                       WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                    + "                       WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                    + "                       WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                    + "          END AS 审批状态"
                    + smax
                    + "          FROM t_OfficeAutomation_Document_BuyBuilding todi"
                    + "          LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BuyBuilding_MainID"
                    + "          LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + "          LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + slet;

            if (!isAdmin && !purview.Contains("OA_Search_013") || approver != "") //M_20150623
                BuyBuilding += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            BuyBuilding += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_013"))
                BuyBuilding += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BuyBuilding_Apply='" + employee + "')";

            if (applicationDepartment != "")
                BuyBuilding += " and OfficeAutomation_Document_BuyBuilding_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                BuyBuilding += " and OfficeAutomation_Document_BuyBuilding_Apply = '" + applicant + "'";

            if (begin != "")
                BuyBuilding += " and OfficeAutomation_Document_BuyBuilding_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                BuyBuilding += " and OfficeAutomation_Document_BuyBuilding_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                BuyBuilding += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    BuyBuilding += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        BuyBuilding += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        BuyBuilding += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                BuyBuilding += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                BuyBuilding += " and OfficeAutomation_Document_BuyBuilding_ApplyForName like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                BuyBuilding += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                BuyBuilding += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_BuyBuilding_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    BuyBuilding += "  OR (OfficeAutomation_Document_BuyBuilding_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_BuyBuilding_MainID))";
                }
            }
            BuyBuilding += sgroup;

            string CarAllowance = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号], * FROM(("
                    + "          SELECT OfficeAutomation_Document_CarAllowance_ID as [ID]"
                    + "          ,OfficeAutomation_Document_CarAllowance_MainID as [MainID]"
                    + "          ,OfficeAutomation_Document_CarAllowance_Apply as 申请人"
                    + "          ,OfficeAutomation_Document_CarAllowance_ApplyDate as ApplyDate"
                    + "          ,toam.OfficeAutomation_SerialNumber AS 文档编码"
                    + "          ,OfficeAutomation_Document_CarAllowance_Department as 部门"
                    + "          ,OfficeAutomation_Document_CarAllowance_Position AS 职位"
                    + "          ,OfficeAutomation_Document_CarAllowance_ApplyForCode AS 工号"
                    + "          ,OfficeAutomation_Document_CarAllowance_ApplyForName AS 姓名"
                    + "          ,OfficeAutomation_Document_CarAllowance_Grade AS 职级"
                    + "          ,OfficeAutomation_Document_CarAllowance_EffectiveDate AS 生效日期"
                    + "          ,CASE OfficeAutomation_Document_CarAllowance_MoneyGradeID"
                    + "          	WHEN 1 THEN '400元/月'"
                    + "          	WHEN 2 THEN '700元/月'"
                    + "          	ELSE '未选择'"
                    + "          END 审批金额"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + "          WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                    FROM   t_OfficeAutomation_Flow f"
                    + "                    WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID]"
                    + "                           AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                    ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "          WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                                FROM   t_OfficeAutomation_Flow f"
                    + "                                WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID]"
                    + "                                       AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                                ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + "          WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                    + "                       WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                    + "                       WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                    + "                       WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                    + "          END AS 审批状态"
                    + smax
                    + "          FROM t_OfficeAutomation_Document_CarAllowance todi"
                    + "          LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CarAllowance_MainID"
                    + "          LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + "          LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + slet;

            if (!isAdmin && !purview.Contains("OA_Search_014") || approver != "") //M_20150623
                CarAllowance += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            CarAllowance += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_014"))
                CarAllowance += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CarAllowance_Apply='" + employee + "')";

            if (applicationDepartment != "")
                CarAllowance += " and OfficeAutomation_Document_CarAllowance_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                CarAllowance += " and OfficeAutomation_Document_CarAllowance_Apply = '" + applicant + "'";

            if (begin != "")
                CarAllowance += " and OfficeAutomation_Document_CarAllowance_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                CarAllowance += " and OfficeAutomation_Document_CarAllowance_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                CarAllowance += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    CarAllowance += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        CarAllowance += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        CarAllowance += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                CarAllowance += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                CarAllowance += " and OfficeAutomation_Document_CarAllowance_ApplyForName like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                CarAllowance += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                CarAllowance += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CarAllowance_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    CarAllowance += "  OR (OfficeAutomation_Document_CarAllowance_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CarAllowance_MainID))";
                }
            }
            CarAllowance += sgroup;










            string OpenProve = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号], * FROM(("
                    + "          SELECT OfficeAutomation_Document_OpenProve_ID as [ID]"
                    + "          ,OfficeAutomation_Document_OpenProve_MainID as [MainID]"
                    + " ,OfficeAutomation_Document_OpenProve_Apply as 填写人"
                    + " ,OfficeAutomation_Document_OpenProve_ApplyDate as ApplyDate"
                    + " ,OfficeAutomation_Document_OpenProve_Department as 现任职部门"
                    + " ,OfficeAutomation_Document_OpenProve_Code AS 工号"
                    + " ,OfficeAutomation_Document_OpenProve_Name AS 姓名"
                    + " ,OfficeAutomation_Document_OpenProve_EnterDate AS 入职日期"
                    + " ,OfficeAutomation_Document_OpenProve_Position AS 现职位"
                    + " ,OfficeAutomation_Document_OpenProve_Phone AS 联系电话"
                   // + " ,OfficeAutomation_Document_OpenProve_SignMode AS 联系电话"
                    + " ,case when OfficeAutomation_Document_OpenProve_SignMode='1' then '快递到付,快递地址：'+ OfficeAutomation_Document_OpenProve_SignAddress+',联系电话：'+OfficeAutomation_Document_OpenProve_SignPhone+',签收人:'+OfficeAutomation_Document_OpenProve_Recipient  "
                         + "when OfficeAutomation_Document_OpenProve_SignMode ='2' then '到公司总部进行签收 ' "
                        + "else ''end 签收方式"
                   + " ,OfficeAutomation_Document_OpenProve_ExceptionalCase AS 特殊情况说明"
                   // + " ,OfficeAutomation_Document_OpenProve_Rank AS 现职级"
                    + " ,dt.OfficeAutomation_Document_OpenProve_Detail_Prove AS 申请证明类别"
                    + " ,dt.OfficeAutomation_Document_OpenProve_Detail_No AS 份数"
                    + " ,CASE dt.OfficeAutomation_Document_OpenProve_Detail_Reasondb "
                    + " 	WHEN '1' THEN '办理签证：出游地点 ' + isnull(OfficeAutomation_Document_OpenProve_Detail_Address,'') + '，出游时间 ' + isnull(OfficeAutomation_Document_OpenProve_Detail_Sdate,'') +'至' + isnull(OfficeAutomation_Document_OpenProve_Detail_Edate,'')"
                    + " 	WHEN '0' THEN '其他原因：'+ OfficeAutomation_Document_OpenProve_Detail_AnotherR "
                    + " 	WHEN '2' THEN '购车' "
                    + " 	WHEN '3' THEN '购房' "
                    
                    + " END AS 开具原因"
                    + " ,CASE dt.OfficeAutomation_Document_OpenProve_Detail_Kind "
                    + " 	WHEN '1' THEN '月均税前收入'"
                    + " 	WHEN '2' THEN '月均税后收入'"
                     + " 	WHEN '4' THEN '无'"
                    + " 	WHEN '3' THEN '\"'+ '其他要求：' + isnull(OfficeAutomation_Document_OpenProve_Detail_AnotherKind,'') +'\"' "
                    + " END  AS 收入证明金额类型"
                    + " ,CASE toam.OfficeAutomation_Main_FlowStateID"
                    + " WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "           FROM   t_OfficeAutomation_Flow f"
                    + "           WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OpenProve_MainID]"
                    + "                  AND f.OfficeAutomation_Flow_Audit = 0"
                    + "           ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + " WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                    + "                       FROM   t_OfficeAutomation_Flow f"
                    + "                       WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OpenProve_MainID]"
                    + "                              AND f.OfficeAutomation_Flow_Audit = 0"
                    + "                       ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                    + " WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                    + "              WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OpenProve_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                    + "              WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OpenProve_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) in( 1,100) THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                    + "              WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OpenProve_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                    + " END AS 审批状态"
                    + smax
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_OpenProve] todi "
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_OpenProve_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " RIGHT JOIN t_OfficeAutomation_Document_OpenProve_Detail dt ON dt.OfficeAutomation_Document_OpenProve_Detail_MainID = todi.OfficeAutomation_Document_OpenProve_ID"
                    + slet;

            if (!isAdmin && !purview.Contains("OA_Search_018") || approver != "") //M_20150623
                OpenProve += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            OpenProve += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_018"))
                OpenProve += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_OpenProve_Apply='" + employee + "')";

            if (applicationDepartment != "")
                OpenProve += " and OfficeAutomation_Document_OpenProve_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                OpenProve += " and OfficeAutomation_Document_OpenProve_Apply = '" + applicant + "'";

            if (begin != "")
                OpenProve += " and OfficeAutomation_Document_OpenProve_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                OpenProve += " and OfficeAutomation_Document_OpenProve_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                OpenProve += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    OpenProve += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OpenProve_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        OpenProve += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        OpenProve += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                OpenProve += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                OpenProve += " and [OfficeAutomation_Document_OpenProve_Name] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                OpenProve += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                OpenProve += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_OpenProve_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    OpenProve += "  OR (OfficeAutomation_Document_OpenProve_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_OpenProve_MainID))";
                }
            }
            OpenProve += sgroup;

            string ProjCost = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号], * FROM((" //*All
                    + "          SELECT OfficeAutomation_Document_ProjCost_ID as [ID]"
                    + "          ,OfficeAutomation_Document_ProjCost_MainID as [MainID]"
                    + "          ,OfficeAutomation_Document_ProjCost_Apply AS 填写人"
                    + "          ,OfficeAutomation_Document_ProjCost_ApplyForName AS 申请人姓名"
                    + "          ,OfficeAutomation_Document_ProjCost_ApplyForCode AS 申请人工号"
                    + "          ,OfficeAutomation_Document_ProjCost_Department AS 部门名称"
                    + "          ,OfficeAutomation_Document_ProjCost_ApplyDate AS ApplyDate"
                    + "          ,OfficeAutomation_Document_ProjCost_ReplyPhone AS 回复电话"
                    + "          ,OfficeAutomation_Document_ProjCost_Project AS 项目名称"
                    + "          ,OfficeAutomation_Document_ProjCost_Developer AS 发展商"
                    + "          ,OfficeAutomation_Document_ProjCost_ProjLeader AS 项目负责人"
                    + "          ,OfficeAutomation_Document_ProjCost_ProjBusiLeader AS 项目拓展负责人"
                    + "          ,(SELECT OfficeAutomation_DealOfficeType_Name + ',' FROM t_Dic_OfficeAutomation_DealOfficeType WHERE CHARINDEX(CONVERT(VARCHAR(10), OfficeAutomation_DealOfficeType_ID), OfficeAutomation_Document_ProjCost_DealOfficeTypeID) > 0 FOR XML PATH('')) AS [物业性质]"
                    + "          ,OfficeAutomation_Document_ProjCost_Square AS 可售面积"
                    + "          ,OfficeAutomation_Document_ProjCost_Receiver AS 收款人姓名"
                    + "          ,CASE OfficeAutomation_Document_ProjCost_JOrT WHEN 1 THEN '与行家同场联合代理' WHEN 2 THEN '与行家轮流代理，即代理期内中原独家代理，代理期之外由行家轮流代理' WHEN 3 THEN '整个项目由中原独家代理，发展商没有委托除中原以外的任何代理行' END AS 是否与行家联合代理或轮流代理"
                    + "          ,OfficeAutomation_Document_ProjCost_SamePlaceXX1 AS 同场代理的行家名称1"
                    + "          ,OfficeAutomation_Document_ProjCost_SamePlaceXX2 AS 同场代理的行家名称2"
                    + "          ,OfficeAutomation_Document_ProjCost_TurnsAgentXX1 AS 轮流代理的行家名称1"
                    + "          ,OfficeAutomation_Document_ProjCost_TurnsAgentXX2 AS 轮流代理的行家名称2"
                    + "          ,OfficeAutomation_Document_ProjCost_AgencyFee1 AS 同场代理行家代理费1"
                    + "          ,OfficeAutomation_Document_ProjCost_AgencyFee2 AS 同场代理行家代理费2"
                    + "          ,OfficeAutomation_Document_ProjCost_AgencyFee3 AS 轮流代理行家代理费1"
                    + "          ,OfficeAutomation_Document_ProjCost_AgencyFee4 AS 轮流代理行家代理费2"
                    + "          ,CASE OfficeAutomation_Document_ProjCost_IsCashPrize1 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有同场代理行家现金奖1"
                    + "          ,CASE OfficeAutomation_Document_ProjCost_IsCashPrize2 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有同场代理行家现金奖2"
                    + "          ,CASE OfficeAutomation_Document_ProjCost_IsCashPrize3 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有轮流代理行家现金奖1"
                    + "          ,CASE OfficeAutomation_Document_ProjCost_IsCashPrize4 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有轮流代理行家现金奖2"
                    + "          ,OfficeAutomation_Document_ProjCost_CashPrize1 AS 同场代理行家现金奖1"
                    + "          ,OfficeAutomation_Document_ProjCost_CashPrize2 AS 同场代理行家现金奖2"
                    + "          ,OfficeAutomation_Document_ProjCost_CashPrize3 AS 轮流代理行家现金奖1"
                    + "          ,OfficeAutomation_Document_ProjCost_CashPrize4 AS 轮流代理行家现金奖2"
                    + "          ,OfficeAutomation_Document_ProjCost_AgencyBeginDate1 AS 轮流代理行家代理开始期1"
                    + "          ,OfficeAutomation_Document_ProjCost_AgencyBeginDate2 AS 轮流代理行家代理开始期2"
                    + "          ,OfficeAutomation_Document_ProjCost_AgencyEndDate1 AS 轮流代理行家代理结束期1"
                    + "          ,OfficeAutomation_Document_ProjCost_AgencyEndDate2 AS 轮流代理行家代理结束期2"
                    + "          ,CASE OfficeAutomation_Document_ProjCost_IsPFear1 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有同场代理项目费用1"
                    + "          ,CASE OfficeAutomation_Document_ProjCost_IsPFear2 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有同场代理项目费用2"
                    + "          ,CASE OfficeAutomation_Document_ProjCost_IsPFear3 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有轮流代理项目费用1"
                    + "          ,CASE OfficeAutomation_Document_ProjCost_IsPFear4 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有轮流代理项目费用2"
                    + "          ,OfficeAutomation_Document_ProjCost_PFear1 AS 同场代理项目费用1"
                    + "          ,OfficeAutomation_Document_ProjCost_PFear2 AS 同场代理项目费用2"
                    + "          ,OfficeAutomation_Document_ProjCost_PFear3 AS 轮流代理项目费用1"
                    + "          ,OfficeAutomation_Document_ProjCost_PFear4 AS 轮流代理项目费用2"
                    + "          ,OfficeAutomation_Document_ProjCost_PreProjAgenceFee AS 预计项目代理费计提"
                    + "          ,OfficeAutomation_Document_ProjCost_BrokerCostApply AS 居间费用计提申请"
                    + "          ,OfficeAutomation_Document_ProjCost_BrokerCostReason AS 居间费用计提原因"
                    + "          ,OfficeAutomation_Document_ProjCost_BrokerName AS 居间人姓名"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) END AS 审批状态"
                    + "          ,(SELECT TOP 1 f.OfficeAutomation_Flow_Suggestion FROM t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) AS 审批意见"
                    + smax
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjCost] todi "
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjCost_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + slet;

            if (!isAdmin && !purview.Contains("OA_Search_018") || approver != "") //M_20150623
                ProjCost += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            ProjCost += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_018"))
                ProjCost += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjCost_Apply='" + employee + "')";

            if (applicationDepartment != "")
                ProjCost += " and OfficeAutomation_Document_ProjCost_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                ProjCost += " and OfficeAutomation_Document_ProjCost_Apply = '" + applicant + "'";

            if (begin != "")
                ProjCost += " and OfficeAutomation_Document_ProjCost_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                ProjCost += " and OfficeAutomation_Document_ProjCost_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                ProjCost += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    ProjCost += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        ProjCost += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        ProjCost += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                ProjCost += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                ProjCost += " and [OfficeAutomation_Document_ProjCost_Project] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                ProjCost += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                ProjCost += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjCost_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    ProjCost += "  OR (OfficeAutomation_Document_ProjCost_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjCost_MainID))";
                }
            }
            ProjCost += sgroup;


            string CoopCost = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号], * FROM(("
                    + "          SELECT OfficeAutomation_Document_CoopCost_ID as [ID]"
                    + "          ,OfficeAutomation_Document_CoopCost_MainID as [MainID]"
                    + "          ,OfficeAutomation_Document_CoopCost_Apply AS 填写人"
                    + "          ,OfficeAutomation_Document_CoopCost_ApplyForName AS 申请人姓名"
                    + "          ,OfficeAutomation_Document_CoopCost_ApplyForCode AS 申请人工号"
                    + "          ,OfficeAutomation_Document_CoopCost_Department AS 部门名称"
                    + "          ,OfficeAutomation_Document_CoopCost_ApplyDate AS ApplyDate"
                    + "          ,OfficeAutomation_Document_CoopCost_ReplyPhone AS 回复电话"
                    + "          ,(SELECT OfficeAutomation_DepartmentType_Name FROM t_Dic_OfficeAutomation_DepartmentType WHERE OfficeAutomation_DepartmentType_DocumentID = 15 AND OfficeAutomation_DepartmentType_ID = OfficeAutomation_Document_CoopCost_DepartmentTypeID) AS 部门类别"
                    + "          ,OfficeAutomation_Document_CoopCost_DealDate AS 成交日期"
                    + "          ,OfficeAutomation_Document_CoopCost_PropertyName AS 物业名称"
                    + "          ,OfficeAutomation_Document_CoopCost_ReportID AS 成交报告编号"
                    + "          ,(SELECT OfficeAutomation_DealType_Name FROM t_Dic_OfficeAutomation_DealType WHERE OfficeAutomation_DealType_ID = OfficeAutomation_Document_CoopCost_DealTypeID) AS [交易性质]"
                    + "          ,OfficeAutomation_Document_CoopCost_Area AS 面积"
                    + "          ,OfficeAutomation_Document_CoopCost_DealPrice AS [成交价/月租金]"
                    + "          ,OfficeAutomation_Document_CoopCost_OwnerComm AS 业佣"
                    + "          ,OfficeAutomation_Document_CoopCost_OwnerScale AS 业佣比例"
                    + "          ,OfficeAutomation_Document_CoopCost_ClientComm AS 客佣"
                    + "          ,OfficeAutomation_Document_CoopCost_ClientScale AS 客佣比例"
                    + "          ,OfficeAutomation_Document_CoopCost_TotalComm AS 总佣金"
                    + "          ,OfficeAutomation_Document_CoopCost_TotalScale AS 总比例"
                    + "          ,CASE OfficeAutomation_Document_CoopCost_BillTypeOwner WHEN 2 THEN '合作方提供发票领款人' WHEN 1 THEN '需我司代扣税费合作人' END AS 业主发票抬头类型"
                    + "          ,OfficeAutomation_Document_CoopCost_OwnerName AS 业主发票抬头姓名"
                    + "          ,CASE OfficeAutomation_Document_CoopCost_IsOwner WHEN 0 THEN '否' WHEN 1 THEN '是' END AS [业主方]"
                    + "          ,OfficeAutomation_Document_CoopCost_OwnerCoopCondition AS 业主合作条件"
                    + "          ,OfficeAutomation_Document_CoopCost_OwnerCoopMoney AS 业主合作金额"
                    + "          ,OfficeAutomation_Document_CoopCost_OwnerCoopScale AS 业主合作费占业佣比例"
                    + "          ,OfficeAutomation_Document_CoopCost_OwnerCoopTotalScale AS 业主合作费占总佣金比例"
                    + "          ,CASE OfficeAutomation_Document_CoopCost_BillTypeClient WHEN 2 THEN '合作方提供发票领款人' WHEN 1 THEN '需我司代扣税费合作人' END AS 买家发票抬头类型"
                    + "          ,OfficeAutomation_Document_CoopCost_ClientName AS 买家发票抬头姓名"
                    + "          ,CASE OfficeAutomation_Document_CoopCost_IsClient WHEN 0 THEN '否' WHEN 1 THEN '是' END AS [买家/租客方]"
                    + "          ,OfficeAutomation_Document_CoopCost_ClientCoopCondition AS 买家合作条件"
                    + "          ,OfficeAutomation_Document_CoopCost_ClientCoopMoney AS 买家合作金额"
                    + "          ,OfficeAutomation_Document_CoopCost_ClientCoopScale AS 买家合作费占客佣比例"
                    + "          ,OfficeAutomation_Document_CoopCost_ClientCoopTotalScale AS 买家合作费占总佣金比例"
                    + "          ,OfficeAutomation_Document_CoopCost_CoopMoney AS 合作金额"
                    + "          ,OfficeAutomation_Document_CoopCost_CoopTotalScale AS 合作费占总佣金比例"
                    + "          ,OfficeAutomation_Document_CoopCost_ActualComm AS 公司实收佣金金额"
                    + "          ,OfficeAutomation_Document_CoopCost_ActualCommScale AS 实际收佣比例"
                    + "          ,CASE toam.OfficeAutomation_Main_FlowStateID WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) END AS 审批状态"
                    + "          ,(SELECT TOP 1 f.OfficeAutomation_Flow_Suggestion FROM t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) AS 审批意见"
                    + smax
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CoopCost] todi "
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CoopCost_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + slet;

            if (!isAdmin && !purview.Contains("OA_Search_019") || approver != "") //M_20150623
                CoopCost += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            CoopCost += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_019"))
                CoopCost += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CoopCost_Apply='" + employee + "')";

            if (applicationDepartment != "")
                CoopCost += " and OfficeAutomation_Document_CoopCost_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                CoopCost += " and OfficeAutomation_Document_CoopCost_Apply = '" + applicant + "'";

            if (begin != "")
                CoopCost += " and OfficeAutomation_Document_CoopCost_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                CoopCost += " and OfficeAutomation_Document_CoopCost_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                CoopCost += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    CoopCost += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        CoopCost += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        CoopCost += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                CoopCost += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                CoopCost += " and [OfficeAutomation_Document_CoopCost_PropertyName] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                CoopCost += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                CoopCost += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CoopCost_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    CoopCost += "  OR (OfficeAutomation_Document_CoopCost_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CoopCost_MainID))";
                }
            }
            CoopCost += sgroup;

            string undertakeproj = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
                + @",OfficeAutomation_Document_UndertakeProj_ID as ID 
                    ,OfficeAutomation_Document_UndertakeProj_MainID as MainID
                    ,[OfficeAutomation_Document_UndertakeProj_Department] as Department
                   
                    ,[OfficeAutomation_Document_UndertakeProj_Apply] as Apply 
                    ,OfficeAutomation_Document_UndertakeProj_AreaFollowerContacter '联系人姓名'
                    ,OfficeAutomation_Document_UndertakeProj_AreaFollowerContacterPhone '联系人电话'
                    ,OfficeAutomation_Document_UndertakeProj_Project AS [项目名称] 
                    ,(SELECT OfficeAutomation_DealType_Name FROM t_Dic_OfficeAutomation_DealType WHERE OfficeAutomation_DealType_ID = OfficeAutomation_Document_UndertakeProj_DealTypeID) AS 代理类型    
                    ,OfficeAutomation_Document_UndertakeProj_Developer AS [开发商]
                    ,OfficeAutomation_Document_UndertakeProj_GroupName AS [所属集团] 
                    ,OfficeAutomation_Document_UndertakeProj_ProjectAddress AS [项目地址] 
                    ,OfficeAutomation_Document_UndertakeProj_AreaFollowerContacter '区域统筹人'
                    ,OfficeAutomation_Document_UndertakeProj_AreaCheckDataer '区域对数人'
                    , OfficeAutomation_Document_UndertakeProj_SetNumber  '承接货量(套数)' 
                    ,OfficeAutomation_Document_UndertakeProj_PreCompleteNumber AS 预估代理期内完成货量
                    ,OfficeAutomation_Document_UndertakeProj_PreCompleteMoney AS 预估代理期内完成货量金额
                    ,OfficeAutomation_Document_UndertakeProj_PreCompleteComm AS 预估代理期内完成货量佣金 
                    ,(SELECT OfficeAutomation_ProjectProperty_Name FROM t_Dic_OfficeAutomation_ProjectProperty WHERE OfficeAutomation_ProjectProperty_ID = OfficeAutomation_Document_UndertakeProj_ProjectPropertyID AND OfficeAutomation_ProjectProperty_DocumentID = 16) AS [项目性质] 
                    ,(SELECT OfficeAutomation_DealOfficeType_Name + ',' FROM t_Dic_OfficeAutomation_DealOfficeType WHERE CHARINDEX(CONVERT(VARCHAR(10), OfficeAutomation_DealOfficeType_ID), OfficeAutomation_Document_UndertakeProj_DealOfficeTypeIDs) > 0 FOR XML PATH('')) AS [物业性质] 
                    ,OfficeAutomation_Document_UndertakeProj_UnitPrice+'/㎡'     价格 
                    ,'中原' 代理公司   
                    ,OfficeAutomation_Document_UndertakeProj_SamePlaceXX1+OfficeAutomation_Document_UndertakeProj_SamePlaceXX2 '行家代理信息'
                    , '' 城市   
                    ,OfficeAutomation_Document_UndertakeProj_ProjectArea AS [项目所在区域] 
                    ,OfficeAutomation_Document_UndertakeProj_AreaScale    独立接盘区
                    ,OfficeAutomation_Document_UndertakeProj_AreaScale 两区合作接盘区
                    ,'报备' '新签/续约'
                    ,OfficeAutomation_Document_UndertakeProj_AgentStartDate 代理开始日期    
                    ,OfficeAutomation_Document_UndertakeProj_AgentEndDate 代理结束日期    
                    ,OfficeAutomation_Document_UndertakeProj_ClientGuardStartDate 保护开始日期   
                    ,OfficeAutomation_Document_UndertakeProj_ClientGuardEndDate 保护结束日期  
                    ,[OfficeAutomation_Document_UndertakeProj_ApplyDate] AS ApplyDate   
                    ,(SELECT TOP 1 OfficeAutomation_Flow_AuditDate FROM t_OfficeAutomation_Flow WHERE todi.OfficeAutomation_Document_UndertakeProj_MainID=t_OfficeAutomation_Flow.OfficeAutomation_Flow_MainID AND t_OfficeAutomation_Flow.OfficeAutomation_Flow_EmployeeID='0001' order by t_OfficeAutomation_Flow.OfficeAutomation_Flow_AuditDate desc) as [黄生的终审日期]   
                    ,OfficeAutomation_Document_UndertakeProj_OwnerCommFixScale 发展商佣金        
                    ,OfficeAutomation_Document_UndertakeProj_EBCommAgent 电商佣金     
                    ,OfficeAutomation_Document_UndertakeProj_RewardSignHave 现金奖   
                    ,[dbo].[fn_BaseAgent2Text](OfficeAutomation_Document_UndertakeProj_BaseAgent
                    ,OfficeAutomation_Document_UndertakeProj_BaseAgentOther) AS 场内代理
                    ,CASE 
	                    WHEN OfficeAutomation_Document_UndertakeProj_IsCoopWithECommerce='1' THEN '1、是，电商公司名称' + OfficeAutomation_Document_UndertakeProj_ECommerceName 
	                    WHEN OfficeAutomation_Document_UndertakeProj_IsCoopWithECommerce='0' THEN '2、否，但客户需要在电商公司刷卡以获取买房优惠'
	                    WHEN OfficeAutomation_Document_UndertakeProj_IsCoopWithECommerce='2' THEN '3、否，整个项目没有任何电商参与'
	                    ELSE ''
                    END 我司是否与电商签约,
                    CASE
	                    WHEN OfficeAutomation_Document_UndertakeProj_JOrT='1' THEN '与行家同场联合代理'
	                    WHEN OfficeAutomation_Document_UndertakeProj_JOrT='2' THEN '与行家轮流代理，即代理期内中原独家代理，代理期之外由行家轮流代理'
	                    WHEN OfficeAutomation_Document_UndertakeProj_JOrT='3' THEN '整个项目由中原独家代理，发展商没有委托除中原以外的任何代理行'
	                    ELSE ''
                    END 是否与行家联合代理或轮流代理,

                    CASE WHEN OfficeAutomation_Document_UndertakeProj_ProjectCost='1' THEN '无'
	                    WHEN OfficeAutomation_Document_UndertakeProj_ProjectCost='0' THEN '有 （项目费用必须另上文申请提交黄生审批同意方可生效）'
                    ELSE '无'
                    END '项目费用(合作费)'

                    ,'' AS 合同方法名称 

                    --代理费相关
                    ,('(1)发展商佣：（若要计算单套现金奖，合同代理费必须填写用来表示百分比的纯数字）固定收佣，合同代理费' + OfficeAutomation_Document_UndertakeProj_OwnerCommFixScale + '%，公布代理费（扣除合作费后实收）：' + OfficeAutomation_Document_UndertakeProj_OwnerCommAgent + '变动收佣，其中'  ) AS '代理费(发展商佣)'
                    , OfficeAutomation_Document_UndertakeProj_ClientCommFixScale AS '代理费(客佣)',
                    --代理费相关结束

                    ('(3)电商佣：（若要计算单套现金奖，合同代理费必须填写用来表示百分比的纯数字）固定收佣，合同代理费' + OfficeAutomation_Document_UndertakeProj_EBComm + '%，公布代理费（扣除电商费用及合作费后实收）：' + OfficeAutomation_Document_UndertakeProj_EBCommAgent + '变动收佣，其中') AS '代理费(电商佣)',

                    OfficeAutomation_Document_UndertakeProj_Remark AS '代理费(代理费其他情况)',

                    CASE WHEN OfficeAutomation_Document_UndertakeProj_HaveSingleReward='1' THEN '有，此项目实收佣金比例≥3%，现金奖' + OfficeAutomation_Document_UndertakeProj_RewardSignHave + '元/套， 现金奖的可发放金额=每套净佣金*15%（以发展商奖金为上限），可发放金额分配比例为：营业员44%，主管15%，区经8%，副总监/总监（O/R）3%，公司30%；超过每套净佣金的15%部分及公司30%部分全数上缴公司，可计入员工业绩，但不计算员工佣金'
		                    WHEN OfficeAutomation_Document_UndertakeProj_HaveSingleReward='2' THEN '有，此项目实收佣金比例<3%，现金奖全数上缴公司，可计入员工业绩，但不计算员工佣金；'
		                    WHEN OfficeAutomation_Document_UndertakeProj_HaveSingleReward='3' THEN '无，此项目不设现金奖。'
		                    WHEN OfficeAutomation_Document_UndertakeProj_HaveSingleReward='4' THEN '其他情况'
                    ELSE ''
                    END AS '代理费(单套现金奖)',

                    OfficeAutomation_Document_UndertakeProj_DeveloperConditions AS '代理费(发展商支付现金奖的条件)',
                    OfficeAutomation_Document_UndertakeProj_AreaConditions AS '代理费(区域派发现金奖给同事的条件)',

                    CASE WHEN OfficeAutomation_Document_UndertakeProj_PayRewardWay = '1' THEN '奖金由发展商划入公司帐户，随薪佣发放。' 
		                    WHEN OfficeAutomation_Document_UndertakeProj_PayRewardWay='2' THEN '奖金由发展商直接支付现金，接收人必须是申请部门负责人。'
		                    ELSE ''
                    END AS '代理费(现金奖的发放方式)',

                    CASE WHEN OfficeAutomation_Document_UndertakeProj_IsMyPay = '1' THEN '是' 
		                    WHEN OfficeAutomation_Document_UndertakeProj_IsMyPay = '2' THEN '否' 
		                    ELSE ''
                    END
                    AS '代理费(现金奖是否需开具发票并由我司支付税费)',

                    CASE WHEN OfficeAutomation_Document_UndertakeProj_AreaComfirn = '1' THEN '是'
		                    WHEN OfficeAutomation_Document_UndertakeProj_AreaComfirn = '2' THEN '否'
		                    ELSE ''
                    END + ',区域承诺在前交回公司 ' + OfficeAutomation_Document_UndertakeProj_ReturnBackDate + '前交回公司'
                    AS '代理费(区域是否已提交发展商奖金确认书)',

                    OfficeAutomation_Document_UndertakeProj_TermsOfContract AS '代理费(代理合同约定的佣金支付条件)',
                    OfficeAutomation_Document_UndertakeProj_TermsOfMajorIssues AS '重大问题的合同条款（如违约赔偿条款、接盘区域限制等）'
                    --20181009新增 结束
                    , '' '是否与该发展商直接签约'   
                    ,'' AS '签约公司名称'   
                    ,'' AS '公司类型'   
	                ,'' AS '是否限购'
                    ,'' AS '是否限签'
                    ,OfficeAutomation_Document_UndertakeProj_AnotherCompany '合作公司'
                    ,OfficeAutomation_Document_UndertakeProj_WillBreakUp '《转介表》确认合作公司名称'
                    ,OfficeAutomation_Document_UndertakeProj_BreakUp '拆分比例'
                    ,OfficeAutomation_Document_UndertakeProj_Ncommissions '转介后广州中原净佣金比例'
                    ,'' '广州中原是否直接与发展商签代理合同/联动协议'
                    ,toam.OfficeAutomation_SerialNumber AS 文档编号     
                    ,toam.OfficeAutomation_Main_Department AS 申请部门        
                    ,  case when [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%（1）%' then '未审批'  
                    when [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%（2）%' then '审批中'	
                    when [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%（7）%' then '暂时保存中'	
                    when [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%（8）%' then '已过期'   
                    else  [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) end AS  '审批状态' "
                + smax
                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_UndertakeProj] todi "
                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_UndertakeProj_MainID"
                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                + slet;

            if (!isAdmin && !purview.Contains("OA_Search_020") || approver != "") //M_20150623
                undertakeproj += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            undertakeproj += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_020"))
                undertakeproj += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_UndertakeProj_Apply='" + employee + "')";

            if (applicationDepartment != "")
                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_Apply = '" + applicant + "'";

            if (begin != "")
                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                undertakeproj += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    undertakeproj += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        undertakeproj += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        undertakeproj += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                undertakeproj += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                undertakeproj += " and [OfficeAutomation_Document_UndertakeProj_Project] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                undertakeproj += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                undertakeproj += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_UndertakeProj_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    undertakeproj += "  OR (OfficeAutomation_Document_UndertakeProj_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_UndertakeProj_MainID))";
                }
            }
            undertakeproj += sgroup;

            string ProjLinkRepoData = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_ID as ID"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_MainID as MainID"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_Department AS Department"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_ApplyDate AS ApplyDate"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_Apply as Apply"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_ProjName AS 项目名称"
                     + "          ,CASE OfficeAutomation_Document_ProjLinkRepoData_HavePreSaleID WHEN 0 THEN '否' WHEN 1 THEN '是' END AS 是否有预售证"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_ProjAddress AS 项目地址"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_DeveloperName AS 开发商名称"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_GroupName AS 所属集团名称"
                     + "          ,(SELECT OfficeAutomation_DealOfficeType_Name + ',' FROM t_Dic_OfficeAutomation_DealOfficeType WHERE CHARINDEX(CONVERT(VARCHAR(10), OfficeAutomation_DealOfficeType_ID), OfficeAutomation_Document_ProjLinkRepoData_DealOfficeTypeIDs) > 0 FOR XML PATH('')) AS [物业性质]"
                     + "          ,(OfficeAutomation_Document_ProjLinkRepoData_AgentStartDate + '～' + OfficeAutomation_Document_ProjLinkRepoData_AgentEndDate) AS 项目代理期"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_GoodsQuantity AS 代理期内可售货量"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_GoodsValue AS 代理期内可售货值"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_CommPoint AS 申请报数点数"
                     + "          ,CASE OfficeAutomation_Document_ProjLinkRepoData_HaveCoopCost WHEN 0 THEN '否' WHEN 1 THEN '是' END AS 是否有合作费"
                     + "          ,CASE OfficeAutomation_Document_ProjLinkRepoData_JOrT WHEN 1 THEN '与行家同场联合代理' WHEN 2 THEN '与行家轮流代理，即代理期内中原独家代理，代理期之外由行家轮流代理' WHEN 3 THEN '整个项目由中原独家代理，发展商没有委托除中原以外的任何代理行' END AS [是否与行家联合代理或轮流代理]"
                     + "          ,(CASE OfficeAutomation_Document_ProjLinkRepoData_JOrT WHEN 1 THEN('1.名称：' + OfficeAutomation_Document_ProjLinkRepoData_SamePlaceXX1 + '，代理费：' + OfficeAutomation_Document_ProjLinkRepoData_AgencyFee1 + '，现金奖：' + (CASE OfficeAutomation_Document_ProjLinkRepoData_IsCashPrize1 WHEN 1 THEN OfficeAutomation_Document_ProjLinkRepoData_CashPrize1 + '元/套' ELSE '无' END) + '，项目费用：' + (CASE OfficeAutomation_Document_ProjLinkRepoData_IsPFear1 WHEN 1 THEN '比例:' + OfficeAutomation_Document_ProjLinkRepoData_PFear1 ELSE '无' END) + '；2.名称：' + OfficeAutomation_Document_ProjLinkRepoData_SamePlaceXX2 + '，代理费：' + OfficeAutomation_Document_ProjLinkRepoData_AgencyFee2 + '，现金奖：' + (CASE OfficeAutomation_Document_ProjLinkRepoData_IsCashPrize2 WHEN 1 THEN OfficeAutomation_Document_ProjLinkRepoData_CashPrize2 + '元/套' ELSE '无' END) + '，项目费用：' + (CASE OfficeAutomation_Document_ProjLinkRepoData_IsPFear2 WHEN 1 THEN '比例:' + OfficeAutomation_Document_ProjLinkRepoData_PFear2 ELSE '无' END))ELSE '' END) AS [同场代理的行家]"
                     + "          ,(CASE OfficeAutomation_Document_ProjLinkRepoData_JOrT WHEN 2 THEN('1.名称：' + OfficeAutomation_Document_ProjLinkRepoData_TurnsAgentXX1 + '，代理期：' + OfficeAutomation_Document_ProjLinkRepoData_AgencyBeginDate1 + '～' + OfficeAutomation_Document_ProjLinkRepoData_AgencyEndDate1 + '，代理费：' + OfficeAutomation_Document_ProjLinkRepoData_AgencyFee3 + '，现金奖：' + (CASE OfficeAutomation_Document_ProjLinkRepoData_IsCashPrize3 WHEN 1 THEN OfficeAutomation_Document_ProjLinkRepoData_CashPrize3 + '元/套' ELSE '无' END) + '，项目费用：' + (CASE OfficeAutomation_Document_ProjLinkRepoData_IsPFear3 WHEN 1 THEN '比例:' + OfficeAutomation_Document_ProjLinkRepoData_PFear3 ELSE '无' END) + '；2.名称：' + OfficeAutomation_Document_ProjLinkRepoData_TurnsAgentXX2 + '，代理期：' + OfficeAutomation_Document_ProjLinkRepoData_AgencyBeginDate2 + '～' + OfficeAutomation_Document_ProjLinkRepoData_AgencyEndDate2 + '，代理费：' + OfficeAutomation_Document_ProjLinkRepoData_AgencyFee4 + '，现金奖：' + (CASE OfficeAutomation_Document_ProjLinkRepoData_IsCashPrize4 WHEN 1 THEN OfficeAutomation_Document_ProjLinkRepoData_CashPrize4 + '元/套' ELSE '无' END) + '，项目费用：' + (CASE OfficeAutomation_Document_ProjLinkRepoData_IsPFear4 WHEN 1 THEN '比例:' + OfficeAutomation_Document_ProjLinkRepoData_PFear4 ELSE '无' END))ELSE '' END) AS [轮流代理的行家]"
                     + "          ,(OfficeAutomation_Document_ProjLinkRepoData_LinkStartDate + '～' + OfficeAutomation_Document_ProjLinkRepoData_LinkEndDate) AS 联动时间"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_CommCalcGet AS 佣金计提"
                     + "          ,('项目部：宗数:' + OfficeAutomation_Document_ProjLinkRepoData_ProjDepCount + '，报数成交价:' + OfficeAutomation_Document_ProjLinkRepoData_ProjDepPrice + '，应收佣金:' + OfficeAutomation_Document_ProjLinkRepoData_ProjDepComm + '；物业部：宗数:' + OfficeAutomation_Document_ProjLinkRepoData_PropDepCount + '，报数成交价:' + OfficeAutomation_Document_ProjLinkRepoData_PropDepPrice + '，应收佣金:' + OfficeAutomation_Document_ProjLinkRepoData_PropDepComm) AS [联动业绩拆分（宗数/报数成交价/应收佣金）]"
                     + "          ,('计提类型：' + (CASE OfficeAutomation_Document_ProjLinkRepoData_CalcGetType WHEN 1 THEN '无' WHEN 2 THEN '仅一手部分计提' WHEN 3 THEN '仅二手部分计提' WHEN 4 THEN '一二手部分均计提' WHEN 5 THEN OfficeAutomation_Document_ProjLinkRepoData_CalcGetTypeOther END) + '；承担类型：' + (CASE OfficeAutomation_Document_ProjLinkRepoData_AssumeType WHEN 1 THEN '无' WHEN 2 THEN '项目部承担' WHEN 3 THEN '物业部承担' WHEN 4 THEN '项目部与物业部各自承担' WHEN 5 THEN OfficeAutomation_Document_ProjLinkRepoData_AssumeTypeOther END))AS 项目合作费"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_AddRemark AS 补充说明"
                     + "          ,(CASE OfficeAutomation_Document_ProjLinkRepoData_ProjType WHEN 1 THEN '新项目' ELSE '旧项目' END) AS 项目类型"
                     + "          ,(CASE OfficeAutomation_Document_ProjLinkRepoData_ProjType WHEN 1 THEN '' ELSE OfficeAutomation_Document_ProjLinkRepoData_HisIndepCount END) AS [如为旧项目，独立成交的成交宗数]"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_HisIndepPerformance AS 成交业绩"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_HisTotalProfit AS 期间累计税前利润"
                     + "          ,(CASE OfficeAutomation_Document_ProjLinkRepoData_ProjType WHEN 1 THEN '' ELSE OfficeAutomation_Document_ProjLinkRepoData_HisLinkCount END) AS [如为旧项目，联动成交的成交宗数]"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_HisLinkPerformance AS 成交业绩"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_HisTotalProfit AS 期间累计税前利润"
                     + "          ,CASE OfficeAutomation_Document_ProjLinkRepoData_AgentModel WHEN 1 THEN '联合代理' WHEN 2 THEN '独家代理' END AS 代理模式"
                     + "          ,CASE OfficeAutomation_Document_ProjLinkRepoData_HaveCoopConf WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有合作确认函"
                     + "          ,CASE OfficeAutomation_Document_ProjLinkRepoData_IsSignBack WHEN 1 THEN '是' WHEN 0 THEN '否，预计签回时间：' + OfficeAutomation_Document_ProjLinkRepoData_ContractPreSignBackDate END AS 合同是否签回"
                     + "          ,OfficeAutomation_Document_ProjLinkRepoData_Remark AS 备注"
                    //2016-05-16 SYSREQ201605131050117462723 黄生审核意见
                     + "          ,'审批结果：' + (SELECT top 1 CASE OfficeAutomation_Flow_IsAgree WHEN '0' THEN '不同意' WHEN '1' THEN '同意' WHEN '2' THEN '其他意见' ELSE '未审核' END AS [意见]  FROM t_OfficeAutomation_Flow WHERE todi.OfficeAutomation_Document_ProjLinkRepoData_MainID=t_OfficeAutomation_Flow.OfficeAutomation_Flow_MainID AND t_OfficeAutomation_Flow.OfficeAutomation_Flow_Employee='黄轩明' order by t_OfficeAutomation_Flow.OfficeAutomation_Flow_AuditDate desc) + '\r\n审核意见：' + (SELECT top 1 CASE OfficeAutomation_Flow_Suggestion WHEN '' THEN '无' WHEN null THEN '无' ELSE OfficeAutomation_Flow_Suggestion END FROM t_OfficeAutomation_Flow WHERE todi.OfficeAutomation_Document_ProjLinkRepoData_MainID=t_OfficeAutomation_Flow.OfficeAutomation_Flow_MainID AND t_OfficeAutomation_Flow.OfficeAutomation_Flow_Employee='黄轩明' order by t_OfficeAutomation_Flow.OfficeAutomation_Flow_AuditDate desc) as [黄生审批意见]"
                //2016-05-16 SYSREQ201605131050117462723 黄生审核时间
                     + "          ,(SELECT TOP 1 OfficeAutomation_Flow_AuditDate FROM t_OfficeAutomation_Flow WHERE todi.OfficeAutomation_Document_ProjLinkRepoData_MainID=t_OfficeAutomation_Flow.OfficeAutomation_Flow_MainID AND t_OfficeAutomation_Flow.OfficeAutomation_Flow_EmployeeID='0001' order by t_OfficeAutomation_Flow.OfficeAutomation_Flow_AuditDate desc) as [黄生的终审日期]"
                + smax
                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjLinkRepoData] todi "
                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjLinkRepoData_MainID"
                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                + slet;

            if (!isAdmin && !purview.Contains("OA_Search_029") || approver != "") //M_20150623
                ProjLinkRepoData += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            ProjLinkRepoData += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_029"))
                ProjLinkRepoData += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjLinkRepoData_Apply='" + employee + "')";

            if (applicationDepartment != "")
                ProjLinkRepoData += " and OfficeAutomation_Document_ProjLinkRepoData_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                ProjLinkRepoData += " and OfficeAutomation_Document_ProjLinkRepoData_Apply = '" + applicant + "'";

            if (begin != "")
                ProjLinkRepoData += " and OfficeAutomation_Document_ProjLinkRepoData_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                ProjLinkRepoData += " and OfficeAutomation_Document_ProjLinkRepoData_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                ProjLinkRepoData += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    ProjLinkRepoData += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        ProjLinkRepoData += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        ProjLinkRepoData += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                ProjLinkRepoData += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                ProjLinkRepoData += " and [OfficeAutomation_Document_ProjLinkRepoData_ProjName] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                ProjLinkRepoData += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                ProjLinkRepoData += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjLinkRepoData_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    ProjLinkRepoData += "  OR (OfficeAutomation_Document_ProjLinkRepoData_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjLinkRepoData_MainID))";
                }
            }
            ProjLinkRepoData += sgroup;

            string FurtherEducation = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_ID as [ID]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_MainID as [MainID]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_Apply as [Apply]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_ApplyDate as [ApplyDate]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_Name as [申请人姓名]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_No as [工号]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_Department as [部门/分行]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_InData as [入职日期]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_OnData as [通过试用日期]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_Position as [职位]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_Rank as [职级]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_Srecord as [最高学历]"
                     + "          ,case OfficeAutomation_Document_FurtherEducation_Welfare WHEN 1 THEN '是' WHEN 0 THEN '否' END as [本年度是否享有该福利]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_ApplyID as [资格证号码]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_IDData as [出证日期]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_School as [学校名称]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_Subjects as [进修科目]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_BeginData as [开课日期]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_During as [进修期限]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_EndData as [预计毕业日期]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_Fees as [本年度培训费/学费]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_ShouldAllowance as [本年度可享受津贴]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_ApplyAllowance as [申请津贴]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_ActualyAllowance as [实际享受津贴]"
                     + "          ,case OfficeAutomation_Document_FurtherEducation_Conditions WHEN 1 THEN '是' WHEN 2 THEN '否' ELSE '' END as [符合申请条件]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_AllowData as [发放时间]"
                     + "          ,OfficeAutomation_Document_FurtherEducation_Remark as [备注]"
                + smax
                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_FurtherEducation] todi "
                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_FurtherEducation_MainID"
                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                + slet;

            if (!isAdmin && !purview.Contains("OA_Search_035") || approver != "") //M_20150623
                FurtherEducation += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            FurtherEducation += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_035"))
                FurtherEducation += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_FurtherEducation_Name = '" + employee + "' or OfficeAutomation_Document_FurtherEducation_Apply='" + employee + "')";

            if (applicationDepartment != "")
                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_Apply = '" + applicant + "'";

            if (begin != "")
                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                FurtherEducation += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    FurtherEducation += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        FurtherEducation += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        FurtherEducation += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                FurtherEducation += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                FurtherEducation += " and [OfficeAutomation_Document_FurtherEducation_School] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                FurtherEducation += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                FurtherEducation += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_FurtherEducation_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    FurtherEducation += "  OR (OfficeAutomation_Document_FurtherEducation_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_FurtherEducation_MainID))";
                }
            }
            FurtherEducation += sgroup;

            string ReduceComm = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
                   +"             ,toam.OfficeAutomation_SerialNumber '文档编号' "
                     + "          ,OfficeAutomation_Document_ReduceComm_ID as [ID]"
                     + "          ,OfficeAutomation_Document_ReduceComm_MainID as [MainID]"
                     + "          ,OfficeAutomation_Document_ReduceComm_Apply as [Apply]"
                     + "          ,OfficeAutomation_Document_ReduceComm_ApplyDate as [ApplyDate]"
                     + "          ,OfficeAutomation_Document_ReduceComm_Apply as [申请人]"
                     + "          ,OfficeAutomation_Document_ReduceComm_Department as [Department]"
                     //+ "          ,OfficeAutomation_Document_ReduceComm_ApplyID as [发文编号]"
                     + "          ,(SELECT OfficeAutomation_DepartmentType_Name"
                     + "          FROM [DB_EcOfficeAutomation].[dbo].[t_Dic_OfficeAutomation_DepartmentType]"
                     + "          where OfficeAutomation_DepartmentType_DocumentID = 13"
                     + "          and OfficeAutomation_DepartmentType_IsEnable = 1"
                     + "          AND OfficeAutomation_DepartmentType_ID = OfficeAutomation_Document_ReduceComm_DepartmentTypeID) as [所属区域]"
                     + "          ,OfficeAutomation_Document_ReduceComm_Subject as [文件主题]"
                     + "          ,OfficeAutomation_Document_ReduceComm_DealDepartment as [成交单位]"
                     + "          ,OfficeAutomation_Document_ReduceComm_OriginalDealPrice as [原成交价]"
                     + "          ,OfficeAutomation_Document_ReduceComm_FinalDealPrice as [客户最终成交价]"
                     + "          ,OfficeAutomation_Document_ReduceComm_CommPoint as [代理费点数]"
                     + "          ,OfficeAutomation_Document_ReduceComm_OriginalComm as [原佣金]"
                     + "          ,OfficeAutomation_Document_ReduceComm_ReduceCashBonus as [让现金奖金额]"
                     + "          ,OfficeAutomation_Document_ReduceComm_ReduceComm as [让佣金额]"

                     + "          ,OfficeAutomation_Document_ReduceComm_EBCommPoint as [电商代理费总数]"
                     + "          ,OfficeAutomation_Document_ReduceComm_CaCommPoint as [发展商代理费总数]"
                     + "          ,OfficeAutomation_Document_ReduceComm_KSa as [合同约定客佣]"
                     + "          ,OfficeAutomation_Document_ReduceComm_EBOriginalComm as [电商佣总额]"
                     + "          ,OfficeAutomation_Document_ReduceComm_CaOriginalComm as [发展商佣总额]"
                     + "          ,OfficeAutomation_Document_ReduceComm_KSb as [折让前客佣]"
                     + "          ,OfficeAutomation_Document_ReduceComm_EBReduceCashBonus as [让电商佣总额]"
                     + "          ,OfficeAutomation_Document_ReduceComm_CaReduceCashBonus as [让发展商佣总额]"
                     + "          ,OfficeAutomation_Document_ReduceComm_KSc as [申请折让客佣]"
                     + "          ,OfficeAutomation_Document_ReduceComm_EBReduceComm as [折让后电商佣总额]"
                     + "          ,OfficeAutomation_Document_ReduceComm_CaReduceComm as [折让后发展商佣总额]"
                     + "          ,OfficeAutomation_Document_ReduceComm_KSd as [折让后客佣]"

                     + "          ,OfficeAutomation_Document_ReduceComm_TotalReduce as [让现金奖+让佣的总金额]"
                     + "          ,OfficeAutomation_Document_ReduceComm_ActualReportMoney as [实际上数金额]"
                     + "          ,case OfficeAutomation_Document_ReduceComm_ReduceWay WHEN '1' THEN '√' WHEN '1|' THEN '√' END as [从发展商佣金中扣除]"
                     + "          ,case OfficeAutomation_Document_ReduceComm_ReduceWay WHEN '2' THEN '√' WHEN '2|' THEN '√' END as [从电商佣金中扣除]"
                     + "          ,case OfficeAutomation_Document_ReduceComm_ReduceWay WHEN '3' THEN '√' WHEN '3|' THEN '√' END as [折让现金给客户]"
                     + "          ,case OfficeAutomation_Document_ReduceComm_ReduceWay WHEN '4' THEN '√' WHEN '4|' THEN '√' END as [从客佣中扣除]"
                     + "          ,OfficeAutomation_Document_ReduceComm_Reason as [让佣原因说明]"
                + smax
                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ReduceComm] todi "
                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ReduceComm_MainID"
                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                + slet;

            if (!isAdmin && !purview.Contains("OA_Search_017") || approver != "") //M_20150623
                ReduceComm += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            ReduceComm += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_017"))
                ReduceComm += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ReduceComm_Apply='" + employee + "')";

            if (applicationDepartment != "")
                ReduceComm += " and OfficeAutomation_Document_ReduceComm_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                ReduceComm += " and OfficeAutomation_Document_ReduceComm_Apply = '" + applicant + "'";

            if (begin != "")
                ReduceComm += " and OfficeAutomation_Document_ReduceComm_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                ReduceComm += " and OfficeAutomation_Document_ReduceComm_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                ReduceComm += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    ReduceComm += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        ReduceComm += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        ReduceComm += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                ReduceComm += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                ReduceComm += " and [OfficeAutomation_Document_ReduceComm_Reason] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                ReduceComm += " and auditorsum like '%" + approver + "%'";

            //if (approver != "" && apptime != "") //M_GWSky：20150630
            //    ReduceComm += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ReduceComm_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            //20190806 MODIFY BY HERMAN:增加结束日期查询条件
            if (!string.IsNullOrEmpty(approver) && !string.IsNullOrEmpty(apptime) && !string.IsNullOrEmpty(apptotime))
                ReduceComm += string.Format(@" and (
                    SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow 
                    WHERE OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ReduceComm_MainID AND
                          OfficeAutomation_Flow_Auditor LIKE '%{0}%' AND 
                          CONVERT(NVARCHAR(50),OfficeAutomation_Flow_AuditDate,120) >= '{1}' AND
                          CONVERT(NVARCHAR(50),OfficeAutomation_Flow_AuditDate,120) <= '{2}'
                    ) IS NOT NULL
                ", approver, apptime, apptotime);

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    ReduceComm += "  OR (OfficeAutomation_Document_ReduceComm_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ReduceComm_MainID))";
                }
            }
            ReduceComm += sgroup;
            //特殊上数申请
            string SpeciaNumber = @"  select 
                                        ROW_NUMBER() OVER(ORDER BY " + sn + @" desc) as [序号]
                                        ,OfficeAutomation_Document_SpecialNumber_ID as [ID]
                                        ,OfficeAutomation_Document_SpecialNumber_MainID MainID
                                        ,OfficeAutomation_Document_SpecialNumber_ApplyDate ApplyDate 
                                        ,OfficeAutomation_Document_SpecialNumber_Department '发文部门'
                                        ,OfficeAutomation_Document_SpecialNumber_Apply '发文人'
                                        ,OfficeAutomation_Document_SpecialNumber_ApplyDate '发文日期'
                                        ,OfficeAutomation_Document_SpecialNumber_Subject '文件主题'
                                        ,case when OfficeAutomation_Document_SpecialNumber_DealNature =1 then '物业部一手'
                                         when OfficeAutomation_Document_SpecialNumber_DealNature =2 then '二手批量'
                                         when OfficeAutomation_Document_SpecialNumber_DealNature =3 then '二手散单' end '交易性质'
                                        ,OfficeAutomation_Document_SpecialNumber_Names '项目名称/成交地址（二手散单）'
                                        ,OfficeAutomation_Document_SpecialNumber_Period '项目代理期'
                                        ,OfficeAutomation_Document_SpecialNumber_ApplyNo ' 项目报备申请编号'
                                        ,REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_SpecialNumber_DealOfficeTypeIDs ,'3|','住宅，'),'4|','公寓，'),'5|','写字楼，'),'6|','商铺，'),'7|','车位，'),'8|','别墅，'),'9|','其他，'+OfficeAutomation_Document_SpecialNumber_DealOfficeOther) '物业性质'  
                                        ,case when OfficeAutomation_Document_SpecialNumber_AgentModel =1then '联合代理' 
                                              when OfficeAutomation_Document_SpecialNumber_AgentModel=2 then '独家代理'
	                                          end '代理模式'
                                        ,REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(OfficeAutomation_Document_SpecialNumber_TheReason ,'|1','无合作确认函（即开工函），'),'|2','无代理合同，'),'|3','无客户确认函，'),'|4','过代理期成交，')
                                        ,'|5','大额成交无网签，'),'|6','无产权文件，'),'|7','与受托方签订代理合同无发展商委托原件,'),'|9','无预售证,'),'|8','其他,') '欠缺的资料及申请特殊上数原因'  
                                        ,OfficeAutomation_Document_SpecialNumber_Describe '原因详述'
                                        ,(SELECT OfficeAutomation_Flow_Suggestion FROM t_OfficeAutomation_Flow  
                                         WHERE OfficeAutomation_Document_SpecialNumber_MainID = OfficeAutomation_Flow_MainID AND OfficeAutomation_Flow_Idx = 1) '申请人' 
                                        ,(SELECT OfficeAutomation_Flow_Suggestion FROM t_OfficeAutomation_Flow  
                                         WHERE OfficeAutomation_Document_SpecialNumber_MainID = OfficeAutomation_Flow_MainID AND OfficeAutomation_Flow_Idx = 2) '申请部门主管' 
                                        ,(SELECT OfficeAutomation_Flow_Suggestion FROM t_OfficeAutomation_Flow  
                                         WHERE OfficeAutomation_Document_SpecialNumber_MainID = OfficeAutomation_Flow_MainID AND OfficeAutomation_Flow_Idx = 3) '申请部门负责人' 
                                         , ((SELECT OfficeAutomation_Flow_Suggestion 	FROM t_OfficeAutomation_Flow  
                                                            WHERE OfficeAutomation_Document_SpecialNumber_MainID = OfficeAutomation_Flow_MainID 	 
                                                            AND OfficeAutomation_Flow_Idx = 4) + '　' +  	(SELECT OfficeAutomation_Flow_Suggestion 
                                                            FROM t_OfficeAutomation_Flow  	WHERE OfficeAutomation_Document_SpecialNumber_MainID = OfficeAutomation_Flow_MainID 	 
                                                            AND OfficeAutomation_Flow_Idx = 5) ) AS [法律部意见] 
                                        ,(SELECT TOP 1 OfficeAutomation_Flow_AuditDate FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Document_SpecialNumber_MainID=t_OfficeAutomation_Flow.OfficeAutomation_Flow_MainID AND t_OfficeAutomation_Flow.OfficeAutomation_Flow_Idx =6) as '法律部审核时间' 
                                         ,'审批结果：' +(SELECT top 1 CASE OfficeAutomation_Flow_IsAgree WHEN '0' THEN '不同意' WHEN '1' THEN '同意' WHEN '2' THEN '其他意见' ELSE '未审核' END AS [意见]  
                                         FROM t_OfficeAutomation_Flow 
                                         WHERE OfficeAutomation_Document_SpecialNumber_MainID=t_OfficeAutomation_Flow.OfficeAutomation_Flow_MainID
                                          AND t_OfficeAutomation_Flow.OfficeAutomation_Flow_Employee='黄轩明' order by t_OfficeAutomation_Flow.OfficeAutomation_Flow_AuditDate desc)
                                           + '\r\n审核意见：' + (SELECT top 1 CASE OfficeAutomation_Flow_Suggestion WHEN '' THEN '无' WHEN null THEN '无' ELSE OfficeAutomation_Flow_Suggestion END 
                                           FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Document_SpecialNumber_MainID=t_OfficeAutomation_Flow.OfficeAutomation_Flow_MainID 
                                           AND t_OfficeAutomation_Flow.OfficeAutomation_Flow_Employee='黄轩明' order by t_OfficeAutomation_Flow.OfficeAutomation_Flow_AuditDate desc) as [黄生审批意见]
                                            ,(SELECT TOP 1 OfficeAutomation_Flow_AuditDate FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Document_SpecialNumber_MainID=t_OfficeAutomation_Flow.OfficeAutomation_Flow_MainID AND t_OfficeAutomation_Flow.OfficeAutomation_Flow_EmployeeID='0001' order by t_OfficeAutomation_Flow.OfficeAutomation_Flow_AuditDate desc) as [黄生的终审日期]
	                                         ,(select '['+OfficeAutomation_Attach_Name+']' from t_OfficeAutomation_Attach where OfficeAutomation_Attach_MainID =  OfficeAutomation_Document_SpecialNumber_MainID FOR XML PATH('')) as 附件名称"
               + smax
               + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SpecialNumber] todi "
               + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SpecialNumber_MainID"
               + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
               + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
               + slet;

            if (!isAdmin && !purview.Contains("OA_Search_017") || approver != "") //M_20150623
                SpeciaNumber += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            SpeciaNumber += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_017"))
                SpeciaNumber += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SpecialNumber_Apply='" + employee + "')";

            if (applicationDepartment != "")
                SpeciaNumber += " and OfficeAutomation_Document_SpecialNumber_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                SpeciaNumber += " and OfficeAutomation_Document_SpecialNumber_Apply = '" + applicant + "'";

            if (begin != "")
                SpeciaNumber += " and OfficeAutomation_Document_SpecialNumber_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                SpeciaNumber += " and OfficeAutomation_Document_SpecialNumber_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                SpeciaNumber += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    SpeciaNumber += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        SpeciaNumber += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        SpeciaNumber += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                SpeciaNumber += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                SpeciaNumber += " and [OfficeAutomation_Document_SpecialNumber_Subject] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                SpeciaNumber += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                SpeciaNumber += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_SpecialNumber_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    SpeciaNumber += "  OR (OfficeAutomation_Document_SpecialNumber_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_SpecialNumber_MainID))";
                }
            }
            SpeciaNumber += sgroup;

            string CommissionOfMonth = " SELECT ROW_NUMBER() OVER(ORDER BY "+sn+" desc) as [序号], * FROM("
                + "          (SELECT OfficeAutomation_Document_CommissionOfMonth_ID as [ID]"
                + "          ,OfficeAutomation_Document_CommissionOfMonth_MainID as [MainID]"
                + "          ,OfficeAutomation_Document_CommissionOfMonth_Apply as [Apply]"
                + "          ,OfficeAutomation_Document_CommissionOfMonth_ApplyDate as [ApplyDate]"
                + "          ,OfficeAutomation_Document_CommissionOfMonth_ApplyID as [发文编号]"
                + "          ,OfficeAutomation_Document_CommissionOfMonth_Department as [Department]"
                + "          ,OfficeAutomation_Document_CommissionOfMonth_Name as 姓名"
                + "          ,OfficeAutomation_Document_CommissionOfMonth_Code as 工号"
                + "          ,OfficeAutomation_Document_CommissionOfMonth_EnterDate as 入职日期"
                + "          ,OfficeAutomation_Document_CommissionOfMonth_Position as 现职位"
                + "          ,OfficeAutomation_Document_CommissionOfMonth_Rank as 现职级"
                + "          ,OfficeAutomation_Document_CommissionOfMonth_Results as 预估本月实收业绩及解HOLD佣实收业绩"
                + "          ,OfficeAutomation_Document_CommissionOfMonth_Describe as 备注"
                + "          ,CASE MAX(f.OfficeAutomation_Flow_Idx) WHEN 7 THEN '申请人取消申请' ELSE '确认使用' END AS 反馈确认情况"
                + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                + "                      FROM   t_OfficeAutomation_Flow f"
                + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID]"
                + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                + "                      FROM   t_OfficeAutomation_Flow f"
                + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID]"
                + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                + "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                + "           END AS [审批状态]"
            + smax
            + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CommissionOfMonth] todi "
            + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CommissionOfMonth_MainID"
            + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
            + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + slet;

            if (!isAdmin && !purview.Contains("OA_Search_048") || approver != "") //M_20150623
                CommissionOfMonth += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            CommissionOfMonth += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_048"))
                CommissionOfMonth += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CommissionOfMonth_Apply='" + employee + "')";

            if (applicationDepartment != "")
                CommissionOfMonth += " and OfficeAutomation_Document_CommissionOfMonth_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                CommissionOfMonth += " and OfficeAutomation_Document_CommissionOfMonth_Apply = '" + applicant + "'";

            if (begin != "")
                CommissionOfMonth += " and OfficeAutomation_Document_CommissionOfMonth_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                CommissionOfMonth += " and OfficeAutomation_Document_CommissionOfMonth_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                CommissionOfMonth += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    CommissionOfMonth += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        CommissionOfMonth += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        CommissionOfMonth += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                CommissionOfMonth += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                CommissionOfMonth += " and [OfficeAutomation_Document_CommissionOfMonth_Name] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                CommissionOfMonth += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                CommissionOfMonth += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CommissionOfMonth_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    CommissionOfMonth += "  OR (OfficeAutomation_Document_CommissionOfMonth_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CommissionOfMonth_MainID))";
                }
            }
            CommissionOfMonth += sgroup;

            string DealOffice = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
    + " ,OfficeAutomation_Document_DealOffice_ID as [ID]"
    + " ,OfficeAutomation_Document_DealOffice_MainID as [MainID]"
    + " ,OfficeAutomation_Document_DealOffice_Apply as [Apply]"
    + " ,OfficeAutomation_Document_DealOffice_Department as [Department]"
    + " ,OfficeAutomation_Document_DealOffice_ApplyDate as [ApplyDate]"
    + " ,OfficeAutomation_Document_DealOffice_ReplyPhone as 回复电话"
    + " ,OfficeAutomation_Document_DealOffice_ReplyFax as 回复传真"
    + " ,OfficeAutomation_Document_DealOffice_WorkArea as 工作区域"
    + " ,OfficeAutomation_Document_DealOffice_Branch as 分行"
    + " ,case OfficeAutomation_Document_DealOffice_TypeID WHEN 1 THEN '商铺' WHEN 2 THEN '写字楼' END as 分行类别"
    + " ,OfficeAutomation_Document_DealOffice_OfficeArea as 商铺写字楼区域"
    + " ,OfficeAutomation_Document_DealOffice_OfficeAddress as 商铺写字楼地址"
    + " ,OfficeAutomation_Document_DealOffice_DealArea as 买卖面积"
    + " ,OfficeAutomation_Document_DealOffice_DealPrice as 买卖成交价"
    + " ,OfficeAutomation_Document_DealOffice_DealOwnerMoney as 买卖业佣"
    + " ,OfficeAutomation_Document_DealOffice_DealOwnerPercent as 买卖业佣比例"
    + " ,OfficeAutomation_Document_DealOffice_DealClientMoney as 买卖客佣金额"
    + " ,OfficeAutomation_Document_DealOffice_DealClientPercent as 买卖客佣比例"
    + " ,OfficeAutomation_Document_DealOffice_DealMoney as 买卖合计佣金"
    + " ,OfficeAutomation_Document_DealOffice_DealPercent as 买卖合计佣金比例"
    + " ,OfficeAutomation_Document_DealOffice_LeaseArea as 租赁面积"
    + " ,OfficeAutomation_Document_DealOffice_LeasePrice as 租赁月租金"
    + " ,OfficeAutomation_Document_DealOffice_LeaseOwnerMoney as 租赁业主佣金"
    + " ,OfficeAutomation_Document_DealOffice_LeaseOwnerPercent as 租赁业主佣金比例"
    + " ,OfficeAutomation_Document_DealOffice_LeaseClientMoney as 租赁客户佣金"
    + " ,OfficeAutomation_Document_DealOffice_LeaseClientPercent as 租赁客佣比例"
    + " ,OfficeAutomation_Document_DealOffice_LeaseMoney as 租赁总佣金"
    + " ,OfficeAutomation_Document_DealOffice_LeasePercent as 租赁总佣金比例"
    + " ,OfficeAutomation_Document_DealOffice_CrossAreaRemark as 跨区成交说明"
    + " ,OfficeAutomation_Document_DealOffice_MoneyRemark as 佣金不足比例说明"
    + smax
    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_DealOffice] todi "
    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_DealOffice_MainID"
    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
    + slet;

            if (!isAdmin && !purview.Contains("OA_Search_011") || approver != "") //M_20150623
                DealOffice += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            DealOffice += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_011"))
                DealOffice += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_DealOffice_Apply='" + employee + "')";

            if (applicationDepartment != "")
                DealOffice += " and OfficeAutomation_Document_DealOffice_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                DealOffice += " and OfficeAutomation_Document_DealOffice_Apply = '" + applicant + "'";

            if (begin != "")
                DealOffice += " and OfficeAutomation_Document_DealOffice_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                DealOffice += " and OfficeAutomation_Document_DealOffice_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                DealOffice += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    DealOffice += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        DealOffice += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        DealOffice += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                DealOffice += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                DealOffice += " and ([OfficeAutomation_Document_DealOffice_CrossAreaRemark] like '%" + keyWord + "%' OR [OfficeAutomation_Document_DealOffice_MoneyRemark] like '%" + keyWord + "%')";

            if (approver != "" && cstatue != 3) //M_20150623
                DealOffice += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                DealOffice += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_DealOffice_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    DealOffice += "  OR (OfficeAutomation_Document_DealOffice_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_DealOffice_MainID))";
                }
            }
            DealOffice += sgroup;

            string projrepodata = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
            + " ,OfficeAutomation_Document_ProjRepoData_ID as [ID]"
            + " ,OfficeAutomation_Document_ProjRepoData_MainID as [MainID]"
            + " ,OfficeAutomation_Document_ProjRepoData_Apply as [Apply]"
            + " ,OfficeAutomation_Document_ProjRepoData_Department as [Department]"
            + " ,OfficeAutomation_Document_ProjRepoData_ApplyDate as [ApplyDate]"
            + " ,OfficeAutomation_Document_ProjRepoData_ReplyPhone AS [回复电话]"
            + " ,OfficeAutomation_Document_ProjRepoData_ApplyID AS 发文编号"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_ApplyType WHEN 1 THEN '未有合同先行报数申请' WHEN 2 THEN '未有预售证先行报数申请' WHEN 3 THEN '按' + OfficeAutomation_Document_ProjRepoData_ApplyTypeRate + '%报数申请' WHEN 4 THEN '其他：' + OfficeAutomation_Document_ProjRepoData_ApplyTypeOther END AS 申请类别"
            + " ,OfficeAutomation_Document_ProjRepoData_ProjName AS 项目名称"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_HavePreSaleID WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有预售证"
            + " ,OfficeAutomation_Document_ProjRepoData_PreSaleID AS 预售证号"
            + " ,OfficeAutomation_Document_ProjRepoData_ProjAddress AS 项目地址"
            + " ,OfficeAutomation_Document_ProjRepoData_DeveloperName AS 开发商名称"
            + " ,OfficeAutomation_Document_ProjRepoData_GroupName AS 所属集团名称"
            + " ,(SELECT OfficeAutomation_DealOfficeType_Name + ',' FROM t_Dic_OfficeAutomation_DealOfficeType WHERE CHARINDEX(CONVERT(VARCHAR(10), OfficeAutomation_DealOfficeType_ID), OfficeAutomation_Document_ProjRepoData_DealOfficeTypeIDs) > 0 FOR XML PATH('')) AS 物业性质"
            + " ,OfficeAutomation_Document_ProjRepoData_DealOfficeOther AS 其它物业性质"
            + " ,OfficeAutomation_Document_ProjRepoData_AgentStartDate AS 项目代理开始日期"
            + " ,OfficeAutomation_Document_ProjRepoData_AgentEndDate AS 项目代理结束日期"
            + " ,OfficeAutomation_Document_ProjRepoData_PreComm AS 预计创佣"
            + " ,OfficeAutomation_Document_ProjRepoData_GoodsQuantity AS 代理期内可售货量"
            + " ,OfficeAutomation_Document_ProjRepoData_GoodsValue AS 代理期内可售货值"
            + " ,OfficeAutomation_Document_ProjRepoData_CommPoint AS 申请报数点数"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_AgentModel WHEN 1 THEN '联合代理' WHEN 2 THEN '独家代理' END AS 代理模式"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_ContractType WHEN 1 THEN '销售代理合同' WHEN 2 THEN '招商代理合同' WHEN 3 THEN '其他：' + OfficeAutomation_Document_ProjRepoData_ContractTypeOther END AS 合同类型"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_HaveCoopCost WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有合作费"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_HaveCoopConf WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有合作确认函"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_IsSignBack WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 合同是否签回"
            + " ,OfficeAutomation_Document_ProjRepoData_ContractPreSignBackDate AS 合同预计签回时间"
            + " ,OfficeAutomation_Document_ProjRepoData_Remark AS 备注"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_ProjType WHEN 1 THEN '新项目' WHEN 2 THEN '旧项目' END AS 项目类别"
            + " ,CONVERT(NVARCHAR(30),OfficeAutomation_Document_ProjRepoData_DealHistoryStartDate,111) AS 成交开始日期"
            + " ,CONVERT(NVARCHAR(30),OfficeAutomation_Document_ProjRepoData_DealHistoryEndDate,111) AS 成交结束日期"
            + " ,CONVERT(NVARCHAR(30),OfficeAutomation_Document_ProjRepoData_TotalProfitStartDate,111) AS 累计利润开始日期"
            + " ,CONVERT(NVARCHAR(30),OfficeAutomation_Document_ProjRepoData_TotalProfitEndDate,111) AS 累计利润开始日期"
            + " ,OfficeAutomation_Document_ProjRepoData_IndepCount AS 独立成交宗数"
            + " ,OfficeAutomation_Document_ProjRepoData_IndepPerformance AS 独立成交业绩"
            + " ,OfficeAutomation_Document_ProjRepoData_LinkCount AS 联动成交宗数"
            + " ,OfficeAutomation_Document_ProjRepoData_LinkPerformance AS 联动成交业绩"
            + " ,OfficeAutomation_Document_ProjRepoData_TotalProfit AS 期间累计税前利润"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_JOrT WHEN 1 THEN '与行家同场联合代理' WHEN 2 THEN '与行家轮流代理，即代理期内中原独家代理，代理期之外由行家轮流代理' WHEN 3 THEN '整个项目由中原独家代理，发展商没有委托除中原以外的任何代理行' END AS 是否与行家联合代理或轮流代理"
            + " ,OfficeAutomation_Document_ProjRepoData_SamePlaceXX1 AS 同场代理的行家名称1"
            + " ,OfficeAutomation_Document_ProjRepoData_SamePlaceXX2 AS 同场代理的行家名称2"
            + " ,OfficeAutomation_Document_ProjRepoData_TurnsAgentXX1 AS 轮流代理的行家名称1"
            + " ,OfficeAutomation_Document_ProjRepoData_TurnsAgentXX2 AS 轮流代理的行家名称2"
            + " ,OfficeAutomation_Document_ProjRepoData_AgencyFee1 AS 同场代理行家代理费1"
            + " ,OfficeAutomation_Document_ProjRepoData_AgencyFee2 AS 同场代理行家代理费2"
            + " ,OfficeAutomation_Document_ProjRepoData_AgencyFee3 AS 轮流代理行家代理费1"
            + " ,OfficeAutomation_Document_ProjRepoData_AgencyFee4 AS 轮流代理行家代理费2"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_IsCashPrize1 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有同场代理行家现金奖1"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_IsCashPrize2 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有同场代理行家现金奖2"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_IsCashPrize3 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有轮流代理行家现金奖1"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_IsCashPrize4 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有轮流代理行家现金奖2"
            + " ,OfficeAutomation_Document_ProjRepoData_CashPrize1 AS 同场代理行家现金奖1"
            + " ,OfficeAutomation_Document_ProjRepoData_CashPrize2 AS 同场代理行家现金奖2"
            + " ,OfficeAutomation_Document_ProjRepoData_CashPrize3 AS 轮流代理行家现金奖1"
            + " ,OfficeAutomation_Document_ProjRepoData_CashPrize4 AS 轮流代理行家现金奖2"
            + " ,OfficeAutomation_Document_ProjRepoData_AgencyBeginDate1 AS 轮流代理行家代理开始期1"
            + " ,OfficeAutomation_Document_ProjRepoData_AgencyBeginDate2 AS 轮流代理行家代理开始期2"
            + " ,OfficeAutomation_Document_ProjRepoData_AgencyEndDate1 AS 轮流代理行家代理结束期1"
            + " ,OfficeAutomation_Document_ProjRepoData_AgencyEndDate2 AS 轮流代理行家代理结束期2"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_IsPFear1 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有同场代理项目费用1"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_IsPFear2 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有同场代理项目费用2"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_IsPFear3 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有轮流代理项目费用1"
            + " ,CASE OfficeAutomation_Document_ProjRepoData_IsPFear4 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有轮流代理项目费用2"
            + " ,OfficeAutomation_Document_ProjRepoData_PFear1 AS 同场代理项目费用1"
            + " ,OfficeAutomation_Document_ProjRepoData_PFear2 AS 同场代理项目费用2"
            + " ,OfficeAutomation_Document_ProjRepoData_PFear3 AS 轮流代理项目费用1"
            + " ,OfficeAutomation_Document_ProjRepoData_PFear4 AS 轮流代理项目费用2"
            + " ,OfficeAutomation_Document_ProjRepoData_Sign AS 标记"
            + smax
            + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjRepoData] todi "
            + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjRepoData_MainID"
            + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
            + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + slet;

            if (!isAdmin && !purview.Contains("OA_Search_028") || approver != "") //M_20150623
                projrepodata += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            projrepodata += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_028"))
                projrepodata += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjRepoData_Apply='" + employee + "')";

            if (applicationDepartment != "")
                projrepodata += " and OfficeAutomation_Document_ProjRepoData_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                projrepodata += " and OfficeAutomation_Document_ProjRepoData_Apply = '" + applicant + "'";

            if (begin != "")
                projrepodata += " and OfficeAutomation_Document_ProjRepoData_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                projrepodata += " and OfficeAutomation_Document_ProjRepoData_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                projrepodata += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    projrepodata += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        projrepodata += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        projrepodata += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                projrepodata += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                projrepodata += " and [OfficeAutomation_Document_ProjRepoData_ProjName] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                projrepodata += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                projrepodata += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjRepoData_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    projrepodata += "  OR (OfficeAutomation_Document_ProjRepoData_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjRepoData_MainID))";
                }
            }
            projrepodata += sgroup;

            string projagentclause = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
            + " ,OfficeAutomation_Document_ProjAgentClause_ID as [ID]"
            + " ,OfficeAutomation_Document_ProjAgentClause_MainID as [MainID]"
            + " ,OfficeAutomation_Document_ProjAgentClause_Apply as [Apply]"
            + " ,OfficeAutomation_Document_ProjAgentClause_Department as [Department]"
            + " ,OfficeAutomation_Document_ProjAgentClause_ApplyDate as [ApplyDate]"
            + " ,OfficeAutomation_Document_ProjAgentClause_ReplyPhone AS 回复电话"
            + " ,OfficeAutomation_Document_ProjAgentClause_ApplyID AS 发文编号"
            + " ,OfficeAutomation_Document_ProjAgentClause_ProjName AS 项目名称"
            + " ,OfficeAutomation_Document_ProjAgentClause_DeveloperName AS 开发商名称"
            + " ,OfficeAutomation_Document_ProjAgentClause_ProjAddress AS 项目地址"
            + " ,OfficeAutomation_Document_ProjAgentClause_AgentStart AS 项目代理开始日期"
            + " ,OfficeAutomation_Document_ProjAgentClause_AgentEnd AS 项目代理结束日期"
            + " ,OfficeAutomation_Document_ProjAgentClause_SaleDate AS 开售日"
            + " ,(SELECT OfficeAutomation_DealOfficeType_Name + ',' FROM t_Dic_OfficeAutomation_DealOfficeType WHERE CHARINDEX(CONVERT(VARCHAR(10), OfficeAutomation_DealOfficeType_ID), OfficeAutomation_Document_ProjAgentClause_DealOfficeTypeIDs) > 0 FOR XML PATH('')) AS [物业性质]"
            + " ,OfficeAutomation_Document_ProjAgentClause_DealOfficeOther AS 其他物业性质描述"
            + " ,OfficeAutomation_Document_ProjAgentClause_GoodsQuantity AS 货量"
            + " ,OfficeAutomation_Document_ProjAgentClause_GoodsValue AS 货值"
            + " ,OfficeAutomation_Document_ProjAgentClause_PreComm AS 预计创佣"
            + " ,CASE OfficeAutomation_Document_ProjAgentClause_AgentModel WHEN 1 THEN '联合代理' WHEN 2 THEN '独家代理' END AS 代理模式"
            + " ,OfficeAutomation_Document_ProjAgentClause_CommPoint AS 佣金点数"
            + " ,CASE OfficeAutomation_Document_ProjAgentClause_ContractType WHEN 1 THEN '联动合同' WHEN 2 THEN '一手销售代理合同' WHEN 3 THEN '其他：' + OfficeAutomation_Document_ProjAgentClause_ContractTypeOther END AS 合同类型"
            + " ,OfficeAutomation_Document_ProjAgentClause_Remark AS 备注"
            + " ,OfficeAutomation_Document_ProjAgentClause_ClauseSettleComm AS 结佣条件条款"
            + " ,OfficeAutomation_Document_ProjAgentClause_ClauseFine AS 扣罚条款"
            + " ,OfficeAutomation_Document_ProjAgentClause_ClauseAreaLimit AS 区域限制条款"
            + " ,OfficeAutomation_Document_ProjAgentClause_ClausePerforCheck AS 绩效考核条款"
            + " ,OfficeAutomation_Document_ProjAgentClause_ClauseHonest AS 廉洁条款"
            + " ,OfficeAutomation_Document_ProjAgentClause_ClauseOther AS 其他条款"
            + " ,CASE OfficeAutomation_Document_ProjAgentClause_PorjectExam WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 项目报备是否已审批"
            + " ,CASE OfficeAutomation_Document_ProjAgentClause_JOrT WHEN 1 THEN '与行家同场联合代理' WHEN 2 THEN '与行家轮流代理，即代理期内中原独家代理，代理期之外由行家轮流代理' WHEN 3 THEN '整个项目由中原独家代理，发展商没有委托除中原以外的任何代理行' END AS 是否与行家联合代理或轮流代理"
            + " ,OfficeAutomation_Document_ProjAgentClause_SamePlaceXX1 AS 同场代理的行家名称1"
            + " ,OfficeAutomation_Document_ProjAgentClause_SamePlaceXX2 AS 同场代理的行家名称2"
            + " ,OfficeAutomation_Document_ProjAgentClause_TurnsAgentXX1 AS 轮流代理的行家名称1"
            + " ,OfficeAutomation_Document_ProjAgentClause_TurnsAgentXX2 AS 轮流代理的行家名称2"
            + " ,OfficeAutomation_Document_ProjAgentClause_AgencyFee1 AS 同场代理行家代理费1"
            + " ,OfficeAutomation_Document_ProjAgentClause_AgencyFee2 AS 同场代理行家代理费2"
            + " ,OfficeAutomation_Document_ProjAgentClause_AgencyFee3 AS 轮流代理行家代理费1"
            + " ,OfficeAutomation_Document_ProjAgentClause_AgencyFee4 AS 轮流代理行家代理费2"
            + " ,CASE OfficeAutomation_Document_ProjAgentClause_IsCashPrize1 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有同场代理行家现金奖1"
            + " ,CASE OfficeAutomation_Document_ProjAgentClause_IsCashPrize2 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有同场代理行家现金奖2"
            + " ,CASE OfficeAutomation_Document_ProjAgentClause_IsCashPrize3 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有轮流代理行家现金奖1"
            + " ,CASE OfficeAutomation_Document_ProjAgentClause_IsCashPrize4 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有轮流代理行家现金奖2"
            + " ,OfficeAutomation_Document_ProjAgentClause_CashPrize1 AS 同场代理行家现金奖1"
            + " ,OfficeAutomation_Document_ProjAgentClause_CashPrize2 AS 同场代理行家现金奖2"
            + " ,OfficeAutomation_Document_ProjAgentClause_CashPrize3 AS 轮流代理行家现金奖1"
            + " ,OfficeAutomation_Document_ProjAgentClause_CashPrize4 AS 轮流代理行家现金奖2"
            + " ,OfficeAutomation_Document_ProjAgentClause_AgencyBeginDate1 AS 轮流代理行家代理开始期1"
            + " ,OfficeAutomation_Document_ProjAgentClause_AgencyBeginDate2 AS 轮流代理行家代理开始期2"
            + " ,OfficeAutomation_Document_ProjAgentClause_AgencyEndDate1 AS 轮流代理行家代理结束期1"
            + " ,OfficeAutomation_Document_ProjAgentClause_AgencyEndDate2 AS 轮流代理行家代理结束期2"
            + " ,CASE OfficeAutomation_Document_ProjAgentClause_IsPFear1 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有同场代理项目费用1"
            + " ,CASE OfficeAutomation_Document_ProjAgentClause_IsPFear2 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有同场代理项目费用2"
            + " ,CASE OfficeAutomation_Document_ProjAgentClause_IsPFear3 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有轮流代理项目费用1"
            + " ,CASE OfficeAutomation_Document_ProjAgentClause_IsPFear4 WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否有轮流代理项目费用2"
            + " ,OfficeAutomation_Document_ProjAgentClause_PFear1 AS 同场代理项目费用1"
            + " ,OfficeAutomation_Document_ProjAgentClause_PFear2 AS 同场代理项目费用2"
            + " ,OfficeAutomation_Document_ProjAgentClause_PFear3 AS 轮流代理项目费用1"
            + " ,OfficeAutomation_Document_ProjAgentClause_PFear4 AS 轮流代理项目费用2"
            + " ,OfficeAutomation_Document_ProjAgentClause_Sign AS 标记"
            + smax
            + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjAgentClause] todi "
            + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjAgentClause_MainID"
            + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
            + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + slet;

            if (!isAdmin && !purview.Contains("OA_Search_025") || approver != "") //M_20150623
                projagentclause += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            projagentclause += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_025"))
                projagentclause += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjAgentClause_Apply='" + employee + "')";

            if (applicationDepartment != "")
                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_Apply = '" + applicant + "'";

            if (begin != "")
                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                projagentclause += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    projagentclause += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        projagentclause += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        projagentclause += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                projagentclause += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                projagentclause += " and [OfficeAutomation_Document_ProjAgentClause_ProjName] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                projagentclause += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                projagentclause += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjAgentClause_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    projagentclause += "  OR (OfficeAutomation_Document_ProjAgentClause_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjAgentClause_MainID))";
                }
            }
            projagentclause += sgroup;

            string projdormsubsiby = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ID as [ID]"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_MainID as [MainID]"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_Apply as [Apply]"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_Department as [Department]"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ApplyDate as [ApplyDate]"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ReplyPhone AS 回复电话"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ApplyID AS 发文编号"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ProjName AS 项目名称"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DeveloperName AS 开发商名称"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ProjAddress AS 项目地址"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_AgentStartDate AS 项目代理开始日期"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_AgentEndDate AS 项目代理结束日期"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_SaleDate AS 开售日"
            + " ,(SELECT OfficeAutomation_DealOfficeType_Name + ',' FROM t_Dic_OfficeAutomation_DealOfficeType WHERE CHARINDEX(CONVERT(VARCHAR(10), OfficeAutomation_DealOfficeType_ID), OfficeAutomation_Document_ProjDormSubsiby_DealOfficeTypeIDs) > 0 FOR XML PATH('')) AS [物业性质]"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DealOfficeOther AS 其他物业性质"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_GoodsQuantity AS 货量"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_GoodsValue AS 货值"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_PreComm AS 预计创佣"
            + " ,CASE OfficeAutomation_Document_ProjDormSubsiby_AgentModel WHEN 1 THEN '联合代理' WHEN 2 THEN '独家代理' END AS 代理模式"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_CommPoint AS 佣金点数"
            + " ,CONVERT(NVARCHAR(30),OfficeAutomation_Document_ProjDormSubsiby_RentStartDate,111) AS 租赁合同开始日期"
            + " ,CONVERT(NVARCHAR(30),OfficeAutomation_Document_ProjDormSubsiby_RentEndDate,111) AS 租赁合同结束日期"
            + " ,CASE OfficeAutomation_Document_ProjDormSubsiby_RentType WHEN 1 THEN '续租' WHEN 2 THEN '新增' END AS 租赁类型"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_LiveNumber AS 居住人数"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DormAddress AS 宿舍地址"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DormArea AS 租住面积"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DormType AS 户型"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_MonthlyRent AS 月租金"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_Deposit AS 按金"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_AgencyFee AS 中介费"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_MonthlyEstimatedCost AS 每月预计支出费用"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ManagermentCost AS 管理费"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ElectricCharge AS 电费"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_WaterCharge AS 水费"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_GasCharge AS 煤气费"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_MonthlyCost AS 每月支出合计"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DormRemark AS 宿舍费用备注"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_StartPlace AS 津贴出发地"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_EndPlace AS 津贴目的地"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_RoundTripMoney AS 双程金额"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_NumberOfTimes AS 次数"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_SumOfMoney AS 津贴总金额"
            + " ,CONVERT(NVARCHAR(30),OfficeAutomation_Document_ProjDormSubsiby_SubsibyValidityStartDate,111) AS 津贴有效开始日期"
            + " ,CONVERT(NVARCHAR(30),OfficeAutomation_Document_ProjDormSubsiby_SubsibyValidityEndDate,111) AS 津贴有效结束日期"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_SubsibyRemark AS 津贴费用说明"
            + " ,REPLACE(REPLACE(OfficeAutomation_Document_ProjDormSubsiby_EnjoyPersonInfo,'&&','，'),'||','；') AS 享受人员信息"
            + " ,REPLACE(REPLACE(OfficeAutomation_Document_ProjDormSubsiby_PerformanceProfitInfo,'&&','，'),'||','；') AS 享受人员信息"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_SumPerformance AS 累计业绩合计"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_SumProfit AS 累计利润合计"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ProjGoodsQuantity AS 项目货量"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ProjGoodsValue AS 项目货值"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ProjCommission AS 项目预计创佣"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ProjCommPoint AS 项目佣金点数"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DormSumCost AS 宿舍费用总额"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_SubsibySumCost AS 津贴费用总额"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DormSumCostScale AS 宿舍费用占比"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_SubsibySumCostScale AS 津贴费用占比"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DormRemark AS 备注"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DormitoryMonth AS [人均宿舍津贴（元/月）]"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DormitoryMan AS [人均宿舍津贴（人数）]"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DormitoryMdm AS [人均宿舍津贴（元/人/月）]"
            + " ,CONVERT(NVARCHAR(30),OfficeAutomation_Document_ProjDormSubsiby_DormitoryStartDate,111) AS 津贴有效期开始时间"
            + " ,CONVERT(NVARCHAR(30),OfficeAutomation_Document_ProjDormSubsiby_DormitoryEndDate,111) AS 津贴有效期结束时间"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_DormitoryRemark AS 津贴费用说明"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_ApplyMoney AS 宿舍津贴申请发放金额"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_TrafficApplyMoney AS 交通津贴申请发放金额"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_LastYear AS 上一期租赁期长（年）"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_LastMonth AS 上一期租赁期长（月）"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_LastRent AS 上一期的租金"
            + " ,OfficeAutomation_Document_ProjDormSubsiby_Sign AS 标记"
            + smax
            + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjDormSubsiby] todi "
            + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjDormSubsiby_MainID"
            + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
            + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + slet;

            if (!isAdmin && !purview.Contains("OA_Search_027") || approver != "") //M_20150623
                projdormsubsiby += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            projdormsubsiby += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_027"))
                projdormsubsiby += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjDormSubsiby_Apply='" + employee + "')";

            if (applicationDepartment != "")
                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_Apply = '" + applicant + "'";

            if (begin != "")
                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                projdormsubsiby += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    projdormsubsiby += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        projdormsubsiby += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        projdormsubsiby += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                projdormsubsiby += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                projdormsubsiby += " and [OfficeAutomation_Document_ProjDormSubsiby_ProjName] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                projdormsubsiby += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                projdormsubsiby += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjDormSubsiby_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    projdormsubsiby += "  OR (OfficeAutomation_Document_ProjDormSubsiby_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjDormSubsiby_MainID))";
                }
            }
            projdormsubsiby += sgroup;

            string BadDebts = "", bd;
            if (eid == "3873" || eid == "45362" || eid == "42508" || eid == "28614" || eid == "54917" || eid == "51673" || eid == "50203") //*9
            {
                bd = " SELECT ROW_NUMBER() OVER(ORDER BY ApplyDate desc) as [序号], * FROM( "
                + " (SELECT OfficeAutomation_Document_BadDebts_ID as [ID]"
                + " ,OfficeAutomation_Document_BadDebts_MainID as [MainID]"
                + " ,toam.OfficeAutomation_SerialNumber AS [文档编码(自动生成)]"
                + " ,OfficeAutomation_Document_BadDebts_Apply as 申请人"
                + " ,OfficeAutomation_Document_BadDebts_ApplyDate as [ApplyDate]"
                + " ,OfficeAutomation_Document_BadDebts_ApplyID as 发文编号"
                + " ,OfficeAutomation_Document_BadDebts_Department as 申请部门"
                + " ,OfficeAutomation_Document_BadDebts_ReplyPhone AS 回复电话"
                + " ,OfficeAutomation_Document_BadDebts_Building AS 物业名称"
                + " ,CASE OfficeAutomation_Document_BadDebts_OneOrTwo WHEN 1 THEN '一手项目' WHEN 2 THEN '纯二手单位' END  AS 一手还是二手"
                + " ,OfficeAutomation_Document_BadDebts_Reason AS 坏账原因详述"
                + " ,OfficeAutomation_Document_BadDebts_MoneyCount AS 坏账金额总计"
                + " ,OfficeAutomation_Document_BadDebts_SumBDMoney AS 自动坏账总额"
                + " ,dt.OfficeAutomation_Document_BadDebts_Detail_ReportID AS 成交报告编号"
                + " ,dt.OfficeAutomation_Document_BadDebts_Detail_Address AS 成交地址"
                + " ,dt.OfficeAutomation_Document_BadDebts_Detail_Owner AS 应收业佣"
                + " ,dt.OfficeAutomation_Document_BadDebts_Detail_Client AS 应收客佣"
                + " ,dt.OfficeAutomation_Document_BadDebts_Detail_OwnerBadMoney AS 业主坏账金额"
                + " ,dt.OfficeAutomation_Document_BadDebts_Detail_ClientBadMoney AS 客户坏账金额"
                + " ,dt.OfficeAutomation_Document_BadDebts_Detail_BadReason AS 坏账原因"
                + " ,CASE dt.OfficeAutomation_Document_BadDebts_Detail_IsSpecialAdjust WHEN 1 THEN '是' WHEN 0 THEN '否' END  AS 是否特殊调整"
                + " ,CASE dt.OfficeAutomation_Document_BadDebts_Detail_IsAutoBad WHEN 1 THEN '是' WHEN 0 THEN '否' END AS 是否已自动坏账"
                + " ,dt.OfficeAutomation_Document_BadDebts_Detail_AutoBadDate AS 自动坏账时间"
                + " ,dt.OfficeAutomation_Document_BadDebts_Detail_DealDate AS 成交日期"
                + " ,dt.OfficeAutomation_Document_BadDebts_Detail_BadDate AS 坏账日期"
                + " ,dt.OfficeAutomation_Document_BadDebts_Detail_Area AS 所属区域"
                + " ,OfficeAutomation_Document_BadDebts_Remark AS 备注"
                + " ,CASE toam.OfficeAutomation_Main_FlowStateID WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) END AS 审批状态"
                + " ,(SELECT TOP 1 f.OfficeAutomation_Flow_Suggestion FROM t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) AS 审批意见"
                 + " , ((SELECT OfficeAutomation_Flow_Suggestion 	FROM t_OfficeAutomation_Flow  "
                  + "  WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID 	 "
                 + "   AND OfficeAutomation_Flow_Idx = 4) + '　' +  	(SELECT OfficeAutomation_Flow_Suggestion  "
                  + "  FROM t_OfficeAutomation_Flow  	WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID 	 "
                 + "   AND OfficeAutomation_Flow_Idx = 5) ) AS [法律部意见]  "	
                + " ,MAX(f.OfficeAutomation_Flow_AuditDate) AS 最后审批时间"
                +" ,(select '['+OfficeAutomation_Attach_Name+']' from t_OfficeAutomation_Attach where OfficeAutomation_Attach_MainID =  OfficeAutomation_Document_BadDebts_MainID FOR XML PATH('')) as 附件名称";
            }
            else
            {
                bd = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号], * FROM( "
                + " (SELECT OfficeAutomation_Document_BadDebts_ID as [ID]"
                + " ,OfficeAutomation_Document_BadDebts_MainID as [MainID]"
                + " ,toam.OfficeAutomation_SerialNumber AS [文档编码(自动生成)]"
                + " ,OfficeAutomation_Document_BadDebts_ApplyDate as ApplyDate"
                + " ,'关于' + OfficeAutomation_Document_BadDebts_Building + '的坏账申请' AS 文件主题"
                + " ,OfficeAutomation_Document_BadDebts_Apply as 发文人员"
                + " ,OfficeAutomation_Document_BadDebts_MoneyCount AS [分业、客佣坏账金额合计]"
                + " ,("
                + " 	(SELECT OfficeAutomation_Flow_Suggestion"
                + " 	FROM t_OfficeAutomation_Flow "
                + " 	WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID"
                + " 	AND OfficeAutomation_Flow_Idx = 4) + '　' + "
                + " 	(SELECT OfficeAutomation_Flow_Suggestion"
                + " 	FROM t_OfficeAutomation_Flow "
                + " 	WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID"
                + " 	AND OfficeAutomation_Flow_Idx = 5)"
                + " ) AS [法律部意见]"
                + " ,("
                + " 	SELECT OfficeAutomation_Flow_AuditDate"
                + " 	FROM t_OfficeAutomation_Flow "
                + " 	WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID"
                + " 	AND OfficeAutomation_Flow_Idx = 5"
                + " ) AS 法律部审批时间"
                + " ,("
                + " 	(SELECT OfficeAutomation_Flow_Suggestion"
                + " 	FROM t_OfficeAutomation_Flow "
                + " 	WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID"
                + " 	AND OfficeAutomation_Flow_Idx = 6) + '　' + "
                + " 	(SELECT OfficeAutomation_Flow_Suggestion"
                + " 	FROM t_OfficeAutomation_Flow "
                + " 	WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID"
                + " 	AND OfficeAutomation_Flow_Idx = 8)"
                + " ) AS 财务部意见"
                + " ,("
                + " 	SELECT OfficeAutomation_Flow_AuditDate"
                + " 	FROM t_OfficeAutomation_Flow "
                + " 	WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID"
                + " 	AND OfficeAutomation_Flow_Idx = 8"
                + " ) AS 财务部审批时间"
                + " ,("
                + " 	(SELECT OfficeAutomation_Flow_Suggestion"
                + " 	FROM t_OfficeAutomation_Flow "
                + " 	WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID"
                + " 	AND OfficeAutomation_Flow_Idx = 9) + '　' + "
                + " 	(SELECT OfficeAutomation_Flow_Suggestion"
                + " 	FROM t_OfficeAutomation_Flow "
                + " 	WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID"
                + " 	AND OfficeAutomation_Flow_Idx = 10)"
                + " ) AS 后勤事务部意见"
                + " ,("
                + " 	SELECT OfficeAutomation_Flow_AuditDate"
                + " 	FROM t_OfficeAutomation_Flow "
                + " 	WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID"
                + " 	AND OfficeAutomation_Flow_Idx = 10"
                + " ) AS 后勤事务部审批时间"
                + " ,("
                + " 	SELECT OfficeAutomation_Flow_Suggestion"
                + " 	FROM t_OfficeAutomation_Flow "
                + " 	WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID"
                + " 	AND OfficeAutomation_Flow_Idx = 11"
                + " ) AS 董事总经理意见"
                + " ,("
                + " 	SELECT OfficeAutomation_Flow_AuditDate"
                + " 	FROM t_OfficeAutomation_Flow "
                + " 	WHERE OfficeAutomation_Document_BadDebts_MainID = OfficeAutomation_Flow_MainID"
                + " 	AND OfficeAutomation_Flow_Idx = 11"
                + " ) AS 董事总经理审批时间";
                //+ " FROM t_OfficeAutomation_Document_BadDebts todi"
                //+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BadDebts_MainID"
                //+ " )) AS BadDebts_Count"
            }
            BadDebts += bd
+ smax
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BadDebts] todi "
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BadDebts_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//+ (eid == "3873" || eid == "45362" || eid == "28614" || eid == "54917" || eid == "51673" || eid == "42508" || eid == "50203" ? " RIGHT JOIN t_OfficeAutomation_Document_BadDebts_Detail dt ON dt.OfficeAutomation_Document_BadDebts_Detail_MainID = todi.OfficeAutomation_Document_BadDebts_ID" : "")
+ slet;

            if (!isAdmin && !purview.Contains("OA_Search_016") || approver != "") //M_20150623
                BadDebts += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            BadDebts += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_016"))
                BadDebts += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BadDebts_Apply='" + employee + "')";

            if (applicationDepartment != "")
                BadDebts += " and OfficeAutomation_Document_BadDebts_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                BadDebts += " and OfficeAutomation_Document_BadDebts_Apply = '" + applicant + "'";

            if (begin != "")
                BadDebts += " and OfficeAutomation_Document_BadDebts_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                BadDebts += " and OfficeAutomation_Document_BadDebts_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                BadDebts += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    BadDebts += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        BadDebts += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        BadDebts += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                BadDebts += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                BadDebts += " and [OfficeAutomation_Document_BadDebts_Remark] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                BadDebts += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                BadDebts += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BadDebts_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    BadDebts += "  OR (OfficeAutomation_Document_BadDebts_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_BadDebts_MainID))";
                }
            }
            BadDebts += sgroup;




            string wyrecruit = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
            + " ,OfficeAutomation_Document_WYRecruit_ID as [ID]"
            + " ,OfficeAutomation_Document_WYRecruit_MainID as [MainID]"
            + " ,OfficeAutomation_Document_WYRecruit_ApplyDate as [ApplyDate]"
            + " ,OfficeAutomation_Document_WYRecruit_Apply AS 申请人姓名"
            + " ,OfficeAutomation_Document_WYRecruit_Position AS 申请人职位名称"
            + " ,OfficeAutomation_Document_WYRecruit_Region AS 所属区域"
            + " ,OfficeAutomation_Document_WYRecruit_UseBranch AS 使用分行"
            + " ,OfficeAutomation_Document_WYRecruit_RecruitType AS 招聘形式"
            + " ,OfficeAutomation_Document_WYRecruit_OrganizationName AS 举办机构名称"
            + " ,OfficeAutomation_Document_WYRecruit_ApplyAmount AS 申请金额"
            + " ,OfficeAutomation_Document_WYRecruit_StartDate + '~' + OfficeAutomation_Document_WYRecruit_EndDate AS 使用时间"
            + " ,OfficeAutomation_Document_WYRecruit_ReimbursementAmount AS 实际报销金额"
            + " ,OfficeAutomation_Document_WYRecruit_Secretary AS 跟进秘书姓名"
            + " ,OfficeAutomation_Document_WYRecruit_CustomService AS 客服人员姓名"
            + " ,OfficeAutomation_Document_WYRecruit_Contact AS 联系方式"
            + smax
            + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_WYRecruit] todi "
            + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_WYRecruit_MainID"
            + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
            + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + slet;

            if (!isAdmin && !purview.Contains("OA_Search_082") || approver != "") //M_20150623
                wyrecruit += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            wyrecruit += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_082"))
                wyrecruit += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_WYRecruit_Apply='" + employee + "')";

            if (applicationDepartment != "")
                wyrecruit += " and OfficeAutomation_Document_WYRecruit_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                wyrecruit += " and OfficeAutomation_Document_WYRecruit_Apply = '" + applicant + "'";

            if (begin != "")
                wyrecruit += " and OfficeAutomation_Document_WYRecruit_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                wyrecruit += " and OfficeAutomation_Document_WYRecruit_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                wyrecruit += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    wyrecruit += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WYRecruit_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        wyrecruit += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        wyrecruit += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                wyrecruit += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                wyrecruit += " and [OfficeAutomation_Document_WYRecruit_Remark] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                wyrecruit += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                wyrecruit += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_WYRecruit_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    wyrecruit += "  OR (OfficeAutomation_Document_WYRecruit_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_WYRecruit_MainID))";
                }
            }
            wyrecruit += sgroup;


            string recruit = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
            + " ,OfficeAutomation_Document_Recruit_ID as [ID]"
            + " ,OfficeAutomation_Document_Recruit_MainID as [MainID]"
            + " ,OfficeAutomation_Document_Recruit_ApplyDate as [ApplyDate]"
            + " ,OfficeAutomation_Document_Recruit_Department AS 申请部门"
            + " ,OfficeAutomation_Document_Recruit_Position AS 申请职位"
            + " ,OfficeAutomation_Document_Recruit_Grade AS 职级"
            + " ,OfficeAutomation_Document_Recruit_Remuneration AS 薪酬幅度"
            + " ,OfficeAutomation_Document_Recruit_Number AS 需求人数"
            + " ,OfficeAutomation_Document_Recruit_TakeOfficeDate AS 期望到职日期"
            + " ,'' AS 入职部门"
            + " ,'' AS 入职岗位"
            + " ,'' AS 入职者姓名"
            + " ,'' AS 入职日期"
            + " ,'' AS 薪金"
            + " ,'' AS 处理结果职级"
            + smax
            + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Recruit] todi "
            + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Recruit_MainID"
            + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
            + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + slet;

            if (!isAdmin && !purview.Contains("OA_Search_083") || approver != "") //M_20150623
                recruit += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            recruit += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_083"))
                recruit += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Recruit_Apply='" + employee + "')";

            if (applicationDepartment != "")
                recruit += " and OfficeAutomation_Document_Recruit_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                recruit += " and OfficeAutomation_Document_Recruit_Apply = '" + applicant + "'";

            if (begin != "")
                recruit += " and OfficeAutomation_Document_Recruit_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                recruit += " and OfficeAutomation_Document_Recruit_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                recruit += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    recruit += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Recruit_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        recruit += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        recruit += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                recruit += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                recruit += " and [OfficeAutomation_Document_Recruit_Remark] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                recruit += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                recruit += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Recruit_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    recruit += "  OR (OfficeAutomation_Document_Recruit_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Recruit_MainID))";
                }
            }
            recruit += sgroup;

            
            //20161222 添加公积金特殊申请导出数据
            string housingfundchange = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
            + " ,OfficeAutomation_Document_HousingFundChange_ID as [ID]"
            + " ,OfficeAutomation_Document_HousingFundChange_MainID as [MainID]"
            + " ,OfficeAutomation_Document_HousingFundChange_Apply AS 填写人"
            + " ,OfficeAutomation_Document_HousingFundChange_ApplyDate as [ApplyDate]"
            + " ,OfficeAutomation_Document_HousingFundChange_Department AS 现任职部门"
            + " ,dt.OfficeAutomation_Document_HousingFundChange_Detail_Code AS 工号"
            + " ,dt.OfficeAutomation_Document_HousingFundChange_Detail_Name AS 姓名"
            + " ,dt.OfficeAutomation_Document_HousingFundChange_Detail_InDate AS 入职日期"
            + " ,dt.OfficeAutomation_Document_HousingFundChange_Detail_Pos AS 现职位"
            + " ,dt.OfficeAutomation_Document_HousingFundChange_Detail_Grade AS 现职级"
            + " ,dt.OfficeAutomation_Document_HousingFundChange_Detail_Code AS 工号"
            + " ,case dt.OfficeAutomation_Document_HousingFundChange_Detail_IsPay when 0 then '不缴存' else '缴存' END AS 申请类型"
            + " ,dt.OfficeAutomation_Document_HousingFundChange_Detail_PayMonth AS 月份"
            + " ,dt.OfficeAutomation_Document_HousingFundChange_Detail_PayRate AS 个人缴存比例"
            + " ,CASE toam.OfficeAutomation_Main_FlowStateID WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundChange_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundChange_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundChange_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundChange_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundChange_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) END AS 审批状态"

            + smax
            + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_HousingFundChange] todi"
            + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_HousingFundChange_MainID"
            + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
            + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " RIGHT JOIN t_OfficeAutomation_Document_HousingFundChange_Detail dt ON dt.OfficeAutomation_Document_HousingFundChange_Detail_MainID = todi.OfficeAutomation_Document_HousingFundChange_ID"
            + slet;

            if (!isAdmin && !purview.Contains("OA_Search_083") || approver != "") //M_20150623
                housingfundchange += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            housingfundchange += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_083"))
                housingfundchange += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_HousingFundChange_Apply='" + employee + "')";

            if (applicationDepartment != "")
                housingfundchange += " and OfficeAutomation_Document_HousingFundChange_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                housingfundchange += " and OfficeAutomation_Document_HousingFundChange_Apply = '" + applicant + "'";

            if (begin != "")
                housingfundchange += " and OfficeAutomation_Document_HousingFundChange_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                housingfundchange += " and OfficeAutomation_Document_HousingFundChange_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                housingfundchange += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    housingfundchange += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundChange_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        housingfundchange += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        housingfundchange += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                housingfundchange += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                housingfundchange += " and [OfficeAutomation_Document_HousingFundChange_Remark] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                housingfundchange += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                housingfundchange += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_HousingFundChange_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    housingfundchange += "  OR (OfficeAutomation_Document_HousingFundChange_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_HousingFundChange_MainID))";
                }
            }
            housingfundchange += sgroup;


            //20170518 添加公积金缴存比例年度调整申请导出数据
            string housingfundadjust = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
            + " ,OfficeAutomation_Document_HousingFundAdjustment_ID as [ID]"
            + " ,OfficeAutomation_Document_HousingFundAdjustment_MainID as [MainID]"
            + " ,OfficeAutomation_Document_HousingFundAdjustment_Apply AS 填写人"
            + " ,OfficeAutomation_Document_HousingFundAdjustment_ApplyDate as [ApplyDate]"
            + " ,OfficeAutomation_Document_HousingFundAdjustment_Department AS 现任职部门"
            + " ,dt.OfficeAutomation_Document_HousingFundAdjustment_Detail_Name AS 姓名"
            + " ,dt.OfficeAutomation_Document_HousingFundAdjustment_Detail_InDate AS 入职日期"
            + " ,dt.OfficeAutomation_Document_HousingFundAdjustment_Detail_Pos AS 现职位"
            + " ,dt.OfficeAutomation_Document_HousingFundAdjustment_Detail_Grade AS 现职级"
            + " ,dt.OfficeAutomation_Document_HousingFundAdjustment_Detail_Code AS 申请人工号"
            + " ,dt.OfficeAutomation_Document_HousingFundAdjustment_Detail_PayMonth AS 年份"
            + " ,dt.OfficeAutomation_Document_HousingFundAdjustment_Detail_PayRate AS 个人缴存比例"
            + " ,CASE toam.OfficeAutomation_Main_FlowStateID WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundAdjustment_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundAdjustment_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundAdjustment_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundAdjustment_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundAdjustment_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) END AS 审批状态"

            + smax
            + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_HousingFundAdjustment] todi"
            + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_HousingFundAdjustment_MainID"
            + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
            + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " RIGHT JOIN t_OfficeAutomation_Document_HousingFundAdjustment_Detail dt ON dt.OfficeAutomation_Document_HousingFundAdjustment_Detail_MainID = todi.OfficeAutomation_Document_HousingFundAdjustment_ID"
            + slet;

            if (!isAdmin && !purview.Contains("OA_Search_087") || approver != "") //M_20150623
                housingfundadjust += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            housingfundadjust += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_087"))
                housingfundadjust += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_HousingFundAdjustment_Apply='" + employee + "')";

            if (applicationDepartment != "")
                housingfundadjust += " and OfficeAutomation_Document_HousingFundAdjustment_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                housingfundadjust += " and OfficeAutomation_Document_HousingFundAdjustment_Apply = '" + applicant + "'";

            if (begin != "")
                housingfundadjust += " and OfficeAutomation_Document_HousingFundAdjustment_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                housingfundadjust += " and OfficeAutomation_Document_HousingFundAdjustment_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                housingfundadjust += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    housingfundadjust += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundAdjustment_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        housingfundadjust += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        housingfundadjust += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                housingfundadjust += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            //if (keyWord != "")
            //    housingfundadjust += " and [OfficeAutomation_Document_HousingFundAdjustment_Remark] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                housingfundadjust += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                housingfundadjust += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_HousingFundAdjustment_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    housingfundadjust += "  OR (OfficeAutomation_Document_HousingFundAdjustment_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_HousingFundAdjustment_MainID))";
                }
            }
            housingfundadjust += sgroup;

            //20170518 添加公积金缴存基数年度调整申请导出数据
            string housingfundBaseadjust = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
            + " ,OfficeAutomation_Document_HousingFundBaseAdjust_ID as [ID]"
            + " ,OfficeAutomation_Document_HousingFundBaseAdjust_MainID as [MainID]"
            + " ,OfficeAutomation_Document_HousingFundBaseAdjust_Apply AS 填写人"
            + " ,OfficeAutomation_Document_HousingFundBaseAdjust_ApplyDate as [ApplyDate]"
            + " ,OfficeAutomation_Document_HousingFundBaseAdjust_Department AS 现任职部门"
            + " ,dt.OfficeAutomation_Document_HousingFundBaseAdjust_Detail_Name AS 姓名"
            + " ,dt.OfficeAutomation_Document_HousingFundBaseAdjust_Detail_InDate AS 入职日期"
            + " ,dt.OfficeAutomation_Document_HousingFundBaseAdjust_Detail_Pos AS 现职位"
            + " ,dt.OfficeAutomation_Document_HousingFundBaseAdjust_Detail_Grade AS 现职级"
            + " ,dt.OfficeAutomation_Document_HousingFundBaseAdjust_Detail_Code AS 申请人工号"
            + " ,dt.OfficeAutomation_Document_HousingFundBaseAdjust_Detail_PayMonth AS 年份"
         + ", case when  dt.OfficeAutomation_Document_HousingFundBaseAdjust_Detail_ChoiceBase =1 then '以基本工资为缴存基数' else dt.OfficeAutomation_Document_HousingFundBaseAdjust_Detail_BaseText end  AS 申请调整基数内容"
            + " ,CASE toam.OfficeAutomation_Main_FlowStateID WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundBaseAdjust_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundBaseAdjust_MainID] AND f.OfficeAutomation_Flow_Audit = 0 ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核' WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundBaseAdjust_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundBaseAdjust_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundBaseAdjust_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) END AS 审批状态"

            + smax
            + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_HousingFundBaseAdjust] todi"
            + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_HousingFundBaseAdjust_MainID"
            + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
            + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " RIGHT JOIN t_OfficeAutomation_Document_HousingFundBaseAdjust_Detail dt ON dt.OfficeAutomation_Document_HousingFundBaseAdjust_Detail_MainID = todi.OfficeAutomation_Document_HousingFundBaseAdjust_ID"
            + slet;

            if (!isAdmin && !purview.Contains("OA_Search_087") || approver != "") //M_20150623
                housingfundBaseadjust += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            housingfundBaseadjust += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_087"))
                housingfundBaseadjust += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_HousingFundBaseAdjust_Apply='" + employee + "')";

            if (applicationDepartment != "")
                housingfundBaseadjust += " and OfficeAutomation_Document_HousingFundBaseAdjust_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                housingfundBaseadjust += " and OfficeAutomation_Document_HousingFundBaseAdjust_Apply = '" + applicant + "'";

            if (begin != "")
                housingfundBaseadjust += " and OfficeAutomation_Document_HousingFundBaseAdjust_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                housingfundBaseadjust += " and OfficeAutomation_Document_HousingFundBaseAdjust_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                housingfundBaseadjust += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    housingfundBaseadjust += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundBaseAdjust_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        housingfundBaseadjust += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        housingfundBaseadjust += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                housingfundBaseadjust += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            //if (keyWord != "")
            //    housingfundadjust += " and [OfficeAutomation_Document_HousingFundAdjustment_Remark] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                housingfundBaseadjust += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                housingfundBaseadjust += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_HousingFundBaseAdjust_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    housingfundBaseadjust += "  OR (OfficeAutomation_Document_HousingFundBaseAdjust_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_HousingFundBaseAdjust_MainID))";
                }
            }
            housingfundBaseadjust += sgroup;

            //20170811 添加公章申请导出数据
            string OfficialSeal = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
            + " ,OfficeAutomation_Document_OfficialSeal_ID as [ID]"
            + " ,OfficeAutomation_Document_OfficialSeal_MainID as [MainID]"
            + " ,OfficeAutomation_Document_OfficialSeal_Detail_BN AS '项目（楼盘）名称/文件名称'"
            + " ,OfficeAutomation_Document_OfficialSeal_Detail_Company as 对方名称"
            + " ,OfficeAutomation_Document_OfficialSeal_Detail_TransFile AS '事务文件'"
            + " ,OfficeAutomation_Document_OfficialSeal_Detail_Use AS 用途"
            + " ,OfficeAutomation_Document_OfficialSeal_Department AS 申请部门"
            + " ,OfficeAutomation_Document_OfficialSeal_Apply AS 申请盖章人员"
             + " ,OfficeAutomation_Document_OfficialSeal_ApplyDate as  ApplyDate"
            + smax
            + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_OfficialSeal] todi"
            + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_OfficialSeal_MainID"
            + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
            + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " RIGHT JOIN t_OfficeAutomation_Document_OfficialSeal_Detail dt ON dt.OfficeAutomation_Document_OfficialSeal_Detail_MainID = todi.OfficeAutomation_Document_OfficialSeal_ID"
            + slet;

            if (!isAdmin && !purview.Contains("OA_Search_037") || approver != "") //M_20150623
                OfficialSeal += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            OfficialSeal += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_037"))
                OfficialSeal += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_OfficialSeal_Apply='" + employee + "')";

            if (applicationDepartment != "")
                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_Apply = '" + applicant + "'";

            if (begin != "")
                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                OfficialSeal += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    OfficialSeal += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        OfficialSeal += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        OfficialSeal += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                OfficialSeal += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            //if (keyWord != "")
            //    OfficialSeal += " and [OfficeAutomation_Document_HousingFundAdjustment_Remark] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3 ) //M_20150623
                OfficialSeal += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                OfficialSeal += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_OfficialSeal_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    OfficialSeal += "  OR (OfficeAutomation_Document_OfficialSeal_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_OfficialSeal_MainID))";
                }
            }
            OfficialSeal += sgroup;


            //20170811 添加开具发票申请导出数据
            string Invoicing = " SELECT ROW_NUMBER() OVER(ORDER BY " + sn + " desc) as [序号]"
            + " ,OfficeAutomation_Document_Invoicing_ID  as [ID]"
            + " ,OfficeAutomation_Document_Invoicing_MainID  as [MainID]"
            + " ,OfficeAutomation_Document_Invoicing_PurchaseName  AS '购方名称'"
            + " ,OfficeAutomation_Document_Invoicing_TaxpayerNum  as 纳税人识别号"
            + " ,OfficeAutomation_Document_Invoicing_Address  AS '地址、电话：'"
            + " ,OfficeAutomation_Document_Invoicing_OpenNum AS 开户行及账号"
            + " ,OfficeAutomation_Document_Invoicing_Content AS 开具内容"
            + " ,OfficeAutomation_Document_Invoicing_Money AS 开具金额"
            + " ,OfficeAutomation_Document_Invoicing_BuildingName as  '报数时的楼盘名称（或成交物业地址）'"
            + " ,OfficeAutomation_Document_Invoicing_Department as '申请部门'"
            + " ,OfficeAutomation_Document_Invoicing_Apply  as '申请人'"
            + " ,OfficeAutomation_Document_Invoicing_ApplyDate   as ApplyDate"
            + smax
            + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Invoicing] todi"
            + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Invoicing_MainID "
            + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
            + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + slet;

            if (!isAdmin && !purview.Contains("OA_Search_089") || approver != "") //M_20150623
                Invoicing += " LEFT JOIN #ab ON #ab.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Invoicing += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_089"))
                Invoicing += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_OfficialSeal_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Invoicing += " and OfficeAutomation_Document_Invoicing_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Invoicing += " and OfficeAutomation_Document_Invoicing_Apply  = '" + applicant + "'";

            if (begin != "")
                Invoicing += " and OfficeAutomation_Document_Invoicing_ApplyDate  >='" + begin + " 00:00:00'";

            if (end != "")
                Invoicing += " and OfficeAutomation_Document_Invoicing_ApplyDate <='" + end + " 23:59:59'";

            if (state != "")
                Invoicing += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Invoicing += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Invoicing += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Invoicing += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Invoicing += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            //if (keyWord != "")
            //    OfficialSeal += " and [OfficeAutomation_Document_HousingFundAdjustment_Remark] like '%" + keyWord + "%'";

            if (approver != "" && cstatue != 3) //M_20150623
                Invoicing += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Invoicing += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Invoicing_MainID  AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Invoicing += "  OR (OfficeAutomation_Document_Invoicing_Apply ='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and Exists (SELECT OfficeAutomation_Main_ID FROM t_OfficeAutomation_Main WHERE OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Invoicing_MainID))";
                }
            }
            Invoicing += sgroup;
            ///////////////////////////////////////////////////////////////////////////////////////////////////
            //////////////////////////////////////结束、结尾、最后、END
            ////////////////////////////////////////////////////////////////////////////////////////////////////














            switch (applyType)
            {
                case "62":
                    sql += UtContract;
                    break;
                case "63":
                    sql += UtNewProj;
                    break;
                case "17":
                    sql += ExtraBonus;
                    break;
                case "9":
                    sql += BuyBuilding;
                    break;
                case "10":
                    sql += CarAllowance;
                    break;
                case "70":
                    sql += OpenProve;
                    break;
                case "14":
                    sql += ProjCost; //*All
                    break;
                case "15":
                    sql += CoopCost;
                    break;
                case "16":
                    sql += undertakeproj;
                    break;
                case "25":
                    sql += ProjLinkRepoData;
                    break;
                case "29":
                    sql += FurtherEducation;
                    break;
                case "13":
                    sql += ReduceComm;
                    break;
                case "30":
                    sql += SpeciaNumber;
                    break;
                case "42":
                    sql += CommissionOfMonth;
                    break;
                case "6":
                    sql += DealOffice;
                    break;
                case "24":
                    sql += projrepodata;
                    break;
                case "21":
                    sql += projagentclause;
                    break;
                case "23":
                    sql += projdormsubsiby;
                    break;
                case "12":
                    sql += BadDebts;
                    break;
                case "55":
                    sql += Propaganda;
                    break;
                case "56":
                    sql += Budgetab;
                    break;
                case "77":
                    sql += wyrecruit;
                    break;
                case "78":
                    sql += recruit;
                    break;
                case "80":
                    sql += housingfundchange;
                    break;
                case "84":
                    sql += housingfundadjust;
                    break;
                case "95":
                    sql += housingfundBaseadjust;
                    break;
                case "31":
                    sql += OfficialSeal;
                    break;
                case "86":
                    sql += Invoicing;
                    break;
                case "45":
                    sql += CostIfActivity;
                    break;
                    
            }

            if(nt == "2")
                sql += " ORDER BY LastFlowCT DESC";
            else
                sql += " order by ApplyDate desc";
            
            if (!isAdmin)
                sql += " DROP TABLE #ab";

            return RunSQL(sql);
        }

        #endregion






        #region 逻辑删除
        public bool LogicDelete(string mainID)
        {
            string sql = "UPDATE [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Main] SET OfficeAutomation_Main_IsDelete=1 WHERE OfficeAutomation_Main_ID='" + mainID + "'";
            return RunNoneSQL(sql);
        }
        #endregion

        /// <summary>
        /// 判断该文档编号是否在佣金系统已使用
        /// </summary>
        /// <returns></returns>
        public bool IsUtDelete(string SerialNumber)
        {
            string sql = @"SELECT * FROM [gzs-fineccdb01].[DB_EcCommission].[dbo].t_Dic_Report_CashPrize
                            WHERE [CashPrize_Num] ='" + SerialNumber + "'";
          DataTable dt =  RunSQL(sql).Tables[0];
          if (dt.Rows.Count > 0)
          {
              return true;
          }
          else
          {
              return false;
          }
           
        }




        //20170208 注释掉删除，修改成逻辑删除
        #region 删除主表及关联的表的记录
        /// <summary>
        /// 删除主表及关联的表的记录
        /// </summary>
        /// <param name="mainID"></param>
        /// <returns></returns>
        //public bool Delete(string mainID)
        //{
        //    SqlCommand cmdToExecute = new SqlCommand();

        //    cmdToExecute.CommandText = "pr_deleteMainAndReturnTableName";

        //    cmdToExecute.CommandType = CommandType.StoredProcedure;

        //    cmdToExecute.Connection = _mainConnection;

        //    try
        //    {
        //        cmdToExecute.Parameters.Add(new SqlParameter("@sMainID", SqlDbType.NVarChar, 36, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Proposed, mainID));

        //        if (_mainConnectionIsCreatedLocal)
        //        {
        //            _mainConnection.Open();
        //            cmdToExecute.Transaction = _mainConnection.BeginTransaction();
        //        }
        //        else
        //        {
        //            if (_mainConnectionProvider.IsTransactionPending)
        //            {
        //                cmdToExecute.Transaction = _mainConnectionProvider.CurrentTransaction;
        //            }
        //        }

        //        int documentID = (int)cmdToExecute.ExecuteScalar();

        //        if (_mainConnectionIsCreatedLocal)
        //        {
        //            cmdToExecute.Transaction.Commit();
        //        }

        //        switch (documentID)
        //        {
        //            case 1:
        //                DA_OfficeAutomation_Document_ITPower_Inherit da_OfficeAutomation_Document_ITPower_Inherit = new DA_OfficeAutomation_Document_ITPower_Inherit();
        //                return da_OfficeAutomation_Document_ITPower_Inherit.Delete(mainID);
        //            case 2:
        //                DA_OfficeAutomation_Document_SysReq_Inherit da_OfficeAutomation_Document_SysReq_Inherit = new DA_OfficeAutomation_Document_SysReq_Inherit();
        //                return da_OfficeAutomation_Document_SysReq_Inherit.Delete(mainID);
        //            case 3:
        //                DA_OfficeAutomation_Document_SysPower_Inherit da_OfficeAutomation_Document_SysPower_Inherit = new DA_OfficeAutomation_Document_SysPower_Inherit();
        //                return da_OfficeAutomation_Document_SysPower_Inherit.Delete(mainID);
        //            case 4:
        //                DA_OfficeAutomation_Document_Scrap_Inherit da_OfficeAutomation_Document_Scrap_Inherit = new DA_OfficeAutomation_Document_Scrap_Inherit();
        //                return da_OfficeAutomation_Document_Scrap_Inherit.Delete(mainID);
        //            case 5:
        //                DA_OfficeAutomation_Document_AssetTransfer_Inherit da_OfficeAutomation_Document_AssetTransfer_Inherit = new DA_OfficeAutomation_Document_AssetTransfer_Inherit();
        //                return da_OfficeAutomation_Document_AssetTransfer_Inherit.Delete(mainID);
        //            case 6:
        //                DA_OfficeAutomation_Document_DealOffice_Inherit da_OfficeAutomation_Document_DealOffice_Inherit = new DA_OfficeAutomation_Document_DealOffice_Inherit();
        //                return da_OfficeAutomation_Document_DealOffice_Inherit.Delete(mainID);
        //            case 7:
        //                DA_OfficeAutomation_Document_ITBuy_Inherit da_OfficeAutomation_Document_ITBuy_Inherit = new DA_OfficeAutomation_Document_ITBuy_Inherit();
        //                return da_OfficeAutomation_Document_ITBuy_Inherit.Delete(mainID);
        //            case 8:
        //                DA_OfficeAutomation_Document_PersInterests_Inherit da_OfficeAutomation_Document_PersInterests_Inherit = new DA_OfficeAutomation_Document_PersInterests_Inherit();
        //                return da_OfficeAutomation_Document_PersInterests_Inherit.Delete(mainID);
        //            case 9:
        //                DA_OfficeAutomation_Document_BuyBuilding_Inherit da_OfficeAutomation_Document_BuyBuilding_Inherit = new DA_OfficeAutomation_Document_BuyBuilding_Inherit();
        //                return da_OfficeAutomation_Document_BuyBuilding_Inherit.Delete(mainID);
        //            case 10:
        //                DA_OfficeAutomation_Document_CarAllowance_Inherit da_OfficeAutomation_Document_CarAllowance_Inherit = new DA_OfficeAutomation_Document_CarAllowance_Inherit();
        //                return da_OfficeAutomation_Document_CarAllowance_Inherit.Delete(mainID);
        //            case 11:
        //                DA_OfficeAutomation_Document_BackComm_Inherit da_OfficeAutomation_Document_BackComm_Inherit = new DA_OfficeAutomation_Document_BackComm_Inherit();
        //                return da_OfficeAutomation_Document_BackComm_Inherit.Delete(mainID);
        //            case 12:
        //                DA_OfficeAutomation_Document_BadDebts_Inherit da_OfficeAutomation_Document_BadDebts_Inherit = new DA_OfficeAutomation_Document_BadDebts_Inherit();
        //                return da_OfficeAutomation_Document_BadDebts_Inherit.Delete(mainID);
        //            case 13:
        //                DA_OfficeAutomation_Document_ReduceComm_Inherit da_OfficeAutomation_Document_ReduceComm_Inherit = new DA_OfficeAutomation_Document_ReduceComm_Inherit();
        //                return da_OfficeAutomation_Document_ReduceComm_Inherit.Delete(mainID);
        //            case 14:
        //                DA_OfficeAutomation_Document_ProjCost_Inherit da_OfficeAutomation_Document_ProjCost_Inherit = new DA_OfficeAutomation_Document_ProjCost_Inherit();
        //                return da_OfficeAutomation_Document_ProjCost_Inherit.Delete(mainID);
        //            case 15:
        //                DA_OfficeAutomation_Document_CoopCost_Inherit da_OfficeAutomation_Document_CoopCost_Inherit = new DA_OfficeAutomation_Document_CoopCost_Inherit();
        //                return da_OfficeAutomation_Document_CoopCost_Inherit.Delete(mainID);
        //            case 16:
        //                DA_OfficeAutomation_Document_UndertakeProj_Inherit da_OfficeAutomation_Document_UndertakeProj_Inherit = new DA_OfficeAutomation_Document_UndertakeProj_Inherit();
        //                return da_OfficeAutomation_Document_UndertakeProj_Inherit.Delete(mainID);
        //            case 17:
        //                DA_OfficeAutomation_Document_ExtraBonus_Inherit da_OfficeAutomation_Document_ExtraBonus_Inherit = new DA_OfficeAutomation_Document_ExtraBonus_Inherit();
        //                return da_OfficeAutomation_Document_ExtraBonus_Inherit.Delete(mainID);
        //            case 18:
        //                DA_OfficeAutomation_Document_ResumeBusi_Inherit da_OfficeAutomation_Document_ResumeBusi_Inherit = new DA_OfficeAutomation_Document_ResumeBusi_Inherit();
        //                return da_OfficeAutomation_Document_ResumeBusi_Inherit.Delete(mainID);
        //            case 19:
        //                DA_OfficeAutomation_Document_WithdrawShop_Inherit da_OfficeAutomation_Document_WithdrawShop_Inherit = new DA_OfficeAutomation_Document_WithdrawShop_Inherit();
        //                return da_OfficeAutomation_Document_WithdrawShop_Inherit.Delete(mainID);
        //            case 20:
        //                DA_OfficeAutomation_Document_SuspendBusi_Inherit da_OfficeAutomation_Document_SuspendBusi_Inherit = new DA_OfficeAutomation_Document_SuspendBusi_Inherit();
        //                return da_OfficeAutomation_Document_SuspendBusi_Inherit.Delete(mainID);
        //            case 21:
        //                DA_OfficeAutomation_Document_ProjAgentClause_Inherit da_OfficeAutomation_Document_ProjAgentClause_Inherit = new DA_OfficeAutomation_Document_ProjAgentClause_Inherit();
        //                return da_OfficeAutomation_Document_ProjAgentClause_Inherit.Delete(mainID);
        //            case 22:
        //                DA_OfficeAutomation_Document_ProjWorkCloth_Inherit da_OfficeAutomation_Document_ProjWorkCloth_Inherit = new DA_OfficeAutomation_Document_ProjWorkCloth_Inherit();
        //                return da_OfficeAutomation_Document_ProjWorkCloth_Inherit.Delete(mainID);
        //            case 23:
        //                DA_OfficeAutomation_Document_ProjDormSubsiby_Inherit da_OfficeAutomation_Document_ProjDormSubsiby_Inherit = new DA_OfficeAutomation_Document_ProjDormSubsiby_Inherit();
        //                return da_OfficeAutomation_Document_ProjDormSubsiby_Inherit.Delete(mainID);
        //            case 24:
        //                DA_OfficeAutomation_Document_ProjRepoData_Inherit da_OfficeAutomation_Document_ProjRepoData_Inherit = new DA_OfficeAutomation_Document_ProjRepoData_Inherit();
        //                return da_OfficeAutomation_Document_ProjRepoData_Inherit.Delete(mainID);
        //            case 25:
        //                DA_OfficeAutomation_Document_ProjLinkRepoData_Inherit da_OfficeAutomation_Document_ProjLinkRepoData_Inherit = new DA_OfficeAutomation_Document_ProjLinkRepoData_Inherit();
        //                return da_OfficeAutomation_Document_ProjLinkRepoData_Inherit.Delete(mainID);
        //            case 26:
        //                DA_OfficeAutomation_Document_ChangeData_Inherit da_OfficeAutomation_Document_ChangeData_Inherit = new DA_OfficeAutomation_Document_ChangeData_Inherit();
        //                return da_OfficeAutomation_Document_ChangeData_Inherit.Delete(mainID);
        //            case 27:
        //                DA_OfficeAutomation_Document_CommissionAdjust_Inherit da_OfficeAutomation_Document_CommissionAdjust_Inherit = new DA_OfficeAutomation_Document_CommissionAdjust_Inherit();
        //                return da_OfficeAutomation_Document_CommissionAdjust_Inherit.Delete(mainID);
        //            case 28:
        //                DA_OfficeAutomation_Document_WirelessFixedLine_Inherit da_OfficeAutomation_Document_WirelessFixedLine_Inherit = new DA_OfficeAutomation_Document_WirelessFixedLine_Inherit();
        //                return da_OfficeAutomation_Document_WirelessFixedLine_Inherit.Delete(mainID);
        //            case 29:
        //                DA_OfficeAutomation_Document_FurtherEducation_Inherit da_OfficeAutomation_Document_FurtherEducation_Inherit = new DA_OfficeAutomation_Document_FurtherEducation_Inherit();
        //                return da_OfficeAutomation_Document_FurtherEducation_Inherit.Delete(mainID);
        //            case 30:
        //                DA_OfficeAutomation_Document_SpecialNumber_Inherit da_OfficeAutomation_Document_SpecialNumber_Inherit = new DA_OfficeAutomation_Document_SpecialNumber_Inherit();
        //                return da_OfficeAutomation_Document_SpecialNumber_Inherit.Delete(mainID);
        //            case 31:
        //                DA_OfficeAutomation_Document_OfficialSeal_Inherit da_OfficeAutomation_Document_OfficialSeal_Inherit = new DA_OfficeAutomation_Document_OfficialSeal_Inherit();
        //                return da_OfficeAutomation_Document_OfficialSeal_Inherit.Delete(mainID);
        //            case 32:
        //                DA_OfficeAutomation_Document_BranchContract_Inherit da_OfficeAutomation_Document_BranchContract_Inherit = new DA_OfficeAutomation_Document_BranchContract_Inherit();
        //                return da_OfficeAutomation_Document_BranchContract_Inherit.Delete(mainID);
        //            case 33:
        //                DA_OfficeAutomation_Document_Tourism_Inherit da_OfficeAutomation_Document_Tourism_Inherit = new DA_OfficeAutomation_Document_Tourism_Inherit();
        //                return da_OfficeAutomation_Document_Tourism_Inherit.Delete(mainID);
        //            case 34:
        //                DA_OfficeAutomation_Document_OweSubmit_Inherit da_OfficeAutomation_Document_OweSubmit_Inherit = new DA_OfficeAutomation_Document_OweSubmit_Inherit();
        //                return da_OfficeAutomation_Document_OweSubmit_Inherit.Delete(mainID);
        //            case 35:
        //                DA_OfficeAutomation_Document_TotalRev_Inherit da_OfficeAutomation_Document_TotalRev_Inherit = new DA_OfficeAutomation_Document_TotalRev_Inherit();
        //                return da_OfficeAutomation_Document_TotalRev_Inherit.Delete(mainID);
        //            case 36:
        //                DA_OfficeAutomation_Document_Feasibility_Inherit da_OfficeAutomation_Document_Feasibility_Inherit = new DA_OfficeAutomation_Document_Feasibility_Inherit();
        //                return da_OfficeAutomation_Document_Feasibility_Inherit.Delete(mainID);
        //            case 37:
        //                DA_OfficeAutomation_Document_AfterCommission_Inherit da_OfficeAutomation_Document_AfterCommission_Inherit = new DA_OfficeAutomation_Document_AfterCommission_Inherit();
        //                return da_OfficeAutomation_Document_AfterCommission_Inherit.Delete(mainID);
        //            case 38:
        //                DA_OfficeAutomation_Document_LegalCommission_Inherit da_OfficeAutomation_Document_LegalCommission_Inherit = new DA_OfficeAutomation_Document_LegalCommission_Inherit();
        //                return da_OfficeAutomation_Document_LegalCommission_Inherit.Delete(mainID);
        //            case 39:
        //                DA_OfficeAutomation_Document_GeneralApply_Inherit da_OfficeAutomation_Document_GeneralApply_Inherit = new DA_OfficeAutomation_Document_GeneralApply_Inherit();
        //                return da_OfficeAutomation_Document_GeneralApply_Inherit.Delete(mainID);
        //            case 40:
        //                DA_OfficeAutomation_Document_ContractTerms_Inherit da_OfficeAutomation_Document_ContractTerms_Inherit = new DA_OfficeAutomation_Document_ContractTerms_Inherit();
        //                return da_OfficeAutomation_Document_ContractTerms_Inherit.Delete(mainID);
        //            case 41:
        //                DA_OfficeAutomation_Document_NetSign_Inherit da_OfficeAutomation_Document_NetSign_Inherit = new DA_OfficeAutomation_Document_NetSign_Inherit();
        //                return da_OfficeAutomation_Document_NetSign_Inherit.Delete(mainID);
        //            case 42:
        //                DA_OfficeAutomation_Document_CommissionOfMonth_Inherit da_OfficeAutomation_Document_CommissionOfMonth_Inherit = new DA_OfficeAutomation_Document_CommissionOfMonth_Inherit();
        //                return da_OfficeAutomation_Document_CommissionOfMonth_Inherit.Delete(mainID);
        //            case 43:
        //                DA_OfficeAutomation_Document_Marketing_Inherit da_OfficeAutomation_Document_Marketing_Inherit = new DA_OfficeAutomation_Document_Marketing_Inherit();
        //                return da_OfficeAutomation_Document_Marketing_Inherit.Delete(mainID);
        //            case 44:
        //                DA_OfficeAutomation_Document_Secondment_Inherit da_OfficeAutomation_Document_Secondment_Inherit = new DA_OfficeAutomation_Document_Secondment_Inherit();
        //                return da_OfficeAutomation_Document_Secondment_Inherit.Delete(mainID);
        //            case 45:
        //                DA_OfficeAutomation_Document_CostOfActivity_Inherit da_OfficeAutomation_Document_CostOfActivity_Inherit = new DA_OfficeAutomation_Document_CostOfActivity_Inherit();
        //                return da_OfficeAutomation_Document_CostOfActivity_Inherit.Delete(mainID);
        //            case 46:
        //                DA_OfficeAutomation_Document_PunishTerms_Inherit da_OfficeAutomation_Document_PunishTerms_Inherit = new DA_OfficeAutomation_Document_PunishTerms_Inherit();
        //                return da_OfficeAutomation_Document_PunishTerms_Inherit.Delete(mainID);
        //            case 47:
        //                DA_OfficeAutomation_Document_ChangeNS_Inherit da_OfficeAutomation_Document_ChangeNS_Inherit = new DA_OfficeAutomation_Document_ChangeNS_Inherit();
        //                return da_OfficeAutomation_Document_ChangeNS_Inherit.Delete(mainID);
        //            case 48:
        //                DA_OfficeAutomation_Document_SpecialCase_Inherit da_OfficeAutomation_Document_SpecialCase_Inherit = new DA_OfficeAutomation_Document_SpecialCase_Inherit();
        //                return da_OfficeAutomation_Document_SpecialCase_Inherit.Delete(mainID);
        //            case 49:
        //                DA_OfficeAutomation_Document_NewPersInterests_Inherit da_OfficeAutomation_Document_NewPersInterests_Inherit = new DA_OfficeAutomation_Document_NewPersInterests_Inherit();
        //                return da_OfficeAutomation_Document_NewPersInterests_Inherit.Delete(mainID);
        //            case 50:
        //                DA_OfficeAutomation_Document_SocialSecurity_Inherit da_OfficeAutomation_Document_SocialSecurity_Inherit = new DA_OfficeAutomation_Document_SocialSecurity_Inherit();
        //                return da_OfficeAutomation_Document_SocialSecurity_Inherit.Delete(mainID);
        //            case 51:
        //                DA_OfficeAutomation_Document_PortAssessment_Inherit da_OfficeAutomation_Document_PortAssessment_Inherit = new DA_OfficeAutomation_Document_PortAssessment_Inherit();
        //                return da_OfficeAutomation_Document_PortAssessment_Inherit.Delete(mainID);
        //            case 52:
        //                DA_OfficeAutomation_Document_ProjectCarAllowance_Inherit da_OfficeAutomation_Document_ProjectCarAllowance_Inherit = new DA_OfficeAutomation_Document_ProjectCarAllowance_Inherit();
        //                return da_OfficeAutomation_Document_ProjectCarAllowance_Inherit.Delete(mainID);
        //            case 53:
        //                DA_OfficeAutomation_Document_Maintenance_Inherit da_OfficeAutomation_Document_Maintenance_Inherit = new DA_OfficeAutomation_Document_Maintenance_Inherit();
        //                return da_OfficeAutomation_Document_Maintenance_Inherit.Delete(mainID);
        //            case 54:
        //                DA_OfficeAutomation_Document_Repair_Inherit da_OfficeAutomation_Document_Repair_Inherit = new DA_OfficeAutomation_Document_Repair_Inherit();
        //                return da_OfficeAutomation_Document_Repair_Inherit.Delete(mainID);
        //            case 55:
        //                DA_OfficeAutomation_Document_Propaganda_Inherit da_OfficeAutomation_Document_Propaganda_Inherit = new DA_OfficeAutomation_Document_Propaganda_Inherit();
        //                return da_OfficeAutomation_Document_Propaganda_Inherit.Delete(mainID);
        //            case 56:
        //                DA_OfficeAutomation_Document_Budgetab_Inherit da_OfficeAutomation_Document_Budgetab_Inherit = new DA_OfficeAutomation_Document_Budgetab_Inherit();
        //                return da_OfficeAutomation_Document_Budgetab_Inherit.Delete(mainID);
        //            case 57:
        //                DA_OfficeAutomation_Document_EBAdjuct_Inherit da_OfficeAutomation_Document_EBAdjuct_Inherit = new DA_OfficeAutomation_Document_EBAdjuct_Inherit();
        //                return da_OfficeAutomation_Document_EBAdjuct_Inherit.Delete(mainID);
        //            case 58:
        //                DA_OfficeAutomation_Document_Guarantee_Inherit da_OfficeAutomation_Document_Guarantee_Inherit = new DA_OfficeAutomation_Document_Guarantee_Inherit();
        //                return da_OfficeAutomation_Document_Guarantee_Inherit.Delete(mainID);
        //            case 59:
        //                DA_OfficeAutomation_Document_SignedG_Inherit da_OfficeAutomation_Document_SignedG_Inherit = new DA_OfficeAutomation_Document_SignedG_Inherit();
        //                return da_OfficeAutomation_Document_SignedG_Inherit.Delete(mainID);
        //            case 60:
        //                DA_OfficeAutomation_Document_PullafewRd_Inherit da_OfficeAutomation_Document_PullafewRd_Inherit = new DA_OfficeAutomation_Document_PullafewRd_Inherit();
        //                return da_OfficeAutomation_Document_PullafewRd_Inherit.Delete(mainID);
        //            case 61:
        //                DA_OfficeAutomation_Document_PullafewTwo_Inherit da_OfficeAutomation_Document_PullafewTwo_Inherit = new DA_OfficeAutomation_Document_PullafewTwo_Inherit();
        //                return da_OfficeAutomation_Document_PullafewTwo_Inherit.Delete(mainID);
        //            case 62:
        //                DA_OfficeAutomation_Document_UtContract_Inherit da_OfficeAutomation_Document_UtContract_Inherit = new DA_OfficeAutomation_Document_UtContract_Inherit();
        //                return da_OfficeAutomation_Document_UtContract_Inherit.Delete(mainID);
        //            case 63:
        //                DA_OfficeAutomation_Document_UtNewProj_Inherit da_OfficeAutomation_Document_UtNewProj_Inherit = new DA_OfficeAutomation_Document_UtNewProj_Inherit();
        //                return da_OfficeAutomation_Document_UtNewProj_Inherit.Delete(mainID);
        //            case 64:
        //                DA_OfficeAutomation_Document_ProjReDaAdd_Inherit da_OfficeAutomation_Document_ProjReDaAdd_Inherit = new DA_OfficeAutomation_Document_ProjReDaAdd_Inherit();
        //                return da_OfficeAutomation_Document_ProjReDaAdd_Inherit.Delete(mainID);
        //            case 65:
        //                DA_OfficeAutomation_Document_WrongSave_Inherit da_OfficeAutomation_Document_WrongSave_Inherit = new DA_OfficeAutomation_Document_WrongSave_Inherit();
        //                return da_OfficeAutomation_Document_WrongSave_Inherit.Delete(mainID);
        //            case 66:
        //                DA_OfficeAutomation_Document_BuyBudiData_Inherit da_OfficeAutomation_Document_BuyBudiData_Inherit = new DA_OfficeAutomation_Document_BuyBudiData_Inherit();
        //                return da_OfficeAutomation_Document_BuyBudiData_Inherit.Delete(mainID);
        //            case 67:
        //                DA_OfficeAutomation_Document_ProjBaComm_Inherit da_OfficeAutomation_Document_ProjBaComm_Inherit = new DA_OfficeAutomation_Document_ProjBaComm_Inherit();
        //                return da_OfficeAutomation_Document_ProjBaComm_Inherit.Delete(mainID);
        //            case 68:
        //                DA_OfficeAutomation_Document_BorrowMoney_Inherit da_OfficeAutomation_Document_BorrowMoney_Inherit = new DA_OfficeAutomation_Document_BorrowMoney_Inherit();
        //                return da_OfficeAutomation_Document_BorrowMoney_Inherit.Delete(mainID);
        //            case 69:
        //                DA_OfficeAutomation_Document_SpecialAdd_Inherit da_OfficeAutomation_Document_SpecialAdd_Inherit = new DA_OfficeAutomation_Document_SpecialAdd_Inherit();
        //                return da_OfficeAutomation_Document_SpecialAdd_Inherit.Delete(mainID);
        //            case 70:
        //                DA_OfficeAutomation_Document_OpenProve_Inherit da_OfficeAutomation_Document_OpenProve_Inherit = new DA_OfficeAutomation_Document_OpenProve_Inherit();
        //                return da_OfficeAutomation_Document_OpenProve_Inherit.Delete(mainID);
        //            case 71:
        //                DA_OfficeAutomation_Document_PartTime_Inherit da_OfficeAutomation_Document_PartTime_Inherit = new DA_OfficeAutomation_Document_PartTime_Inherit();
        //                return da_OfficeAutomation_Document_PartTime_Inherit.Delete(mainID);
        //            case 72:
        //                DA_OfficeAutomation_Document_SysLogist_Inherit da_OfficeAutomation_Document_SysLogist_Inherit = new DA_OfficeAutomation_Document_SysLogist_Inherit();
        //                return da_OfficeAutomation_Document_SysLogist_Inherit.Delete(mainID);
        //            case 73:
        //                DA_OfficeAutomation_Document_SolHold_Inherit da_OfficeAutomation_Document_SolHold_Inherit = new DA_OfficeAutomation_Document_SolHold_Inherit();
        //                return da_OfficeAutomation_Document_SolHold_Inherit.Delete(mainID);
        //            case 74:
        //                DA_OfficeAutomation_Document_HoldCoisn_Inherit da_OfficeAutomation_Document_HoldCoisn_Inherit = new DA_OfficeAutomation_Document_HoldCoisn_Inherit();
        //                return da_OfficeAutomation_Document_HoldCoisn_Inherit.Delete(mainID);
        //            case 75:
        //                DA_OfficeAutomation_Document_Record_Inherit da_OfficeAutomation_Document_Record_Inherit = new DA_OfficeAutomation_Document_Record_Inherit();
        //                return da_OfficeAutomation_Document_Record_Inherit.Delete(mainID);
        //            case 76:
        //                var CallCenterFeasibility_Inherit = new DA_OfficeAutomation_Document_CallCenterFeasibility_Inherit();
        //                return CallCenterFeasibility_Inherit.Delete(mainID);
        //            case 77:
        //                var WYRecruit_Inherit = new DA_OfficeAutomation_Document_WYRecruit_Operate();
        //                return WYRecruit_Inherit.Delete(mainID);
        //            case 78:
        //                var Recruit_Inherit = new DA_OfficeAutomation_Document_Recruit_Operate();
        //                return Recruit_Inherit.Delete(mainID);
        //            case 79:
        //                var bll = new DA_OfficeAutomation_Document_CommissionAssign_Operate();
        //                return bll.Delete(mainID);
        //            case 80:
        //                var HousingFundChangebll = new DA_OfficeAutomation_Document_HousingFundChange_Operate();
        //                return HousingFundChangebll.Delete(mainID);
        //            case 81:
        //                var StaffDataCheck_Operatebll = new DA_OfficeAutomation_Document_StaffDataCheck_Operate();
        //                return StaffDataCheck_Operatebll.Delete(mainID);
        //            default:
        //                break;
        //        }

        //        return false;
        //    }
        //    catch (Exception ex)
        //    {
        //        if (_mainConnectionIsCreatedLocal)
        //        {
        //            cmdToExecute.Transaction.Rollback();
        //        }
        //        throw new Exception(ex.Message.ToString());
        //    }
        //    finally
        //    {
        //        if (_mainConnectionIsCreatedLocal)
        //        {
        //            _mainConnection.Close();
        //        }

        //        cmdToExecute.Dispose();
        //    }
        //}
        #endregion



        #region 搜索并查询出各申请表列表
        /// <summary>
        /// 通过搜索，查询出各申请表列表，按最后审批时间排序
        /// </summary>
        /// <param name="isAdmin">是否管理员查询</param>
        /// <param name="applicationDepartment"></param>
        /// <param name="applicant">申请部门</param>
        /// <param name="begin"></param>
        /// <param name="end"></param>
        /// <param name="applyType"></param>
        /// <param name="state"></param>
        /// <param name="purview">权限</param>
        /// <returns></returns>
        public DataSet Search_New(bool islawer, bool isAdmin, string applicationDepartment, string applicant, string begin, string end, string applyType, string state, string employee, string code, string purview, string serialNumber, string keyWord, string ctype, int cstatue, string approver, string apptime, string apptotime, bool willDelete,string intereststype)
        {
            string myAgency = "";
            DA_OfficeAutomation_Agent_Inherit da_OfficeAutomation_Agent_Inherit = new DA_OfficeAutomation_Agent_Inherit();
            DataSet ds = da_OfficeAutomation_Agent_Inherit.GetMyAgencyForAgent(employee, code);
            string myAgency2 = da_OfficeAutomation_Agent_Inherit.GetMyAgencyForSQL(employee, code);

            apptotime = string.IsNullOrEmpty(apptotime) ? DateTime.Now.AddDays(1).ToString("yyyy-MM-dd") : apptotime;

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    myAgency += " OR (auditoridsum LIKE '%" + dr["OfficeAutomation_Agent_AuditorID"].ToString()
                        + "%' AND auditorsum LIKE '%" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "%')";
                }
            }

            string sql = "";

            if (!isAdmin || approver != "")
            {
                sql += "CREATE TABLE #a"
                       + " ("
                       + "    OfficeAutomation_Flow_MainID UNIQUEIDENTIFIER,"
                       + "    auditorsum                   NVARCHAR(2000),"
                       + "    auditoridsum                NVARCHAR(2000),"
                       + "    DocumentID                 int"
                       + "  )"
                       + " INSERT INTO #a"
                       + "                     (OfficeAutomation_Flow_MainID,"
                       + "                      auditorsum,"
                       + "                      auditoridsum)"
                    //+ " SELECT *"
                    //+ " FROM   vw_SumAuditor";
                       + " SELECT OfficeAutomation_Flow_MainID,"
                       + "            CASE WHEN toam.OfficeAutomation_Main_AuditorNamesSum IS NULL then dbo.Fun_sum_employee(OfficeAutomation_Flow_MainID) ELSE toam.OfficeAutomation_Main_AuditorNamesSum END   AS auditorsum,"
                       + "            CASE WHEN toam.OfficeAutomation_Main_AuditorIDsSum IS NULL then dbo.Fun_sum_employeeid(OfficeAutomation_Flow_MainID) ELSE toam.OfficeAutomation_Main_AuditorIDsSum END   AS auditoridsum"
                       + " FROM  dbo.t_OfficeAutomation_Flow AS toaf"
                       + "            LEFT JOIN t_OfficeAutomation_Main toam"
                       + "                      ON toaf.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID"
                       + " WHERE 1=1";

                if (state != "")
                    sql += " AND toam.OfficeAutomation_Main_FlowStateID=" + state;
                if (serialNumber != "")
                    sql += " AND toam.OfficeAutomation_SerialNumber like '" + serialNumber + "%'";
                if (applyType != "")
                {
                    if (applyType == "8")
                        sql += " AND (toam.OfficeAutomation_DocumentID = 8 or toam.OfficeAutomation_DocumentID = 49)";
                    else
                        sql += " AND toam.OfficeAutomation_DocumentID=" + applyType;
                }

                sql += " GROUP BY OfficeAutomation_Flow_MainID,OfficeAutomation_Main_AuditorNamesSum,OfficeAutomation_Main_AuditorIDsSum";
            }

            string itpower = " SELECT [OfficeAutomation_Document_ITPower_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ITPower_MainID] as MainID"
                 + "          ,[OfficeAutomation_Document_ITPower_DepartmentID] as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ITPower_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ITPower_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ITPower_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITPower_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITPower_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITPower_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITPower_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITPower_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ITPower_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,todi.OfficeAutomation_Document_ITPower_Deal as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "           ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ITPower] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ITPower_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                 + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ITPower_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_005") || approver != "") //M_20150623
                itpower += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            //20170210修改  添加了逻辑删除，所以查询的时候要排除掉状态是删除的申请
            itpower += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_005"))
                itpower += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ITPower_Apply='" + employee + "')";

            if (applicationDepartment != "")
                itpower += " and OfficeAutomation_Document_ITPower_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                itpower += " and OfficeAutomation_Document_ITPower_Apply = '" + applicant + "'";

            if (begin != "")
                itpower += " and OfficeAutomation_Document_ITPower_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                itpower += " and OfficeAutomation_Document_ITPower_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                itpower += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    itpower += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITPower_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver!= "")
                        itpower += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        itpower += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                itpower += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                itpower += " and [OfficeAutomation_Document_ITPower_ApplyReason] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                itpower += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                itpower += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                itpower += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ITPower_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";
            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    itpower += "  OR (OfficeAutomation_Document_ITPower_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ITPower_MainID))";
                }
            }

            itpower += " GROUP BY OfficeAutomation_Document_ITPower_ID"
            + ",OfficeAutomation_Document_ITPower_MainID"
            + ",OfficeAutomation_Document_ITPower_DepartmentID"
            + ",OfficeAutomation_Document_ITPower_Department"
            + ",OfficeAutomation_Document_ITPower_ApplyDate"
            + ",OfficeAutomation_Document_ITPower_Apply"
            + ",toam.OfficeAutomation_SerialNumber"
            + ",toam.OfficeAutomation_Main_FlowStateID"
            + ",tdoad.OfficeAutomation_Document_Name"
            + ",todi.OfficeAutomation_Document_ITPower_Deal"
            + ",toam.OfficeAutomation_SerialNumber";//*-1

            string sysreq = " SELECT [OfficeAutomation_Document_SysReq_ID] as ID"
                 + "          ,[OfficeAutomation_Document_SysReq_MainID] as MainID"
                 + "          ,[OfficeAutomation_Document_SysReq_DepartmentID] as DepartmentID"
                 + "          ,[OfficeAutomation_Document_SysReq_Department] as Department"
                 + "          ,[OfficeAutomation_Document_SysReq_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_SysReq_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysReq_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysReq_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysReq_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysReq_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysReq_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_SysReq_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,(SELECT OfficeAutomation_SoftSystem_Name FROM t_Dic_OfficeAutomation_SoftSystem WHERE OfficeAutomation_SoftSystem_ID = OfficeAutomation_Document_SysReq_SystemName) as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SysReq] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SysReq_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                 + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SysReq_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_007") || approver != "") //M_20150623
                sysreq += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            sysreq += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_007"))  //20140919-跟进人也能看到审批表
                sysreq += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SysReq_Apply='" + employee + "' or ISNULL(OfficeAutomation_Document_SysReq_Follower,'') Like '%" + employee + "%')";

            if (applicationDepartment != "")
                sysreq += " and OfficeAutomation_Document_SysReq_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                sysreq += " and OfficeAutomation_Document_SysReq_Apply = '" + applicant + "'";

            if (begin != "")
                sysreq += " and OfficeAutomation_Document_SysReq_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                sysreq += " and OfficeAutomation_Document_SysReq_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                sysreq += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    sysreq += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysReq_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        sysreq += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        sysreq += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                sysreq += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                //sysreq += " and [OfficeAutomation_Document_SysReq_ReqContent] like '%" + keyWord + "%'";
                sysreq += " and (SELECT OfficeAutomation_SoftSystem_Name FROM t_Dic_OfficeAutomation_SoftSystem WHERE OfficeAutomation_SoftSystem_ID = OfficeAutomation_Document_SysReq_SystemName) like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                sysreq += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                sysreq += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                sysreq += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_SysReq_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    sysreq += "  OR (OfficeAutomation_Document_SysReq_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_SysReq_MainID))";
                }
            }

            //if (!isAdmin && !purview.Contains("OA_Search_007")) //20140919-跟进人也能看到审批表
            //    sysreq += " and ISNULL(OfficeAutomation_Document_SysReq_Follower,'') Like '%" + employee + "%'";

            sysreq += " GROUP BY [OfficeAutomation_Document_SysReq_ID]"
                 + "          ,[OfficeAutomation_Document_SysReq_MainID]"
                 + "          ,[OfficeAutomation_Document_SysReq_DepartmentID]"
                 + "          ,[OfficeAutomation_Document_SysReq_Department]"
                 + "          ,[OfficeAutomation_Document_SysReq_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_SysReq_Apply]"
                 + "          ,[OfficeAutomation_Document_SysReq_SystemName]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-3

            string syspower = " SELECT [OfficeAutomation_Document_SysPower_ID] as ID"
                 + "          ,[OfficeAutomation_Document_SysPower_MainID] as MainID"
                 + "          ,[OfficeAutomation_Document_SysPower_DepartmentID] as DepartmentID"
                 + "          ,[OfficeAutomation_Document_SysPower_Department] as Department"
                 + "          ,[OfficeAutomation_Document_SysPower_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_SysPower_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysPower_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysPower_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysPower_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysPower_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysPower_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_SysPower_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,todi.OfficeAutomation_Document_SysPower_Deal as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SysPower] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SysPower_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SysPower_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_006") || approver != "") //M_20150623
                syspower += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            syspower += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_006"))
                syspower += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SysPower_Apply='" + employee + "')";

            if (applicationDepartment != "")
                syspower += " and OfficeAutomation_Document_SysPower_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                syspower += " and OfficeAutomation_Document_SysPower_Apply = '" + applicant + "'";

            if (begin != "")
                syspower += " and OfficeAutomation_Document_SysPower_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                syspower += " and OfficeAutomation_Document_SysPower_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                syspower += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    syspower += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysPower_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        syspower += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        syspower += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0 AND toam.OfficeAutomation_Main_FlowStateID != 3";
                }

            if (serialNumber != "")
                syspower += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                syspower += " and [OfficeAutomation_Document_SysPower_ReqContent] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                syspower += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                syspower += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                syspower += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_SysPower_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    syspower += "  OR (OfficeAutomation_Document_SysPower_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_SysPower_MainID))";
                }
            }

            syspower += " GROUP BY [OfficeAutomation_Document_SysPower_ID]"
                 + "          ,[OfficeAutomation_Document_SysPower_MainID]"
                 + "          ,[OfficeAutomation_Document_SysPower_DepartmentID]"
                 + "          ,[OfficeAutomation_Document_SysPower_Department]"
                 + "          ,[OfficeAutomation_Document_SysPower_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_SysPower_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,todi.OfficeAutomation_Document_SysPower_Deal"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-4

            string scrap = " SELECT [OfficeAutomation_Document_Scrap_ID] as ID"
                 + "          ,[OfficeAutomation_Document_Scrap_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_Scrap_Department] as Department"
                 + "          ,[OfficeAutomation_Document_Scrap_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_Scrap_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Scrap_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Scrap_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Scrap_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Scrap_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Scrap_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Scrap_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,(isnull(OfficeAutomation_Document_Scrap_UserName,'') + '　' + isnull(todi.[OfficeAutomation_Document_Scrap_Remark],'')) as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Scrap] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Scrap_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Scrap_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_009") || approver != "") //M_20150623
                scrap += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            scrap += " WHERE  toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_009"))
                scrap += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Scrap_Apply='" + employee + "')";

            if (applicationDepartment != "")
                scrap += " and OfficeAutomation_Document_Scrap_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                scrap += " and OfficeAutomation_Document_Scrap_Apply = '" + applicant + "'";

            if (begin != "")
                scrap += " and OfficeAutomation_Document_Scrap_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                scrap += " and OfficeAutomation_Document_Scrap_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                scrap += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    scrap += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Scrap_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        scrap += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        scrap += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                scrap += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                scrap += " and [OfficeAutomation_Document_Scrap_ReqReason] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                scrap += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                scrap += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                scrap += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Scrap_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    scrap += "  OR (OfficeAutomation_Document_Scrap_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Scrap_MainID))";
                }
            }

            scrap += " GROUP BY [OfficeAutomation_Document_Scrap_ID]"
                 + "          ,[OfficeAutomation_Document_Scrap_MainID]"
                 + "          ,[OfficeAutomation_Document_Scrap_Department]"
                 + "          ,[OfficeAutomation_Document_Scrap_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Scrap_Apply]"
                 + "          ,[OfficeAutomation_Document_Scrap_UserName]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,todi.[OfficeAutomation_Document_Scrap_Remark]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-5

            string assettransfer = " SELECT [OfficeAutomation_Document_AssetTransfer_ID] as ID"
                 + "          ,[OfficeAutomation_Document_AssetTransfer_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_AssetTransfer_Department] as Department"
                 + "          ,[OfficeAutomation_Document_AssetTransfer_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_AssetTransfer_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AssetTransfer_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AssetTransfer_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AssetTransfer_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AssetTransfer_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AssetTransfer_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_AssetTransfer_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_AssetTransfer_Remark] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_AssetTransfer] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_AssetTransfer_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_AssetTransfer_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_010") || approver != "") //M_20150623
                assettransfer += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            assettransfer += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_010"))
                assettransfer += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_AssetTransfer_Apply='" + employee + "')";

            if (applicationDepartment != "")
                assettransfer += " and OfficeAutomation_Document_AssetTransfer_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                assettransfer += " and OfficeAutomation_Document_AssetTransfer_Apply = '" + applicant + "'";

            if (begin != "")
                assettransfer += " and OfficeAutomation_Document_AssetTransfer_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                assettransfer += " and OfficeAutomation_Document_AssetTransfer_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                assettransfer += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    assettransfer += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AssetTransfer_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        assettransfer += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        assettransfer += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                assettransfer += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                assettransfer += " and OfficeAutomation_Document_AssetTransfer_TransferReason like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                assettransfer += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                assettransfer += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                assettransfer += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_AssetTransfer_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    assettransfer += "  OR (OfficeAutomation_Document_AssetTransfer_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete=0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_AssetTransfer_MainID))";
                }
            }

            assettransfer += " GROUP BY [OfficeAutomation_Document_AssetTransfer_ID]"
                 + "          ,[OfficeAutomation_Document_AssetTransfer_MainID]"
                 + "          ,[OfficeAutomation_Document_AssetTransfer_Department]"
                 + "          ,[OfficeAutomation_Document_AssetTransfer_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_AssetTransfer_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_AssetTransfer_Remark]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-6

            string dealoffice = " SELECT [OfficeAutomation_Document_DealOffice_ID] as ID"
                 + "          ,[OfficeAutomation_Document_DealOffice_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_DealOffice_Department] as Department"
                 + "          ,[OfficeAutomation_Document_DealOffice_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_DealOffice_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_DealOffice_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,'' as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_DealOffice] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_DealOffice_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_DealOffice_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_011") || approver != "") //M_20150623
                dealoffice += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            dealoffice += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_011"))
                dealoffice += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_DealOffice_Apply='" + employee + "')";

            if (applicationDepartment != "")
                dealoffice += " and OfficeAutomation_Document_DealOffice_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                dealoffice += " and OfficeAutomation_Document_DealOffice_Apply = '" + applicant + "'";

            if (begin != "")
                dealoffice += " and OfficeAutomation_Document_DealOffice_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                dealoffice += " and OfficeAutomation_Document_DealOffice_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                dealoffice += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    dealoffice += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_DealOffice_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        dealoffice += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        dealoffice += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                dealoffice += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                dealoffice += " and ([OfficeAutomation_Document_DealOffice_CrossAreaRemark] like '%" + keyWord + "%' OR [OfficeAutomation_Document_DealOffice_MoneyRemark] like '%" + keyWord + "%')";

            if (willDelete) //M_DeleteAdd 20151230
                dealoffice += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                dealoffice += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                dealoffice += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_DealOffice_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' )";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    dealoffice += "  OR (OfficeAutomation_Document_DealOffice_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_DealOffice_MainID))";
                }
            }

            dealoffice += " GROUP BY [OfficeAutomation_Document_DealOffice_ID]"
                 + "          ,[OfficeAutomation_Document_DealOffice_MainID]"
                 + "          ,[OfficeAutomation_Document_DealOffice_Department]"
                 + "          ,[OfficeAutomation_Document_DealOffice_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_DealOffice_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-7

            string itbuy = " SELECT [OfficeAutomation_Document_ITBuy_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ITBuy_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ITBuy_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ITBuy_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ITBuy_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITBuy_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITBuy_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITBuy_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITBuy_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITBuy_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ITBuy_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ITBuy_ApplyID]+' '+case when [OfficeAutomation_Document_ITBuy_Remark]!='' then '√' else '' end as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ITBuy] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ITBuy_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ITBuy_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_008") || approver != "") //M_20150623
                itbuy += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            itbuy += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_008"))
                itbuy += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ITBuy_Apply='" + employee + "')";

            if (applicationDepartment != "")
                itbuy += " and OfficeAutomation_Document_ITBuy_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                itbuy += " and OfficeAutomation_Document_ITBuy_Apply = '" + applicant + "'";

            if (begin != "")
                itbuy += " and OfficeAutomation_Document_ITBuy_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                itbuy += " and OfficeAutomation_Document_ITBuy_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                itbuy += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    itbuy += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ITBuy_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        itbuy += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        itbuy += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                itbuy += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                itbuy += " and OfficeAutomation_Document_ITBuy_Reason like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                itbuy += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                itbuy += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                itbuy += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ITBuy_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    itbuy += "  OR (OfficeAutomation_Document_ITBuy_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ITBuy_MainID))";
                }
            }

            itbuy += " GROUP BY [OfficeAutomation_Document_ITBuy_ID]"
                 + "          ,[OfficeAutomation_Document_ITBuy_MainID]"
                 + "          ,[OfficeAutomation_Document_ITBuy_Department]"
                 + "          ,[OfficeAutomation_Document_ITBuy_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ITBuy_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ITBuy_ApplyID]"
                 + "          ,[OfficeAutomation_Document_ITBuy_Remark]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-8

            string persinterests = " SELECT [OfficeAutomation_Document_PersInterests_ID] as ID"
                 + "          ,[OfficeAutomation_Document_PersInterests_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_PersInterests_Department] as Department"
                 + "          ,[OfficeAutomation_Document_PersInterests_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_PersInterests_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PersInterests_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PersInterests_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PersInterests_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PersInterests_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PersInterests_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_PersInterests_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_PersInterests_Remark] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_PersInterests] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_PersInterests_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_PersInterests_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_012") || approver != "") //M_20150623
                persinterests += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            persinterests += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_012"))
                persinterests += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_PersInterests_Apply='" + employee + "')";

            if (applicationDepartment != "")
                persinterests += " and OfficeAutomation_Document_PersInterests_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                persinterests += " and OfficeAutomation_Document_PersInterests_Apply = '" + applicant + "'";

            if (begin != "")
                persinterests += " and OfficeAutomation_Document_PersInterests_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                persinterests += " and OfficeAutomation_Document_PersInterests_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                persinterests += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    persinterests += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PersInterests_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        persinterests += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        persinterests += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                persinterests += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                persinterests += " and OfficeAutomation_Document_PersInterests_ApplyDetail like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                persinterests += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                persinterests += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                persinterests += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_PersInterests_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (intereststype != "")
            {
                if (intereststype == "7")
                {
                    persinterests += " and OfficeAutomation_Document_PersInterests_InterestsTypeID=1";
                }
                else if (intereststype == "8")
                {
                    persinterests += " and OfficeAutomation_Document_PersInterests_InterestsTypeID=4";
                }
                else if (intereststype == "9")
                {
                    persinterests += " and OfficeAutomation_Document_PersInterests_InterestsTypeID=2";
                }
                else if (intereststype == "10")
                {
                    persinterests += " and OfficeAutomation_Document_PersInterests_InterestsTypeID=10";
                }
                else if (intereststype == "11")
                {
                    persinterests += " and OfficeAutomation_Document_PersInterests_InterestsTypeID=11";
                }

            }
           
            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    persinterests += "  OR (OfficeAutomation_Document_PersInterests_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_PersInterests_MainID))";
                }
            }

            persinterests += " GROUP BY [OfficeAutomation_Document_PersInterests_ID]"
                 + "          ,[OfficeAutomation_Document_PersInterests_MainID]"
                 + "          ,[OfficeAutomation_Document_PersInterests_Department]"
                 + "          ,[OfficeAutomation_Document_PersInterests_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_PersInterests_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_PersInterests_Remark]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-9

            string NewPersInterests = " SELECT [OfficeAutomation_Document_NewPersInterests_ID] as ID"
     + "          ,[OfficeAutomation_Document_NewPersInterests_MainID] as MainID"
     + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
     + "          ,[OfficeAutomation_Document_NewPersInterests_Department] as Department"
     + "          ,[OfficeAutomation_Document_NewPersInterests_ApplyDate] as ApplyDate"
     + "          ,[OfficeAutomation_Document_NewPersInterests_Apply] as Apply"
     + "          ,toam.OfficeAutomation_SerialNumber"
     + "          ,toam.OfficeAutomation_Main_FlowStateID"
     + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_NewPersInterests_MainID) AS [waitfor]"
     + "          ,tdoad.OfficeAutomation_Document_Name"
     + "          ,[OfficeAutomation_Document_NewPersInterests_Building] as Remark"
     + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
     + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"

     + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_NewPersInterests] todi"
     + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_NewPersInterests_MainID"
     + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
     + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_NewPersInterests_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_012") || approver != "") //M_20150623
                NewPersInterests += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            NewPersInterests += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_012"))
                NewPersInterests += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_NewPersInterests_Apply='" + employee + "')";

            if (applicationDepartment != "")
                NewPersInterests += " and OfficeAutomation_Document_NewPersInterests_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                NewPersInterests += " and OfficeAutomation_Document_NewPersInterests_Apply = '" + applicant + "'";

            if (begin != "")
                NewPersInterests += " and OfficeAutomation_Document_NewPersInterests_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                NewPersInterests += " and OfficeAutomation_Document_NewPersInterests_ApplyDate<='" + end + " 23:59:59'";
            
            if (state != "")
                NewPersInterests += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    NewPersInterests += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_NewPersInterests_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        NewPersInterests += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        NewPersInterests += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                NewPersInterests += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                NewPersInterests += " and OfficeAutomation_Document_NewPersInterests_Building like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                NewPersInterests += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                NewPersInterests += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                NewPersInterests += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_NewPersInterests_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (intereststype != "")
            {
                if (intereststype == "7")
                {
                    NewPersInterests += " and OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (1,7)" ;
                }
                else if (intereststype == "8")
                {
                    NewPersInterests += " and OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (4,8)" ;
                }
                else if (intereststype == "9")
                {
                    NewPersInterests += " and OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (2,3,9)" ;
                }
                else if (intereststype == "10")
                {
                    NewPersInterests += " and OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (5,10)";
                }
                else if (intereststype == "11")
                {
                    NewPersInterests += " and OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (6,11)" ;
                }

            }
            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    NewPersInterests += "  OR (OfficeAutomation_Document_NewPersInterests_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_NewPersInterests_MainID))";
                }
            }

            NewPersInterests += " GROUP BY [OfficeAutomation_Document_NewPersInterests_ID]"
                 + "          ,[OfficeAutomation_Document_NewPersInterests_MainID]"
                 + "          ,[OfficeAutomation_Document_NewPersInterests_Department]"
                 + "          ,[OfficeAutomation_Document_NewPersInterests_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_NewPersInterests_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_NewPersInterests_Building]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-9.1

            string buybuilding = " SELECT [OfficeAutomation_Document_BuyBuilding_ID] as ID"
                 + "          ,[OfficeAutomation_Document_BuyBuilding_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_BuyBuilding_Department] as Department"
                 + "          ,[OfficeAutomation_Document_BuyBuilding_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_BuyBuilding_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_BuyBuilding_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_BuyBuilding_ApplyForName] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BuyBuilding] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BuyBuilding_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BuyBuilding_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_013") || approver != "") //M_20150623
                buybuilding += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            buybuilding += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_013"))
                buybuilding += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BuyBuilding_Apply='" + employee + "')";

            if (applicationDepartment != "")
                buybuilding += " and OfficeAutomation_Document_BuyBuilding_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                buybuilding += " and OfficeAutomation_Document_BuyBuilding_Apply = '" + applicant + "'";

            if (begin != "")
                buybuilding += " and OfficeAutomation_Document_BuyBuilding_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                buybuilding += " and OfficeAutomation_Document_BuyBuilding_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                buybuilding += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    buybuilding += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBuilding_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        buybuilding += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        buybuilding += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                buybuilding += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                buybuilding += " and OfficeAutomation_Document_BuyBuilding_ApplyForName like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                buybuilding += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                buybuilding += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                buybuilding += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_BuyBuilding_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    buybuilding += "  OR (OfficeAutomation_Document_BuyBuilding_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_BuyBuilding_MainID))";
                }
            }

            buybuilding += " GROUP BY [OfficeAutomation_Document_BuyBuilding_ID]"
                 + "          ,[OfficeAutomation_Document_BuyBuilding_MainID]"
                 + "          ,[OfficeAutomation_Document_BuyBuilding_Department]"
                 + "          ,[OfficeAutomation_Document_BuyBuilding_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_BuyBuilding_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_BuyBuilding_ApplyForName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-10

            string carallowance = " SELECT [OfficeAutomation_Document_CarAllowance_ID] as ID"
                 + "          ,[OfficeAutomation_Document_CarAllowance_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_CarAllowance_Department] as Department"
                 + "          ,[OfficeAutomation_Document_CarAllowance_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_CarAllowance_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_CarAllowance_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_CarAllowance_ApplyForName] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CarAllowance] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CarAllowance_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CarAllowance_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_014") || approver != "") //M_20150623
                carallowance += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            carallowance += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_014"))
                carallowance += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CarAllowance_Apply='" + employee + "')";

            if (applicationDepartment != "")
                carallowance += " and OfficeAutomation_Document_CarAllowance_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                carallowance += " and OfficeAutomation_Document_CarAllowance_Apply = '" + applicant + "'";

            if (begin != "")
                carallowance += " and OfficeAutomation_Document_CarAllowance_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                carallowance += " and OfficeAutomation_Document_CarAllowance_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                carallowance += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    carallowance += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CarAllowance_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        carallowance += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        carallowance += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                carallowance += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                carallowance += " and OfficeAutomation_Document_CarAllowance_ApplyForName like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                carallowance += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                carallowance += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                carallowance += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CarAllowance_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    carallowance += "  OR (OfficeAutomation_Document_CarAllowance_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CarAllowance_MainID))";
                }
            }

            carallowance += " GROUP BY [OfficeAutomation_Document_CarAllowance_ID]"
                 + "          ,[OfficeAutomation_Document_CarAllowance_MainID]"
                 + "          ,[OfficeAutomation_Document_CarAllowance_Department]"
                 + "          ,[OfficeAutomation_Document_CarAllowance_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_CarAllowance_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_CarAllowance_ApplyForName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-11

            string backcomm = " SELECT [OfficeAutomation_Document_BackComm_ID] as ID"
                 + "          ,[OfficeAutomation_Document_BackComm_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_BackComm_Department] as Department"
                 + "          ,[OfficeAutomation_Document_BackComm_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_BackComm_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BackComm_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BackComm_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BackComm_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BackComm_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BackComm_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_BackComm_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_BackComm_Remark] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BackComm] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BackComm_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BackComm_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_015") || approver != "") //M_20150623
                backcomm += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            backcomm += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_015"))
                backcomm += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BackComm_Apply='" + employee + "')";

            if (applicationDepartment != "")
                backcomm += " and OfficeAutomation_Document_BackComm_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                backcomm += " and OfficeAutomation_Document_BackComm_Apply = '" + applicant + "'";

            if (begin != "")
                backcomm += " and OfficeAutomation_Document_BackComm_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                backcomm += " and OfficeAutomation_Document_BackComm_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                backcomm += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    backcomm += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BackComm_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        backcomm += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        backcomm += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                backcomm += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                backcomm += " and ([OfficeAutomation_Document_BackComm_Reason] like '%" + keyWord + "%' OR [OfficeAutomation_Document_BackComm_Measure] like '%" + keyWord + "%')";

            if (willDelete) //M_DeleteAdd 20151230
                backcomm += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                backcomm += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                backcomm += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_BackComm_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    backcomm += "  OR (OfficeAutomation_Document_BackComm_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_BackComm_MainID))";
                }
            }

            backcomm += " GROUP BY [OfficeAutomation_Document_BackComm_ID]"
                 + "          ,[OfficeAutomation_Document_BackComm_MainID]"
                 + "          ,[OfficeAutomation_Document_BackComm_Department]"
                 + "          ,[OfficeAutomation_Document_BackComm_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_BackComm_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_BackComm_Remark]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-12

            string baddebts = " SELECT [OfficeAutomation_Document_BadDebts_ID] as ID"
                 + "          ,[OfficeAutomation_Document_BadDebts_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_BadDebts_Department] as Department"
                 + "          ,[OfficeAutomation_Document_BadDebts_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_BadDebts_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_BadDebts_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_BadDebts_Remark] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BadDebts] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BadDebts_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BadDebts_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_016") || approver != "") //M_20150623
                baddebts += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            baddebts += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_016"))
                baddebts += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BadDebts_Apply='" + employee + "')";

            if (applicationDepartment != "")
                baddebts += " and OfficeAutomation_Document_BadDebts_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                baddebts += " and OfficeAutomation_Document_BadDebts_Apply = '" + applicant + "'";

            if (begin != "" && end != "")
                baddebts += " and OfficeAutomation_Document_BadDebts_ApplyDate between '" + begin + " 00:00:00' and '" + end + " 23:59:59'";

            if (state != "")
                baddebts += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    baddebts += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BadDebts_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        baddebts += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        baddebts += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                baddebts += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";
            //20160503 新增OfficeAutomation_Document_BadDebts_Building关键字的模糊搜索
            if (keyWord != "")
                baddebts += " and (([OfficeAutomation_Document_BadDebts_Reason] like '%" + keyWord + "%') or ([OfficeAutomation_Document_BadDebts_Building] like '%" + keyWord + "%') or ([OfficeAutomation_Document_BadDebts_Remark] like '%" + keyWord + "%')) ";

            if (willDelete) //M_DeleteAdd 20151230
                baddebts += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                baddebts += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                baddebts += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_BadDebts_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    baddebts += "  OR (OfficeAutomation_Document_BadDebts_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_BadDebts_MainID))";
                }
            }

            baddebts += " GROUP BY [OfficeAutomation_Document_BadDebts_ID]"
                 + "          ,[OfficeAutomation_Document_BadDebts_MainID]"
                 + "          ,[OfficeAutomation_Document_BadDebts_Department]"
                 + "          ,[OfficeAutomation_Document_BadDebts_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_BadDebts_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_BadDebts_Remark]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-13

            string reducecomm = " SELECT [OfficeAutomation_Document_ReduceComm_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ReduceComm_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ReduceComm_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ReduceComm_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ReduceComm_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ReduceComm_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ReduceComm_Subject] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ReduceComm] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ReduceComm_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ReduceComm_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_017") || approver != "") //M_20150623
                reducecomm += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            reducecomm += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_017"))
                reducecomm += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ReduceComm_Apply='" + employee + "')";

            if (applicationDepartment != "")
                reducecomm += " and OfficeAutomation_Document_ReduceComm_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                reducecomm += " and OfficeAutomation_Document_ReduceComm_Apply = '" + applicant + "'";

            if (begin != "")
                reducecomm += " and OfficeAutomation_Document_ReduceComm_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                reducecomm += " and OfficeAutomation_Document_ReduceComm_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                reducecomm += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    reducecomm += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ReduceComm_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        reducecomm += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        reducecomm += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                reducecomm += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                reducecomm += " and [OfficeAutomation_Document_ReduceComm_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                reducecomm += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                reducecomm += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                reducecomm += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ReduceComm_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    reducecomm += "  OR (OfficeAutomation_Document_ReduceComm_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ReduceComm_MainID))";
                }
            }

            reducecomm += " GROUP BY [OfficeAutomation_Document_ReduceComm_ID]"
                 + "          ,[OfficeAutomation_Document_ReduceComm_MainID]"
                 + "          ,[OfficeAutomation_Document_ReduceComm_Department]"
                 + "          ,[OfficeAutomation_Document_ReduceComm_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ReduceComm_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ReduceComm_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-14

            string projcost = " SELECT [OfficeAutomation_Document_ProjCost_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ProjCost_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ProjCost_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ProjCost_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ProjCost_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ProjCost_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,([OfficeAutomation_Document_ProjCost_Project] + ISNULL(OfficeAutomation_Document_ProjCost_Remark,'')) as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjCost] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjCost_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjCost_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_018") || approver != "") //M_20150623
                projcost += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            projcost += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_018"))
                projcost += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjCost_Apply='" + employee + "')";

            if (applicationDepartment != "")
                projcost += " and OfficeAutomation_Document_ProjCost_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                projcost += " and OfficeAutomation_Document_ProjCost_Apply = '" + applicant + "'";

            if (begin != "")
                projcost += " and OfficeAutomation_Document_ProjCost_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                projcost += " and OfficeAutomation_Document_ProjCost_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                projcost += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    projcost += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        projcost += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        projcost += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                projcost += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                projcost += " and [OfficeAutomation_Document_ProjCost_Project] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                projcost += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                projcost += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                projcost += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjCost_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    projcost += "  OR (OfficeAutomation_Document_ProjCost_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjCost_MainID))";
                }
            }

            projcost += " GROUP BY [OfficeAutomation_Document_ProjCost_ID]"
                 + "          ,[OfficeAutomation_Document_ProjCost_MainID]"
                 + "          ,[OfficeAutomation_Document_ProjCost_Department]"
                 + "          ,[OfficeAutomation_Document_ProjCost_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ProjCost_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjCost_Project]"
                 + "          ,[OfficeAutomation_Document_ProjCost_Remark]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-15

            string coopcost = " SELECT [OfficeAutomation_Document_CoopCost_ID] as ID"
                 + "          ,[OfficeAutomation_Document_CoopCost_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_CoopCost_Department] as Department"
                 + "          ,[OfficeAutomation_Document_CoopCost_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_CoopCost_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_CoopCost_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_CoopCost_PropertyName] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CoopCost] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CoopCost_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CoopCost_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_019") || approver != "") //M_20150623
                coopcost += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            coopcost += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_019"))
                coopcost += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CoopCost_Apply='" + employee + "')";

            if (applicationDepartment != "")
                coopcost += " and OfficeAutomation_Document_CoopCost_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                coopcost += " and OfficeAutomation_Document_CoopCost_Apply = '" + applicant + "'";

            if (begin != "")
                coopcost += " and OfficeAutomation_Document_CoopCost_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                coopcost += " and OfficeAutomation_Document_CoopCost_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                coopcost += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    coopcost += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CoopCost_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        coopcost += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        coopcost += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                coopcost += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                coopcost += " and [OfficeAutomation_Document_CoopCost_PropertyName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                coopcost += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                coopcost += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                coopcost += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CoopCost_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    coopcost += "  OR (OfficeAutomation_Document_CoopCost_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CoopCost_MainID))";
                }
            }

            coopcost += " GROUP BY [OfficeAutomation_Document_CoopCost_ID]"
                 + "          ,[OfficeAutomation_Document_CoopCost_MainID]"
                 + "          ,[OfficeAutomation_Document_CoopCost_Department]"
                 + "          ,[OfficeAutomation_Document_CoopCost_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_CoopCost_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_CoopCost_PropertyName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-16

            string undertakeproj = " SELECT [OfficeAutomation_Document_UndertakeProj_ID] as ID"
                 + "          ,[OfficeAutomation_Document_UndertakeProj_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_UndertakeProj_Department] as Department"
                 + "          ,[OfficeAutomation_Document_UndertakeProj_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_UndertakeProj_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_UndertakeProj_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,OfficeAutomation_Document_UndertakeProj_Project as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_UndertakeProj] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_UndertakeProj_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_UndertakeProj_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_020") || approver != "") //M_20150623
                undertakeproj += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            undertakeproj += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_020"))
                undertakeproj += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_UndertakeProj_Apply='" + employee + "')";

            if (applicationDepartment != "")
                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_Apply = '" + applicant + "'";

            if (begin != "")
                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                undertakeproj += " and OfficeAutomation_Document_UndertakeProj_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                undertakeproj += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    undertakeproj += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UndertakeProj_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        undertakeproj += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        undertakeproj += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                undertakeproj += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                undertakeproj += " and [OfficeAutomation_Document_UndertakeProj_Project] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230 //*xx
                undertakeproj += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                undertakeproj += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                undertakeproj += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_UndertakeProj_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    undertakeproj += "  OR (OfficeAutomation_Document_UndertakeProj_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_UndertakeProj_MainID))";
                }
            }

            undertakeproj += " GROUP BY [OfficeAutomation_Document_UndertakeProj_ID]"
                 + "          ,[OfficeAutomation_Document_UndertakeProj_MainID]"
                 + "          ,[OfficeAutomation_Document_UndertakeProj_Department]"
                 + "          ,[OfficeAutomation_Document_UndertakeProj_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_UndertakeProj_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,OfficeAutomation_Document_UndertakeProj_Project"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-17

            string extrabonus = " SELECT [OfficeAutomation_Document_ExtraBonus_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ExtraBonus_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ExtraBonus_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ExtraBonus_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ExtraBonus_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ExtraBonus_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ExtraBonus_Project] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ExtraBonus] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ExtraBonus_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ExtraBonus_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_021") || approver != "") //M_20150623
                extrabonus += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            extrabonus += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_021"))
                extrabonus += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ExtraBonus_Apply='" + employee + "')";

            if (applicationDepartment != "")
                extrabonus += " and OfficeAutomation_Document_ExtraBonus_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                extrabonus += " and OfficeAutomation_Document_ExtraBonus_Apply = '" + applicant + "'";

            if (begin != "")
                extrabonus += " and OfficeAutomation_Document_ExtraBonus_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                extrabonus += " and OfficeAutomation_Document_ExtraBonus_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                extrabonus += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    extrabonus += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ExtraBonus_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        extrabonus += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        extrabonus += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }
            if (serialNumber != "")
                extrabonus += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                extrabonus += " and [OfficeAutomation_Document_ExtraBonus_Project] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                extrabonus += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                extrabonus += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                extrabonus += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ExtraBonus_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    extrabonus += "  OR (OfficeAutomation_Document_ExtraBonus_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ExtraBonus_MainID))";
                }
            }

            extrabonus += " GROUP BY [OfficeAutomation_Document_ExtraBonus_ID]"
                 + "          ,[OfficeAutomation_Document_ExtraBonus_MainID]"
                 + "          ,[OfficeAutomation_Document_ExtraBonus_Department]"
                 + "          ,[OfficeAutomation_Document_ExtraBonus_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ExtraBonus_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ExtraBonus_Project]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-18

            string resumebusi = " SELECT [OfficeAutomation_Document_ResumeBusi_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ResumeBusi_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ResumeBusi_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ResumeBusi_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ResumeBusi_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ResumeBusi_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ResumeBusi_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ResumeBusi_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ResumeBusi_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ResumeBusi_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ResumeBusi_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,([OfficeAutomation_Document_ResumeBusi_DepartmentName] + isnull(toam.OfficeAutomation_Main_Sremark,'')) as Remark" //M_Remark：Win 20151109
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ResumeBusi] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ResumeBusi_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ResumeBusi_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_022") || approver != "") //M_20150623
                resumebusi += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            resumebusi += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_022"))
                resumebusi += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ResumeBusi_Apply='" + employee + "')";

            if (applicationDepartment != "")
                resumebusi += " and OfficeAutomation_Document_ResumeBusi_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                resumebusi += " and OfficeAutomation_Document_ResumeBusi_Apply = '" + applicant + "'";

            if (begin != "")
                resumebusi += " and OfficeAutomation_Document_ResumeBusi_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                resumebusi += " and OfficeAutomation_Document_ResumeBusi_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                resumebusi += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    resumebusi += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ResumeBusi_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        resumebusi += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        resumebusi += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                resumebusi += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                resumebusi += " and [OfficeAutomation_Document_ResumeBusi_DepartmentName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                resumebusi += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                resumebusi += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                resumebusi += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ResumeBusi_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    resumebusi += "  OR (OfficeAutomation_Document_ResumeBusi_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ResumeBusi_MainID))";
                }
            }

            resumebusi += " GROUP BY [OfficeAutomation_Document_ResumeBusi_ID]"
                 + "          ,[OfficeAutomation_Document_ResumeBusi_MainID]"
                 + "          ,[OfficeAutomation_Document_ResumeBusi_Department]"
                 + "          ,[OfficeAutomation_Document_ResumeBusi_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ResumeBusi_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_Sremark" //M_Remark：Win 20151109
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ResumeBusi_DepartmentName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-19

            string withdrawshop = " SELECT [OfficeAutomation_Document_WithdrawShop_ID] as ID"
                 + "          ,[OfficeAutomation_Document_WithdrawShop_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_WithdrawShop_Department] as Department"
                 + "          ,[OfficeAutomation_Document_WithdrawShop_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_WithdrawShop_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WithdrawShop_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WithdrawShop_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WithdrawShop_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WithdrawShop_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WithdrawShop_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_WithdrawShop_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,([OfficeAutomation_Document_WithdrawShop_DepartmentName] + isnull(toam.OfficeAutomation_Main_Sremark,'')) as Remark" //M_Remark：Win 20151109
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_WithdrawShop] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_WithdrawShop_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_WithdrawShop_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_023") || approver != "") //M_20150623
                withdrawshop += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            withdrawshop += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_023"))
                withdrawshop += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_WithdrawShop_Apply='" + employee + "')";

            if (applicationDepartment != "")
                withdrawshop += " and OfficeAutomation_Document_WithdrawShop_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                withdrawshop += " and OfficeAutomation_Document_WithdrawShop_Apply = '" + applicant + "'";

            if (begin != "")
                withdrawshop += " and OfficeAutomation_Document_WithdrawShop_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                withdrawshop += " and OfficeAutomation_Document_WithdrawShop_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                withdrawshop += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    withdrawshop += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WithdrawShop_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        withdrawshop += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        withdrawshop += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                withdrawshop += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                withdrawshop += " and [OfficeAutomation_Document_WithdrawShop_DepartmentName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                withdrawshop += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                withdrawshop += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                withdrawshop += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_WithdrawShop_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    withdrawshop += "  OR (OfficeAutomation_Document_WithdrawShop_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_WithdrawShop_MainID))";
                }
            }

            withdrawshop += " GROUP BY [OfficeAutomation_Document_WithdrawShop_ID]"
                 + "          ,[OfficeAutomation_Document_WithdrawShop_MainID]"
                 + "          ,[OfficeAutomation_Document_WithdrawShop_Department]"
                 + "          ,[OfficeAutomation_Document_WithdrawShop_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_WithdrawShop_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_Sremark" //M_Remark：Win 20151109
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_WithdrawShop_DepartmentName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-20

            string suspendbusi = " SELECT [OfficeAutomation_Document_SuspendBusi_ID] as ID"
                 + "          ,[OfficeAutomation_Document_SuspendBusi_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_SuspendBusi_Department] as Department"
                 + "          ,[OfficeAutomation_Document_SuspendBusi_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_SuspendBusi_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SuspendBusi_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SuspendBusi_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SuspendBusi_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SuspendBusi_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SuspendBusi_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_SuspendBusi_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,([OfficeAutomation_Document_SuspendBusi_DepartmentName] + isnull(toam.OfficeAutomation_Main_Sremark,'')) as Remark" //M_Remark：Win 20151109
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SuspendBusi] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SuspendBusi_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SuspendBusi_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_024") || approver != "") //M_20150623
                suspendbusi += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            suspendbusi += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_024"))
                suspendbusi += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SuspendBusi_Apply='" + employee + "')";

            if (applicationDepartment != "")
                suspendbusi += " and OfficeAutomation_Document_SuspendBusi_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                suspendbusi += " and OfficeAutomation_Document_SuspendBusi_Apply = '" + applicant + "'";

            if (begin != "")
                suspendbusi += " and OfficeAutomation_Document_SuspendBusi_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                suspendbusi += " and OfficeAutomation_Document_SuspendBusi_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                suspendbusi += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    suspendbusi += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SuspendBusi_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        suspendbusi += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        suspendbusi += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                suspendbusi += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                suspendbusi += " and [OfficeAutomation_Document_SuspendBusi_DepartmentName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                suspendbusi += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                suspendbusi += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                suspendbusi += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_SuspendBusi_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    suspendbusi += "  OR (OfficeAutomation_Document_SuspendBusi_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_SuspendBusi_MainID))";
                }
            }

            suspendbusi += " GROUP BY [OfficeAutomation_Document_SuspendBusi_ID]"
                 + "          ,[OfficeAutomation_Document_SuspendBusi_MainID]"
                 + "          ,[OfficeAutomation_Document_SuspendBusi_Department]"
                 + "          ,[OfficeAutomation_Document_SuspendBusi_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_SuspendBusi_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_Sremark" //M_Remark：Win 20151109
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_SuspendBusi_DepartmentName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-21

            string projagentclause = " SELECT [OfficeAutomation_Document_ProjAgentClause_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ProjAgentClause_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ProjAgentClause_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ProjAgentClause_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ProjAgentClause_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ProjAgentClause_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjAgentClause_ProjName] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjAgentClause] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjAgentClause_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjAgentClause_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_025") || approver != "") //M_20150623
                projagentclause += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            projagentclause += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_025"))
                projagentclause += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjAgentClause_Apply='" + employee + "')";

            if (applicationDepartment != "")
                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_Apply = '" + applicant + "'";

            if (begin != "")
                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                projagentclause += " and OfficeAutomation_Document_ProjAgentClause_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                projagentclause += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    projagentclause += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjAgentClause_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        projagentclause += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        projagentclause += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                projagentclause += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                projagentclause += " and [OfficeAutomation_Document_ProjAgentClause_ProjName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                projagentclause += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                projagentclause += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                projagentclause += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjAgentClause_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    projagentclause += "  OR (OfficeAutomation_Document_ProjAgentClause_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjAgentClause_MainID))";
                }
            }

            projagentclause += " GROUP BY [OfficeAutomation_Document_ProjAgentClause_ID]"
                 + "          ,[OfficeAutomation_Document_ProjAgentClause_MainID]"
                 + "          ,[OfficeAutomation_Document_ProjAgentClause_Department]"
                 + "          ,[OfficeAutomation_Document_ProjAgentClause_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ProjAgentClause_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjAgentClause_ProjName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-22

            string projworkcloth = " SELECT [OfficeAutomation_Document_ProjWorkCloth_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjWorkCloth_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjWorkCloth_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjWorkCloth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjWorkCloth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjWorkCloth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ProjWorkCloth_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_ProjName] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjWorkCloth] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjWorkCloth_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjWorkCloth_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_026") || approver != "") //M_20150623
                projworkcloth += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            projworkcloth += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_026"))
                projworkcloth += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjWorkCloth_Apply='" + employee + "')";

            if (applicationDepartment != "")
                projworkcloth += " and OfficeAutomation_Document_ProjWorkCloth_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                projworkcloth += " and OfficeAutomation_Document_ProjWorkCloth_Apply = '" + applicant + "'";

            if (begin != "")
                projworkcloth += " and OfficeAutomation_Document_ProjWorkCloth_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                projworkcloth += " and OfficeAutomation_Document_ProjWorkCloth_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                projworkcloth += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    projworkcloth += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjWorkCloth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        projworkcloth += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        projworkcloth += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                projworkcloth += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                projworkcloth += " and [OfficeAutomation_Document_ProjWorkCloth_ProjName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                projworkcloth += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                projworkcloth += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                projworkcloth += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjWorkCloth_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    projworkcloth += "  OR (OfficeAutomation_Document_ProjWorkCloth_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjWorkCloth_MainID))";
                }
            }

            projworkcloth += " GROUP BY [OfficeAutomation_Document_ProjWorkCloth_ID]"
                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_MainID]"
                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_Department]"
                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjWorkCloth_ProjName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-23

            string projdormsubsiby = " SELECT [OfficeAutomation_Document_ProjDormSubsiby_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ProjDormSubsiby_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjDormSubsiby_ProjName] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjDormSubsiby] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjDormSubsiby_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                 + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjDormSubsiby_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_027") || approver != "") //M_20150623
                projdormsubsiby += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            projdormsubsiby += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_027"))
                projdormsubsiby += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjDormSubsiby_Apply='" + employee + "')";

            if (applicationDepartment != "")
                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_Apply = '" + applicant + "'";

            if (begin != "")
                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                projdormsubsiby += " and OfficeAutomation_Document_ProjDormSubsiby_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                projdormsubsiby += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    projdormsubsiby += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjDormSubsiby_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        projdormsubsiby += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        projdormsubsiby += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                projdormsubsiby += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                projdormsubsiby += " and [OfficeAutomation_Document_ProjDormSubsiby_ProjName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                projdormsubsiby += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                projdormsubsiby += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                projdormsubsiby += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjDormSubsiby_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    projdormsubsiby += "  OR (OfficeAutomation_Document_ProjDormSubsiby_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjDormSubsiby_MainID))";
                }
            }

            projdormsubsiby += " GROUP BY [OfficeAutomation_Document_ProjDormSubsiby_ID]"
            + ",[OfficeAutomation_Document_ProjDormSubsiby_MainID]"
            + ",[OfficeAutomation_Document_ProjDormSubsiby_Department]"
            + ",[OfficeAutomation_Document_ProjDormSubsiby_ApplyDate]"
            + ",[OfficeAutomation_Document_ProjDormSubsiby_Apply]"
            + ",toam.OfficeAutomation_SerialNumber"
            + ",toam.OfficeAutomation_Main_FlowStateID"
            + ",tdoad.OfficeAutomation_Document_Name"
            + ",[OfficeAutomation_Document_ProjDormSubsiby_ProjName]"
            + ",toam.[OfficeAutomation_SerialNumber]";//*-2

            string projrepodata = " SELECT [OfficeAutomation_Document_ProjRepoData_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ProjRepoData_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ProjRepoData_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ProjRepoData_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ProjRepoData_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ProjRepoData_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjRepoData_ProjName] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjRepoData] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjRepoData_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjRepoData_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_028") || approver != "") //M_20150623
                projrepodata += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            projrepodata += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_028"))
                projrepodata += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjRepoData_Apply='" + employee + "')";

            if (applicationDepartment != "")
                projrepodata += " and OfficeAutomation_Document_ProjRepoData_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                projrepodata += " and OfficeAutomation_Document_ProjRepoData_Apply = '" + applicant + "'";

            if (begin != "")
                projrepodata += " and OfficeAutomation_Document_ProjRepoData_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                projrepodata += " and OfficeAutomation_Document_ProjRepoData_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                projrepodata += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    projrepodata += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjRepoData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        projrepodata += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        projrepodata += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                projrepodata += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                projrepodata += " and [OfficeAutomation_Document_ProjRepoData_ProjName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                projrepodata += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                projrepodata += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                projrepodata += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjRepoData_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    projrepodata += "  OR (OfficeAutomation_Document_ProjRepoData_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjRepoData_MainID))";
                }
            }

            projrepodata += " GROUP BY [OfficeAutomation_Document_ProjRepoData_ID]"
                 + "          ,[OfficeAutomation_Document_ProjRepoData_MainID]"
                 + "          ,[OfficeAutomation_Document_ProjRepoData_Department]"
                 + "          ,[OfficeAutomation_Document_ProjRepoData_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ProjRepoData_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjRepoData_ProjName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-24

            string projlinkrepodata = " SELECT [OfficeAutomation_Document_ProjLinkRepoData_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //+ "                      FROM   t_OfficeAutomation_Flow f"
                 //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID]"
                 //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ProjLinkRepoData_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_ProjName] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjLinkRepoData] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjLinkRepoData_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjLinkRepoData_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_029") || approver != "") //M_20150623
                projlinkrepodata += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            projlinkrepodata += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_029"))
                projlinkrepodata += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjLinkRepoData_Apply='" + employee + "')";

            if (applicationDepartment != "")
                projlinkrepodata += " and OfficeAutomation_Document_ProjLinkRepoData_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                projlinkrepodata += " and OfficeAutomation_Document_ProjLinkRepoData_Apply = '" + applicant + "'";

            if (begin != "")
                projlinkrepodata += " and OfficeAutomation_Document_ProjLinkRepoData_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                projlinkrepodata += " and OfficeAutomation_Document_ProjLinkRepoData_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                projlinkrepodata += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    projlinkrepodata += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjLinkRepoData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        projlinkrepodata += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        projlinkrepodata += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                projlinkrepodata += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                projlinkrepodata += " and [OfficeAutomation_Document_ProjLinkRepoData_ProjName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                projlinkrepodata += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                projlinkrepodata += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                projlinkrepodata += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjLinkRepoData_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    projlinkrepodata += "  or (OfficeAutomation_Document_ProjLinkRepoData_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjLinkRepoData_MainID))";
                }
            }

            projlinkrepodata += " GROUP BY [OfficeAutomation_Document_ProjLinkRepoData_ID]"
                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_MainID]"
                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Department]"
                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjLinkRepoData_ProjName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-25

            string ChangeData = " SELECT [OfficeAutomation_Document_ChangeData_ID] as ID"
                + "          ,[OfficeAutomation_Document_ChangeData_MainID] as MainID"
                + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                + "          ,[OfficeAutomation_Document_ChangeData_Department] as Department"
                + "          ,[OfficeAutomation_Document_ChangeData_ApplyDate] as ApplyDate"
                + "          ,[OfficeAutomation_Document_ChangeData_Apply] as Apply"
                + "          ,toam.OfficeAutomation_SerialNumber"
                + "          ,toam.OfficeAutomation_Main_FlowStateID"
                //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                //+ "                      FROM   t_OfficeAutomation_Flow f"
                //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeData_MainID]"
                //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                //+ "                      FROM   t_OfficeAutomation_Flow f"
                //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeData_MainID]"
                //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                // + "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                // + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                // + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                // + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                // + "           END AS [waitfor]"
                + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ChangeData_MainID) AS [waitfor]"
                + "          ,tdoad.OfficeAutomation_Document_Name"
                + "          ,([OfficeAutomation_Document_ChangeData_Reason] + ISNULL(OfficeAutomation_Document_ChangeData_Remark,'')) as Remark"//*-
                + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ChangeData] todi"
                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ChangeData_MainID"
                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ChangeData_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_032") || approver != "") //M_20150623
                ChangeData += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            ChangeData += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_032"))
                ChangeData += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ChangeData_Apply='" + employee + "')";

            if (applicationDepartment != "")
                ChangeData += " and OfficeAutomation_Document_ChangeData_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                ChangeData += " and OfficeAutomation_Document_ChangeData_Apply = '" + applicant + "'";

            if (begin != "")
                ChangeData += " and OfficeAutomation_Document_ChangeData_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                ChangeData += " and OfficeAutomation_Document_ChangeData_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                ChangeData += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    ChangeData += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        ChangeData += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        ChangeData += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                ChangeData += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                ChangeData += " and ([OfficeAutomation_Document_ChangeData_Reason] like '%" + keyWord + "%' or OfficeAutomation_Document_ChangeData_Remark like '%" + keyWord + "%')";

            if (willDelete) //M_DeleteAdd 20151230
                ChangeData += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                ChangeData += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                ChangeData += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ChangeData_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    ChangeData += "  OR (OfficeAutomation_Document_ChangeData_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ChangeData_MainID))";
                }
            }

            ChangeData += " GROUP BY [OfficeAutomation_Document_ChangeData_ID]"
                 + "          ,[OfficeAutomation_Document_ChangeData_MainID]"
                 + "          ,[OfficeAutomation_Document_ChangeData_Department]"
                 + "          ,[OfficeAutomation_Document_ChangeData_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ChangeData_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ChangeData_Reason]"
                 + "          ,OfficeAutomation_Document_ChangeData_Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-26

            string CommissionAdjust = " SELECT [OfficeAutomation_Document_CommissionAdjust_ID] as ID"
                + "          ,[OfficeAutomation_Document_CommissionAdjust_MainID] as MainID"
                + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                + "          ,[OfficeAutomation_Document_CommissionAdjust_Department] as Department"
                + "          ,[OfficeAutomation_Document_CommissionAdjust_ApplyDate] as ApplyDate"
                + "          ,[OfficeAutomation_Document_CommissionAdjust_Apply] as Apply"
                + "          ,toam.OfficeAutomation_SerialNumber"
                + "          ,toam.OfficeAutomation_Main_FlowStateID"
                //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                //+ "                      FROM   t_OfficeAutomation_Flow f"
                //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAdjust_MainID]"
                //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                //+ "                      FROM   t_OfficeAutomation_Flow f"
                //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAdjust_MainID]"
                //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                // + "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                // + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAdjust_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                // + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAdjust_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                // + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAdjust_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                // + "           END AS [waitfor]"
                + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_CommissionAdjust_MainID) AS [waitfor]"
                + "          ,tdoad.OfficeAutomation_Document_Name"
                + "          ,([OfficeAutomation_Document_CommissionAdjust_Building] + ' 坏账：' + OfficeAutomation_Document_CommissionAdjust_AjustComm + ISNULL(OfficeAutomation_Document_CommissionAdjust_Remark,'')) as Remark"
                + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CommissionAdjust] todi"
                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CommissionAdjust_MainID"
                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CommissionAdjust_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_033") || approver != "") //M_20150623
                CommissionAdjust += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            CommissionAdjust += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_033"))
                CommissionAdjust += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CommissionAdjust_Apply='" + employee + "')";

            if (applicationDepartment != "")
                CommissionAdjust += " and OfficeAutomation_Document_CommissionAdjust_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                CommissionAdjust += " and OfficeAutomation_Document_CommissionAdjust_Apply = '" + applicant + "'";

            if (begin != "")
                CommissionAdjust += " and OfficeAutomation_Document_CommissionAdjust_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                CommissionAdjust += " and OfficeAutomation_Document_CommissionAdjust_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                CommissionAdjust += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    CommissionAdjust += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAdjust_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        CommissionAdjust += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        CommissionAdjust += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                CommissionAdjust += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                CommissionAdjust += " and ([OfficeAutomation_Document_CommissionAdjust_Building] like '%" + keyWord + "%' or OfficeAutomation_Document_CommissionAdjust_Remark like '%" + keyWord + "%' or OfficeAutomation_Document_CommissionAdjust_AjustComm like '%" + keyWord + "%')";

            if (willDelete) //M_DeleteAdd 20151230
                CommissionAdjust += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                CommissionAdjust += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                CommissionAdjust += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CommissionAdjust_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    CommissionAdjust += "  OR (OfficeAutomation_Document_CommissionAdjust_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CommissionAdjust_MainID))";
                }
            }

            CommissionAdjust += " GROUP BY [OfficeAutomation_Document_CommissionAdjust_ID]"
                 + "          ,[OfficeAutomation_Document_CommissionAdjust_MainID]"
                 + "          ,[OfficeAutomation_Document_CommissionAdjust_Department]"
                 + "          ,[OfficeAutomation_Document_CommissionAdjust_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_CommissionAdjust_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_CommissionAdjust_Building]"
                 + "          ,[OfficeAutomation_Document_CommissionAdjust_AjustComm]"
                 + "          ,OfficeAutomation_Document_CommissionAdjust_Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-27

            string WirelessFixedLine = " SELECT [OfficeAutomation_Document_WirelessFixedLine_ID] as ID"
                + "          ,[OfficeAutomation_Document_WirelessFixedLine_MainID] as MainID"
                + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                + "          ,'项目部' as Department"
                + "          ,[OfficeAutomation_Document_WirelessFixedLine_ApplyDate] as ApplyDate"
                + "          ,[OfficeAutomation_Document_WirelessFixedLine_Apply] as Apply"
                + "          ,toam.OfficeAutomation_SerialNumber"
                + "          ,toam.OfficeAutomation_Main_FlowStateID"
                //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                //+ "                      FROM   t_OfficeAutomation_Flow f"
                //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WirelessFixedLine_MainID]"
                //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                //+ "                      FROM   t_OfficeAutomation_Flow f"
                //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WirelessFixedLine_MainID]"
                //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                // + "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                // + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WirelessFixedLine_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                // + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WirelessFixedLine_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                // + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WirelessFixedLine_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                // + "           END AS [waitfor]"
                + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_WirelessFixedLine_MainID) AS [waitfor]"
                + "          ,tdoad.OfficeAutomation_Document_Name"
                + "          ,[OfficeAutomation_Document_WirelessFixedLine_ApplyID] as Remark"
                + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_WirelessFixedLine] todi"
                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_WirelessFixedLine_MainID"
                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_WirelessFixedLine_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_034") || approver != "") //M_20150623
                WirelessFixedLine += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            WirelessFixedLine += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_034"))
                WirelessFixedLine += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_WirelessFixedLine_Apply='" + employee + "')";

            //if (applicationDepartment != "")
            //    WirelessFixedLine += " and OfficeAutomation_Document_WirelessFixedLine_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                WirelessFixedLine += " and OfficeAutomation_Document_WirelessFixedLine_Apply = '" + applicant + "'";

            if (begin != "")
                WirelessFixedLine += " and OfficeAutomation_Document_WirelessFixedLine_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                WirelessFixedLine += " and OfficeAutomation_Document_WirelessFixedLine_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                WirelessFixedLine += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    WirelessFixedLine += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WirelessFixedLine_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        WirelessFixedLine += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        WirelessFixedLine += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                WirelessFixedLine += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                WirelessFixedLine += " and [OfficeAutomation_Document_WirelessFixedLine_ApplyID] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                WirelessFixedLine += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                WirelessFixedLine += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                WirelessFixedLine += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_WirelessFixedLine_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    WirelessFixedLine += "  OR (OfficeAutomation_Document_WirelessFixedLine_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_WirelessFixedLine_MainID))";
                }
            }

            WirelessFixedLine += " GROUP BY [OfficeAutomation_Document_WirelessFixedLine_ID]"
                 + "          ,[OfficeAutomation_Document_WirelessFixedLine_MainID]"
                 + "          ,[OfficeAutomation_Document_WirelessFixedLine_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_WirelessFixedLine_Apply]"
                 + "          ,[OfficeAutomation_Document_WirelessFixedLine_SumNumber]"
                 + "          ,[OfficeAutomation_Document_WirelessFixedLine_ApplyID]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-28

            string FurtherEducation = " SELECT [OfficeAutomation_Document_FurtherEducation_ID] as ID"
                    + "          ,[OfficeAutomation_Document_FurtherEducation_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_FurtherEducation_Department] as Department"
                    + "          ,[OfficeAutomation_Document_FurtherEducation_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_FurtherEducation_Name] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //   + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //   + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //   + "                      FROM   t_OfficeAutomation_Flow f"
                 //   + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID]"
                 //   + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //   + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //   + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //   + "                      FROM   t_OfficeAutomation_Flow f"
                 //   + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID]"
                 //   + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //   + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_FurtherEducation_MainID) AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_FurtherEducation_School] as Remark"
                    + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                    + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_FurtherEducation] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_FurtherEducation_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_FurtherEducation_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_035") || approver != "") //M_20150623
                FurtherEducation += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            FurtherEducation += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_035"))
                FurtherEducation += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_FurtherEducation_Name = '" + employee + "' or OfficeAutomation_Document_FurtherEducation_Apply='" + employee + "')";

            if (applicationDepartment != "")
                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_Name = '" + applicant + "'";

            if (begin != "")
                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                FurtherEducation += " and OfficeAutomation_Document_FurtherEducation_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                FurtherEducation += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    FurtherEducation += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_FurtherEducation_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        FurtherEducation += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        FurtherEducation += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                FurtherEducation += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                FurtherEducation += " and [OfficeAutomation_Document_FurtherEducation_School] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                FurtherEducation += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                FurtherEducation += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                FurtherEducation += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_FurtherEducation_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    FurtherEducation += "  OR (OfficeAutomation_Document_FurtherEducation_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_FurtherEducation_MainID))";
                }
            }

            FurtherEducation += " GROUP BY [OfficeAutomation_Document_FurtherEducation_ID]"
                 + "          ,[OfficeAutomation_Document_FurtherEducation_MainID]"
                 + "          ,[OfficeAutomation_Document_FurtherEducation_Department]"
                 + "          ,[OfficeAutomation_Document_FurtherEducation_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_FurtherEducation_Name]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_FurtherEducation_School]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-29

            string SpecialNumber = " SELECT [OfficeAutomation_Document_SpecialNumber_ID] as ID"
                    + "          ,[OfficeAutomation_Document_SpecialNumber_MainID] as MainID"
                    + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                    + "          ,[OfficeAutomation_Document_SpecialNumber_Department] as Department"
                    + "          ,[OfficeAutomation_Document_SpecialNumber_ApplyDate] as ApplyDate"
                    + "          ,[OfficeAutomation_Document_SpecialNumber_Apply] as Apply"
                    + "          ,toam.OfficeAutomation_SerialNumber"
                    + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 //   + "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                 //   + "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //   + "                      FROM   t_OfficeAutomation_Flow f"
                 //   + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID]"
                 //   + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //   + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //   + "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                 //   + "                      FROM   t_OfficeAutomation_Flow f"
                 //   + "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID]"
                 //   + "                             AND f.OfficeAutomation_Flow_Audit = 0"
                 //   + "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                 //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                 //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                 //+ "           END AS [waitfor]"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_SpecialNumber_MainID) AS [waitfor]"
                    + "          ,tdoad.OfficeAutomation_Document_Name"
                    + "          ,[OfficeAutomation_Document_SpecialNumber_Subject] as Remark"
                    + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                    + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                    + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SpecialNumber] todi"
                    + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SpecialNumber_MainID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                    + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SpecialNumber_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_036") || approver != "") //M_20150623
                SpecialNumber += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            SpecialNumber += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_036"))
                SpecialNumber += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SpecialNumber_Apply='" + employee + "')";

            if (applicationDepartment != "")
                SpecialNumber += " and OfficeAutomation_Document_SpecialNumber_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                SpecialNumber += " and OfficeAutomation_Document_SpecialNumber_Apply = '" + applicant + "'";

            if (begin != "")
                SpecialNumber += " and OfficeAutomation_Document_SpecialNumber_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                SpecialNumber += " and OfficeAutomation_Document_SpecialNumber_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                SpecialNumber += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    SpecialNumber += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialNumber_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        SpecialNumber += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        SpecialNumber += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                SpecialNumber += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                SpecialNumber += " and [OfficeAutomation_Document_SpecialNumber_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                SpecialNumber += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                SpecialNumber += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                SpecialNumber += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_SpecialNumber_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    SpecialNumber += "  OR (OfficeAutomation_Document_SpecialNumber_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_SpecialNumber_MainID))";
                }
            }

            SpecialNumber += " GROUP BY [OfficeAutomation_Document_SpecialNumber_ID]"
                 + "          ,[OfficeAutomation_Document_SpecialNumber_MainID]"
                 + "          ,[OfficeAutomation_Document_SpecialNumber_Department]"
                 + "          ,[OfficeAutomation_Document_SpecialNumber_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_SpecialNumber_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_SpecialNumber_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-30

            string OfficialSeal = " SELECT [OfficeAutomation_Document_OfficialSeal_ID] as ID"
        + "          ,[OfficeAutomation_Document_OfficialSeal_MainID] as MainID"
        + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
        + "          ,[OfficeAutomation_Document_OfficialSeal_Department] as Department"
        + "          ,[OfficeAutomation_Document_OfficialSeal_ApplyDate] as ApplyDate"
        + "          ,[OfficeAutomation_Document_OfficialSeal_Apply] as Apply"
        + "          ,toam.OfficeAutomation_SerialNumber"
        + "          ,toam.OfficeAutomation_Main_FlowStateID"
        //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
        //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
        //+ "                      FROM   t_OfficeAutomation_Flow f"
        //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID]"
        //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
        //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
        //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
        //+ "                      FROM   t_OfficeAutomation_Flow f"
        //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID]"
        //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
        //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
        //+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
        //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
        //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
        //+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
        //+ "           END AS [waitfor]"
        + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_OfficialSeal_MainID) AS [waitfor]"
        + "          ,tdoad.OfficeAutomation_Document_Name"
        + "          ,((CASE WHEN OfficeAutomation_Document_OfficialSeal_SureCommissioner !='' THEN '(√★)' ELSE '' END)"
        + "          + (SELECT OfficeAutomation_Document_OfficialSeal_Detail_BN + '，' FROM t_OfficeAutomation_Document_OfficialSeal_Detail WHERE OfficeAutomation_Document_OfficialSeal_Detail_MainID = OfficeAutomation_Document_OfficialSeal_ID FOR XML PATH(''))"
        + "          + (CASE WHEN OfficeAutomation_Document_OfficialSeal_SureCommissioner !='' THEN ISNULL(OfficeAutomation_Document_OfficialSeal_SureData,'') ELSE '' END)) as Remark"
        + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
        + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
        + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_OfficialSeal] todi"
        + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_OfficialSeal_MainID"
        + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
        + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
        + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_OfficialSeal_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_037") || approver != "") //M_20150623
                OfficialSeal += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            OfficialSeal += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_037"))
                OfficialSeal += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_OfficialSeal_Apply='" + employee + "')";

            if (applicationDepartment != "")
                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_Apply = '" + applicant + "'";

            if (begin != "")
                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                OfficialSeal += " and OfficeAutomation_Document_OfficialSeal_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                OfficialSeal += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    OfficialSeal += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OfficialSeal_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        OfficialSeal += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        OfficialSeal += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0 AND OfficeAutomation_Main_FlowStateID<>8 ";
                }

            if (serialNumber != "")
                OfficialSeal += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                OfficialSeal += " and ((SELECT OfficeAutomation_Document_OfficialSeal_Detail_BN + '；' FROM t_OfficeAutomation_Document_OfficialSeal_Detail WHERE OfficeAutomation_Document_OfficialSeal_Detail_MainID = OfficeAutomation_Document_OfficialSeal_ID FOR XML PATH('')) like '%" + keyWord + "%'"
                                + " or OfficeAutomation_Document_OfficialSeal_SureData like '%" + keyWord + "%')";

            if (willDelete) //M_DeleteAdd 20151230 //*xx
                OfficialSeal += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                OfficialSeal += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                OfficialSeal += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_OfficialSeal_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    OfficialSeal += "  OR (OfficeAutomation_Document_OfficialSeal_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_OfficialSeal_MainID))";
                }
            }

            OfficialSeal += " GROUP BY [OfficeAutomation_Document_OfficialSeal_ID]"
                 + "          ,[OfficeAutomation_Document_OfficialSeal_MainID]"
                 + "          ,[OfficeAutomation_Document_OfficialSeal_Department]"
                 + "          ,[OfficeAutomation_Document_OfficialSeal_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_OfficialSeal_Apply]"
                 + "          ,OfficeAutomation_Document_OfficialSeal_SureCommissioner"
                 + "          ,OfficeAutomation_Document_OfficialSeal_SureData"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-31

            string BranchContract = " SELECT [OfficeAutomation_Document_BranchContract_ID] as ID"
                + "          ,[OfficeAutomation_Document_BranchContract_MainID] as MainID"
                + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                + "          ,[OfficeAutomation_Document_BranchContract_Department] as Department"
                + "          ,[OfficeAutomation_Document_BranchContract_ApplyDate] as ApplyDate"
                + "          ,[OfficeAutomation_Document_BranchContract_Apply] as Apply"
                + "          ,toam.OfficeAutomation_SerialNumber"
                + "          ,toam.OfficeAutomation_Main_FlowStateID"
                //+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
                //+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                //+ "                      FROM   t_OfficeAutomation_Flow f"
                //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BranchContract_MainID]"
                //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                //+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
                //+ "                      FROM   t_OfficeAutomation_Flow f"
                //+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BranchContract_MainID]"
                //+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
                //+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
                // + "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                // + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BranchContract_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                // + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BranchContract_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
                // + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BranchContract_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
                // + "           END AS [waitfor]"
                + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_BranchContract_MainID) AS [waitfor]"
                + "          ,tdoad.OfficeAutomation_Document_Name"
                + "          ,[OfficeAutomation_Document_BranchContract_Name] as Remark"
                + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BranchContract] todi"
                + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BranchContract_MainID"
                + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BranchContract_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_038") || approver != "") //M_20150623
                BranchContract += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            BranchContract += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_038"))
                BranchContract += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BranchContract_Apply='" + employee + "')";

            if (applicationDepartment != "")
                BranchContract += " and OfficeAutomation_Document_BranchContract_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                BranchContract += " and OfficeAutomation_Document_BranchContract_Apply = '" + applicant + "'";

            if (begin != "")
                BranchContract += " and OfficeAutomation_Document_BranchContract_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                BranchContract += " and OfficeAutomation_Document_BranchContract_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                BranchContract += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    BranchContract += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BranchContract_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        BranchContract += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        BranchContract += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                BranchContract += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                BranchContract += " and [OfficeAutomation_Document_BranchContract_Name] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230 //*xx
                BranchContract += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                BranchContract += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                BranchContract += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_BranchContract_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "' ) ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    BranchContract += "  OR (OfficeAutomation_Document_BranchContract_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_BranchContract_MainID))";
                }
            }

            BranchContract += " GROUP BY [OfficeAutomation_Document_BranchContract_ID]"
                 + "          ,[OfficeAutomation_Document_BranchContract_MainID]"
                 + "          ,[OfficeAutomation_Document_BranchContract_Department]"
                 + "          ,[OfficeAutomation_Document_BranchContract_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_BranchContract_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_BranchContract_Name]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-32

            string Tourism = " SELECT [OfficeAutomation_Document_Tourism_ID] as ID"
+ "          ,[OfficeAutomation_Document_Tourism_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_Tourism_Department] as Department"
+ "          ,[OfficeAutomation_Document_Tourism_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_Tourism_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Tourism_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Tourism_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Tourism_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Tourism_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Tourism_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//                 + "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Tourism_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_Tourism_ActivityPlace] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Tourism] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Tourism_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Tourism_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_039") || approver != "") //M_20150623
                Tourism += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Tourism += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_039"))
                Tourism += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Tourism_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Tourism += " and OfficeAutomation_Document_Tourism_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Tourism += " and OfficeAutomation_Document_Tourism_Apply = '" + applicant + "'";

            if (begin != "")
                Tourism += " and OfficeAutomation_Document_Tourism_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Tourism += " and OfficeAutomation_Document_Tourism_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Tourism += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Tourism += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Tourism_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Tourism += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Tourism += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Tourism += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Tourism += " and [OfficeAutomation_Document_Tourism_ActivityPlace] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                Tourism += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                Tourism += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Tourism += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Tourism_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Tourism += "  OR (OfficeAutomation_Document_Tourism_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Tourism_MainID))";
                }
            }

            Tourism += " GROUP BY [OfficeAutomation_Document_Tourism_ID]"
                 + "          ,[OfficeAutomation_Document_Tourism_MainID]"
                 + "          ,[OfficeAutomation_Document_Tourism_Department]"
                 + "          ,[OfficeAutomation_Document_Tourism_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Tourism_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_Tourism_ActivityPlace]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";//*-33

            string OweSubmit = " SELECT [OfficeAutomation_Document_OweSubmit_ID] as ID"
+ "          ,[OfficeAutomation_Document_OweSubmit_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_OweSubmit_Department] as Department"
+ "          ,[OfficeAutomation_Document_OweSubmit_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_OweSubmit_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OweSubmit_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OweSubmit_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OweSubmit_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OweSubmit_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OweSubmit_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//                 + "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_OweSubmit_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_OweSubmit_Name] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_OweSubmit] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_OweSubmit_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_OweSubmit_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_040") || approver != "") //M_20150623
                OweSubmit += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            OweSubmit += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_040"))
                OweSubmit += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_OweSubmit_Apply='" + employee + "')";

            if (applicationDepartment != "")
                OweSubmit += " and OfficeAutomation_Document_OweSubmit_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                OweSubmit += " and OfficeAutomation_Document_OweSubmit_Apply = '" + applicant + "'";

            if (begin != "")
                OweSubmit += " and OfficeAutomation_Document_OweSubmit_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                OweSubmit += " and OfficeAutomation_Document_OweSubmit_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                OweSubmit += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    OweSubmit += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OweSubmit_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        OweSubmit += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        OweSubmit += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                OweSubmit += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                OweSubmit += " and [OfficeAutomation_Document_OweSubmit_Name] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                OweSubmit += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                OweSubmit += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                OweSubmit += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_OweSubmit_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    OweSubmit += "  OR (OfficeAutomation_Document_OweSubmit_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_OweSubmit_MainID))";
                }
            }

            OweSubmit += " GROUP BY [OfficeAutomation_Document_OweSubmit_ID]"
                 + "          ,[OfficeAutomation_Document_OweSubmit_MainID]"
                 + "          ,[OfficeAutomation_Document_OweSubmit_Department]"
                 + "          ,[OfficeAutomation_Document_OweSubmit_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_OweSubmit_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_OweSubmit_Name]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string TotalRev = " SELECT [OfficeAutomation_Document_TotalRev_ID] as ID"
+ "          ,[OfficeAutomation_Document_TotalRev_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_TotalRev_Department] as Department"
+ "          ,[OfficeAutomation_Document_TotalRev_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_TotalRev_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_TotalRev_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_TotalRev_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_TotalRev_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_TotalRev_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_TotalRev_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//                 + "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_TotalRev_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,([OfficeAutomation_Document_TotalRev_Subject] + isnull(toam.OfficeAutomation_Main_Sremark,'')) as Remark" //M_Remark：Win 20151109
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_TotalRev] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_TotalRev_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_TotalRev_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_041") || approver != "") //M_20150623
                TotalRev += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            TotalRev += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_041"))
                TotalRev += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_TotalRev_Apply='" + employee + "')";

            if (applicationDepartment != "")
                TotalRev += " and OfficeAutomation_Document_TotalRev_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                TotalRev += " and OfficeAutomation_Document_TotalRev_Apply = '" + applicant + "'";

            if (begin != "")
                TotalRev += " and OfficeAutomation_Document_TotalRev_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                TotalRev += " and OfficeAutomation_Document_TotalRev_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                TotalRev += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    TotalRev += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_TotalRev_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        TotalRev += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        TotalRev += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                TotalRev += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                TotalRev += " and [OfficeAutomation_Document_TotalRev_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                TotalRev += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                TotalRev += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                TotalRev += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_TotalRev_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    TotalRev += "  OR (OfficeAutomation_Document_TotalRev_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_TotalRev_MainID))";
                }
            }

            TotalRev += " GROUP BY [OfficeAutomation_Document_TotalRev_ID]"
                 + "          ,[OfficeAutomation_Document_TotalRev_MainID]"
                 + "          ,[OfficeAutomation_Document_TotalRev_Department]"
                 + "          ,[OfficeAutomation_Document_TotalRev_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_TotalRev_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_Sremark" //M_Remark：Win 20151109
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_TotalRev_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string Feasibility = " SELECT [OfficeAutomation_Document_Feasibility_ID] as ID"
+ "          ,[OfficeAutomation_Document_Feasibility_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_Feasibility_Department] as Department"
+ "          ,[OfficeAutomation_Document_Feasibility_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_Feasibility_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Feasibility_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Feasibility_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Feasibility_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Feasibility_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Feasibility_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//                 + "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Feasibility_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,([OfficeAutomation_Document_Feasibility_Branch] + isnull(toam.OfficeAutomation_Main_Sremark,'')) as Remark" //M_Remark：Win 20151109
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Feasibility] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Feasibility_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Feasibility_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_042") || approver != "") //M_20150623
                Feasibility += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Feasibility += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_042"))
                Feasibility += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Feasibility_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Feasibility += " and OfficeAutomation_Document_Feasibility_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Feasibility += " and OfficeAutomation_Document_Feasibility_Apply = '" + applicant + "'";

            if (begin != "")
                Feasibility += " and OfficeAutomation_Document_Feasibility_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Feasibility += " and OfficeAutomation_Document_Feasibility_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Feasibility += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Feasibility += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Feasibility_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Feasibility += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Feasibility += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Feasibility += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Feasibility += " and [OfficeAutomation_Document_Feasibility_Branch] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                Feasibility += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                Feasibility += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Feasibility += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Feasibility_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Feasibility += "  OR (OfficeAutomation_Document_Feasibility_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Feasibility_MainID))";
                }
            }

            Feasibility += " GROUP BY [OfficeAutomation_Document_Feasibility_ID]"
                 + "          ,[OfficeAutomation_Document_Feasibility_MainID]"
                 + "          ,[OfficeAutomation_Document_Feasibility_Department]"
                 + "          ,[OfficeAutomation_Document_Feasibility_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Feasibility_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_Sremark" //M_Remark：Win 20151109
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_Feasibility_Branch]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string AfterCommission = " SELECT [OfficeAutomation_Document_AfterCommission_ID] as ID"
+ "          ,[OfficeAutomation_Document_AfterCommission_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_AfterCommission_Department] as Department"
+ "          ,[OfficeAutomation_Document_AfterCommission_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_AfterCommission_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AfterCommission_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AfterCommission_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AfterCommission_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AfterCommission_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AfterCommission_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//                 + "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_AfterCommission_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_AfterCommission_Subject] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_AfterCommission] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_AfterCommission_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_AfterCommission_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_043") || approver != "") //M_20150623
                AfterCommission += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            AfterCommission += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_043"))
                AfterCommission += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_AfterCommission_Apply='" + employee + "')";

            if (applicationDepartment != "")
                AfterCommission += " and OfficeAutomation_Document_AfterCommission_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                AfterCommission += " and OfficeAutomation_Document_AfterCommission_Apply = '" + applicant + "'";

            if (begin != "")
                AfterCommission += " and OfficeAutomation_Document_AfterCommission_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                AfterCommission += " and OfficeAutomation_Document_AfterCommission_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                AfterCommission += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    AfterCommission += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_AfterCommission_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        AfterCommission += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        AfterCommission += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                AfterCommission += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                AfterCommission += " and [OfficeAutomation_Document_AfterCommission_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                AfterCommission += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                AfterCommission += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                AfterCommission += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_AfterCommission_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    AfterCommission += "  OR (OfficeAutomation_Document_AfterCommission_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_AfterCommission_MainID))";
                }
            }

            AfterCommission += " GROUP BY [OfficeAutomation_Document_AfterCommission_ID]"
                 + "          ,[OfficeAutomation_Document_AfterCommission_MainID]"
                 + "          ,[OfficeAutomation_Document_AfterCommission_Department]"
                 + "          ,[OfficeAutomation_Document_AfterCommission_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_AfterCommission_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_AfterCommission_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string LegalCommission = " SELECT [OfficeAutomation_Document_LegalCommission_ID] as ID"
+ "          ,[OfficeAutomation_Document_LegalCommission_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_LegalCommission_Department] as Department"
+ "          ,[OfficeAutomation_Document_LegalCommission_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_LegalCommission_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_LegalCommission_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_LegalCommission_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//                 + "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_LegalCommission_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_LegalCommission_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//                 + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_LegalCommission_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//                 + "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_LegalCommission_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_LegalCommission_Subject] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_LegalCommission] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_LegalCommission_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_LegalCommission_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_044") || approver != "") //M_20150623
                LegalCommission += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            LegalCommission += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_044"))
                LegalCommission += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_LegalCommission_Apply='" + employee + "')";

            if (applicationDepartment != "")
                LegalCommission += " and OfficeAutomation_Document_LegalCommission_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                LegalCommission += " and OfficeAutomation_Document_LegalCommission_Apply = '" + applicant + "'";

            if (begin != "")
                LegalCommission += " and OfficeAutomation_Document_LegalCommission_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                LegalCommission += " and OfficeAutomation_Document_LegalCommission_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                LegalCommission += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    LegalCommission += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_LegalCommission_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        LegalCommission += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        LegalCommission += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                LegalCommission += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                LegalCommission += " and [OfficeAutomation_Document_LegalCommission_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                LegalCommission += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                LegalCommission += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                LegalCommission += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_LegalCommission_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    LegalCommission += "  OR (OfficeAutomation_Document_LegalCommission_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_LegalCommission_MainID))";
                }
            }

            LegalCommission += " GROUP BY [OfficeAutomation_Document_LegalCommission_ID]"
                 + "          ,[OfficeAutomation_Document_LegalCommission_MainID]"
                 + "          ,[OfficeAutomation_Document_LegalCommission_Department]"
                 + "          ,[OfficeAutomation_Document_LegalCommission_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_LegalCommission_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_LegalCommission_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string GeneralApply = " SELECT [OfficeAutomation_Document_GeneralApply_ID] as ID"
+ "          ,[OfficeAutomation_Document_GeneralApply_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_GeneralApply_Department] as Department"
+ "          ,[OfficeAutomation_Document_GeneralApply_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_GeneralApply_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_GeneralApply_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_GeneralApply_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//     + "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//     + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_GeneralApply_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//     + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_GeneralApply_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//     + "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_GeneralApply_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//     + "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_GeneralApply_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,([OfficeAutomation_Document_GeneralApply_Subject] + isnull(toam.OfficeAutomation_Main_Sremark,'')) as Remark" //M_Remark：Win 20151109
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_GeneralApply] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_GeneralApply_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_GeneralApply_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_045") || approver != "") //M_20150623
                GeneralApply += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            GeneralApply += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_045"))
                GeneralApply += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_GeneralApply_Apply='" + employee + "' or (todi.OfficeAutomation_Document_GeneralApply_CanSeeEmployeeID like '%" + code + "%' and OfficeAutomation_Document_GeneralApply_CanSeeEmployeeName like '%" + employee + "%'))";

            if (applicationDepartment != "")
                GeneralApply += " and OfficeAutomation_Document_GeneralApply_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                GeneralApply += " and OfficeAutomation_Document_GeneralApply_Apply = '" + applicant + "'";

            if (begin != "")
                GeneralApply += " and OfficeAutomation_Document_GeneralApply_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                GeneralApply += " and OfficeAutomation_Document_GeneralApply_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                GeneralApply += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    GeneralApply += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_GeneralApply_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        GeneralApply += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        GeneralApply += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                GeneralApply += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                GeneralApply += " and [OfficeAutomation_Document_GeneralApply_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230 //*xx
                GeneralApply += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((select count(*) from(SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%')d),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                GeneralApply += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                GeneralApply += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_GeneralApply_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    GeneralApply += "  OR (OfficeAutomation_Document_GeneralApply_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_GeneralApply_MainID))";
                }
            }

            GeneralApply += " GROUP BY [OfficeAutomation_Document_GeneralApply_ID]"
                 + "          ,[OfficeAutomation_Document_GeneralApply_MainID]"
                 + "          ,[OfficeAutomation_Document_GeneralApply_Department]"
                 + "          ,[OfficeAutomation_Document_GeneralApply_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_GeneralApply_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_Sremark" //M_Remark：Win 20151109
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_GeneralApply_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string ContractTerms = " SELECT [OfficeAutomation_Document_ContractTerms_ID] as ID"
+ "          ,[OfficeAutomation_Document_ContractTerms_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_ContractTerms_Department] as Department"
+ "          ,[OfficeAutomation_Document_ContractTerms_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_ContractTerms_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ContractTerms_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ContractTerms_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ContractTerms_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ContractTerms_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ContractTerms_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//+ "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ContractTerms_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_ContractTerms_Subject] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ContractTerms] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ContractTerms_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ContractTerms_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_046") || approver != "") //M_20150623
                ContractTerms += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            ContractTerms += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_046"))
                ContractTerms += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ContractTerms_Apply='" + employee + "')";

            if (applicationDepartment != "")
                ContractTerms += " and OfficeAutomation_Document_ContractTerms_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                ContractTerms += " and OfficeAutomation_Document_ContractTerms_Apply = '" + applicant + "'";

            if (begin != "")
                ContractTerms += " and OfficeAutomation_Document_ContractTerms_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                ContractTerms += " and OfficeAutomation_Document_ContractTerms_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                ContractTerms += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    ContractTerms += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ContractTerms_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        ContractTerms += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        ContractTerms += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                ContractTerms += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                ContractTerms += " and [OfficeAutomation_Document_ContractTerms_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                ContractTerms += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                ContractTerms += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                ContractTerms += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ContractTerms_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    ContractTerms += "  OR (OfficeAutomation_Document_ContractTerms_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ContractTerms_MainID))";
                }
            }

            ContractTerms += " GROUP BY [OfficeAutomation_Document_ContractTerms_ID]"
                 + "          ,[OfficeAutomation_Document_ContractTerms_MainID]"
                 + "          ,[OfficeAutomation_Document_ContractTerms_Department]"
                 + "          ,[OfficeAutomation_Document_ContractTerms_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ContractTerms_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ContractTerms_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string NetSign = " SELECT [OfficeAutomation_Document_NetSign_ID] as ID"
+ "          ,[OfficeAutomation_Document_NetSign_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_NetSign_Department] as Department"
+ "          ,[OfficeAutomation_Document_NetSign_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_NetSign_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber" 
+ "          ,toam.OfficeAutomation_Main_FlowStateID" 
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_NetSign_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_NetSign_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_NetSign_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_NetSign_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_NetSign_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//+ "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_NetSign_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_NetSign_BudingAddress] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_NetSign] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_NetSign_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_NetSign_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_047") || approver != "") //M_20150623
                NetSign += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            NetSign += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_047"))
                NetSign += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_NetSign_Apply='" + employee + "')";

            if (applicationDepartment != "")
                NetSign += " and OfficeAutomation_Document_NetSign_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                NetSign += " and OfficeAutomation_Document_NetSign_Apply = '" + applicant + "'";

            if (begin != "")
                NetSign += " and OfficeAutomation_Document_NetSign_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                NetSign += " and OfficeAutomation_Document_NetSign_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                NetSign += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    NetSign += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_NetSign_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        NetSign += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        NetSign += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                NetSign += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                NetSign += " and ([OfficeAutomation_Document_NetSign_ApplyID] like '%" + keyWord + "%' or OfficeAutomation_Document_NetSign_BudingAddress like '%"+keyWord+"%')";

            if (willDelete) //M_DeleteAdd 20151230
                NetSign += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                NetSign += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                NetSign += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_NetSign_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    NetSign += "  OR (OfficeAutomation_Document_NetSign_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_NetSign_MainID))";
                }
            }

            NetSign += " GROUP BY [OfficeAutomation_Document_NetSign_ID]"
                 + "          ,[OfficeAutomation_Document_NetSign_MainID]"
                 + "          ,[OfficeAutomation_Document_NetSign_Department]"
                 + "          ,[OfficeAutomation_Document_NetSign_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_NetSign_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_NetSign_BudingAddress]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string CommissionOfMonth = " SELECT [OfficeAutomation_Document_CommissionOfMonth_ID] as ID"
+ "          ,[OfficeAutomation_Document_CommissionOfMonth_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_CommissionOfMonth_Department] as Department"
+ "          ,[OfficeAutomation_Document_CommissionOfMonth_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_CommissionOfMonth_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//+ "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_CommissionOfMonth_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_CommissionOfMonth_Name] + '，' + ISNULL((SELECT OfficeAutomation_Document_CommissionOfMonth_Detail_Name + '，' FROM t_OfficeAutomation_Document_CommissionOfMonth_Detail WHERE OfficeAutomation_Document_CommissionOfMonth_Detail_MainID = OfficeAutomation_Document_CommissionOfMonth_ID FOR XML PATH('')),'') as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CommissionOfMonth] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CommissionOfMonth_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CommissionOfMonth_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_048") || approver != "") //M_20150623
                CommissionOfMonth += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            CommissionOfMonth += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_048"))
                CommissionOfMonth += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CommissionOfMonth_Apply='" + employee + "')";

            if (applicationDepartment != "")
                CommissionOfMonth += " and OfficeAutomation_Document_CommissionOfMonth_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                CommissionOfMonth += " and OfficeAutomation_Document_CommissionOfMonth_Apply = '" + applicant + "'";

            if (begin != "")
                CommissionOfMonth += " and OfficeAutomation_Document_CommissionOfMonth_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                CommissionOfMonth += " and OfficeAutomation_Document_CommissionOfMonth_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                CommissionOfMonth += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    CommissionOfMonth += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionOfMonth_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        CommissionOfMonth += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        CommissionOfMonth += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                CommissionOfMonth += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                //CommissionOfMonth += " and [OfficeAutomation_Document_CommissionOfMonth_Name] like '%" + keyWord + "%'";
                CommissionOfMonth += " and ((SELECT OfficeAutomation_Document_CommissionOfMonth_Detail_Name + '；' FROM t_OfficeAutomation_Document_CommissionOfMonth_Detail WHERE OfficeAutomation_Document_CommissionOfMonth_Detail_MainID = OfficeAutomation_Document_CommissionOfMonth_ID FOR XML PATH('')) like '%" + keyWord + "%'"
                            + " or OfficeAutomation_Document_CommissionOfMonth_Name like '%" + keyWord + "%')";

            if (willDelete) //M_DeleteAdd 20151230
                CommissionOfMonth += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                CommissionOfMonth += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                CommissionOfMonth += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CommissionOfMonth_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    CommissionOfMonth += "  OR (OfficeAutomation_Document_CommissionOfMonth_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CommissionOfMonth_MainID))";
                }
            }

            CommissionOfMonth += " GROUP BY [OfficeAutomation_Document_CommissionOfMonth_ID]"
                 + "          ,[OfficeAutomation_Document_CommissionOfMonth_MainID]"
                 + "          ,[OfficeAutomation_Document_CommissionOfMonth_Department]"
                 + "          ,[OfficeAutomation_Document_CommissionOfMonth_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_CommissionOfMonth_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_CommissionOfMonth_Name]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string Marketing = " SELECT [OfficeAutomation_Document_Marketing_ID] as ID"
+ "          ,[OfficeAutomation_Document_Marketing_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_Marketing_Department] as Department"
+ "          ,[OfficeAutomation_Document_Marketing_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_Marketing_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Marketing_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Marketing_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Marketing_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Marketing_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Marketing_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//+ "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Marketing_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_Marketing_Subject] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Marketing] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Marketing_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Marketing_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_049") || approver != "") //M_20150623
                Marketing += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Marketing += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_049"))
                Marketing += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Marketing_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Marketing += " and OfficeAutomation_Document_Marketing_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Marketing += " and OfficeAutomation_Document_Marketing_Apply = '" + applicant + "'";

            if (begin != "")
                Marketing += " and OfficeAutomation_Document_Marketing_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Marketing += " and OfficeAutomation_Document_Marketing_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Marketing += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Marketing += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Marketing_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Marketing += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Marketing += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Marketing += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Marketing += " and [OfficeAutomation_Document_Marketing_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                Marketing += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                Marketing += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Marketing += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Marketing_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Marketing += "  OR (OfficeAutomation_Document_Marketing_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Marketing_MainID))";
                }
            }

            Marketing += " GROUP BY [OfficeAutomation_Document_Marketing_ID]"
                 + "          ,[OfficeAutomation_Document_Marketing_MainID]"
                 + "          ,[OfficeAutomation_Document_Marketing_Department]"
                 + "          ,[OfficeAutomation_Document_Marketing_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Marketing_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_Marketing_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string Secondment = " SELECT [OfficeAutomation_Document_Secondment_ID] as ID"
+ "          ,[OfficeAutomation_Document_Secondment_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_Secondment_Department] as Department"
+ "          ,[OfficeAutomation_Document_Secondment_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_Secondment_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Secondment_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Secondment_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Secondment_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Secondment_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Secondment_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//+ "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Secondment_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_Secondment_AssetsName] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Secondment] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Secondment_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Secondment_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_050") || approver != "") //M_20150623
                Secondment += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Secondment += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_050"))
                Secondment += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Secondment_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Secondment += " and OfficeAutomation_Document_Secondment_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Secondment += " and OfficeAutomation_Document_Secondment_Apply = '" + applicant + "'";

            if (begin != "")
                Secondment += " and OfficeAutomation_Document_Secondment_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Secondment += " and OfficeAutomation_Document_Secondment_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Secondment += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Secondment += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Secondment_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Secondment += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Secondment += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Secondment += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Secondment += " and [OfficeAutomation_Document_Secondment_AssetsName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                Secondment += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                Secondment += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Secondment += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Secondment_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Secondment += "  OR (OfficeAutomation_Document_Secondment_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Secondment_MainID))";
                }
            }

            Secondment += " GROUP BY [OfficeAutomation_Document_Secondment_ID]"
                 + "          ,[OfficeAutomation_Document_Secondment_MainID]"
                 + "          ,[OfficeAutomation_Document_Secondment_Department]"
                 + "          ,[OfficeAutomation_Document_Secondment_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Secondment_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_Secondment_AssetsName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string CostOfActivity = " SELECT [OfficeAutomation_Document_CostOfActivity_ID] as ID"
+ "          ,[OfficeAutomation_Document_CostOfActivity_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_CostOfActivity_Department] as Department"
+ "          ,[OfficeAutomation_Document_CostOfActivity_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_CostOfActivity_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CostOfActivity_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CostOfActivity_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CostOfActivity_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CostOfActivity_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CostOfActivity_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//+ "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_CostOfActivity_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_CostOfActivity_Subject] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CostOfActivity] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CostOfActivity_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CostOfActivity_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_051") || approver != "") //M_20150623
                CostOfActivity += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            CostOfActivity += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_051"))
                CostOfActivity += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CostOfActivity_Apply='" + employee + "')";

            if (applicationDepartment != "")
                CostOfActivity += " and OfficeAutomation_Document_CostOfActivity_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                CostOfActivity += " and OfficeAutomation_Document_CostOfActivity_Apply = '" + applicant + "'";

            if (begin != "")
                CostOfActivity += " and OfficeAutomation_Document_CostOfActivity_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                CostOfActivity += " and OfficeAutomation_Document_CostOfActivity_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                CostOfActivity += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    CostOfActivity += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CostOfActivity_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        CostOfActivity += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        CostOfActivity += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                CostOfActivity += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                CostOfActivity += " and [OfficeAutomation_Document_CostOfActivity_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                CostOfActivity += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                CostOfActivity += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                CostOfActivity += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CostOfActivity_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    CostOfActivity += "  OR (OfficeAutomation_Document_CostOfActivity_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CostOfActivity_MainID))";
                }
            }

            CostOfActivity += " GROUP BY [OfficeAutomation_Document_CostOfActivity_ID]"
                 + "          ,[OfficeAutomation_Document_CostOfActivity_MainID]"
                 + "          ,[OfficeAutomation_Document_CostOfActivity_Department]"
                 + "          ,[OfficeAutomation_Document_CostOfActivity_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_CostOfActivity_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_CostOfActivity_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string PunishTerms = " SELECT [OfficeAutomation_Document_PunishTerms_ID] as ID"
+ "          ,[OfficeAutomation_Document_PunishTerms_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_PunishTerms_Department] as Department"
+ "          ,[OfficeAutomation_Document_PunishTerms_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_PunishTerms_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PunishTerms_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PunishTerms_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PunishTerms_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PunishTerms_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PunishTerms_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//+ "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_PunishTerms_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_PunishTerms_Contract] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_PunishTerms] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_PunishTerms_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_PunishTerms_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_052") || approver != "") //M_20150623
                PunishTerms += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            PunishTerms += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_052"))
                PunishTerms += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_PunishTerms_Apply='" + employee + "')";

            if (applicationDepartment != "")
                PunishTerms += " and OfficeAutomation_Document_PunishTerms_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                PunishTerms += " and OfficeAutomation_Document_PunishTerms_Apply = '" + applicant + "'";

            if (begin != "")
                PunishTerms += " and OfficeAutomation_Document_PunishTerms_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                PunishTerms += " and OfficeAutomation_Document_PunishTerms_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                PunishTerms += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    PunishTerms += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PunishTerms_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        PunishTerms += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        PunishTerms += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                PunishTerms += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                PunishTerms += " and [OfficeAutomation_Document_PunishTerms_Contract] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                PunishTerms += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                PunishTerms += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                PunishTerms += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_PunishTerms_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    PunishTerms += "  OR (OfficeAutomation_Document_PunishTerms_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_PunishTerms_MainID))";
                }
            }

            PunishTerms += " GROUP BY [OfficeAutomation_Document_PunishTerms_ID]"
                 + "          ,[OfficeAutomation_Document_PunishTerms_MainID]"
                 + "          ,[OfficeAutomation_Document_PunishTerms_Department]"
                 + "          ,[OfficeAutomation_Document_PunishTerms_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_PunishTerms_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_PunishTerms_Contract]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string ChangeNS = " SELECT [OfficeAutomation_Document_ChangeNS_ID] as ID"
+ "          ,[OfficeAutomation_Document_ChangeNS_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_ChangeNS_Department] as Department"
+ "          ,[OfficeAutomation_Document_ChangeNS_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_ChangeNS_Apply] as Apply"
+ "          ,toam.OfficeAutomation_Main_Creater as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeNS_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeNS_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeNS_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeNS_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeNS_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//+ "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ChangeNS_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_ChangeNS_Location] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ChangeNS] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ChangeNS_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ChangeNS_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_053") || approver != "") //M_20150623
                ChangeNS += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            ChangeNS += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_053"))
                ChangeNS += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ChangeNS_Apply='" + employee + "' or toam.OfficeAutomation_Main_Creater='" + employee + "')";

            if (applicationDepartment != "")
                ChangeNS += " and OfficeAutomation_Document_ChangeNS_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                ChangeNS += " and OfficeAutomation_Document_ChangeNS_Apply = '" + applicant + "'";

            if (begin != "")
                ChangeNS += " and OfficeAutomation_Document_ChangeNS_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                ChangeNS += " and OfficeAutomation_Document_ChangeNS_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                ChangeNS += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    ChangeNS += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ChangeNS_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        ChangeNS += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        ChangeNS += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                ChangeNS += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                ChangeNS += " and ([OfficeAutomation_Document_ChangeNS_ApplyID] like '%" + keyWord + "%' or OfficeAutomation_Document_ChangeNS_Location like '%"+keyWord+"%')";

            if (willDelete) //M_DeleteAdd 20151230
                ChangeNS += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                ChangeNS += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                ChangeNS += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ChangeNS_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    ChangeNS += "  OR (OfficeAutomation_Document_ChangeNS_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ChangeNS_MainID))";
                }
            }

            ChangeNS += " GROUP BY [OfficeAutomation_Document_ChangeNS_ID]"
                 + "          ,[OfficeAutomation_Document_ChangeNS_MainID]"
                 + "          ,[OfficeAutomation_Document_ChangeNS_Department]"
                 + "          ,[OfficeAutomation_Document_ChangeNS_ApplyDate]"
                 + "          ,toam.OfficeAutomation_Main_Creater"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ChangeNS_Location]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string SpecialCase = " SELECT [OfficeAutomation_Document_SpecialCase_ID] as ID"
+ "          ,[OfficeAutomation_Document_SpecialCase_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_SpecialCase_Department] as Department"
+ "          ,[OfficeAutomation_Document_SpecialCase_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_SpecialCase_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,CASE toam.OfficeAutomation_Main_FlowStateID"
//+ "             WHEN 1 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialCase_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 2 THEN '待'+(SELECT TOP 1 f.OfficeAutomation_Flow_Employee"
//+ "                      FROM   t_OfficeAutomation_Flow f"
//+ "                      WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialCase_MainID]"
//+ "                             AND f.OfficeAutomation_Flow_Audit = 0"
//+ "                      ORDER  BY f.OfficeAutomation_Flow_Idx ASC)+'审核'"
//+ "             WHEN 3 THEN (SELECT CASE WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialCase_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 0 THEN '申请不同意' WHEN (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialCase_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 1 THEN '申请已同意' WHEN(SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM   t_OfficeAutomation_Flow f "
//+ "             WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialCase_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = 2 THEN '其他意见' END) "
//+ "           END AS [waitfor]"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_SpecialCase_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_SpecialCase_Location] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SpecialCase] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SpecialCase_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SpecialCase_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_054") || approver != "") //M_20150623
                SpecialCase += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            SpecialCase += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_054"))
                SpecialCase += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SpecialCase_Apply='" + employee + "')";

            if (applicationDepartment != "")
                SpecialCase += " and OfficeAutomation_Document_SpecialCase_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                SpecialCase += " and OfficeAutomation_Document_SpecialCase_Apply = '" + applicant + "'";

            if (begin != "")
                SpecialCase += " and OfficeAutomation_Document_SpecialCase_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                SpecialCase += " and OfficeAutomation_Document_SpecialCase_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                SpecialCase += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    SpecialCase += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialCase_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        SpecialCase += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        SpecialCase += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                SpecialCase += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                SpecialCase += " and [OfficeAutomation_Document_SpecialCase_Location] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                SpecialCase += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                SpecialCase += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                SpecialCase += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_SpecialCase_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    SpecialCase += "  OR (OfficeAutomation_Document_SpecialCase_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_SpecialCase_MainID))";
                }
            }

            SpecialCase += " GROUP BY [OfficeAutomation_Document_SpecialCase_ID]"
                 + "          ,[OfficeAutomation_Document_SpecialCase_MainID]"
                 + "          ,[OfficeAutomation_Document_SpecialCase_Department]"
                 + "          ,[OfficeAutomation_Document_SpecialCase_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_SpecialCase_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_SpecialCase_Location]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string SocialSecurity = " SELECT [OfficeAutomation_Document_SocialSecurity_ID] as ID"
+ "          ,[OfficeAutomation_Document_SocialSecurity_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_SocialSecurity_Department] as Department"
+ "          ,[OfficeAutomation_Document_SocialSecurity_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_SocialSecurity_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_SocialSecurity_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_SocialSecurity_Results] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SocialSecurity] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SocialSecurity_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SocialSecurity_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_055") || approver != "") //M_20150623
                SocialSecurity += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            SocialSecurity += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_055"))
                SocialSecurity += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SocialSecurity_Apply='" + employee + "')";

            if (applicationDepartment != "")
                SocialSecurity += " and OfficeAutomation_Document_SocialSecurity_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                SocialSecurity += " and OfficeAutomation_Document_SocialSecurity_Apply = '" + applicant + "'";

            if (begin != "")
                SocialSecurity += " and OfficeAutomation_Document_SocialSecurity_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                SocialSecurity += " and OfficeAutomation_Document_SocialSecurity_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                SocialSecurity += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    SocialSecurity += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SocialSecurity_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        SocialSecurity += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        SocialSecurity += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                SocialSecurity += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                SocialSecurity += " and [OfficeAutomation_Document_SocialSecurity_Results] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                SocialSecurity += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                SocialSecurity += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                SocialSecurity += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_SocialSecurity_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    SocialSecurity += "  OR (OfficeAutomation_Document_SocialSecurity_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_SocialSecurity_MainID))";
                }
            }

            SocialSecurity += " GROUP BY [OfficeAutomation_Document_SocialSecurity_ID]"
                 + "          ,[OfficeAutomation_Document_SocialSecurity_MainID]"
                 + "          ,[OfficeAutomation_Document_SocialSecurity_Department]"
                 + "          ,[OfficeAutomation_Document_SocialSecurity_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_SocialSecurity_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_SocialSecurity_Results]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

//            string PortAssessment = " SELECT [OfficeAutomation_Document_PortAssessment_ID] as ID"
//+ "          ,[OfficeAutomation_Document_PortAssessment_MainID] as MainID"
//+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
//+ "          ,[OfficeAutomation_Document_PortAssessment_Department] as Department"
//+ "          ,[OfficeAutomation_Document_PortAssessment_ApplyDate] as ApplyDate"
//+ "          ,[OfficeAutomation_Document_PortAssessment_Apply] as Apply"
//+ "          ,toam.OfficeAutomation_SerialNumber"
//+ "          ,toam.OfficeAutomation_Main_FlowStateID"
//+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_PortAssessment_MainID) AS [waitfor]"
//+ "          ,tdoad.OfficeAutomation_Document_Name"
//+ "          ,[OfficeAutomation_Document_PortAssessment_ApplyID] as Remark"
//+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
//+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
//+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_PortAssessment] todi"
//+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_PortAssessment_MainID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
//+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
//+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_PortAssessment_MainID";

            //            if (!isAdmin && !purview.Contains("OA_Search_056") || approver != "") //M_20150623
//                PortAssessment += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

//            PortAssessment += " WHERE 1=1";

//            if (!isAdmin && !purview.Contains("OA_Search_056"))
//                PortAssessment += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_PortAssessment_Apply='" + employee + "')";

//            if (applicationDepartment != "")
//                PortAssessment += " and OfficeAutomation_Document_PortAssessment_Department like '%" + applicationDepartment + "%'";

//            if (applicant != "")
//                PortAssessment += " and OfficeAutomation_Document_PortAssessment_Apply = '" + applicant + "'";

//            if (begin != "")
//                PortAssessment += " and OfficeAutomation_Document_PortAssessment_ApplyDate >='" + begin + " 00:00:00'";

//            if (end != "")
//                PortAssessment += " and OfficeAutomation_Document_PortAssessment_ApplyDate<='" + end + " 23:59:59'";

//            if (state != "")
//                PortAssessment += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            //if (cstatue != 10)
            //    if (cstatue < 3)
            //        PortAssessment += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PortAssessment_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
            //    else //M_20150623
            //    {
            //        if (approver != "")
            //            PortAssessment += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
            //        else
            //            PortAssessment += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
            //    }

//            if (serialNumber != "")
//                PortAssessment += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

//            if (keyWord != "")
//                PortAssessment += " and [OfficeAutomation_Document_PortAssessment_ApplyID] like '%" + keyWord + "%'";

            //if (willDelete) //M_DeleteAdd 20151230
            //    PortAssessment += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            //if (approver != "" && cstatue != 3) //M_20150623
            //    PortAssessment += " and auditorsum like '%" + approver + "%'";

            //if (approver != "" && apptime != "") //M_GWSky：20150630
            //    itpower += " and (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_PortAssessment_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND convert(varchar(50),OfficeAutomation_Flow_AuditDate,120) like '%" + apptime + "%') IS NOT NULL";

//            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
//            {
//                foreach (DataRow dr in ds.Tables[0].Rows)
//                {
//                    PortAssessment += "  OR OfficeAutomation_Document_PortAssessment_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "'";
//                }
//            }

//            PortAssessment += " GROUP BY [OfficeAutomation_Document_PortAssessment_ID]"
//                 + "          ,[OfficeAutomation_Document_PortAssessment_MainID]"
//                 + "          ,[OfficeAutomation_Document_PortAssessment_Department]"
//                 + "          ,[OfficeAutomation_Document_PortAssessment_ApplyDate]"
//                 + "          ,[OfficeAutomation_Document_PortAssessment_Apply]"
//                 + "          ,toam.OfficeAutomation_SerialNumber"
//                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
//                 + "          ,tdoad.OfficeAutomation_Document_Name"
//                 + "          ,[OfficeAutomation_Document_PortAssessment_ApplyID]"
//                 + "          ,toam.[OfficeAutomation_SerialNumber]"; 




            string ProjectCarAllowance = " SELECT [OfficeAutomation_Document_ProjectCarAllowance_ID] as ID"
+ "          ,[OfficeAutomation_Document_ProjectCarAllowance_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_ProjectCarAllowance_Department] as Department"
+ "          ,[OfficeAutomation_Document_ProjectCarAllowance_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_ProjectCarAllowance_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ProjectCarAllowance_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_ProjectCarAllowance_ApplyForName] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjectCarAllowance] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjectCarAllowance_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjectCarAllowance_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_057") || approver != "") //M_20150623
                ProjectCarAllowance += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            ProjectCarAllowance += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_057"))
                ProjectCarAllowance += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjectCarAllowance_Apply='" + employee + "')";

            if (applicationDepartment != "")
                ProjectCarAllowance += " and OfficeAutomation_Document_ProjectCarAllowance_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                ProjectCarAllowance += " and OfficeAutomation_Document_ProjectCarAllowance_Apply = '" + applicant + "'";

            if (begin != "")
                ProjectCarAllowance += " and OfficeAutomation_Document_ProjectCarAllowance_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                ProjectCarAllowance += " and OfficeAutomation_Document_ProjectCarAllowance_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                ProjectCarAllowance += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    ProjectCarAllowance += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjectCarAllowance_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        ProjectCarAllowance += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        ProjectCarAllowance += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                ProjectCarAllowance += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                ProjectCarAllowance += " and [OfficeAutomation_Document_ProjectCarAllowance_ApplyForName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                ProjectCarAllowance += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                ProjectCarAllowance += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                ProjectCarAllowance += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjectCarAllowance_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    ProjectCarAllowance += "  OR (OfficeAutomation_Document_ProjectCarAllowance_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjectCarAllowance_MainID))";
                }
            }

            ProjectCarAllowance += " GROUP BY [OfficeAutomation_Document_ProjectCarAllowance_ID]"
                 + "          ,[OfficeAutomation_Document_ProjectCarAllowance_MainID]"
                 + "          ,[OfficeAutomation_Document_ProjectCarAllowance_Department]"
                 + "          ,[OfficeAutomation_Document_ProjectCarAllowance_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ProjectCarAllowance_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjectCarAllowance_ApplyForName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string Maintenance = " SELECT [OfficeAutomation_Document_Maintenance_ID] as ID"
+ "          ,[OfficeAutomation_Document_Maintenance_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_Maintenance_Department] as Department"
+ "          ,[OfficeAutomation_Document_Maintenance_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_Maintenance_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Maintenance_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_Maintenance_Subject] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Maintenance] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Maintenance_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Maintenance_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_058") || approver != "") //M_20150623
                Maintenance += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Maintenance += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_058"))
                Maintenance += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Maintenance_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Maintenance += " and OfficeAutomation_Document_Maintenance_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Maintenance += " and OfficeAutomation_Document_Maintenance_Apply = '" + applicant + "'";

            if (begin != "")
                Maintenance += " and OfficeAutomation_Document_Maintenance_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Maintenance += " and OfficeAutomation_Document_Maintenance_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Maintenance += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Maintenance += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Maintenance_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Maintenance += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Maintenance += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Maintenance += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Maintenance += " and [OfficeAutomation_Document_Maintenance_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                Maintenance += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                Maintenance += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Maintenance += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Maintenance_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Maintenance += "  OR (OfficeAutomation_Document_Maintenance_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Maintenance_MainID))";
                }
            }

            Maintenance += " GROUP BY [OfficeAutomation_Document_Maintenance_ID]"
                 + "          ,[OfficeAutomation_Document_Maintenance_MainID]"
                 + "          ,[OfficeAutomation_Document_Maintenance_Department]"
                 + "          ,[OfficeAutomation_Document_Maintenance_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Maintenance_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_Maintenance_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string Repair = " SELECT [OfficeAutomation_Document_Repair_ID] as ID"
+ "          ,[OfficeAutomation_Document_Repair_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_Repair_Department] as Department"
+ "          ,[OfficeAutomation_Document_Repair_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_Repair_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Repair_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_Repair_ApplyID] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Repair] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Repair_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Repair_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_059") || approver != "") //M_20150623
                Repair += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Repair += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_059"))
                Repair += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Repair_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Repair += " and OfficeAutomation_Document_Repair_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Repair += " and OfficeAutomation_Document_Repair_Apply = '" + applicant + "'";

            if (begin != "")
                Repair += " and OfficeAutomation_Document_Repair_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Repair += " and OfficeAutomation_Document_Repair_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Repair += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Repair += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Repair_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Repair += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Repair += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Repair += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Repair += " and [OfficeAutomation_Document_Repair_ApplyID] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                Repair += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                Repair += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Repair += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Repair_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Repair += "  OR (OfficeAutomation_Document_Repair_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Repair_MainID))";
                }
            }

            Repair += " GROUP BY [OfficeAutomation_Document_Repair_ID]"
                 + "          ,[OfficeAutomation_Document_Repair_MainID]"
                 + "          ,[OfficeAutomation_Document_Repair_Department]"
                 + "          ,[OfficeAutomation_Document_Repair_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Repair_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_Repair_ApplyID]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string Propaganda = " SELECT [OfficeAutomation_Document_Propaganda_ID] as ID"
+ "          ,[OfficeAutomation_Document_Propaganda_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_Propaganda_Department] as Department"
+ "          ,[OfficeAutomation_Document_Propaganda_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_Propaganda_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Propaganda_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_Propaganda_TNo] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Propaganda] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Propaganda_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Propaganda_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_060") || approver != "") //M_20150623
                Propaganda += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Propaganda += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_060"))
                Propaganda += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Propaganda_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Propaganda += " and OfficeAutomation_Document_Propaganda_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Propaganda += " and OfficeAutomation_Document_Propaganda_Apply = '" + applicant + "'";

            if (begin != "")
                Propaganda += " and OfficeAutomation_Document_Propaganda_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Propaganda += " and OfficeAutomation_Document_Propaganda_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Propaganda += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Propaganda += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Propaganda_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Propaganda += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Propaganda += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Propaganda += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Propaganda += " and [OfficeAutomation_Document_Propaganda_TNo] like '%" + keyWord + "%'";
             //   Propaganda += " and [OfficeAutomation_Document_Propaganda_BranchAddress] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                Propaganda += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                Propaganda += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Propaganda += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Propaganda_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Propaganda += "  OR (OfficeAutomation_Document_Propaganda_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Propaganda_MainID))";
                }
            }

            Propaganda += " GROUP BY [OfficeAutomation_Document_Propaganda_ID]"
                 + "          ,[OfficeAutomation_Document_Propaganda_MainID]"
                 + "          ,[OfficeAutomation_Document_Propaganda_Department]"
                 + "          ,[OfficeAutomation_Document_Propaganda_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Propaganda_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_Propaganda_BranchAddress]"
                 + "          ,[OfficeAutomation_Document_Propaganda_Summary]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]"
                 + "           ,OfficeAutomation_Document_Propaganda_TNo";

            string Budgetab = " SELECT [OfficeAutomation_Document_Budgetab_ID] as ID"
+ "          ,[OfficeAutomation_Document_Budgetab_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_Budgetab_Department] as Department"
+ "          ,[OfficeAutomation_Document_Budgetab_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_Budgetab_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Budgetab_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_Budgetab_Phone] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Budgetab] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Budgetab_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Budgetab_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_061") || approver != "") //M_20150623
                Budgetab += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Budgetab += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_061"))
                Budgetab += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Budgetab_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Budgetab += " and OfficeAutomation_Document_Budgetab_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Budgetab += " and OfficeAutomation_Document_Budgetab_Apply = '" + applicant + "'";

            if (begin != "")
                Budgetab += " and OfficeAutomation_Document_Budgetab_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Budgetab += " and OfficeAutomation_Document_Budgetab_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Budgetab += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Budgetab += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Budgetab_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Budgetab += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Budgetab += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Budgetab += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Budgetab += " and [OfficeAutomation_Document_Budgetab_Phone] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                Budgetab += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                Budgetab += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Budgetab += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Budgetab_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Budgetab += "  OR (OfficeAutomation_Document_Budgetab_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Budgetab_MainID))";
                }
            }

            Budgetab += " GROUP BY [OfficeAutomation_Document_Budgetab_ID]"
                 + "          ,[OfficeAutomation_Document_Budgetab_MainID]"
                 + "          ,[OfficeAutomation_Document_Budgetab_Department]"
                 + "          ,[OfficeAutomation_Document_Budgetab_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Budgetab_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_Budgetab_Phone]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string EBAdjuct = " SELECT [OfficeAutomation_Document_EBAdjuct_ID] as ID"
+ "          ,[OfficeAutomation_Document_EBAdjuct_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_EBAdjuct_Department] as Department"
+ "          ,[OfficeAutomation_Document_EBAdjuct_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_EBAdjuct_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_EBAdjuct_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_EBAdjuct_ApplyID] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_EBAdjuct] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_EBAdjuct_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_EBAdjuct_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_062") || approver != "") //M_20150623
                EBAdjuct += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            EBAdjuct += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_062"))
                EBAdjuct += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_EBAdjuct_Apply='" + employee + "')";

            if (applicationDepartment != "")
                EBAdjuct += " and OfficeAutomation_Document_EBAdjuct_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                EBAdjuct += " and OfficeAutomation_Document_EBAdjuct_Apply = '" + applicant + "'";

            if (begin != "")
                EBAdjuct += " and OfficeAutomation_Document_EBAdjuct_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                EBAdjuct += " and OfficeAutomation_Document_EBAdjuct_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                EBAdjuct += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    EBAdjuct += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_EBAdjuct_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        EBAdjuct += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        EBAdjuct += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                EBAdjuct += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                EBAdjuct += " and [OfficeAutomation_Document_EBAdjuct_ApplyID] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                EBAdjuct += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                EBAdjuct += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                EBAdjuct += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_EBAdjuct_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    EBAdjuct += "  OR (OfficeAutomation_Document_EBAdjuct_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_EBAdjuct_MainID))";
                }
            }

            EBAdjuct += " GROUP BY [OfficeAutomation_Document_EBAdjuct_ID]"
                 + "          ,[OfficeAutomation_Document_EBAdjuct_MainID]"
                 + "          ,[OfficeAutomation_Document_EBAdjuct_Department]"
                 + "          ,[OfficeAutomation_Document_EBAdjuct_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_EBAdjuct_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_EBAdjuct_ApplyID]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string Guarantee = " SELECT [OfficeAutomation_Document_Guarantee_ID] as ID"
+ "          ,[OfficeAutomation_Document_Guarantee_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_Guarantee_Department] as Department"
+ "          ,[OfficeAutomation_Document_Guarantee_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_Guarantee_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Guarantee_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_Guarantee_Subject] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Guarantee] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Guarantee_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Guarantee_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_063") || approver != "") //M_20150623
                Guarantee += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Guarantee += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_063"))
                Guarantee += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Guarantee_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Guarantee += " and OfficeAutomation_Document_Guarantee_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Guarantee += " and OfficeAutomation_Document_Guarantee_Apply = '" + applicant + "'";

            if (begin != "")
                Guarantee += " and OfficeAutomation_Document_Guarantee_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Guarantee += " and OfficeAutomation_Document_Guarantee_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Guarantee += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Guarantee += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Guarantee_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Guarantee += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Guarantee += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Guarantee += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Guarantee += " and [OfficeAutomation_Document_Guarantee_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                Guarantee += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                Guarantee += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Guarantee += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Guarantee_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Guarantee += "  OR (OfficeAutomation_Document_Guarantee_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Guarantee_MainID))";
                }
            }

            Guarantee += " GROUP BY [OfficeAutomation_Document_Guarantee_ID]"
                 + "          ,[OfficeAutomation_Document_Guarantee_MainID]"
                 + "          ,[OfficeAutomation_Document_Guarantee_Department]"
                 + "          ,[OfficeAutomation_Document_Guarantee_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Guarantee_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_Guarantee_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string SignedG = " SELECT [OfficeAutomation_Document_SignedG_ID] as ID"
+ "          ,[OfficeAutomation_Document_SignedG_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_SignedG_Department] as Department"
+ "          ,[OfficeAutomation_Document_SignedG_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_SignedG_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_SignedG_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_SignedG_Subject] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SignedG] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SignedG_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SignedG_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_064") || approver != "") //M_20150623
                SignedG += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            SignedG += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_064"))
                SignedG += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SignedG_Apply='" + employee + "')";

            if (applicationDepartment != "")
                SignedG += " and OfficeAutomation_Document_SignedG_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                SignedG += " and OfficeAutomation_Document_SignedG_Apply = '" + applicant + "'";

            if (begin != "")
                SignedG += " and OfficeAutomation_Document_SignedG_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                SignedG += " and OfficeAutomation_Document_SignedG_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                SignedG += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    SignedG += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SignedG_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        SignedG += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        SignedG += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                SignedG += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                SignedG += " and [OfficeAutomation_Document_SignedG_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                SignedG += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                SignedG += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                SignedG += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_SignedG_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    SignedG += "  OR (OfficeAutomation_Document_SignedG_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_SignedG_MainID))";
                }
            }

            SignedG += " GROUP BY [OfficeAutomation_Document_SignedG_ID]"
                 + "          ,[OfficeAutomation_Document_SignedG_MainID]"
                 + "          ,[OfficeAutomation_Document_SignedG_Department]"
                 + "          ,[OfficeAutomation_Document_SignedG_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_SignedG_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_SignedG_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string PullafewRd = " SELECT [OfficeAutomation_Document_PullafewRd_ID] as ID"
+ "          ,[OfficeAutomation_Document_PullafewRd_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_PullafewRd_Department] as Department"
+ "          ,[OfficeAutomation_Document_PullafewRd_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_PullafewRd_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_PullafewRd_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_PullafewRd_ApplyID] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_PullafewRd] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_PullafewRd_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_PullafewRd_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_065") || approver != "") //M_20150623
                PullafewRd += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            PullafewRd += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_065"))
                PullafewRd += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_PullafewRd_Apply='" + employee + "')";

            if (applicationDepartment != "")
                PullafewRd += " and OfficeAutomation_Document_PullafewRd_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                PullafewRd += " and OfficeAutomation_Document_PullafewRd_Apply = '" + applicant + "'";

            if (begin != "")
                PullafewRd += " and OfficeAutomation_Document_PullafewRd_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                PullafewRd += " and OfficeAutomation_Document_PullafewRd_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                PullafewRd += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    PullafewRd += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PullafewRd_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        PullafewRd += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        PullafewRd += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                PullafewRd += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                PullafewRd += " and [OfficeAutomation_Document_PullafewRd_ApplyID] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                PullafewRd += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                PullafewRd += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                PullafewRd += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_PullafewRd_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    PullafewRd += "  OR (OfficeAutomation_Document_PullafewRd_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_PullafewRd_MainID))";
                }
            }

            PullafewRd += " GROUP BY [OfficeAutomation_Document_PullafewRd_ID]"
                 + "          ,[OfficeAutomation_Document_PullafewRd_MainID]"
                 + "          ,[OfficeAutomation_Document_PullafewRd_Department]"
                 + "          ,[OfficeAutomation_Document_PullafewRd_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_PullafewRd_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_PullafewRd_ApplyID]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string PullafewTwo = " SELECT [OfficeAutomation_Document_PullafewTwo_ID] as ID"
+ "          ,[OfficeAutomation_Document_PullafewTwo_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_PullafewTwo_Department] as Department"
+ "          ,[OfficeAutomation_Document_PullafewTwo_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_PullafewTwo_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_PullafewTwo_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_PullafewTwo_ApplyID] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_PullafewTwo] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_PullafewTwo_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_PullafewTwo_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_066") || approver != "") //M_20150623
                PullafewTwo += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            PullafewTwo += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_066"))
                PullafewTwo += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_PullafewTwo_Apply='" + employee + "')";

            if (applicationDepartment != "")
                PullafewTwo += " and OfficeAutomation_Document_PullafewTwo_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                PullafewTwo += " and OfficeAutomation_Document_PullafewTwo_Apply = '" + applicant + "'";

            if (begin != "")
                PullafewTwo += " and OfficeAutomation_Document_PullafewTwo_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                PullafewTwo += " and OfficeAutomation_Document_PullafewTwo_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                PullafewTwo += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    PullafewTwo += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PullafewTwo_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        PullafewTwo += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        PullafewTwo += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                PullafewTwo += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                PullafewTwo += " and [OfficeAutomation_Document_PullafewTwo_ApplyID] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                PullafewTwo += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                PullafewTwo += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                PullafewTwo += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_PullafewTwo_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    PullafewTwo += "  OR (OfficeAutomation_Document_PullafewTwo_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_PullafewTwo_MainID))";
                }
            }

            PullafewTwo += " GROUP BY [OfficeAutomation_Document_PullafewTwo_ID]"
                 + "          ,[OfficeAutomation_Document_PullafewTwo_MainID]"
                 + "          ,[OfficeAutomation_Document_PullafewTwo_Department]"
                 + "          ,[OfficeAutomation_Document_PullafewTwo_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_PullafewTwo_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_PullafewTwo_ApplyID]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string UtContract = " SELECT [OfficeAutomation_Document_UtContract_ID] as ID"
+ "          ,[OfficeAutomation_Document_UtContract_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_UtContract_Department] as Department"
+ "          ,[OfficeAutomation_Document_UtContract_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_UtContract_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_UtContract_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,([OfficeAutomation_Document_UtContract_Name1] + [OfficeAutomation_Document_UtContract_Name2]) as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_UtContract] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_UtContract_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_UtContract_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_067") || approver != "") //M_20150623
                UtContract += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            UtContract += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_067"))
                UtContract += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_UtContract_Apply='" + employee + "')";

            if (applicationDepartment != "")
                UtContract += " and OfficeAutomation_Document_UtContract_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                UtContract += " and OfficeAutomation_Document_UtContract_Apply = '" + applicant + "'";

            if (begin != "")
                UtContract += " and OfficeAutomation_Document_UtContract_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                UtContract += " and OfficeAutomation_Document_UtContract_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                UtContract += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    UtContract += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UtContract_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        UtContract += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        UtContract += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                UtContract += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                UtContract += " and ([OfficeAutomation_Document_UtContract_Name1] like '%" + keyWord + "%' OR [OfficeAutomation_Document_UtContract_Name2] like '%" + keyWord + "%')";

            if (willDelete) //M_DeleteAdd 20151230
                UtContract += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                UtContract += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                UtContract += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_UtContract_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    UtContract += "  OR (OfficeAutomation_Document_UtContract_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_UtContract_MainID))";
                }
            }

            UtContract += " GROUP BY [OfficeAutomation_Document_UtContract_ID]"
                 + "          ,[OfficeAutomation_Document_UtContract_MainID]"
                 + "          ,[OfficeAutomation_Document_UtContract_Department]"
                 + "          ,[OfficeAutomation_Document_UtContract_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_UtContract_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_UtContract_Name1]"
                 + "          ,[OfficeAutomation_Document_UtContract_Name2]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string UtNewProj = " SELECT [OfficeAutomation_Document_UtNewProj_ID] as ID"
+ "          ,[OfficeAutomation_Document_UtNewProj_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_UtNewProj_Department] as Department"
+ "          ,[OfficeAutomation_Document_UtNewProj_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_UtNewProj_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_UtNewProj_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_UtNewProj_Project] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_UtNewProj] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_UtNewProj_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_UtNewProj_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_068") || approver != "") //M_20150623
                UtNewProj += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            UtNewProj += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_068"))
                UtNewProj += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_UtNewProj_Apply='" + employee + "')";

            if (applicationDepartment != "")
                UtNewProj += " and OfficeAutomation_Document_UtNewProj_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                UtNewProj += " and OfficeAutomation_Document_UtNewProj_Apply = '" + applicant + "'";

            if (begin != "")
                UtNewProj += " and OfficeAutomation_Document_UtNewProj_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                UtNewProj += " and OfficeAutomation_Document_UtNewProj_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                UtNewProj += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    UtNewProj += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_UtNewProj_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        UtNewProj += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        UtNewProj += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                UtNewProj += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                UtNewProj += " and [OfficeAutomation_Document_UtNewProj_Project] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                UtNewProj += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                UtNewProj += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                UtNewProj += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_UtNewProj_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    UtNewProj += "  OR (OfficeAutomation_Document_UtNewProj_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_UtNewProj_MainID))";
                }
            }

            UtNewProj += " GROUP BY [OfficeAutomation_Document_UtNewProj_ID]"
                 + "          ,[OfficeAutomation_Document_UtNewProj_MainID]"
                 + "          ,[OfficeAutomation_Document_UtNewProj_Department]"
                 + "          ,[OfficeAutomation_Document_UtNewProj_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_UtNewProj_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_UtNewProj_Project]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string ProjReDaAdd = " SELECT [OfficeAutomation_Document_ProjReDaAdd_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ProjReDaAdd_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ProjReDaAdd_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ProjReDaAdd_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ProjReDaAdd_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ProjReDaAdd_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjReDaAdd_ProjName] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjReDaAdd] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjReDaAdd_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjReDaAdd_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_069") || approver != "") //M_20150623
                ProjReDaAdd += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            ProjReDaAdd += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_069"))
                ProjReDaAdd += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjReDaAdd_Apply='" + employee + "')";

            if (applicationDepartment != "")
                ProjReDaAdd += " and OfficeAutomation_Document_ProjReDaAdd_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                ProjReDaAdd += " and OfficeAutomation_Document_ProjReDaAdd_Apply = '" + applicant + "'";

            if (begin != "")
                ProjReDaAdd += " and OfficeAutomation_Document_ProjReDaAdd_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                ProjReDaAdd += " and OfficeAutomation_Document_ProjReDaAdd_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                ProjReDaAdd += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    ProjReDaAdd += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjReDaAdd_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        ProjReDaAdd += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        ProjReDaAdd += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                ProjReDaAdd += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                ProjReDaAdd += " and [OfficeAutomation_Document_ProjReDaAdd_ProjName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                ProjReDaAdd += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                ProjReDaAdd += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                ProjReDaAdd += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjReDaAdd_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    ProjReDaAdd += "  OR (OfficeAutomation_Document_ProjReDaAdd_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjReDaAdd_MainID))";
                }
            }

            ProjReDaAdd += " GROUP BY [OfficeAutomation_Document_ProjReDaAdd_ID]"
                 + "          ,[OfficeAutomation_Document_ProjReDaAdd_MainID]"
                 + "          ,[OfficeAutomation_Document_ProjReDaAdd_Department]"
                 + "          ,[OfficeAutomation_Document_ProjReDaAdd_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ProjReDaAdd_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjReDaAdd_ProjName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string WrongSave = " SELECT [OfficeAutomation_Document_WrongSave_ID] as ID"
                 + "          ,[OfficeAutomation_Document_WrongSave_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_WrongSave_Department] as Department"
                 + "          ,[OfficeAutomation_Document_WrongSave_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_WrongSave_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_WrongSave_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 //+ "          ,[OfficeAutomation_Document_WrongSave_Address] as Remark"
                 + ",(case  when OfficeAutomation_Main_Sremark is null then '' else OfficeAutomation_Main_Sremark end ) + (case  when OfficeAutomation_Main_Summary is null then '' else OfficeAutomation_Main_Summary end )  as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_WrongSave] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_WrongSave_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_WrongSave_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_070") || approver != "") //M_20150623
                WrongSave += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            WrongSave += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_070"))
                WrongSave += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_WrongSave_Apply='" + employee + "')";

            if (applicationDepartment != "")
                WrongSave += " and OfficeAutomation_Document_WrongSave_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                WrongSave += " and OfficeAutomation_Document_WrongSave_Apply = '" + applicant + "'";

            if (begin != "")
                WrongSave += " and OfficeAutomation_Document_WrongSave_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                WrongSave += " and OfficeAutomation_Document_WrongSave_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                WrongSave += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    WrongSave += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WrongSave_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        WrongSave += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        WrongSave += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                WrongSave += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                WrongSave += " and [OfficeAutomation_Document_WrongSave_Address] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                WrongSave += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                WrongSave += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                WrongSave += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_WrongSave_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    WrongSave += "  OR (OfficeAutomation_Document_WrongSave_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_WrongSave_MainID))";
                }
            }

            WrongSave += " GROUP BY [OfficeAutomation_Document_WrongSave_ID]"
                 + "          ,[OfficeAutomation_Document_WrongSave_MainID]"
                 + "          ,[OfficeAutomation_Document_WrongSave_Department]"
                 + "          ,[OfficeAutomation_Document_WrongSave_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_WrongSave_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_WrongSave_Address]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]"
                 + "          ,toam.[OfficeAutomation_Main_Sremark]"
                 + "          ,toam.[OfficeAutomation_Main_Summary]";

            string BuyBudiData = " SELECT [OfficeAutomation_Document_BuyBudiData_ID] as ID"
                 + "          ,[OfficeAutomation_Document_BuyBudiData_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_BuyBudiData_Department] as Department"
                 + "          ,[OfficeAutomation_Document_BuyBudiData_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_BuyBudiData_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_BuyBudiData_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_BuyBudiData_Area] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BuyBudiData] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BuyBudiData_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BuyBudiData_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_071") || approver != "") //M_20150623
                BuyBudiData += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            BuyBudiData += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_071"))
                BuyBudiData += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BuyBudiData_Apply='" + employee + "')";

            if (applicationDepartment != "")
                BuyBudiData += " and OfficeAutomation_Document_BuyBudiData_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                BuyBudiData += " and OfficeAutomation_Document_BuyBudiData_Apply = '" + applicant + "'";

            if (begin != "")
                BuyBudiData += " and OfficeAutomation_Document_BuyBudiData_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                BuyBudiData += " and OfficeAutomation_Document_BuyBudiData_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                BuyBudiData += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    BuyBudiData += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BuyBudiData_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        BuyBudiData += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        BuyBudiData += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                BuyBudiData += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                BuyBudiData += " and [OfficeAutomation_Document_BuyBudiData_Area] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                BuyBudiData += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                BuyBudiData += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                BuyBudiData += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_BuyBudiData_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    BuyBudiData += "  OR (OfficeAutomation_Document_BuyBudiData_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_BuyBudiData_MainID))";
                }
            }

            BuyBudiData += " GROUP BY [OfficeAutomation_Document_BuyBudiData_ID]"
                 + "          ,[OfficeAutomation_Document_BuyBudiData_MainID]"
                 + "          ,[OfficeAutomation_Document_BuyBudiData_Department]"
                 + "          ,[OfficeAutomation_Document_BuyBudiData_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_BuyBudiData_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_BuyBudiData_Area]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string ProjBaComm = " SELECT [OfficeAutomation_Document_ProjBaComm_ID] as ID"
                 + "          ,[OfficeAutomation_Document_ProjBaComm_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_ProjBaComm_Department] as Department"
                 + "          ,[OfficeAutomation_Document_ProjBaComm_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_ProjBaComm_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ProjBaComm_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,([OfficeAutomation_Document_ProjBaComm_Building] + CONVERT(nvarchar(80),OfficeAutomation_Document_ProjBaComm_MoneyCount) + ISNULL(OfficeAutomation_Document_ProjBaComm_Remark,'')) as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjBaComm] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjBaComm_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjBaComm_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_072") || approver != "") //M_20150623
                ProjBaComm += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            ProjBaComm += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_072"))
                ProjBaComm += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjBaComm_Apply='" + employee + "')";

            if (applicationDepartment != "")
                ProjBaComm += " and OfficeAutomation_Document_ProjBaComm_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                ProjBaComm += " and OfficeAutomation_Document_ProjBaComm_Apply = '" + applicant + "'";

            if (begin != "")
                ProjBaComm += " and OfficeAutomation_Document_ProjBaComm_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                ProjBaComm += " and OfficeAutomation_Document_ProjBaComm_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                ProjBaComm += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    ProjBaComm += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjBaComm_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        ProjBaComm += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        ProjBaComm += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                ProjBaComm += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                ProjBaComm += " and [OfficeAutomation_Document_ProjBaComm_Building] like '%" + keyWord + "%' OR CONVERT(nvarchar(80),OfficeAutomation_Document_ProjBaComm_MoneyCount) like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                ProjBaComm += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                ProjBaComm += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                ProjBaComm += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjBaComm_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    ProjBaComm += "  OR (OfficeAutomation_Document_ProjBaComm_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjBaComm_MainID))";
                }
            }

            ProjBaComm += " GROUP BY [OfficeAutomation_Document_ProjBaComm_ID]"
                 + "          ,[OfficeAutomation_Document_ProjBaComm_MainID]"
                 + "          ,[OfficeAutomation_Document_ProjBaComm_Department]"
                 + "          ,[OfficeAutomation_Document_ProjBaComm_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ProjBaComm_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjBaComm_Building]"
                 + "          ,[OfficeAutomation_Document_ProjBaComm_Remark]"
                 + "          ,[OfficeAutomation_Document_ProjBaComm_MoneyCount]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]"; //关键字有多个

            string BorrowMoney = " SELECT [OfficeAutomation_Document_BorrowMoney_ID] as ID"
                 + "          ,[OfficeAutomation_Document_BorrowMoney_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_BorrowMoney_Department] as Department"
                 + "          ,[OfficeAutomation_Document_BorrowMoney_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_BorrowMoney_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_BorrowMoney_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_BorrowMoney_ApplyID] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_BorrowMoney] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_BorrowMoney_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_BorrowMoney_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_073") || approver != "") //M_20150623
                BorrowMoney += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            BorrowMoney += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_073"))
                BorrowMoney += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_BorrowMoney_Apply='" + employee + "')";

            if (applicationDepartment != "")
                BorrowMoney += " and OfficeAutomation_Document_BorrowMoney_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                BorrowMoney += " and OfficeAutomation_Document_BorrowMoney_Apply = '" + applicant + "'";

            if (begin != "")
                BorrowMoney += " and OfficeAutomation_Document_BorrowMoney_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                BorrowMoney += " and OfficeAutomation_Document_BorrowMoney_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                BorrowMoney += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    BorrowMoney += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_BorrowMoney_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        BorrowMoney += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        BorrowMoney += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                BorrowMoney += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                BorrowMoney += " and [OfficeAutomation_Document_BorrowMoney_ApplyID] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                BorrowMoney += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                BorrowMoney += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                BorrowMoney += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_BorrowMoney_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    BorrowMoney += "  OR (OfficeAutomation_Document_BorrowMoney_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_BorrowMoney_MainID))";
                }
            }

            BorrowMoney += " GROUP BY [OfficeAutomation_Document_BorrowMoney_ID]"
                 + "          ,[OfficeAutomation_Document_BorrowMoney_MainID]"
                 + "          ,[OfficeAutomation_Document_BorrowMoney_Department]"
                 + "          ,[OfficeAutomation_Document_BorrowMoney_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_BorrowMoney_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_BorrowMoney_ApplyID]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";


            string SpecialAdd = " SELECT [OfficeAutomation_Document_SpecialAdd_ID] as ID"
                 + "          ,[OfficeAutomation_Document_SpecialAdd_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_SpecialAdd_Department] as Department"
                 + "          ,[OfficeAutomation_Document_SpecialAdd_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_SpecialAdd_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_SpecialAdd_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_SpecialAdd_Subject] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SpecialAdd] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SpecialAdd_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SpecialAdd_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_074") || approver != "") //M_20150623
                SpecialAdd += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            SpecialAdd += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_074"))
                SpecialAdd += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SpecialAdd_Apply='" + employee + "')";

            if (applicationDepartment != "")
                SpecialAdd += " and OfficeAutomation_Document_SpecialAdd_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                SpecialAdd += " and OfficeAutomation_Document_SpecialAdd_Apply = '" + applicant + "'";

            if (begin != "")
                SpecialAdd += " and OfficeAutomation_Document_SpecialAdd_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                SpecialAdd += " and OfficeAutomation_Document_SpecialAdd_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                SpecialAdd += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    SpecialAdd += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SpecialAdd_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        SpecialAdd += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        SpecialAdd += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                SpecialAdd += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                SpecialAdd += " and [OfficeAutomation_Document_SpecialAdd_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                SpecialAdd += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                SpecialAdd += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                SpecialAdd += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_SpecialAdd_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    SpecialAdd += "  OR (OfficeAutomation_Document_SpecialAdd_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_SpecialAdd_MainID))";
                }
            }

            SpecialAdd += " GROUP BY [OfficeAutomation_Document_SpecialAdd_ID]"
                 + "          ,[OfficeAutomation_Document_SpecialAdd_MainID]"
                 + "          ,[OfficeAutomation_Document_SpecialAdd_Department]"
                 + "          ,[OfficeAutomation_Document_SpecialAdd_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_SpecialAdd_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_SpecialAdd_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string OpenProve = " SELECT [OfficeAutomation_Document_OpenProve_ID] as ID"
                 + "          ,[OfficeAutomation_Document_OpenProve_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_OpenProve_Department] as Department"
                 + "          ,[OfficeAutomation_Document_OpenProve_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_OpenProve_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_OpenProve_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_OpenProve_Name] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_OpenProve] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_OpenProve_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_OpenProve_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_075") || approver != "") //M_20150623
                OpenProve += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            OpenProve += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_075"))
                OpenProve += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_OpenProve_Apply='" + employee + "')";

            if (applicationDepartment != "")
                OpenProve += " and OfficeAutomation_Document_OpenProve_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                OpenProve += " and OfficeAutomation_Document_OpenProve_Apply = '" + applicant + "'";

            if (begin != "")
                OpenProve += " and OfficeAutomation_Document_OpenProve_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                OpenProve += " and OfficeAutomation_Document_OpenProve_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                OpenProve += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    OpenProve += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_OpenProve_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        OpenProve += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        OpenProve += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                OpenProve += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                OpenProve += " and [OfficeAutomation_Document_OpenProve_Name] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                OpenProve += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                OpenProve += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                OpenProve += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_OpenProve_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    OpenProve += "  OR (OfficeAutomation_Document_OpenProve_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_OpenProve_MainID))";
                }
            }

            OpenProve += " GROUP BY [OfficeAutomation_Document_OpenProve_ID]"
                 + "          ,[OfficeAutomation_Document_OpenProve_MainID]"
                 + "          ,[OfficeAutomation_Document_OpenProve_Department]"
                 + "          ,[OfficeAutomation_Document_OpenProve_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_OpenProve_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_OpenProve_Name]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string PartTime = " SELECT [OfficeAutomation_Document_PartTime_ID] as ID"
                 + "          ,[OfficeAutomation_Document_PartTime_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_PartTime_Department] as Department"
                 + "          ,[OfficeAutomation_Document_PartTime_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_PartTime_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_PartTime_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_PartTime_2taC] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_PartTime] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_PartTime_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_PartTime_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_076") || approver != "") //M_20150623
                PartTime += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            PartTime += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_076"))
                PartTime += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_PartTime_Apply='" + employee + "')";

            if (applicationDepartment != "")
                PartTime += " and OfficeAutomation_Document_PartTime_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                PartTime += " and OfficeAutomation_Document_PartTime_Apply = '" + applicant + "'";

            if (begin != "")
                PartTime += " and OfficeAutomation_Document_PartTime_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                PartTime += " and OfficeAutomation_Document_PartTime_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                PartTime += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    PartTime += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_PartTime_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        PartTime += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        PartTime += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                PartTime += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                PartTime += " and [OfficeAutomation_Document_PartTime_2taC] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                PartTime += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                PartTime += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                PartTime += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_PartTime_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    PartTime += "  OR (OfficeAutomation_Document_PartTime_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_PartTime_MainID))";
                }
            }

            PartTime += " GROUP BY [OfficeAutomation_Document_PartTime_ID]"
                 + "          ,[OfficeAutomation_Document_PartTime_MainID]"
                 + "          ,[OfficeAutomation_Document_PartTime_Department]"
                 + "          ,[OfficeAutomation_Document_PartTime_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_PartTime_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_PartTime_2taC]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";


            string SysLogist = " SELECT [OfficeAutomation_Document_SysLogist_ID] as ID"
                 + "          ,[OfficeAutomation_Document_SysLogist_MainID] as MainID"
                 + "          ,[OfficeAutomation_Document_SysLogist_DepartmentID] as DepartmentID"
                 + "          ,[OfficeAutomation_Document_SysLogist_Department] as Department"
                 + "          ,[OfficeAutomation_Document_SysLogist_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_SysLogist_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_SysLogist_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,(SELECT OfficeAutomation_SoftSystem_Name FROM t_Dic_OfficeAutomation_SoftSystem WHERE OfficeAutomation_SoftSystem_ID = OfficeAutomation_Document_SysLogist_SystemName) as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SysLogist] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SysLogist_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                 + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SysLogist_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_077") || approver != "") //M_20150623
                SysLogist += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            SysLogist += " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";

            if (!isAdmin && !purview.Contains("OA_Search_077"))  //20140919-跟进人也能看到审批表
                SysLogist += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SysLogist_Apply='" + employee + "' or ISNULL(OfficeAutomation_Document_SysLogist_Follower,'') Like '%" + employee + "%')";

            if (applicationDepartment != "")
                SysLogist += " and OfficeAutomation_Document_SysLogist_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                SysLogist += " and OfficeAutomation_Document_SysLogist_Apply = '" + applicant + "'";

            if (begin != "")
                SysLogist += " and OfficeAutomation_Document_SysLogist_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                SysLogist += " and OfficeAutomation_Document_SysLogist_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                SysLogist += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    SysLogist += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SysLogist_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        SysLogist += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        SysLogist += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                SysLogist += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                //SysLogist += " and [OfficeAutomation_Document_SysLogist_ReqContent] like '%" + keyWord + "%'";
                SysLogist += " and (SELECT OfficeAutomation_SoftSystem_Name FROM t_Dic_OfficeAutomation_SoftSystem WHERE OfficeAutomation_SoftSystem_ID = OfficeAutomation_Document_SysLogist_SystemName) like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                SysLogist += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                SysLogist += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                SysLogist += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_SysLogist_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    SysLogist += "  OR (OfficeAutomation_Document_SysLogist_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_SysLogist_MainID))";
                }
            }

            SysLogist += " GROUP BY [OfficeAutomation_Document_SysLogist_ID]"
                 + "          ,[OfficeAutomation_Document_SysLogist_MainID]"
                 + "          ,[OfficeAutomation_Document_SysLogist_DepartmentID]"
                 + "          ,[OfficeAutomation_Document_SysLogist_Department]"
                 + "          ,[OfficeAutomation_Document_SysLogist_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_SysLogist_Apply]"
                 + "          ,[OfficeAutomation_Document_SysLogist_SystemName]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,toam.[OfficeAutomation_SerialNumber]"; //该段有跟进人字段，切勿用作模板

            string SolHold = " SELECT [OfficeAutomation_Document_SolHold_ID] as ID"
                 + "          ,[OfficeAutomation_Document_SolHold_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_SolHold_Department] as Department"
                 + "          ,[OfficeAutomation_Document_SolHold_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_SolHold_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_SolHold_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_SolHold_FinText] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_SolHold] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_SolHold_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_SolHold_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_078") || approver != "") //M_20150623
                SolHold += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            SolHold += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_078"))
                SolHold += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_SolHold_Apply='" + employee + "')";

            if (applicationDepartment != "")
                SolHold += " and OfficeAutomation_Document_SolHold_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                SolHold += " and OfficeAutomation_Document_SolHold_Apply = '" + applicant + "'";

            if (begin != "")
                SolHold += " and OfficeAutomation_Document_SolHold_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                SolHold += " and OfficeAutomation_Document_SolHold_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                SolHold += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    SolHold += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_SolHold_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        SolHold += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        SolHold += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                SolHold += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                SolHold += " and ([OfficeAutomation_Document_SolHold_Address] like '%" + keyWord + "%' or [OfficeAutomation_Document_SolHold_ApplyID] like '%" + keyWord + "%' or [OfficeAutomation_Document_SolHold_Money] = '" + keyWord + "' )";

            if (willDelete) //M_DeleteAdd 20151230
                SolHold += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                SolHold += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                SolHold += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_SolHold_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    SolHold += "  OR (OfficeAutomation_Document_SolHold_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_SolHold_MainID))";
                }
            }

            SolHold += " GROUP BY [OfficeAutomation_Document_SolHold_ID]"
                 + "          ,[OfficeAutomation_Document_SolHold_MainID]"
                 + "          ,[OfficeAutomation_Document_SolHold_Department]"
                 + "          ,[OfficeAutomation_Document_SolHold_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_SolHold_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_SolHold_Address]"
                 + "          ,[OfficeAutomation_Document_SolHold_FinText]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";


            string HoldCoisn = " SELECT [OfficeAutomation_Document_HoldCoisn_ID] as ID"
                 + "          ,[OfficeAutomation_Document_HoldCoisn_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_HoldCoisn_Department] as Department"
                 + "          ,[OfficeAutomation_Document_HoldCoisn_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_HoldCoisn_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_HoldCoisn_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_HoldCoisn_Address] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_HoldCoisn] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_HoldCoisn_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_HoldCoisn_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_079") || approver != "") //M_20150623
                HoldCoisn += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            HoldCoisn += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_079"))
                HoldCoisn += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_HoldCoisn_Apply='" + employee + "')";

            if (applicationDepartment != "")
                HoldCoisn += " and OfficeAutomation_Document_HoldCoisn_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                HoldCoisn += " and OfficeAutomation_Document_HoldCoisn_Apply = '" + applicant + "'";

            if (begin != "")
                HoldCoisn += " and OfficeAutomation_Document_HoldCoisn_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                HoldCoisn += " and OfficeAutomation_Document_HoldCoisn_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                HoldCoisn += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    HoldCoisn += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HoldCoisn_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        HoldCoisn += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        HoldCoisn += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                HoldCoisn += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                HoldCoisn += " and [OfficeAutomation_Document_HoldCoisn_Address] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                HoldCoisn += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                HoldCoisn += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                HoldCoisn += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_HoldCoisn_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    HoldCoisn += "  OR (OfficeAutomation_Document_HoldCoisn_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_HoldCoisn_MainID))";
                }
            }

            HoldCoisn += " GROUP BY [OfficeAutomation_Document_HoldCoisn_ID]"
                 + "          ,[OfficeAutomation_Document_HoldCoisn_MainID]"
                 + "          ,[OfficeAutomation_Document_HoldCoisn_Department]"
                 + "          ,[OfficeAutomation_Document_HoldCoisn_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_HoldCoisn_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_HoldCoisn_Address]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string Record = " SELECT [OfficeAutomation_Document_Record_ID] as ID"
                 + "          ,[OfficeAutomation_Document_Record_MainID] as MainID"
                 + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                 + "          ,[OfficeAutomation_Document_Record_Department] as Department"
                 + "          ,[OfficeAutomation_Document_Record_ApplyDate] as ApplyDate"
                 + "          ,[OfficeAutomation_Document_Record_Apply] as Apply"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Record_MainID) AS [waitfor]"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_Record_Address] as Remark"
                 + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                 + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                 + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Record] todi"
                 + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Record_MainID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                 + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
            + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Record_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_080") || approver != "") //M_20150623
                Record += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Record += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_080"))
                Record += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Record_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Record += " and OfficeAutomation_Document_Record_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Record += " and OfficeAutomation_Document_Record_Apply = '" + applicant + "'";

            if (begin != "")
                Record += " and OfficeAutomation_Document_Record_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Record += " and OfficeAutomation_Document_Record_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Record += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Record += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Record_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Record += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Record += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Record += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Record += " and [OfficeAutomation_Document_Record_Address] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                Record += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                Record += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Record += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Record_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Record += "  OR (OfficeAutomation_Document_Record_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Record_MainID))";
                }
            }

            Record += " GROUP BY [OfficeAutomation_Document_Record_ID]"
                 + "          ,[OfficeAutomation_Document_Record_MainID]"
                 + "          ,[OfficeAutomation_Document_Record_Department]"
                 + "          ,[OfficeAutomation_Document_Record_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Record_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_Record_Address]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string CallCenter = " SELECT [OfficeAutomation_Document_CallCenterFeasibility_ID] as ID"
                         + "          ,[OfficeAutomation_Document_CallCenterFeasibility_MainID] as MainID"
                         + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                         + "          ,[OfficeAutomation_Document_CallCenterFeasibility_Department] as Department"
                         + "          ,[OfficeAutomation_Document_CallCenterFeasibility_ApplyDate] as ApplyDate"
                         + "          ,[OfficeAutomation_Document_CallCenterFeasibility_Apply] as Apply"
                         + "          ,toam.OfficeAutomation_SerialNumber"
                         + "          ,toam.OfficeAutomation_Main_FlowStateID"
                         + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_CallCenterFeasibility_MainID) AS [waitfor]"
                         + "          ,tdoad.OfficeAutomation_Document_Name"
                         + "          ,[OfficeAutomation_Document_CallCenterFeasibility_Address] as Remark"
                         + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                         + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                         + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CallCenterFeasibility] todi"
                         + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CallCenterFeasibility_MainID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CallCenterFeasibility_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_081") || approver != "") //M_20150623
                CallCenter += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            CallCenter += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_081"))
                CallCenter += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CallCenterFeasibility_Apply='" + employee + "')";

            if (applicationDepartment != "")
                CallCenter += " and OfficeAutomation_Document_CallCenterFeasibility_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                CallCenter += " and OfficeAutomation_Document_CallCenterFeasibility_Apply = '" + applicant + "'";

            if (begin != "")
                CallCenter += " and OfficeAutomation_Document_CallCenterFeasibility_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                CallCenter += " and OfficeAutomation_Document_CallCenterFeasibility_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                CallCenter += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    CallCenter += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CallCenterFeasibility_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        CallCenter += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        CallCenter += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                CallCenter += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                CallCenter += " and [OfficeAutomation_Document_CallCenterFeasibility_Address] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                CallCenter += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                CallCenter += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                CallCenter += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CallCenterFeasibility_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    CallCenter += "  OR (OfficeAutomation_Document_CallCenterFeasibility_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CallCenterFeasibility_MainID))";
                }
            }

            CallCenter += " GROUP BY [OfficeAutomation_Document_CallCenterFeasibility_ID]"
                 + "          ,[OfficeAutomation_Document_CallCenterFeasibility_MainID]"
                 + "          ,[OfficeAutomation_Document_CallCenterFeasibility_Department]"
                 + "          ,[OfficeAutomation_Document_CallCenterFeasibility_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_CallCenterFeasibility_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_CallCenterFeasibility_Address]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";


            string WYRecruit = " SELECT [OfficeAutomation_Document_WYRecruit_ID] as ID"
                         + "          ,[OfficeAutomation_Document_WYRecruit_MainID] as MainID"
                         + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                         + "          ,[OfficeAutomation_Document_WYRecruit_Department] as Department"
                         + "          ,[OfficeAutomation_Document_WYRecruit_ApplyDate] as ApplyDate"
                         + "          ,[OfficeAutomation_Document_WYRecruit_Apply] as Apply"
                         + "          ,toam.OfficeAutomation_SerialNumber"
                         + "          ,toam.OfficeAutomation_Main_FlowStateID"
                         + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_WYRecruit_MainID) AS [waitfor]"
                         + "          ,tdoad.OfficeAutomation_Document_Name"
                         + "          ,[OfficeAutomation_Document_WYRecruit_Remark] as Remark"
                         + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                         + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                         + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_WYRecruit] todi"
                         + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_WYRecruit_MainID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_WYRecruit_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_082") || approver != "") //M_20150623
                WYRecruit += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            WYRecruit += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            //2016/9/26-52100 申请创建人不为申请人时亦可查看申请
            //if (!isAdmin && !purview.Contains("OA_Search_082"))
            //    WYRecruit += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_WYRecruit_Apply='" + employee + "')";
            if (!isAdmin && !purview.Contains("OA_Search_082"))
                WYRecruit += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_WYRecruit_Apply='" + employee + "' or toam.OfficeAutomation_Main_Creater='" + employee + "')";

            if (applicationDepartment != "")
                WYRecruit += " and OfficeAutomation_Document_WYRecruit_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                WYRecruit += " and OfficeAutomation_Document_WYRecruit_Apply = '" + applicant + "'";

            if (begin != "")
                WYRecruit += " and OfficeAutomation_Document_WYRecruit_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                WYRecruit += " and OfficeAutomation_Document_WYRecruit_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                WYRecruit += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    WYRecruit += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_WYRecruit_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        WYRecruit += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        WYRecruit += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                WYRecruit += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                WYRecruit += " and [OfficeAutomation_Document_WYRecruit_Remark] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                WYRecruit += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                WYRecruit += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                WYRecruit += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_WYRecruit_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    WYRecruit += "  OR (OfficeAutomation_Document_WYRecruit_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_WYRecruit_MainID))";
                }
            }

            WYRecruit += " GROUP BY [OfficeAutomation_Document_WYRecruit_ID]"
                 + "          ,[OfficeAutomation_Document_WYRecruit_MainID]"
                 + "          ,[OfficeAutomation_Document_WYRecruit_Department]"
                 + "          ,[OfficeAutomation_Document_WYRecruit_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_WYRecruit_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_WYRecruit_Remark]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string Recruit = " SELECT [OfficeAutomation_Document_Recruit_ID] as ID"
                         + "          ,[OfficeAutomation_Document_Recruit_MainID] as MainID"
                         + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                         + "          ,[OfficeAutomation_Document_Recruit_Department] as Department"
                         + "          ,[OfficeAutomation_Document_Recruit_ApplyDate] as ApplyDate"
                         + "          ,[OfficeAutomation_Document_Recruit_Apply] as Apply"
                         + "          ,toam.OfficeAutomation_SerialNumber"
                         + "          ,toam.OfficeAutomation_Main_FlowStateID"
                         + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Recruit_MainID) AS [waitfor]"
                         + "          ,tdoad.OfficeAutomation_Document_Name"
                         + "          ,[OfficeAutomation_Document_Recruit_Remark] as Remark"
                         + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                         + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                         + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Recruit] todi"
                         + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Recruit_MainID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Recruit_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_083") || approver != "") //M_20150623
                Recruit += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Recruit += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_083"))
                Recruit += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Recruit_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Recruit += " and OfficeAutomation_Document_Recruit_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Recruit += " and OfficeAutomation_Document_Recruit_Apply = '" + applicant + "'";

            if (begin != "")
                Recruit += " and OfficeAutomation_Document_Recruit_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Recruit += " and OfficeAutomation_Document_Recruit_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Recruit += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Recruit += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Recruit_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Recruit += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Recruit += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Recruit += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Recruit += " and [OfficeAutomation_Document_Recruit_Remark] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                Recruit += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                Recruit += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Recruit += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Recruit_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Recruit += "  OR (OfficeAutomation_Document_Recruit_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Recruit_MainID))";
                }
            }

            Recruit += " GROUP BY [OfficeAutomation_Document_Recruit_ID]"
                 + "          ,[OfficeAutomation_Document_Recruit_MainID]"
                 + "          ,[OfficeAutomation_Document_Recruit_Department]"
                 + "          ,[OfficeAutomation_Document_Recruit_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Recruit_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_Recruit_Remark]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";


            string CommissionAssign = " SELECT [OfficeAutomation_Document_CommissionAssign_ID] as ID"
                         + "          ,[OfficeAutomation_Document_CommissionAssign_MainID] as MainID"
                         + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                         + "          ,[OfficeAutomation_Document_CommissionAssign_Department] as Department"
                         + "          ,[OfficeAutomation_Document_CommissionAssign_ApplyDate] as ApplyDate"
                         + "          ,[OfficeAutomation_Document_CommissionAssign_Apply] as Apply"
                         + "          ,toam.OfficeAutomation_SerialNumber"
                         + "          ,toam.OfficeAutomation_Main_FlowStateID"
                         + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_CommissionAssign_MainID) AS [waitfor]"
                         + "          ,tdoad.OfficeAutomation_Document_Name"
                         + "          ,[OfficeAutomation_Document_CommissionAssign_ProName] as Remark"
                         + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                         + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                         + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CommissionAssign] todi"
                         + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CommissionAssign_MainID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CommissionAssign_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_084") || approver != "") //M_20150623
                CommissionAssign += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            CommissionAssign += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_084"))
                CommissionAssign += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CommissionAssign_Apply='" + employee + "')";

            if (applicationDepartment != "")
                CommissionAssign += " and OfficeAutomation_Document_CommissionAssign_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                CommissionAssign += " and OfficeAutomation_Document_CommissionAssign_Apply = '" + applicant + "'";

            if (begin != "")
                CommissionAssign += " and OfficeAutomation_Document_CommissionAssign_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                CommissionAssign += " and OfficeAutomation_Document_CommissionAssign_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                CommissionAssign += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    CommissionAssign += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CommissionAssign_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        CommissionAssign += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        CommissionAssign += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                CommissionAssign += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                CommissionAssign += " and [OfficeAutomation_Document_CommissionAssign_ProName] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                CommissionAssign += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                CommissionAssign += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                CommissionAssign += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CommissionAssign_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    CommissionAssign += "  OR (OfficeAutomation_Document_CommissionAssign_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CommissionAssign_MainID))";
                }
            }

            CommissionAssign += " GROUP BY [OfficeAutomation_Document_CommissionAssign_ID]"
                 + "          ,[OfficeAutomation_Document_CommissionAssign_MainID]"
                 + "          ,[OfficeAutomation_Document_CommissionAssign_Department]"
                 + "          ,[OfficeAutomation_Document_CommissionAssign_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_CommissionAssign_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_CommissionAssign_ProName]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            string HousingFundChange = " SELECT [OfficeAutomation_Document_HousingFundChange_ID] as ID"
                         + "          ,[OfficeAutomation_Document_HousingFundChange_MainID] as MainID"
                         + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                         + "          ,[OfficeAutomation_Document_HousingFundChange_Department] as Department"
                         + "          ,[OfficeAutomation_Document_HousingFundChange_ApplyDate] as ApplyDate"
                         + "          ,[OfficeAutomation_Document_HousingFundChange_Apply] as Apply"
                         + "          ,toam.OfficeAutomation_SerialNumber"
                         + "          ,toam.OfficeAutomation_Main_FlowStateID"
                         + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_HousingFundChange_MainID) AS [waitfor]"
                         + "          ,tdoad.OfficeAutomation_Document_Name"
                         + "          ,[dbo].Fun_Sum_HousingFundChangeDetailName([OfficeAutomation_Document_HousingFundChange_ID]) as Remark"
                         + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                         + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                         + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_HousingFundChange] todi"
                         + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_HousingFundChange_MainID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_HousingFundChange_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_084") || approver != "") //M_20150623
                HousingFundChange += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            HousingFundChange += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_084"))
                HousingFundChange += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_HousingFundChange_Apply='" + employee + "')";

            if (applicationDepartment != "")
                HousingFundChange += " and OfficeAutomation_Document_HousingFundChange_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                HousingFundChange += " and OfficeAutomation_Document_HousingFundChange_Apply = '" + applicant + "'";

            if (begin != "")
                HousingFundChange += " and OfficeAutomation_Document_HousingFundChange_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                HousingFundChange += " and OfficeAutomation_Document_HousingFundChange_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                HousingFundChange += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    HousingFundChange += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundChange_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        HousingFundChange += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        HousingFundChange += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                HousingFundChange += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                HousingFundChange += " and [OfficeAutomation_Document_HousingFundChange_Remark] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                HousingFundChange += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                HousingFundChange += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                HousingFundChange += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_HousingFundChange_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    HousingFundChange += "  OR (OfficeAutomation_Document_HousingFundChange_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_HousingFundChange_MainID))";
                }
            }

            HousingFundChange += " GROUP BY [OfficeAutomation_Document_HousingFundChange_ID]"
                 + "          ,[OfficeAutomation_Document_HousingFundChange_MainID]"
                 + "          ,[OfficeAutomation_Document_HousingFundChange_Department]"
                 + "          ,[OfficeAutomation_Document_HousingFundChange_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_HousingFundChange_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_HousingFundChange_Remark]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            #region t_OfficeAutomation_Document_StaffDataCheck 2016/9/18 52100
            string StaffDataCheck = " SELECT [OfficeAutomation_Document_StaffDataCheck_ID] as ID"
             + "          ,[OfficeAutomation_Document_StaffDataCheck_MainID] as MainID"
             + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
             + "          ,[OfficeAutomation_Document_StaffDataCheck_Department] as Department"
             + "          ,[OfficeAutomation_Document_StaffDataCheck_ApplyDate] as ApplyDate"
             + "          ,[OfficeAutomation_Document_StaffDataCheck_Apply] as Apply"
             + "          ,toam.OfficeAutomation_SerialNumber"
             + "          ,toam.OfficeAutomation_Main_FlowStateID"
             + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_StaffDataCheck_MainID) AS [waitfor]"
             + "          ,tdoad.OfficeAutomation_Document_Name"
             + "          ,[OfficeAutomation_Document_StaffDataCheck_DifferenceSituation] as Remark"
             + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
             + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
             + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_StaffDataCheck] todi"
             + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_StaffDataCheck_MainID"
             + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
             + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
        + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_StaffDataCheck_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_082") || approver != "") //M_20150623
                StaffDataCheck += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            StaffDataCheck += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_082"))
                StaffDataCheck += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_StaffDataCheck_Apply='" + employee + "')";

            if (applicationDepartment != "")
                StaffDataCheck += " and OfficeAutomation_Document_StaffDataCheck_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                StaffDataCheck += " and OfficeAutomation_Document_StaffDataCheck_Apply = '" + applicant + "'";

            if (begin != "")
                StaffDataCheck += " and OfficeAutomation_Document_StaffDataCheck_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                StaffDataCheck += " and OfficeAutomation_Document_StaffDataCheck_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                StaffDataCheck += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    StaffDataCheck += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_StaffDataCheck_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        StaffDataCheck += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        StaffDataCheck += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                StaffDataCheck += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                StaffDataCheck += " and [OfficeAutomation_Document_StaffDataCheck_DifferenceSituation] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                StaffDataCheck += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                StaffDataCheck += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                StaffDataCheck += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_StaffDataCheck_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    StaffDataCheck += "  OR (OfficeAutomation_Document_StaffDataCheck_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_StaffDataCheck_MainID))";
                }
            }

            StaffDataCheck += " GROUP BY [OfficeAutomation_Document_StaffDataCheck_ID]"
                 + "          ,[OfficeAutomation_Document_StaffDataCheck_MainID]"
                 + "          ,[OfficeAutomation_Document_StaffDataCheck_Department]"
                 + "          ,[OfficeAutomation_Document_StaffDataCheck_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_StaffDataCheck_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_StaffDataCheck_DifferenceSituation]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";








            #endregion

            #region t_OfficeAutomation_Document_ProjGeneralApply 2017/4/10

            string ProjGeneralApply = " SELECT [OfficeAutomation_Document_ProjGeneralApply_ID] as ID"
+ "          ,[OfficeAutomation_Document_ProjGeneralApply_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_ProjGeneralApply_Department] as Department"
+ "          ,[OfficeAutomation_Document_ProjGeneralApply_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_ProjGeneralApply_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_ProjGeneralApply_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,([OfficeAutomation_Document_ProjGeneralApply_Subject] + isnull(toam.OfficeAutomation_Main_Sremark,'')) as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_ProjGeneralApply] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_ProjGeneralApply_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_ProjGeneralApply_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_085") || approver != "")
                ProjGeneralApply += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            ProjGeneralApply += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_085"))
                ProjGeneralApply += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_ProjGeneralApply_Apply='" + employee + "' or (todi.OfficeAutomation_Document_ProjGeneralApply_CanSeeEmployeeID like '%" + code + "%' and OfficeAutomation_Document_ProjGeneralApply_CanSeeEmployeeName like '%" + employee + "%'))";

            if (applicationDepartment != "")
                ProjGeneralApply += " and OfficeAutomation_Document_ProjGeneralApply_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                ProjGeneralApply += " and OfficeAutomation_Document_ProjGeneralApply_Apply = '" + applicant + "'";

            if (begin != "")
                ProjGeneralApply += " and OfficeAutomation_Document_ProjGeneralApply_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                ProjGeneralApply += " and OfficeAutomation_Document_ProjGeneralApply_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                ProjGeneralApply += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    ProjGeneralApply += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_ProjGeneralApply_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        ProjGeneralApply += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        ProjGeneralApply += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                ProjGeneralApply += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                ProjGeneralApply += " and [OfficeAutomation_Document_ProjGeneralApply_Subject] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230 //*xx
                ProjGeneralApply += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((select count(*) from(SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%')d),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                ProjGeneralApply += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                ProjGeneralApply += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_ProjGeneralApply_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    ProjGeneralApply += "  OR (OfficeAutomation_Document_ProjGeneralApply_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_ProjGeneralApply_MainID))";
                }
            }

            ProjGeneralApply += " GROUP BY [OfficeAutomation_Document_ProjGeneralApply_ID]"
                 + "          ,[OfficeAutomation_Document_ProjGeneralApply_MainID]"
                 + "          ,[OfficeAutomation_Document_ProjGeneralApply_Department]"
                 + "          ,[OfficeAutomation_Document_ProjGeneralApply_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_ProjGeneralApply_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_Sremark" //M_Remark：Win 20151109
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_ProjGeneralApply_Subject]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            #endregion


            #region t_OfficeAutomation_Document_CPNShoot 2017/4/24

            string CPNShoot = " SELECT [OfficeAutomation_Document_CPNShoot_ID] as ID"
+ "          ,[OfficeAutomation_Document_CPNShoot_MainID] as MainID"
+ "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
+ "          ,[OfficeAutomation_Document_CPNShoot_Department] as Department"
+ "          ,[OfficeAutomation_Document_CPNShoot_ApplyDate] as ApplyDate"
+ "          ,[OfficeAutomation_Document_CPNShoot_Apply] as Apply"
+ "          ,toam.OfficeAutomation_SerialNumber"
+ "          ,toam.OfficeAutomation_Main_FlowStateID"
+ "          ,[dbo].FindWaitfor(OfficeAutomation_Document_CPNShoot_MainID) AS [waitfor]"
+ "          ,tdoad.OfficeAutomation_Document_Name"
+ "          ,[OfficeAutomation_Document_CPNShoot_ShootAddress] as Remark"
+ "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
+ "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
+ " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_CPNShoot] todi"
+ " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_CPNShoot_MainID"
+ " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
+ " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
+ " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_CPNShoot_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_086") || approver != "")
                CPNShoot += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            CPNShoot += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_086"))
                CPNShoot += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_CPNShoot_Apply='" + employee + "')";

            if (applicationDepartment != "")
                CPNShoot += " and OfficeAutomation_Document_CPNShoot_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                CPNShoot += " and OfficeAutomation_Document_CPNShoot_Apply = '" + applicant + "'";

            if (begin != "")
                CPNShoot += " and OfficeAutomation_Document_CPNShoot_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                CPNShoot += " and OfficeAutomation_Document_CPNShoot_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                CPNShoot += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    CPNShoot += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_CPNShoot_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        CPNShoot += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        CPNShoot += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                CPNShoot += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                CPNShoot += " and [OfficeAutomation_Document_CPNShoot_ShootAddress] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230 //*xx
                CPNShoot += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((select count(*) from(SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%')d),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                CPNShoot += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                CPNShoot += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_CPNShoot_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "')";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    CPNShoot += "  OR (OfficeAutomation_Document_CPNShoot_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_CPNShoot_MainID))";
                }
            }

            CPNShoot += " GROUP BY [OfficeAutomation_Document_CPNShoot_ID]"
                 + "          ,[OfficeAutomation_Document_CPNShoot_MainID]"
                 + "          ,[OfficeAutomation_Document_CPNShoot_Department]"
                 + "          ,[OfficeAutomation_Document_CPNShoot_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_CPNShoot_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_Sremark" //M_Remark：Win 20151109
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,[OfficeAutomation_Document_CPNShoot_ShootAddress]"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            #endregion

            #region t_OfficeAutomation_Document_HousingFundAdjustment 2017/5/18
            string HousingFundAdjustment = " SELECT [OfficeAutomation_Document_HousingFundAdjustment_ID] as ID"
                         + "          ,[OfficeAutomation_Document_HousingFundAdjustment_MainID] as MainID"
                         + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                         + "          ,[OfficeAutomation_Document_HousingFundAdjustment_Department] as Department"
                         + "          ,[OfficeAutomation_Document_HousingFundAdjustment_ApplyDate] as ApplyDate"
                         + "          ,[OfficeAutomation_Document_HousingFundAdjustment_Apply] as Apply"
                         + "          ,toam.OfficeAutomation_SerialNumber"
                         + "          ,toam.OfficeAutomation_Main_FlowStateID"
                         + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_HousingFundAdjustment_MainID) AS [waitfor]"
                         + "          ,tdoad.OfficeAutomation_Document_Name"
                         + "          ,[dbo].Fun_Sum_HousingFundAdjustDetailName([OfficeAutomation_Document_HousingFundAdjustment_ID]) as Remark"
                         + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                         + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                         + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_HousingFundAdjustment] todi"
                         + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_HousingFundAdjustment_MainID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_HousingFundAdjustment_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_087") || approver != "") //M_20150623
                HousingFundAdjustment += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            HousingFundAdjustment += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_087"))
                HousingFundAdjustment += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_HousingFundAdjustment_Apply='" + employee + "')";

            if (applicationDepartment != "")
                HousingFundAdjustment += " and OfficeAutomation_Document_HousingFundAdjustment_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                HousingFundAdjustment += " and OfficeAutomation_Document_HousingFundAdjustment_Apply = '" + applicant + "'";

            if (begin != "")
                HousingFundAdjustment += " and OfficeAutomation_Document_HousingFundAdjustment_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                HousingFundAdjustment += " and OfficeAutomation_Document_HousingFundAdjustment_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                HousingFundAdjustment += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    HousingFundAdjustment += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_HousingFundAdjustment_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        HousingFundAdjustment += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        HousingFundAdjustment += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                HousingFundAdjustment += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                HousingFundAdjustment += " and [OfficeAutomation_Document_HousingFundAdjustment_Apply] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                HousingFundAdjustment += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                HousingFundAdjustment += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                HousingFundAdjustment += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_HousingFundAdjustment_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    HousingFundAdjustment += "  OR (OfficeAutomation_Document_HousingFundAdjustment_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_HousingFundAdjustment_MainID))";
                }
            }

            HousingFundAdjustment += " GROUP BY [OfficeAutomation_Document_HousingFundAdjustment_ID]"
                 + "          ,[OfficeAutomation_Document_HousingFundAdjustment_MainID]"
                 + "          ,[OfficeAutomation_Document_HousingFundAdjustment_Department]"
                 + "          ,[OfficeAutomation_Document_HousingFundAdjustment_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_HousingFundAdjustment_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,toam.[OfficeAutomation_SerialNumber]";

            #endregion


            #region t_OfficeAutomation_Loan 2017/6/28
            string Loan = " SELECT [OfficeAutomation_Document_Loan_ID] as ID"
                         + "          ,[OfficeAutomation_Document_Loan_MainID] as MainID"
                         + "          ,'00000000-0000-0000-0000-000000000000' as DepartmentID"
                         + "          ,[OfficeAutomation_Document_Loan_Department] as Department"
                         + "          ,[OfficeAutomation_Document_Loan_ApplyDate] as ApplyDate"
                         + "          ,[OfficeAutomation_Document_Loan_Apply] as Apply"
                         + "          ,toam.OfficeAutomation_SerialNumber"
                         + "          ,toam.OfficeAutomation_Main_FlowStateID"
                         + "          ,[dbo].FindWaitfor(OfficeAutomation_Document_Loan_MainID) AS [waitfor]"
                         + "          ,tdoad.OfficeAutomation_Document_Name"
                         + "          ,(case  when OfficeAutomation_Main_Sremark is null then '' else OfficeAutomation_Main_Sremark end )  +"
                          +         "(case  when OfficeAutomation_Main_Summary is null then '' else OfficeAutomation_Main_Summary end )  as Remark"
                         + "          ,toam.[OfficeAutomation_SerialNumber] as SerialNumber"
                         + "          ,max(OfficeAutomation_Flow_AuditDate) AS LastFlowCT"
                         + " FROM [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Document_Loan] todi"
                         + " LEFT JOIN t_OfficeAutomation_Main toam ON toam.OfficeAutomation_Main_ID= todi.OfficeAutomation_Document_Loan_MainID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_Document tdoad ON tdoad.OfficeAutomation_Document_ID = toam.OfficeAutomation_DocumentID"
                         + " LEFT JOIN t_Dic_OfficeAutomation_FlowState tdof ON tdof.OfficeAutomation_FlowState_ID = toam.OfficeAutomation_Main_FlowStateID"
                    + " LEFT JOIN t_OfficeAutomation_Flow f ON f.OfficeAutomation_Flow_MainID = todi.OfficeAutomation_Document_Loan_MainID";

            if (!isAdmin && !purview.Contains("OA_Search_087") || approver != "") //M_20150623
                Loan += " LEFT JOIN #a ON #a.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID";

            Loan += " WHERE toam.OfficeAutomation_Main_IsDelete=0";

            if (!isAdmin && !purview.Contains("OA_Search_087"))
                Loan += " and (((auditorsum like '%" + employee + "%' and auditoridsum like '%" + code + "%') " + myAgency + ") or OfficeAutomation_Document_Loan_Apply='" + employee + "')";

            if (applicationDepartment != "")
                Loan += " and OfficeAutomation_Document_Loan_Department like '%" + applicationDepartment + "%'";

            if (applicant != "")
                Loan += " and OfficeAutomation_Document_Loan_Apply = '" + applicant + "'";

            if (begin != "")
                Loan += " and OfficeAutomation_Document_Loan_ApplyDate >='" + begin + " 00:00:00'";

            if (end != "")
                Loan += " and OfficeAutomation_Document_Loan_ApplyDate<='" + end + " 23:59:59'";

            if (state != "")
                Loan += " and toam.OfficeAutomation_Main_FlowStateID ='" + state + "'";

            if (cstatue != 10)
                if (cstatue < 3)
                    Loan += " AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM  t_OfficeAutomation_Flow f WHERE  f.OfficeAutomation_Flow_MainID = [OfficeAutomation_Document_Loan_MainID] ORDER  BY f.OfficeAutomation_Flow_Idx DESC) = " + cstatue;
                else //M_20150623
                {
                    if (approver != "")
                        Loan += " and [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) like '%" + approver + "%'";
                    else
                        Loan += " AND f.OfficeAutomation_Flow_Audit = 0 AND ((f.OfficeAutomation_Flow_Employee LIKE '%" + employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + code + "%')" + myAgency2 + ") AND ISNULL(f.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + code + "%' AND f.OfficeAutomation_Flow_Idx = (SELECT MIN(OfficeAutomation_Flow_Idx) FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_Flow_Audit = 0) AND ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 0";
                }

            if (serialNumber != "")
                Loan += " and toam.OfficeAutomation_SerialNumber like '%" + serialNumber + "%'";

            if (keyWord != "")
                Loan += " and [OfficeAutomation_Document_Loan_PayeeName] like '%" + keyWord + "%' or [OfficeAutomation_Document_Loan_Address] like '%" + keyWord + "%' or [OfficeAutomation_Document_Loan_ReportNo] like '%" + keyWord + "%'";

            if (willDelete) //M_DeleteAdd 20151230
                Loan += " and ISNULL(toam.OfficeAutomation_Main_WillDelete,0) = 1 AND ISNULL((SELECT DISTINCT OfficeAutomation_DeletedFlow_AuditorID FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = f.OfficeAutomation_Flow_MainID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + code + "%'),'0') != '0'";

            if (approver != "" && cstatue != 3) //M_20150623
                Loan += " and auditorsum like '%" + approver + "%'";

            if (approver != "" && apptime != "") //M_GWSky：20150630
                Loan += " and EXISTS (SELECT TOP 1 OfficeAutomation_Flow_AuditorID FROM t_OfficeAutomation_Flow WHERE OfficeAutomation_Flow_MainID =  todi.OfficeAutomation_Document_Loan_MainID AND OfficeAutomation_Flow_Auditor LIKE '%" + approver + "%' AND OfficeAutomation_Flow_AuditDate BETWEEN '" + apptime + "' AND '" + apptotime + "') ";

            if (ds != null && ds.Tables != null && ds.Tables[0].Rows.Count > 0 && serialNumber == "" && approver == "" && applicant == "" && cstatue != 3 && !willDelete)
            {
                foreach (DataRow dr in ds.Tables[0].Rows)
                {
                    Loan += "  OR (OfficeAutomation_Document_Loan_Apply='" + dr["OfficeAutomation_Agent_Auditor"].ToString() + "' and exists (select OfficeAutomation_Main_ID from t_OfficeAutomation_Main where OfficeAutomation_Main_IsDelete =0 and OfficeAutomation_Main_ID =OfficeAutomation_Document_Loan_MainID))";
                }
            }

            Loan += " GROUP BY [OfficeAutomation_Document_Loan_ID]"
                 + "          ,[OfficeAutomation_Document_Loan_MainID]"
                 + "          ,[OfficeAutomation_Document_Loan_Department]"
                 + "          ,[OfficeAutomation_Document_Loan_ApplyDate]"
                 + "          ,[OfficeAutomation_Document_Loan_Apply]"
                 + "          ,toam.OfficeAutomation_SerialNumber"
                 +"           ,OfficeAutomation_Document_Loan_Remarks"
                 + "          ,toam.OfficeAutomation_Main_FlowStateID"
                 + "          ,tdoad.OfficeAutomation_Document_Name"
                 + "          ,toam.[OfficeAutomation_SerialNumber]"
                 + "          ,toam.[OfficeAutomation_Main_Sremark]"
                 + "          ,toam.[OfficeAutomation_Main_Summary]";

            #endregion
            //////////////////////////////////////////////////////////////结尾













            if (string.IsNullOrEmpty(applyType))
            {
                sql += itpower
                    + " union " + sysreq
                    + " union " + syspower
                    + " union " + scrap
                    + " union " + assettransfer
                    + " union " + dealoffice
                    + " union " + itbuy
                    + " union " + persinterests + " union " + NewPersInterests
                    + " union " + buybuilding
                    + " union " + carallowance
                    + " union " + backcomm
                    + " union " + baddebts
                    + " union " + reducecomm
                    + " union " + projcost
                    + " union " + coopcost
                    + " union " + undertakeproj
                    + " union " + extrabonus
                    + " union " + resumebusi
                    + " union " + withdrawshop
                    + " union " + suspendbusi
                    + " union " + projagentclause
                    + " union " + projworkcloth
                    + " union " + projdormsubsiby
                    + " union " + projrepodata
                    + " union " + projlinkrepodata
                    + " union " + ChangeData
                    + " union " + CommissionAdjust
                    + " union " + WirelessFixedLine
                    + " union " + FurtherEducation
                    + " union " + SpecialNumber;
                    
                if (!islawer)
                    sql += " union " + OfficialSeal;
                sql += " union " + BranchContract
                    + " union " + Tourism
                    + " union " + OweSubmit
                    + " union " + TotalRev
                    + " union " + Feasibility
                    + " union " + AfterCommission
                    + " union " + LegalCommission
                    + " union " + GeneralApply
                    + " union " + ContractTerms
                    + " union " + NetSign
                    + " union " + CommissionOfMonth
                    + " union " + Marketing
                    + " union " + Secondment
                    + " union " + CostOfActivity
                    + " union " + PunishTerms
                    + " union " + ChangeNS
                    + " union " + SpecialCase
                    + " union " + SocialSecurity
                    //+ " union " + PortAssessment
                    + " union " + ProjectCarAllowance
                    + " union " + Maintenance
                    + " union " + Repair
                    + " union " + Propaganda
                    + " union " + Budgetab
                    + " union " + EBAdjuct
                    + " union " + Guarantee
                    + " union " + SignedG
                    + " union " + PullafewRd
                    + " union " + PullafewTwo
                    + " union " + UtContract
                    + " union " + UtNewProj
                    + " union " + ProjReDaAdd
                    + " union " + WrongSave
                    + " union " + BuyBudiData
                    + " union " + ProjBaComm
                    + " union " + BorrowMoney
                    + " union " + SpecialAdd
                    + " union " + OpenProve
                    + " union " + PartTime
                    + " union " + SysLogist
                    + " union " + SolHold
                    + " union " + HoldCoisn
                    + " union " + Record
                    + " union " + CallCenter
                    + " union " + WYRecruit
                    + " union " + Recruit
                    + " union " + CommissionAssign
                    + " union " + HousingFundChange
                    + " union " + StaffDataCheck
                    + " union " + ProjGeneralApply
                    + " union " + CPNShoot
                    + " union " + HousingFundAdjustment
                  + "  union " + Loan 
                    ;
            }
            else
            {
                switch (applyType)
                {
                    case "1":
                        sql += itpower;
                        break;
                    case "2":
                        sql += sysreq;
                        break;
                    case "3":
                        sql += syspower;
                        break;
                    case "4":
                        sql += scrap;
                        break;
                    case "5":
                        sql += assettransfer;
                        break;
                    case "6":
                        sql += dealoffice;
                        break;
                    case "7":
                        sql += itbuy;
                        break;
                    case "8":
                        sql += persinterests + " union " + NewPersInterests;
                        break;
                    case "9":
                        sql += buybuilding;
                        break;
                    case "10":
                        sql += carallowance;
                        break;
                    case "11":
                        sql += backcomm;
                        break;
                    case "12":
                        sql += baddebts;
                        break;
                    case "13":
                        sql += reducecomm;
                        break;
                    case "14":
                        sql += projcost;
                        break;
                    case "15":
                        sql += coopcost;
                        break;
                    case "16":
                        sql += undertakeproj;
                        break;
                    case "17":
                        sql += extrabonus;
                        break;
                    case "18":
                        sql += resumebusi;
                        break;
                    case "19":
                        sql += withdrawshop;
                        break;
                    case "20":
                        sql += suspendbusi;
                        break;
                    case "21":
                        sql += projagentclause;
                        break;
                    case "22":
                        sql += projworkcloth;
                        break;
                    case "23":
                        sql += projdormsubsiby;
                        break;
                    case "24":
                        sql += projrepodata;
                        break;
                    case "25":
                        sql += projlinkrepodata;
                        break;
                    case "26":
                        sql += ChangeData;
                        break;
                    case "27":
                        sql += CommissionAdjust;
                        break;
                    case "28":
                        sql += WirelessFixedLine;
                        break;
                    case "29":
                        sql += FurtherEducation;
                        break;
                    case "30":
                        sql += SpecialNumber;
                        break;
                    case "31":
                        sql += OfficialSeal;
                        break;
                    case "32":
                        sql += BranchContract;
                        break;
                    case "33":
                        sql += Tourism;
                        break;
                    case "34":
                        sql += OweSubmit;
                        break;
                    case "35":
                        sql += TotalRev;
                        break;
                    case "36":
                        sql += Feasibility;
                        break;
                    case "37":
                        sql += AfterCommission;
                        break;
                    case "38":
                        sql += LegalCommission;
                        break;
                    case "39":
                        sql += GeneralApply;
                        break;
                    case "40":
                        sql += ContractTerms;
                        break;
                    case "41":
                        sql += NetSign;
                        break;
                    case "42":
                        sql += CommissionOfMonth;
                        break;
                    case "43":
                        sql += Marketing;
                        break;
                    case "44":
                        sql += Secondment;
                        break;
                    case "45":
                        sql += CostOfActivity;
                        break;
                    case "46":
                        sql += PunishTerms;
                        break;
                    case "47":
                        sql += ChangeNS;
                        break;
                    case "48":
                        sql += SpecialCase;
                        break;
                    case "50":
                        sql += SocialSecurity;
                        break;
                    //case "51":
                    //    sql += PortAssessment;
                    //    break;
                    case "52":
                        sql += ProjectCarAllowance;
                        break;
                    case "53":
                        sql += Maintenance;
                        break;
                    case "54":
                        sql += Repair;
                        break;
                    case "55":
                        sql += Propaganda;
                        break;
                    case "56":
                        sql += Budgetab;
                        break;
                    case "57":
                        sql += EBAdjuct;
                        break;
                    case "58":
                        sql += Guarantee;
                        break;
                    case "59":
                        sql += SignedG;
                        break;
                    case "60":
                        sql += PullafewRd;
                        break;
                    case "61":
                        sql += PullafewTwo;
                        break;
                    case "62":
                        sql += UtContract;
                        break;
                    case "63":
                        sql += UtNewProj;
                        break;
                    case "64":
                        sql += ProjReDaAdd;
                        break;
                    case "65":
                        sql += WrongSave;
                        break;
                    case "66":
                        sql += BuyBudiData;
                        break;
                    case "67":
                        sql += ProjBaComm;
                        break;
                    case "68":
                        sql += BorrowMoney;
                        break;
                    case "69":
                        sql += SpecialAdd;
                        break;
                    case "70":
                        sql += OpenProve;
                        break;
                    case "71":
                        sql += PartTime;
                        break;
                    case "72":
                        sql += SysLogist;
                        break;
                    case "73":
                        sql += SolHold;
                        break;
                    case "74":
                        sql += HoldCoisn;
                        break;
                    case "75":
                        sql += Record;
                        break;
                    case "76":
                        sql += CallCenter;
                        break;
                    case "77":
                        sql += WYRecruit;
                        break;
                    case "78":
                        sql += Recruit;
                        break;
                    case "79":
                        sql += CommissionAssign;
                        break;
                    case "80":
                        sql += HousingFundChange;
                        break;
                    case "81":
                        sql += StaffDataCheck;
                        break;
                    case "82":
                        sql += ProjGeneralApply;
                        break;
                    case "83":
                        sql += CPNShoot;
                        break;
                    case "84":
                        sql += HousingFundAdjustment;
                        break;
                    case "85":
                        sql += Loan;
                        break;
                    default:
                        break;
                }
            }

            if (ctype == "1")
                sql += " order by ApplyDate desc";
            else
                sql += " ORDER BY LastFlowCT DESC";

            if (!isAdmin || approver != "")
                sql += " DROP TABLE #a";

            return RunSQL(sql);
        }
        #endregion

        #region 插入主表
        public bool InsertTemp(DataEntity.T_OfficeAutomation_Main obj)
        {
            if (obj == null)
            { return false; }
            
            var sql = "INSERT INTO [DB_EcOfficeAutomation].[dbo].[t_OfficeAutomation_Main] ";
            sql += "([OfficeAutomation_Main_ID],[OfficeAutomation_SerialNumber],[OfficeAutomation_DocumentID],[OfficeAutomation_Main_FlowStateID],[OfficeAutomation_Main_AuditorIDsSum]";
            sql += ",[OfficeAutomation_Main_AuditorNamesSum],[OfficeAutomation_Main_IsBackUp],[OfficeAutomation_Main_WillDelete],[OfficeAutomation_Main_Creater],[OfficeAutomation_Main_CrTime],[OfficeAutomation_Main_ApplyDate],[OfficeAutomation_Main_Apply],[OfficeAutomation_Main_Department]) ";
            sql += " VALUES ('" + obj.OfficeAutomation_Main_ID + "','" + obj.OfficeAutomation_SerialNumber + "'," + obj.OfficeAutomation_DocumentID + "," + obj.OfficeAutomation_Main_FlowStateID + ",null";
            sql += ",null,1,0,'" + obj.OfficeAutomation_Main_Creater + "','" + obj.OfficeAutomation_Main_CrTime + "','" + obj.OfficeAutomation_Main_ApplyDate + "','" + obj.OfficeAutomation_Main_Apply + "','" + obj.OfficeAutomation_Main_Department + "')";
            var row = SqlDatabase.SqlHelper.ExecuteNonQuery(SqlDatabase.SqlHelper.ConnectionString, CommandType.Text, sql);
            return row > 0;
        }
        public T_OfficeAutomation_Main InsertMain(string MainID, string SerialNumber, int DocumentID, string Creater,string Department)
        {
            var t_OfficeAutomation_Main = new T_OfficeAutomation_Main();
            t_OfficeAutomation_Main.OfficeAutomation_Main_ID = new Guid(MainID);
            t_OfficeAutomation_Main.OfficeAutomation_SerialNumber = SerialNumber;
            t_OfficeAutomation_Main.OfficeAutomation_DocumentID = DocumentID; //在《申请表字典表》找到该表的主键，这步一错则会打开别的表
            t_OfficeAutomation_Main.OfficeAutomation_Main_FlowStateID = 7;
            t_OfficeAutomation_Main.OfficeAutomation_Main_Creater = Creater;
            t_OfficeAutomation_Main.OfficeAutomation_Main_CrTime = DateTime.Now;
            t_OfficeAutomation_Main.OfficeAutomation_Main_ApplyDate = DateTime.Now;
            t_OfficeAutomation_Main.OfficeAutomation_Main_Apply = Creater;
            t_OfficeAutomation_Main.OfficeAutomation_Main_Department = Department;

            string where = "[OfficeAutomation_Main_ID]='" + MainID + "'";

            var ex = GetModel(where);
            if (ex != null)
            {
                //已经存在的Main
                //无需修改或者添加，返回true
                return ex;
            }

            var flag = InsertTemp(t_OfficeAutomation_Main);
            if (flag)
            {
                return t_OfficeAutomation_Main;
            }
            else
            {
                return null;
            }
        }
        #endregion 

        #region  更新主表状态为已过期（用于公章使用申请表30天之后自动变为已过期）
        public bool UpdateFlowStateByMainID(string mainID)
        {
            string sql = "UPDATE t_OfficeAutomation_Main set OfficeAutomation_Main_FlowStateID='8'"
                       + " WHERE  OfficeAutomation_Main_ID='" + mainID + "'";
            return RunNoneSQL(sql);
        }
        #endregion


        public void UpdateMain(string mainid,string depname, string apply, string applydate, string summary)
        {
            if (string.IsNullOrEmpty(depname) && string.IsNullOrEmpty(apply) && string.IsNullOrEmpty(applydate) && string.IsNullOrEmpty(summary))
                return;

            string sql = "UPDATE t_OfficeAutomation_Main SET ";
            if (!string.IsNullOrEmpty(depname))
            {
                sql += "OfficeAutomation_Main_Department='" + depname + "',";
            }
            if (!string.IsNullOrEmpty(apply))
            {
                sql += "OfficeAutomation_Main_Apply='" + apply + "',";
            }
            if (!string.IsNullOrEmpty(applydate))
            {
                sql += "OfficeAutomation_Main_ApplyDate='" + applydate + "',";
            }
            if (!string.IsNullOrEmpty(summary))
            {
                sql += "OfficeAutomation_Main_Summary='" + summary + "',";
            }
            sql = sql.TrimEnd(',');
            sql += " WHERE OfficeAutomation_Main_ID='" + mainid + "'";
            RunSQL(sql);
        }

        /// <summary>
        /// 修改备注
        /// </summary>
        /// <param name="Sremark">标记</param>
        /// <param name="Summary">描述</param>
        public void UpdateRemarks(string Sremark, string Summary, string MainID)
        {

            string sql = @"update t_OfficeAutomation_Main set ";
            if (Sremark != null)
                sql += "  OfficeAutomation_Main_Sremark ='" + Sremark + "'";
            if (Sremark != null && Summary != null)
                sql += " ,";
            if (Summary != null)
                sql += "  OfficeAutomation_Main_Summary ='" + Summary + "'";
            sql += "   where OfficeAutomation_Main_ID ='" + MainID + "'";
            RunSQL(sql);
        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="islawer">是否法律部</param>
        /// <param name="isAdmin">是否管理员</param>
        /// <param name="applicationDepartment">申请部门</param>
        /// <param name="applicant">申请人</param>
        /// <param name="begin">申请开始时间</param>
        /// <param name="end">申请结束时间</param>
        /// <param name="applyType">文档类型</param>
        /// <param name="state">审核状态</param>
        /// <param name="employee">搜索人姓名</param>
        /// <param name="code">搜索人工号</param>
        /// <param name="purview">权限字符窜</param>
        /// <param name="serialNumber">文档编码</param>
        /// <param name="keyWord">关键字</param>
        /// <param name="ctype">排序类型1：按最后申请日期排序；2：按最后审批时间排序</param>
        /// <param name="cstatue"></param>
        /// <param name="approver">审核人</param>
        /// <param name="apptime">审核开始时间</param>
        /// <param name="apptotime">审核结束时间</param>
        /// <param name="willDelete">是否即将删除</param>
        /// <param name="intereststype">申报类别（待定）</param>
        /// <returns></returns>
        public DataSet Search_New_II(DataEntity.DTO.SearchFilterDto dto)
        {
            //if (!string.IsNullOrEmpty(dto.KeyWord) && dto.ApplyType == 0)
            //{ throw new Exception("若要进行关键字查询，必须选择申请类型"); }

            //代理人sql
            string agentstr = "";       //代理人申请查询sql
            string agentgenstr = "";    //通用申请代理人的查阅者查询sql
            string agentprojgenstr = ""; //项目部通用申请代理人的查阅者查询sql
            string agentAuthor = "";    //审核人代理人的审核查询sql
            string agentwaitforstr = "";    //待我审批中代理人查询的sql
    
            if (dto.Agents != null && dto.Agents.Count > 0)
            {
                var a = GetAgentSql(dto.Agents);    //获取代理人相关sql
                agentstr = a.agentstr;
                agentgenstr = a.agentgenstr;
                agentAuthor = a.agentAuthor;
                agentwaitforstr = a.agentwaitforstr;
                agentprojgenstr = a.agentprojgenstr;
            }

            //排序 sql
            string order = "";
            string orderjoin = "";
            var o = GetOrderSql(dto.OrderType);
            order = o.ordersql;
            orderjoin = o.joinsql;

            //主查询
            string sql = @"
                SELECT '00000000-0000-0000-0000-000000000000' AS ID, toam.[OfficeAutomation_Main_ID] AS MainID, 
                       '00000000-0000-0000-0000-000000000000' AS DepartmentID, toam.[OfficeAutomation_Main_Department] AS Department,
                       toam.[OfficeAutomation_Main_Apply] AS Apply, toam.[OfficeAutomation_Main_ApplyDate] AS ApplyDate,
                       toam.[OfficeAutomation_SerialNumber], toam.[OfficeAutomation_Main_FlowStateID],
                       [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) AS [waitfor], D.OfficeAutomation_Document_Name,
                       CASE WHEN OfficeAutomation_Document_ID=7 
                            THEN (ISNULL(toam.OfficeAutomation_Main_Summary,'') + ' ' + 
                                 (CASE WHEN ISNULL([OfficeAutomation_Main_Sremark],'')!='' THEN '√' ELSE '' END))
                            ELSE (ISNULL(toam.OfficeAutomation_Main_Sremark,'') +'  '+ISNULL(toam.OfficeAutomation_Main_Summary,'') ) 
                       END AS Remark
                       FROM t_OfficeAutomation_Main toam
                       LEFT JOIN t_Dic_OfficeAutomation_Document D 
                            ON D.OfficeAutomation_Document_ID=toam.[OfficeAutomation_DocumentID] {0} {2}
            ";

            string where = " WHERE toam.OfficeAutomation_Main_IsDelete=0 ";
            if (dto.WillDelete)
            {
                where += " AND toam.OfficeAutomation_Main_WillDelete=1 AND EXISTS (SELECT 1 FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + dto.Employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + dto.EmployeeCode + "%' AND t_OfficeAutomation_DeletedFlow.OfficeAutomation_DeletedFlow_IsAgree in(1,2))";
            }

            string str = dto.AllowIDS.TrimEnd(',');
           
            string allowstr = "toam.OfficeAutomation_DocumentID IN (" + str + ")";

            str = dto.NotAllowIDS.TrimEnd(',');
            string noallowstr = "EXISTS (SELECT 1 FROM [t_OfficeAutomation_Flow] f WHERE ((f.OfficeAutomation_Flow_Employee LIKE '%" + dto.Employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + dto.EmployeeCode + "%') " + agentAuthor + ") AND f.OfficeAutomation_Flow_MainID=toam.OfficeAutomation_Main_ID AND toam.OfficeAutomation_DocumentID IN (" + str + ")) ";

            if (!dto.IsAdmin)
            {
                //看到自己上的申请和看到你代理的人申请
                string ownselectstr = "toam.OfficeAutomation_Main_Creater='" + dto.Employee + "' OR toam.OfficeAutomation_Main_Apply='" + dto.Employee + "' " + agentstr;
  
                    //通用申请查阅人和查看到你代理人的
                    string generalSeeStr = " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_GeneralApply WHERE toam.OfficeAutomation_Main_ID=OfficeAutomation_Document_GeneralApply_MainID AND ((OfficeAutomation_Document_GeneralApply_CanSeeEmployeeName LIKE '%" + dto.Employee + "%' AND OfficeAutomation_Document_GeneralApply_CanSeeEmployeeID LIKE '%" + dto.EmployeeCode + "%') " + agentgenstr + "))";
                    //项目部通用申请查阅人和查看到你代理人的
                    string projgeneralSeeStr = " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_ProjGeneralApply WHERE toam.OfficeAutomation_Main_ID=OfficeAutomation_Document_ProjGeneralApply_MainID AND ((OfficeAutomation_Document_ProjGeneralApply_CanSeeEmployeeName LIKE '%" + dto.Employee + "%' AND OfficeAutomation_Document_ProjGeneralApply_CanSeeEmployeeID LIKE '%" + dto.EmployeeCode + "%') " + agentprojgenstr + "))";

                    ownselectstr = ownselectstr + " OR " + generalSeeStr + " OR " + projgeneralSeeStr;
           
                
                int allowFlag = 0;
                if ((!string.IsNullOrEmpty(dto.AllowIDS) && dto.AllowIDS.Length > 0) && (!string.IsNullOrEmpty(dto.NotAllowIDS) && dto.NotAllowIDS.Length > 0))
                    allowFlag = 1;
                else if (!string.IsNullOrEmpty(dto.AllowIDS) && dto.AllowIDS.Length > 0)
                    allowFlag = 2;

                switch (allowFlag)
                {
                    case 1:
                        where += " AND (" + ownselectstr + " OR " + allowstr + " OR " + noallowstr + " OR EXISTS (SELECT 1 FROM [t_OfficeAutomation_Document_SysReq] WHERE [OfficeAutomation_Document_SysReq_MainID]=toam.OfficeAutomation_Main_ID AND [OfficeAutomation_Document_SysReq_Follower] LIKE '%" + dto.Employee + "%')) ";
                        break;
                    case 2:
                        where += " AND (" + ownselectstr + " OR " + allowstr + " OR EXISTS (SELECT 1 FROM [t_OfficeAutomation_Document_SysReq] WHERE [OfficeAutomation_Document_SysReq_MainID]=toam.OfficeAutomation_Main_ID AND [OfficeAutomation_Document_SysReq_Follower] LIKE '%" + dto.Employee + "%')) ";
                        break;
                    default:
                        where += " AND (" + ownselectstr + " OR " + noallowstr + " OR EXISTS (SELECT 1 FROM [t_OfficeAutomation_Document_SysReq] WHERE [OfficeAutomation_Document_SysReq_MainID]=toam.OfficeAutomation_Main_ID AND [OfficeAutomation_Document_SysReq_Follower] LIKE '%" + dto.Employee + "%')) ";
                        break;
                }
            }
            else
            {
                where += " AND " + allowstr;
            }
            
            if (!string.IsNullOrEmpty(dto.Applicant))
            {
                where += " AND (toam.OfficeAutomation_Main_Creater='" + dto.Applicant + "' OR toam.OfficeAutomation_Main_Apply='" + dto.Applicant + "')";
            }
            if (!string.IsNullOrEmpty(dto.AppDepartment))
            {
                where += " AND toam.OfficeAutomation_Main_Department='" + dto.AppDepartment + "'";
            }
            if (dto.ApplyState > 0)
            {
                if (dto.ApplyState < 4 || dto.ApplyState == 8)
                {
                    //1:未审批,2:审批中,3:已完成、8:已过期
                    where += " AND toam.OfficeAutomation_Main_FlowStateID=" + dto.ApplyState.ToString();
                }
                else if (dto.ApplyState >= 4 && dto.ApplyState <= 6)
                {
                    //申请已同意(已完成、并且最后审核状态是（1:同意,0:不同意,2:其他意见）的申请)
                    int t = 0;
                    switch (dto.ApplyState)
                    {
                        case 4: t = 1; break;
                        case 5: t = 0; break;
                        case 6: t = 2; break;
                    }
                    str = "";
                    str = @" AND toam.OfficeAutomation_Main_FlowStateID=3 
                             AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM t_OfficeAutomation_Flow f WHERE f.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID ORDER BY f.OfficeAutomation_Flow_Idx DESC)=" + t.ToString();
                    where += str;
                }
                else if (dto.ApplyState == 7)
                {
                    //待我审批
                    where += " AND EXISTS (SELECT 1 FROM @waitfortb t WHERE t.MainID=toam.OfficeAutomation_Main_ID)";
                }
            }
            if (dto.ApplyType > 0)
            {
                if (dto.ApplyType == 8)
                {
                    where += " AND toam.OfficeAutomation_DocumentID IN (8,49) "; //个人利益申请有两个表

                    if(dto.InterestsType == "7")
                    {
                        where += " AND (EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_PersInterests WHERE OfficeAutomation_Document_PersInterests_MainID=toam.OfficeAutomation_Main_ID AND OfficeAutomation_Document_PersInterests_InterestsTypeID=1) OR ";
                        where += " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_NewPersInterests WHERE OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (1,7) AND OfficeAutomation_Document_NewPersInterests_MainID=toam.OfficeAutomation_Main_ID )) ";
                    }
                    else if (dto.InterestsType == "8")
                    {
                        where += " AND (EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_PersInterests WHERE OfficeAutomation_Document_PersInterests_MainID=toam.OfficeAutomation_Main_ID AND OfficeAutomation_Document_PersInterests_InterestsTypeID=4) OR ";
                        where += " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_NewPersInterests WHERE OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (4,8) AND OfficeAutomation_Document_NewPersInterests_MainID=toam.OfficeAutomation_Main_ID )) ";
                    }
                    else if (dto.InterestsType == "9")
                    {
                        where += " AND (EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_PersInterests WHERE OfficeAutomation_Document_PersInterests_MainID=toam.OfficeAutomation_Main_ID AND OfficeAutomation_Document_PersInterests_InterestsTypeID=2) OR ";
                        where += " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_NewPersInterests WHERE OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (2,3,9) AND OfficeAutomation_Document_NewPersInterests_MainID=toam.OfficeAutomation_Main_ID )) ";
                    }
                    else if (dto.InterestsType == "10")
                    {
                        where += " AND (EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_PersInterests WHERE OfficeAutomation_Document_PersInterests_MainID=toam.OfficeAutomation_Main_ID AND OfficeAutomation_Document_PersInterests_InterestsTypeID=10) OR ";
                        where += " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_NewPersInterests WHERE OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (5,10) AND OfficeAutomation_Document_NewPersInterests_MainID=toam.OfficeAutomation_Main_ID )) ";
                    }
                    else if (dto.InterestsType == "11")
                    {
                        where += " AND (EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_PersInterests WHERE OfficeAutomation_Document_PersInterests_MainID=toam.OfficeAutomation_Main_ID AND OfficeAutomation_Document_PersInterests_InterestsTypeID=11) OR ";
                        where += " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_NewPersInterests WHERE OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (6,11) AND OfficeAutomation_Document_NewPersInterests_MainID=toam.OfficeAutomation_Main_ID )) ";
                    }
                }
                else if (dto.ApplyType == 102)
                {
                    where += " AND toam.OfficeAutomation_DocumentID IN (13,102) "; //减让佣/现金奖申请表有两个表
                }
                else
                {
                    where += " AND toam.OfficeAutomation_DocumentID=" + dto.ApplyType.ToString();
                }
            }
            if (!string.IsNullOrEmpty(dto.SerialNumber))
            {
                where += " AND toam.OfficeAutomation_SerialNumber LIKE '" + dto.SerialNumber + "%'";
            }
            if (dto.BeginApplyTime.HasValue && dto.EndApplyTime.HasValue)
            {
                where += " AND toam.[OfficeAutomation_Main_ApplyDate] BETWEEN '" + dto.BeginApplyTime.Value.ToString("yyyy-MM-dd HH:mm:ss") + "' AND '" + dto.EndApplyTime.Value.ToString("yyyy-MM-dd HH:mm:ss") + "' ";
            }
            if(dto.IsGroups)
            {
                where += " AND toam.OfficeAutomation_Main_IsGroups =1";
            }
            //关键字搜索
            string keywordjoin = "";
            if (!string.IsNullOrEmpty(dto.KeyWord))
            {
                //20170809 SYSREQ201708031717197976508 需要开通全库关键字搜索权限
                KeyWordSearchSql r = new KeyWordSearchSql();
                if (dto.KeyWordAllTB)
                {
                    r = GetKeyWordSearchSql(dto.KeyWord);                   //全库相应表搜索关键字(效率低)
                }
                else
                {
                    r = GetKeyWordSearchSql(dto.ApplyType, dto.KeyWord);    //如关键字需关联好几个字段，请到这方法里面增加规则(效率高)
                }
                keywordjoin = r.joinsql;
                where += r.wheresql;
            }

            int flag = 0;   //审批人和审批时间都没有选择
            if (!string.IsNullOrEmpty(dto.Approver) && dto.AppTime.HasValue && dto.AppToTime.HasValue)
                flag = 1;   //填了审批人并且选择了审批时间
            else if (!string.IsNullOrEmpty(dto.Approver))
                flag = 2;   //填了审批人
            else if (dto.AppTime.HasValue && dto.AppToTime.HasValue)
                flag = 3;   //选择了审批时间
            str = "";
            switch (flag)
            {
                case 1 :
                    str = @" AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Flow WHERE 
                                toam.OfficeAutomation_Main_ID=OfficeAutomation_Flow_MainID 
                                AND OfficeAutomation_Flow_Employee LIKE '%{0}%' 
                                AND OfficeAutomation_Flow_AuditDate BETWEEN '{1}' AND '{2}' AND OfficeAutomation_Flow_Audit=1) ";
                    str = string.Format(str, dto.Approver, dto.AppTime.Value.ToString("yyyy-MM-dd"), dto.AppToTime.Value.ToString("yyyy-MM-dd"));
                    where += str;
                    break;
                case 2 : 
                    str = @" AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Flow WHERE 
                                toam.OfficeAutomation_Main_ID=OfficeAutomation_Flow_MainID 
                                AND OfficeAutomation_Flow_Employee LIKE '%{0}%' ) ";
                    str = string.Format(str, dto.Approver);
                    where += str;
                    break;
                case 3 :
                    str = @" AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Flow WHERE 
                                toam.OfficeAutomation_Main_ID=OfficeAutomation_Flow_MainID 
                                AND OfficeAutomation_Flow_AuditDate BETWEEN '{1}' AND '{2}' AND OfficeAutomation_Flow_Audit=1) ";
                    where += str;
                    break;
            }

            //待我审核，先预先查询出对应的MainID
            if (dto.ApplyState == 7)
            {
                string waitforsql =
@"DECLARE @waitfortb Table
(
 　MainID uniqueidentifier
)
INSERT INTO @waitfortb
SELECT OfficeAutomation_Flow_MainID FROM t_OfficeAutomation_Flow A WHERE EXISTS (
	SELECT 1 FROM (
		SELECT OfficeAutomation_Flow_MainID,MIN(f.OfficeAutomation_Flow_Idx) AS OfficeAutomation_Flow_Idx
		FROM t_OfficeAutomation_Flow f
		LEFT JOIN t_OfficeAutomation_Main m ON m.OfficeAutomation_Main_ID=f.OfficeAutomation_Flow_MainID
		WHERE f.OfficeAutomation_Flow_Audit=0 AND m.OfficeAutomation_Main_FlowStateID IN (1,2,3) AND m.OfficeAutomation_Main_IsDelete=0 AND m.OfficeAutomation_Main_WillDelete=0
		GROUP BY OfficeAutomation_Flow_MainID
	) AS B
WHERE A.OfficeAutomation_Flow_MainID= B.OfficeAutomation_Flow_MainID AND A.OfficeAutomation_Flow_Idx=B.OfficeAutomation_Flow_Idx 
) ";
                if (!string.IsNullOrEmpty(dto.Approver))
                {
                    //20170807 EMMA 以往有个操作，申请人+待我审批 搜索结果：待申请人审批的所有申请
                    waitforsql += " AND (A.OfficeAutomation_Flow_Employee LIKE '%{0}%'  AND (ISNULL(A.OfficeAutomation_Flow_Auditor,'') NOT LIKE '%{0}%')) ";
                    waitforsql = string.Format(waitforsql, dto.Approver);
                }
                else
                {
                    waitforsql += " AND ((A.OfficeAutomation_Flow_Employee LIKE '%{0}%' AND A.OfficeAutomation_Flow_EmployeeID LIKE '%{1}%' " + agentwaitforstr + " ) AND (ISNULL(A.OfficeAutomation_Flow_Auditor,'') NOT LIKE '%{0}%' AND ISNULL(A.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%{1}%')";
                  if(dto.Agents!=null)
                  {
                      foreach (var AgentDto in dto.Agents)
                      {
                          waitforsql += "  AND (ISNULL(A.OfficeAutomation_Flow_Auditor,'') NOT LIKE '%" + AgentDto.AgentEmpName + "%' AND ISNULL(A.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + AgentDto.AgentEmpID + "%') ";
                      }
                       //waitforsql +="  AND (ISNULL(A.OfficeAutomation_Flow_Auditor,'') NOT LIKE '%" + dto.Agents[0].AgentEmpName + "%' AND ISNULL(A.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + dto.Agents[0].AgentEmpID + "%') ";
                
                  }
                  waitforsql += ")";
                           waitforsql = string.Format(waitforsql, dto.Employee, dto.EmployeeCode);
                }
                    
                sql = waitforsql + 
@"
" + sql;
            }

            sql = sql + where + "{1}";

            sql = string.Format(sql, orderjoin, order, keywordjoin); //排序字符窜合并
            //sql = string.Format(sql, (dto.PageIndex * dto.PageSize).ToString(), (dto.PageSize * (dto.PageIndex + 1)).ToString());   //分页

            return RunSQL(sql);
        }

        /// <summary>
        /// 关键字搜索sql语句生成
        /// </summary>
        /// <param name="ApplyType">申请类型</param>
        /// <param name="KeyWord">关键字</param>
        /// <returns></returns>
        private KeyWordSearchSql GetKeyWordSearchSql(int ApplyType, string KeyWord)
        {
            if (ApplyType == 0 || string.IsNullOrEmpty(KeyWord))
                return null;
            KeyWordSearchSql result = new KeyWordSearchSql();

            result.joinsql = "";    //已废弃不用
            switch (ApplyType)
            {
                case 1:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_ITPower k WHERE k.OfficeAutomation_Document_ITPower_MainID=toam.OfficeAutomation_Main_ID AND (k.OfficeAutomation_Document_ITPower_ApplyReason LIKE '%" + KeyWord + "%' OR (SELECT OfficeAutomation_Document_ITPower_Detail_EmployeeID + '；' FROM t_OfficeAutomation_Document_ITPower_Detail WHERE OfficeAutomation_Document_ITPower_Detail_MainID = OfficeAutomation_Document_ITPower_ID FOR XML PATH('')) LIKE '%" + KeyWord + "%' ) ) ";
                    break;
                case 3:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_SysPower k WHERE k.OfficeAutomation_Document_SysPower_MainID=toam.OfficeAutomation_Main_ID AND (k.OfficeAutomation_Document_SysPower_ReqContent LIKE '%" + KeyWord + "%' OR (SELECT OfficeAutomation_Document_SysPower_Detail_EmployeeID + '；' FROM t_OfficeAutomation_Document_SysPower_Detail WHERE OfficeAutomation_Document_SysPower_Detail_MainID = k.OfficeAutomation_Document_SysPower_ID FOR XML PATH('')) LIKE '%" + KeyWord + "%' ) ) ";
                    break;
                case 4:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_Scrap k WHERE k.OfficeAutomation_Document_Scrap_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_Scrap_ReqReason LIKE '%" + KeyWord + "%' ) ";
                    break;
                case 5:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_AssetTransfer k WHERE k.OfficeAutomation_Document_AssetTransfer_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_AssetTransfer_TransferReason LIKE '%" + KeyWord + "%' ) ";
                    break;
                case 6:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_DealOffice k WHERE k.OfficeAutomation_Document_DealOffice_MainID=toam.OfficeAutomation_Main_ID AND (k.OfficeAutomation_Document_DealOffice_CrossAreaRemark LIKE '%" + KeyWord + "%' OR k.[OfficeAutomation_Document_DealOffice_MoneyRemark] LIKE '%" + KeyWord + "%')) ";
                    break;
                case 7:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_ITBuy k WHERE k.OfficeAutomation_Document_ITBuy_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_ITBuy_Reason LIKE '%" + KeyWord + "%' ) ";
                    break;
                case 8:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_PersInterests k WHERE k.OfficeAutomation_Document_PersInterests_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_PersInterests_ApplyDetail LIKE '%" + KeyWord + "%' ) ";
                    break;
                case 11:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_BackComm k WHERE k.OfficeAutomation_Document_BackComm_MainID=toam.OfficeAutomation_Main_ID AND (k.OfficeAutomation_Document_BackComm_Reason LIKE '%" + KeyWord + "%' OR OfficeAutomation_Document_BackComm_Measure LIKE '%" + KeyWord + "%' )) ";
                    break;
                //case 12:
                //    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_BadDebts k WHERE k.OfficeAutomation_Document_BadDebts_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_BadDebts_Reason] LIKE '%" + KeyWord + "%' or k.[OfficeAutomation_Document_BadDebts_Building] LIKE '%" + KeyWord + "%')) ";
                //    result.wheresql += " or EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_BadDebts k  inner join t_OfficeAutomation_Document_BadDebts_Detail d  on d.OfficeAutomation_Document_BadDebts_Detail_MainID = k.OfficeAutomation_Document_BadDebts_ID WHERE k.OfficeAutomation_Document_BadDebts_MainID=toam.OfficeAutomation_Main_ID  AND (d.OfficeAutomation_Document_BadDebts_Detail_ReportID ='" + KeyWord + "'))";
                //    break;
                case 12:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_BadDebts k WHERE k.OfficeAutomation_Document_BadDebts_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_BadDebts_Reason] LIKE '%"+KeyWord+"%' or k.[OfficeAutomation_Document_BadDebts_Building] LIKE '%"+KeyWord+"%' OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_BadDebts_Detail d  WHERE d.OfficeAutomation_Document_BadDebts_Detail_MainID = k.OfficeAutomation_Document_BadDebts_ID AND k.OfficeAutomation_Document_BadDebts_MainID=toam.OfficeAutomation_Main_ID  AND d.OfficeAutomation_Document_BadDebts_Detail_ReportID = '"+KeyWord+"' ))) ";
                    break;
                case 26:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_ChangeData k WHERE k.OfficeAutomation_Document_ChangeData_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_ChangeData_Reason] LIKE '%" + KeyWord + "%' or k.OfficeAutomation_Document_ChangeData_Remark LIKE '%" + KeyWord + "%')) ";
                    break;
                case 27:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_CommissionAdjust k WHERE k.OfficeAutomation_Document_CommissionAdjust_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_CommissionAdjust_Building] like '%" + KeyWord + "%' or k.OfficeAutomation_Document_CommissionAdjust_Remark like '%" + KeyWord + "%' or k.OfficeAutomation_Document_CommissionAdjust_AjustComm like '%" + KeyWord + "%')) ";
                    break;
                case 29:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_FurtherEducation k WHERE k.OfficeAutomation_Document_FurtherEducation_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_FurtherEducation_School LIKE '%" + KeyWord + "%') ";
                    break;
                case 31:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_OfficialSeal WHERE toam.OfficeAutomation_Main_ID=OfficeAutomation_Document_OfficialSeal_MainID AND OfficeAutomation_Document_OfficialSeal_SureData LIKE '%" + KeyWord + "%') OR toam.OfficeAutomation_Main_Summary LIKE '%" + KeyWord + "%' ";
                    break;
                case 41:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_NetSign k WHERE k.OfficeAutomation_Document_NetSign_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_NetSign_ApplyID] LIKE '%" + KeyWord + "%' or k.OfficeAutomation_Document_NetSign_BudingAddress LIKE '%" + KeyWord + "%')) ";
                    break;
                case 42:
                    result.wheresql = " AND (EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_CommissionOfMonth k WHERE k.OfficeAutomation_Document_CommissionOfMonth_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_CommissionOfMonth_Name LIKE '%" + KeyWord + "%') OR toam.OfficeAutomation_Main_Summary LIKE '%" + KeyWord + "%') ";
                    break;
                case 47:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_ChangeNS k WHERE k.OfficeAutomation_Document_ChangeNS_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_ChangeNS_ApplyID] LIKE '%" + KeyWord + "%' or k.OfficeAutomation_Document_ChangeNS_Location LIKE '%" + KeyWord + "%')) ";
                    break;
                case 55:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_Propaganda k WHERE k.OfficeAutomation_Document_Propaganda_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_Propaganda_BranchAddress like '%" + KeyWord + "%') ";
                    break;
                case 67:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_ProjBaComm k WHERE k.OfficeAutomation_Document_ProjBaComm_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_ProjBaComm_Building] LIKE '%" + KeyWord + "%' OR CONVERT(nvarchar(80),k.OfficeAutomation_Document_ProjBaComm_MoneyCount) LIKE '%" + KeyWord + "%')) ";
                    break;
                case 73:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_SolHold k WHERE k.OfficeAutomation_Document_SolHold_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_SolHold_Address] LIKE '%" + KeyWord + "%' OR k.[OfficeAutomation_Document_SolHold_ApplyID] LIKE '%" + KeyWord + "%' OR k.[OfficeAutomation_Document_SolHold_Money] = '" + KeyWord + "' )) ";
                    break;
                case 80:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_HousingFundChange k WHERE k.OfficeAutomation_Document_HousingFundChange_MainID=toam.OfficeAutomation_Main_ID AND k.[OfficeAutomation_Document_HousingFundChange_Remark] LIKE '%" + KeyWord + "%') ";
                    break;
                case 84:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_HousingFundAdjustment k WHERE k.OfficeAutomation_Document_HousingFundAdjustment_MainID=toam.OfficeAutomation_Main_ID AND k.[OfficeAutomation_Document_HousingFundAdjustment_Apply] LIKE '%" + KeyWord + "%') ";
                    break;
                case 85:
                    result.wheresql = " AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_Loan k WHERE k.OfficeAutomation_Document_Loan_MainID=toam.OfficeAutomation_Main_ID AND k.[OfficeAutomation_Document_Loan_Apply] LIKE '%" + KeyWord + "%') ";
                    break;
                default:
                    result.wheresql = " AND toam.OfficeAutomation_Main_Summary LIKE '%" + KeyWord + "%'";
                    break;
            }
            return result;
        }

        /// <summary>
        /// 关键字搜索sql语句生成(所有表关键字搜索)
        /// </summary>
        /// <param name="KeyWord">关键字</param>
        /// <returns></returns>
        private KeyWordSearchSql GetKeyWordSearchSql(string KeyWord)
        {
            KeyWordSearchSql result = new KeyWordSearchSql();
            result.joinsql = "";
            result.wheresql = " AND (toam.OfficeAutomation_Main_Summary LIKE '%" + KeyWord + "%' ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_ITPower k WHERE k.OfficeAutomation_Document_ITPower_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_ITPower_ApplyReason LIKE '%" + KeyWord + "%' ) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_SysPower k WHERE k.OfficeAutomation_Document_SysPower_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_SysPower_ReqContent LIKE '%" + KeyWord + "%' ) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_Scrap k WHERE k.OfficeAutomation_Document_Scrap_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_Scrap_ReqReason LIKE '%" + KeyWord + "%' ) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_AssetTransfer k WHERE k.OfficeAutomation_Document_AssetTransfer_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_AssetTransfer_TransferReason LIKE '%" + KeyWord + "%' ) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_DealOffice k WHERE k.OfficeAutomation_Document_DealOffice_MainID=toam.OfficeAutomation_Main_ID AND (k.OfficeAutomation_Document_DealOffice_CrossAreaRemark LIKE '%" + KeyWord + "%' OR k.[OfficeAutomation_Document_DealOffice_MoneyRemark] LIKE '%" + KeyWord + "%')) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_ITBuy k WHERE k.OfficeAutomation_Document_ITBuy_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_ITBuy_Reason LIKE '%" + KeyWord + "%' ) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_PersInterests k WHERE k.OfficeAutomation_Document_PersInterests_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_PersInterests_ApplyDetail LIKE '%" + KeyWord + "%' ) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_BackComm k WHERE k.OfficeAutomation_Document_BackComm_MainID=toam.OfficeAutomation_Main_ID AND (k.OfficeAutomation_Document_BackComm_Reason LIKE '%" + KeyWord + "%' OR OfficeAutomation_Document_BackComm_Measure LIKE '%" + KeyWord + "%' )) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_BadDebts k WHERE k.OfficeAutomation_Document_BadDebts_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_BadDebts_Reason] LIKE '%" + KeyWord + "%' or k.[OfficeAutomation_Document_BadDebts_Building] LIKE '%" + KeyWord + "%')) ";
           // result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_BadDebts k WHERE k.OfficeAutomation_Document_BadDebts_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_BadDebts_Reason] LIKE '%" + KeyWord + "%' or k.[OfficeAutomation_Document_BadDebts_Building] LIKE '%" + KeyWord + "%' OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_BadDebts_Detail d  WHERE d.OfficeAutomation_Document_BadDebts_Detail_MainID = k.OfficeAutomation_Document_BadDebts_ID AND k.OfficeAutomation_Document_BadDebts_MainID=toam.OfficeAutomation_Main_ID  AND d.OfficeAutomation_Document_BadDebts_Detail_ReportID = '" + KeyWord + "' ))) ";   
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_ChangeData k WHERE k.OfficeAutomation_Document_ChangeData_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_ChangeData_Reason] LIKE '%" + KeyWord + "%' or k.OfficeAutomation_Document_ChangeData_Remark LIKE '%" + KeyWord + "%')) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_CommissionAdjust k WHERE k.OfficeAutomation_Document_CommissionAdjust_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_CommissionAdjust_Building] like '%" + KeyWord + "%' or k.OfficeAutomation_Document_CommissionAdjust_Remark like '%" + KeyWord + "%' or k.OfficeAutomation_Document_CommissionAdjust_AjustComm like '%" + KeyWord + "%')) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_FurtherEducation k WHERE k.OfficeAutomation_Document_FurtherEducation_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_FurtherEducation_School LIKE '%" + KeyWord + "%') ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_OfficialSeal k WHERE toam.OfficeAutomation_Main_ID=k.OfficeAutomation_Document_OfficialSeal_MainID AND k.OfficeAutomation_Document_OfficialSeal_SureData LIKE '%" + KeyWord + "%') ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_NetSign k WHERE k.OfficeAutomation_Document_NetSign_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_NetSign_ApplyID] LIKE '%" + KeyWord + "%' or k.OfficeAutomation_Document_NetSign_BudingAddress LIKE '%" + KeyWord + "%')) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_CommissionOfMonth k WHERE k.OfficeAutomation_Document_CommissionOfMonth_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_CommissionOfMonth_Name LIKE '%" + KeyWord + "%') ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_ChangeNS k WHERE k.OfficeAutomation_Document_ChangeNS_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_ChangeNS_ApplyID] LIKE '%" + KeyWord + "%' or k.OfficeAutomation_Document_ChangeNS_Location LIKE '%" + KeyWord + "%')) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_Propaganda k WHERE k.OfficeAutomation_Document_Propaganda_MainID=toam.OfficeAutomation_Main_ID AND k.OfficeAutomation_Document_Propaganda_BranchAddress LIKE '%" + KeyWord + "%') ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_ProjBaComm k WHERE k.OfficeAutomation_Document_ProjBaComm_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_ProjBaComm_Building] LIKE '%" + KeyWord + "%' OR CONVERT(nvarchar(80),k.OfficeAutomation_Document_ProjBaComm_MoneyCount) LIKE '%" + KeyWord + "%')) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_SolHold k WHERE k.OfficeAutomation_Document_SolHold_MainID=toam.OfficeAutomation_Main_ID AND (k.[OfficeAutomation_Document_SolHold_Address] LIKE '%" + KeyWord + "%' OR k.[OfficeAutomation_Document_SolHold_ApplyID] LIKE '%" + KeyWord + "%' OR k.[OfficeAutomation_Document_SolHold_Money] = '" + KeyWord + "' )) ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_HousingFundChange k WHERE k.OfficeAutomation_Document_HousingFundChange_MainID=toam.OfficeAutomation_Main_ID AND k.[OfficeAutomation_Document_HousingFundChange_Remark] LIKE '%" + KeyWord + "%') ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_HousingFundAdjustment k WHERE k.OfficeAutomation_Document_HousingFundAdjustment_MainID=toam.OfficeAutomation_Main_ID AND k.[OfficeAutomation_Document_HousingFundAdjustment_Apply] LIKE '%" + KeyWord + "%') ";
            result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_Loan k WHERE k.OfficeAutomation_Document_Loan_MainID=toam.OfficeAutomation_Main_ID AND k.[OfficeAutomation_Document_Loan_Apply] LIKE '%" + KeyWord + "%')";
        //    result.wheresql += " OR EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_BadDebts k inner join t_OfficeAutomation_Document_BadDebts_Detail d on d.OfficeAutomation_Document_BadDebts_Detail_MainID = k.OfficeAutomation_Document_BadDebts_ID WHERE k.OfficeAutomation_Document_BadDebts_MainID=toam.OfficeAutomation_Main_ID AND (d.OfficeAutomation_Document_BadDebts_Detail_ReportID ='" + KeyWord + "')) ";
            result.wheresql += ")";
            return result;
        }

        /// <summary>
        /// 排序sql语句生成
        /// </summary>
        /// <param name="ordertype">排序类型</param>
        /// <returns></returns>
        private OrderSql GetOrderSql(int ordertype)
        {
            if(ordertype == 0)
                return null;
            OrderSql order = new OrderSql();
            if (ordertype == 1)
            {
                //按申请日期排序
                order.ordersql = " ORDER BY toam.[OfficeAutomation_Main_ApplyDate] DESC ";
                order.joinsql = "";
            }
            else if (ordertype == 2)
            {
                //按最后审核日期
                order.ordersql = " ORDER BY CC.[OfficeAutomation_Flow_AuditDate] DESC";
                order.joinsql =
@"
LEFT JOIN
(
SELECT FORDER.OfficeAutomation_Flow_MainID,FORDER.OfficeAutomation_Flow_AuditDate FROM t_OfficeAutomation_Flow FORDER WHERE EXISTS (
	SELECT 1 FROM (
		SELECT OfficeAutomation_Flow_MainID,MAX(f.OfficeAutomation_Flow_Idx) AS OfficeAutomation_Flow_Idx
		FROM t_OfficeAutomation_Flow f
		LEFT JOIN t_OfficeAutomation_Main m ON m.OfficeAutomation_Main_ID=f.OfficeAutomation_Flow_MainID
		WHERE f.OfficeAutomation_Flow_Audit=1 AND m.OfficeAutomation_Main_FlowStateID IN (2,3) AND m.OfficeAutomation_Main_IsDelete=0
		GROUP BY OfficeAutomation_Flow_MainID
	) AS BB
WHERE FORDER.OfficeAutomation_Flow_MainID= BB.OfficeAutomation_Flow_MainID AND FORDER.OfficeAutomation_Flow_Idx=BB.OfficeAutomation_Flow_Idx)
) AS CC ON CC.OfficeAutomation_Flow_MainID=toam.[OfficeAutomation_Main_ID]
";
            }
            return order;
        }

        /// <summary>
        /// 代理人sql语句生成
        /// </summary>
        /// <param name="agents"></param>
        /// <returns></returns>
        private AgentSql GetAgentSql(List<DataEntity.DTO.AgentDto> agents)
        {
            if (agents == null || agents.Count == 0)
                return null;
            AgentSql result = new AgentSql();
            foreach (var i in agents)
            {
                result.agentstr += " OR toam.OfficeAutomation_Main_Creater='" + i.AgentEmpName + "' OR toam.OfficeAutomation_Main_Apply='" + i.AgentEmpName + "' ";
                result.agentgenstr += " OR (OfficeAutomation_Document_GeneralApply_CanSeeEmployeeName LIKE '%" + i.AgentEmpName + "%' AND OfficeAutomation_Document_GeneralApply_CanSeeEmployeeID LIKE '%" + i.AgentEmpID + "%') ";
                result.agentprojgenstr += " OR (OfficeAutomation_Document_ProjGeneralApply_CanSeeEmployeeName LIKE '%" + i.AgentEmpName + "%' AND OfficeAutomation_Document_ProjGeneralApply_CanSeeEmployeeID LIKE '%" + i.AgentEmpID + "%') ";
                result.agentAuthor += " OR (f.OfficeAutomation_Flow_Employee LIKE '%" + i.AgentEmpName + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + i.AgentEmpID + "%') ";
                result.agentwaitforstr += " OR (A.OfficeAutomation_Flow_Employee LIKE '%" + i.AgentEmpName + "%' AND A.OfficeAutomation_Flow_EmployeeID LIKE '%" + i.AgentEmpID + "%') ";
                
            }
            return result;
        }

        /// <summary>
        /// 法律部查询
        /// </summary>
        /// <param name="islawer">是否法律部</param>
        /// <param name="isAdmin">是否管理员</param>
        /// <param name="applicationDepartment">申请部门</param>
        /// <param name="applicant">申请人</param>
        /// <param name="begin">申请开始时间</param>
        /// <param name="end">申请结束时间</param>
        /// <param name="applyType">文档类型</param>
        /// <param name="state">审核状态</param>
        /// <param name="employee">搜索人姓名</param>
        /// <param name="code">搜索人工号</param>
        /// <param name="purview">权限字符窜</param>
        /// <param name="serialNumber">文档编码</param>
        /// <param name="keyWord">关键字</param>
        /// <param name="ctype">排序类型1：按最后申请日期排序；2：按最后审批时间排序</param>
        /// <param name="cstatue"></param>
        /// <param name="approver">审核人</param>
        /// <param name="apptime">审核开始时间</param>
        /// <param name="apptotime">审核结束时间</param>
        /// <param name="willDelete">是否即将删除</param>
        /// <param name="intereststype">申报类别（待定）</param>
        /// <returns></returns>
        public DataSet Search_Lawer(DataEntity.DTO.SearchFilterDto dto)
        {
            //if (!string.IsNullOrEmpty(dto.KeyWord) && dto.ApplyType == 0)
            //{ throw new Exception("若要进行关键字查询，必须选择申请类型"); }

            //代理人sql
            string agentstr = "";       //代理人申请查询sql
            string agentgenstr = "";    //通用申请代理人的查阅者查询sql
            string agentprojgenstr = ""; //项目部通用申请代理人的查阅者查询sql
            string agentAuthor = "";    //审核人代理人的审核查询sql
            string agentwaitforstr = "";    //待我审批中代理人查询的sql

            if (dto.Agents != null && dto.Agents.Count > 0)
            {
                var a = GetAgentSql(dto.Agents);    //获取代理人相关sql
                agentstr = a.agentstr;
                agentgenstr = a.agentgenstr;
                agentAuthor = a.agentAuthor;
                agentwaitforstr = a.agentwaitforstr;
                agentprojgenstr = a.agentprojgenstr;
            }

            //排序 sql
            string order = "";
            string orderjoin = "";
            var o = GetOrderSql(dto.OrderType);
            order = o.ordersql;
            orderjoin = o.joinsql;

            //主查询
            string sql =
@"SELECT
    '00000000-0000-0000-0000-000000000000' AS ID,
    toam.[OfficeAutomation_Main_ID] AS MainID,
    '00000000-0000-0000-0000-000000000000' AS DepartmentID,
    toam.[OfficeAutomation_Main_Department] AS Department,
    toam.[OfficeAutomation_Main_Apply] AS Apply,
    toam.[OfficeAutomation_Main_ApplyDate] AS ApplyDate,
    toam.[OfficeAutomation_SerialNumber],
    toam.[OfficeAutomation_Main_FlowStateID],
    [dbo].FindWaitfor(toam.OfficeAutomation_Main_ID) AS [waitfor],
    D.OfficeAutomation_Document_Name,
    CASE WHEN OfficeAutomation_Document_ID=7 THEN (ISNULL(toam.OfficeAutomation_Main_Summary,'') + ' ' + (CASE WHEN ISNULL([OfficeAutomation_Main_Sremark],'')!='' THEN '√' ELSE '' END))
    ELSE (ISNULL(toam.OfficeAutomation_Main_Sremark,'') +'  '+ISNULL(toam.OfficeAutomation_Main_Summary,'') ) END AS Remark
FROM t_OfficeAutomation_Main toam
LEFT JOIN t_Dic_OfficeAutomation_Document D ON D.OfficeAutomation_Document_ID=toam.[OfficeAutomation_DocumentID]
{0}
{2}
";

            string where = " WHERE toam.OfficeAutomation_Main_IsDelete=0 AND OfficeAutomation_DocumentID != 31 AND OfficeAutomation_DocumentID !=97";
            if (dto.WillDelete)
            {
                where += " AND toam.OfficeAutomation_Main_WillDelete=1 AND EXISTS (SELECT 1 FROM t_OfficeAutomation_DeletedFlow WHERE OfficeAutomation_DeletedFlow_MainID = toam.OfficeAutomation_Main_ID AND OfficeAutomation_DeletedFlow_Auditor LIKE '%" + dto.Employee + "%' AND OfficeAutomation_DeletedFlow_AuditorID LIKE '%" + dto.EmployeeCode + "%' AND t_OfficeAutomation_DeletedFlow.OfficeAutomation_DeletedFlow_IsAgree in(1,2))";
            }

            string str = dto.AllowIDS.TrimEnd(',');
            string allowstr = "toam.OfficeAutomation_DocumentID IN (" + str + ")";

            str = dto.NotAllowIDS.TrimEnd(',');
            string noallowstr = "EXISTS (SELECT 1 FROM [t_OfficeAutomation_Flow] f WHERE ((f.OfficeAutomation_Flow_Employee LIKE '%" + dto.Employee + "%' AND f.OfficeAutomation_Flow_EmployeeID LIKE '%" + dto.EmployeeCode + "%') " + agentAuthor + ") AND f.OfficeAutomation_Flow_MainID=toam.OfficeAutomation_Main_ID AND toam.OfficeAutomation_DocumentID IN (" + str + ")) ";

            if (!dto.IsAdmin)
            {
                //看到自己上的申请和看到你代理的人申请
                string ownselectstr = "toam.OfficeAutomation_Main_Creater='" + dto.Employee + "' OR toam.OfficeAutomation_Main_Apply='" + dto.Employee + "' " + agentstr;

                //通用申请查阅人和查看到你代理人的
                string generalSeeStr = " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_GeneralApply WHERE toam.OfficeAutomation_Main_ID=OfficeAutomation_Document_GeneralApply_MainID AND ((OfficeAutomation_Document_GeneralApply_CanSeeEmployeeName LIKE '%" + dto.Employee + "%' AND OfficeAutomation_Document_GeneralApply_CanSeeEmployeeID LIKE '%" + dto.EmployeeCode + "%') " + agentgenstr + "))";
                //项目部通用申请查阅人和查看到你代理人的
                string projgeneralSeeStr = " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_ProjGeneralApply WHERE toam.OfficeAutomation_Main_ID=OfficeAutomation_Document_ProjGeneralApply_MainID AND ((OfficeAutomation_Document_ProjGeneralApply_CanSeeEmployeeName LIKE '%" + dto.Employee + "%' AND OfficeAutomation_Document_ProjGeneralApply_CanSeeEmployeeID LIKE '%" + dto.EmployeeCode + "%') " + agentprojgenstr + "))";

                ownselectstr = ownselectstr + " OR " + generalSeeStr + " OR " + projgeneralSeeStr;


                int allowFlag = 0;
                if ((!string.IsNullOrEmpty(dto.AllowIDS) && dto.AllowIDS.Length > 0) && (!string.IsNullOrEmpty(dto.NotAllowIDS) && dto.NotAllowIDS.Length > 0))
                    allowFlag = 1;
                else if (!string.IsNullOrEmpty(dto.AllowIDS) && dto.AllowIDS.Length > 0)
                    allowFlag = 2;

                switch (allowFlag)
                {
                    case 1:
                        where += " AND (" + ownselectstr + " OR " + allowstr + " OR " + noallowstr + " OR EXISTS (SELECT 1 FROM [t_OfficeAutomation_Document_SysReq] WHERE [OfficeAutomation_Document_SysReq_MainID]=toam.OfficeAutomation_Main_ID AND [OfficeAutomation_Document_SysReq_Follower] LIKE '%" + dto.Employee + "%')) ";
                        break;
                    case 2:
                        where += " AND (" + ownselectstr + " OR " + allowstr + " OR EXISTS (SELECT 1 FROM [t_OfficeAutomation_Document_SysReq] WHERE [OfficeAutomation_Document_SysReq_MainID]=toam.OfficeAutomation_Main_ID AND [OfficeAutomation_Document_SysReq_Follower] LIKE '%" + dto.Employee + "%')) ";
                        break;
                    default:
                        where += " AND (" + ownselectstr + " OR " + noallowstr + " OR EXISTS (SELECT 1 FROM [t_OfficeAutomation_Document_SysReq] WHERE [OfficeAutomation_Document_SysReq_MainID]=toam.OfficeAutomation_Main_ID AND [OfficeAutomation_Document_SysReq_Follower] LIKE '%" + dto.Employee + "%')) ";
                        break;
                }
            }
            else
            {
                where += " AND " + allowstr;
            }

            if (!string.IsNullOrEmpty(dto.Applicant))
            {
                where += " AND (toam.OfficeAutomation_Main_Creater='" + dto.Applicant + "' OR toam.OfficeAutomation_Main_Apply='" + dto.Applicant + "')";
            }
            if (!string.IsNullOrEmpty(dto.AppDepartment))
            {
                where += " AND toam.OfficeAutomation_Main_Department='" + dto.AppDepartment + "'";
            }
            if (dto.ApplyState > 0)
            {
                if (dto.ApplyState < 4 || dto.ApplyState == 8)
                {
                    //1:未审批,2:审批中,3:已完成、8:已过期
                    where += " AND toam.OfficeAutomation_Main_FlowStateID=" + dto.ApplyState.ToString();
                }
                else if (dto.ApplyState >= 4 && dto.ApplyState <= 6)
                {
                    //申请已同意(已完成、并且最后审核状态是（1:同意,0:不同意,2:其他意见）的申请)
                    int t = 0;
                    switch (dto.ApplyState)
                    {
                        case 4: t = 1; break;
                        case 5: t = 0; break;
                        case 6: t = 2; break;
                    }
                    str = "";
                    str = @" AND toam.OfficeAutomation_Main_FlowStateID=3 
                             AND (SELECT TOP 1 f.OfficeAutomation_Flow_IsAgree FROM t_OfficeAutomation_Flow f WHERE f.OfficeAutomation_Flow_MainID = toam.OfficeAutomation_Main_ID ORDER BY f.OfficeAutomation_Flow_Idx DESC)=" + t.ToString();
                    where += str;
                }
                else if (dto.ApplyState == 7)
                {
                    //待我审批
                    where += " AND EXISTS (SELECT 1 FROM @waitfortb t WHERE t.MainID=toam.OfficeAutomation_Main_ID)";
                }
            }
            if (dto.ApplyType > 0)
            {
                if (dto.ApplyType == 8)
                {
                    where += " AND toam.OfficeAutomation_DocumentID IN (8,49) "; //个人利益申请有两个表

                    if (dto.InterestsType == "7")
                    {
                        where += " AND (EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_PersInterests WHERE OfficeAutomation_Document_PersInterests_MainID=toam.OfficeAutomation_Main_ID AND OfficeAutomation_Document_PersInterests_InterestsTypeID=1) OR ";
                        where += " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_NewPersInterests WHERE OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (1,7) AND OfficeAutomation_Document_NewPersInterests_MainID=toam.OfficeAutomation_Main_ID )) ";
                    }
                    else if (dto.InterestsType == "8")
                    {
                        where += " AND (EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_PersInterests WHERE OfficeAutomation_Document_PersInterests_MainID=toam.OfficeAutomation_Main_ID AND OfficeAutomation_Document_PersInterests_InterestsTypeID=4) OR ";
                        where += " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_NewPersInterests WHERE OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (4,8) AND OfficeAutomation_Document_NewPersInterests_MainID=toam.OfficeAutomation_Main_ID )) ";
                    }
                    else if (dto.InterestsType == "9")
                    {
                        where += " AND (EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_PersInterests WHERE OfficeAutomation_Document_PersInterests_MainID=toam.OfficeAutomation_Main_ID AND OfficeAutomation_Document_PersInterests_InterestsTypeID=2) OR ";
                        where += " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_NewPersInterests WHERE OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (2,3,9) AND OfficeAutomation_Document_NewPersInterests_MainID=toam.OfficeAutomation_Main_ID )) ";
                    }
                    else if (dto.InterestsType == "10")
                    {
                        where += " AND (EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_PersInterests WHERE OfficeAutomation_Document_PersInterests_MainID=toam.OfficeAutomation_Main_ID AND OfficeAutomation_Document_PersInterests_InterestsTypeID=10) OR ";
                        where += " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_NewPersInterests WHERE OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (5,10) AND OfficeAutomation_Document_NewPersInterests_MainID=toam.OfficeAutomation_Main_ID )) ";
                    }
                    else if (dto.InterestsType == "11")
                    {
                        where += " AND (EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_PersInterests WHERE OfficeAutomation_Document_PersInterests_MainID=toam.OfficeAutomation_Main_ID AND OfficeAutomation_Document_PersInterests_InterestsTypeID=11) OR ";
                        where += " EXISTS (SELECT 1 FROM t_OfficeAutomation_Document_NewPersInterests WHERE OfficeAutomation_Document_NewPersInterests_InterestsTypeID in (6,11) AND OfficeAutomation_Document_NewPersInterests_MainID=toam.OfficeAutomation_Main_ID )) ";
                    }
                }
                else
                {
                    where += " AND toam.OfficeAutomation_DocumentID=" + dto.ApplyType.ToString();
                }
            }
            if (!string.IsNullOrEmpty(dto.SerialNumber))
            {
                where += " AND toam.OfficeAutomation_SerialNumber LIKE '" + dto.SerialNumber + "%'";
            }
            if (dto.BeginApplyTime.HasValue && dto.EndApplyTime.HasValue)
            {
                where += " AND toam.[OfficeAutomation_Main_ApplyDate] BETWEEN '" + dto.BeginApplyTime.Value.ToString("yyyy-MM-dd HH:mm:ss") + "' AND '" + dto.EndApplyTime.Value.ToString("yyyy-MM-dd HH:mm:ss") + "' ";
            }
            if (dto.IsGroups)
            {
                where += " AND toam.OfficeAutomation_Main_IsGroups =1";
            }
            //关键字搜索
            string keywordjoin = "";
            if (!string.IsNullOrEmpty(dto.KeyWord))
            {
                //20170809 SYSREQ201708031717197976508 需要开通全库关键字搜索权限
                KeyWordSearchSql r = new KeyWordSearchSql();
                if (dto.KeyWordAllTB)
                {
                    r = GetKeyWordSearchSql(dto.KeyWord);                   //全库相应表搜索关键字(效率低)
                }
                else
                {
                    r = GetKeyWordSearchSql(dto.ApplyType, dto.KeyWord);    //如关键字需关联好几个字段，请到这方法里面增加规则(效率高)
                }
                keywordjoin = r.joinsql;
                where += r.wheresql;
            }

            int flag = 0;   //审批人和审批时间都没有选择
            if (!string.IsNullOrEmpty(dto.Approver) && dto.AppTime.HasValue && dto.AppToTime.HasValue)
                flag = 1;   //填了审批人并且选择了审批时间
            else if (!string.IsNullOrEmpty(dto.Approver))
                flag = 2;   //填了审批人
            else if (dto.AppTime.HasValue && dto.AppToTime.HasValue)
                flag = 3;   //选择了审批时间
            str = "";
            switch (flag)
            {
                case 1:
                    str = @" AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Flow WHERE 
                                toam.OfficeAutomation_Main_ID=OfficeAutomation_Flow_MainID 
                                AND OfficeAutomation_Flow_Employee LIKE '%{0}%' 
                                AND OfficeAutomation_Flow_AuditDate BETWEEN '{1}' AND '{2}' AND OfficeAutomation_Flow_Audit=1) ";
                    str = string.Format(str, dto.Approver, dto.AppTime.Value.ToString("yyyy-MM-dd"), dto.AppToTime.Value.ToString("yyyy-MM-dd"));
                    where += str;
                    break;
                case 2:
                    str = @" AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Flow WHERE 
                                toam.OfficeAutomation_Main_ID=OfficeAutomation_Flow_MainID 
                                AND OfficeAutomation_Flow_Employee LIKE '%{0}%' ) ";
                    str = string.Format(str, dto.Approver);
                    where += str;
                    break;
                case 3:
                    str = @" AND EXISTS (SELECT 1 FROM t_OfficeAutomation_Flow WHERE 
                                toam.OfficeAutomation_Main_ID=OfficeAutomation_Flow_MainID 
                                AND OfficeAutomation_Flow_AuditDate BETWEEN '{1}' AND '{2}' AND OfficeAutomation_Flow_Audit=1) ";
                    where += str;
                    break;
            }

            //待我审核，先预先查询出对应的MainID
            if (dto.ApplyState == 7)
            {
                string waitforsql =
@"DECLARE @waitfortb Table
(
 　MainID uniqueidentifier
)
INSERT INTO @waitfortb
SELECT OfficeAutomation_Flow_MainID FROM t_OfficeAutomation_Flow A WHERE EXISTS (
	SELECT 1 FROM (
		SELECT OfficeAutomation_Flow_MainID,MIN(f.OfficeAutomation_Flow_Idx) AS OfficeAutomation_Flow_Idx
		FROM t_OfficeAutomation_Flow f
		LEFT JOIN t_OfficeAutomation_Main m ON m.OfficeAutomation_Main_ID=f.OfficeAutomation_Flow_MainID
		WHERE f.OfficeAutomation_Flow_Audit=0 AND m.OfficeAutomation_Main_FlowStateID IN (1,2,3) AND m.OfficeAutomation_Main_IsDelete=0 AND m.OfficeAutomation_Main_WillDelete=0
		GROUP BY OfficeAutomation_Flow_MainID
	) AS B
WHERE A.OfficeAutomation_Flow_MainID= B.OfficeAutomation_Flow_MainID AND A.OfficeAutomation_Flow_Idx=B.OfficeAutomation_Flow_Idx 
) ";
                if (!string.IsNullOrEmpty(dto.Approver))
                {
                    //20170807 EMMA 以往有个操作，申请人+待我审批 搜索结果：待申请人审批的所有申请
                    waitforsql += " AND (A.OfficeAutomation_Flow_Employee LIKE '%{0}%'  AND (ISNULL(A.OfficeAutomation_Flow_Auditor,'') NOT LIKE '%{0}%')) ";
                    waitforsql = string.Format(waitforsql, dto.Approver);
                }
                else
                {
                    waitforsql += " AND ((A.OfficeAutomation_Flow_Employee LIKE '%{0}%' AND A.OfficeAutomation_Flow_EmployeeID LIKE '%{1}%' " + agentwaitforstr + " ) AND (ISNULL(A.OfficeAutomation_Flow_Auditor,'') NOT LIKE '%{0}%' AND ISNULL(A.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%{1}%')";
                    if (dto.Agents != null)
                    {
                        waitforsql += "  AND (ISNULL(A.OfficeAutomation_Flow_Auditor,'') NOT LIKE '%" + dto.Agents[0].AgentEmpName + "%' AND ISNULL(A.OfficeAutomation_Flow_AuditorID,'') NOT LIKE '%" + dto.Agents[0].AgentEmpID + "%') ";

                    }
                    waitforsql += ")";
                    waitforsql = string.Format(waitforsql, dto.Employee, dto.EmployeeCode);
                }

                sql = waitforsql +
@"
" + sql;
            }

            sql = sql + where + "{1}";

            sql = string.Format(sql, orderjoin, order, keywordjoin); //排序字符窜合并
            //sql = string.Format(sql, (dto.PageIndex * dto.PageSize).ToString(), (dto.PageSize * (dto.PageIndex + 1)).ToString());   //分页

            return RunSQL(sql);
        }
    }
}

/// <summary>
/// 关键字搜索返回类
/// </summary>
public class KeyWordSearchSql
{
    public string joinsql { get; set; }
    public string wheresql { get; set; }
}

/// <summary>
/// 排序sql返回类
/// </summary>
public class OrderSql 
{
    public string joinsql { get; set; }
    public string ordersql { get; set; }
}

/// <summary>
/// 代理人sql返回类型
/// </summary>
public class AgentSql
{
    /// <summary>
    /// 代理人申请查询sql
    /// </summary>
    public string agentstr {get;set;}

    /// <summary>
    /// 通用申请代理人的查阅者查询sql
    /// </summary>
    public string agentgenstr { get; set; }

    /// <summary>
    /// 审核人代理人的审核查询sql
    /// </summary>
    public string agentAuthor { get; set; }

    /// <summary>
    /// 待我审批中代理人查询的sql
    /// </summary>
    public string agentwaitforstr { get; set; }

    /// <summary>
    /// 项目部通用申请代理人的查阅者查询sql
    /// </summary>
    public string agentprojgenstr { get; set; }
}
